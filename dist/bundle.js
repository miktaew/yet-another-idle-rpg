"use strict";(()=>{var bc=Object.defineProperty;var vc=(e,t,i)=>t in e?bc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Nn=(e,t,i)=>vc(e,typeof t!="symbol"?t+"":t,i);function ya(e){this.year=e.year,this.month=e.month,this.day=e.day,this.hour=e.hour,this.minute=e.minute,this.day_count=e.day_count??1,this.goUp=function(t){if(this.minute+=t??1,this.minute>=60){let i=this.minute%60,n=Math.floor(this.minute/60);this.minute=i,this.hour+=n}if(this.hour>=24){let i=this.hour%24,n=Math.floor((this.hour-1)/24)+1;this.hour=i,this.day+=n,this.day_count+=n}if(this.day>30){let i=(this.day-1)%30+1,n=Math.floor((this.day-1)/30)+1;this.day=i+1,this.month+=n}if(this.month>12){let i=(this.month-1)%12+1,n=Math.floor((this.month-1)/12)+1;this.month=i+1,this.year+=n}},this.goUp(0),this.loadTime=function(t){this.year=t.year,this.month=t.month,this.day=t.day,this.hour=t.hour,this.minute=t.minute,this.day_count=t.day_count},this.getSeason=function(t){let i;return t?i=this.month+Math.floor((this.day+t)/30):i=this.month,i>9?Ei[3]:i>6?Ei[2]:i>3?Ei[1]:Ei[0]},this.getTimeOfDay=function(){return this.hour>=21||this.hour<4?"Night":this.hour>=4&&this.hour<8?"Dawn":this.hour>=8&&this.hour<18?"Day":"Dusk"},this.getTimeOfDaySimple=function(){return this.hour>=21||this.hour<4?"Night":"Day"},this.getDayOfTheWeek=function(){switch(this.day_count%7){case 0:return"Sun";case 1:return"Mon";case 2:return"Tue";case 3:return"Wed";case 4:return"Thu";case 5:return"Fri";case 6:return"Sat"}}}ya.prototype.toString=function(){let e=(this.day>9?this.day:`0${this.day}`)+"/";return e+=(this.month>9?this.month:`0${this.month}`)+"/",e+=this.year+" ",e+=(this.hour>9?this.hour:`0${this.hour}`)+":",e+=(this.minute>9?this.minute:`0${this.minute}`)+", ",e+=this.getSeason()+", "+this.getDayOfTheWeek(),e};function yt({time:e,long_names:t,round:i=!0}){if(!e)throw"No time passed in arguments!";i&&(e.minutes>=60&&(e.hours=e.hours+Math.floor(e.minutes/60)||Math.floor(e.minutes/60),e.minutes=e.minutes%60),e.hours>=24&&(e.days=e.days+Math.floor(e.hours/24)||Math.floor(e.hours/24),e.hours=e.hours%24),e.days>30&&(e.months=e.months+Math.floor(e.days/30)||Math.floor(e.days/30),e.days=e.days%30),e.months>12&&(e.years=e.years+Math.floor(e.months/12)||Math.floor(e.months/12),e.months=e.months%12));let n="";return e.years>0&&(n+=t?`${e.year} years `:`${e.year}Y`),e.months>0&&(n+=t?`${e.months} months `:`${e.months}M`),e.days>0&&(n+=t?`${e.days} days `:`${e.days}D`),e.hours>0&&(n+=t?`${e.hours} hours `:`${e.hours}h`),e.minutes>0&&(n+=t?`${Math.round(e.minutes)} minutes `:`${e.minutes}m`),n}function Si(e){return e=e||M,e.hour>=20||e.hour<4}var Ei=["Spring","Summer","Autumn","Winter"],M=new ya({year:999,month:4,day:1,hour:8,minute:0,day_count:1});var We={strength:"str",health:"hp",max_health:"hp",health_regeneration_flat:"hp regen",health_regeneration_percent:"hp % regen",health_loss_flat:"hp loss",health_loss_percent:"hp % loss",stamina_regeneration_flat:"stam regen",stamina_regeneration_percent:"stam % regen",max_stamina:"stamina",agility:"agl",dexterity:"dex",magic:"magic",attack_speed:"attack speed",attack_power:"attack power",crit_rate:"crit rate",crit_multiplier:"crit dmg",stamina_efficiency:"stamina efficiency",intuition:"int",block_strength:"shield strength",hit_chance:"hit chance",evasion:"EP",evasion_points:"EP",attack_points:"AP",heat_tolerance:"heat resistance",cold_tolerance:"cold resistance",unarmed_power:"unarmed base dmg",armor_penetration:"armor pen",defense:"defense"},Vo={kill:"kill",kill_any:"kill",clear:"clear"},Li={Medicine:"medicine",Gluttony:"food"},Qo={medicine:"Medicine"};function Qt(e,t=3){let i=1e6;return e==0?0:e>=i||e<.01?Number.parseFloat(e).toExponential(t).replace(/[+-]/g,""):e>10?Math.round(e).toLocaleString():e>1?(Math.round(e*10)/10).toLocaleString():(Math.round(e*100)/100).toLocaleString()}function Oe(e){return e>19999?Math.ceil(e/1e3)*1e3:e>1999?Math.ceil(e/100)*100:e>199?Math.ceil(e/10)*10:Math.ceil(e)}function Ti(e){return e>=120?`${Math.floor(e/60)} hours`:e>=60?"1 hour":`${Math.round(e)} minutes`}function Pn(e){let t="",i=Math.floor(e/60),n=e%60;return i>0&&(i>1?t+=i+" hours":t+=i+" hour"),n>0&&(i>0&&(t+=" "),n>1?t+=n+" minutes":t+=n+" minute"),t}function rn(e,t){let i=e/(e+t);return i>=.8?i=.971+(i-.8)**1.4:i>=.7?i=.846+(i-.7)**.9:i>=.6?i=.688+(i-.6)**.8:i>=.5?i=.53+(i-.5)**.8:i>=.4?i=.331+(i-.4)**.7:i>=.3?i=.173+(i-.3)**.8:i>=.2?i=.073+(i-.2):i>=.1?i=.01+(i-.1)**1.2:i=0,i}function jn(e,t){let i=e.replace("v","").split("."),n=t.replace("v","").split(".");i.length>n.length?n.push(...Array(i.length-n.length).fill("0")):n.length>i.length&&i.push(...Array(n.length-i.length).fill("0"));for(let s=0;s<i.length;s++){let a;if(Number.parseInt(i[s])&&Number.parseInt(n[s])?a=[Number.parseInt(i[s]),Number.parseInt(n[s])]:a=[i[s]||0,n[s]||0],a[0]!==a[1])return a[0]>a[1]?1:-1}return 0}function Et(e,t){return jn(e,t)<0}function Wn(e){return 32+e*9/5}var Y={},$e="type_",Ae={Village:["Slums"]},cn=500,kc=cn-1,xc=Math.round(cn/9),un=200,qc=un-1,Mc=Math.round(un/9);Object.keys(Ae).forEach(e=>{Y[e]={};for(let t=0;t<Ae[e].length;t++)Ae[Ae[e][t]]?Ae[Ae[e][t]].includes(e)||Ae[Ae[e][t]].push(e):Ae[Ae[e][t]]=[e]});function wa(e){Object.keys(e).forEach(t=>{Y[t]=e[t]})}function Uo(e=1,t=0){Object.keys(Y).forEach(i=>{for(let n=0;n<Y[i].length;n++)Y[i][n].recovered+=Math.max(t*(Y[i][n].sold-Y[i][n].recovered),e),Y[i][n].recovered>Y[i][n].sold&&(Y[i][n].recovered=Y[i][n].sold)})}function Ko(e){let t={};Object.keys(Ae).forEach(i=>{let n=Ae[i].length;for(let s=0;s<n;s++){let a=Ae[i][s];t[a]=t[a]||{},t[i]=t[i]||{},Object.keys(Y[i]||{}).forEach(o=>{t[a][o]=t[a][o]||[],t[i][o]=t[i][o]||[];for(let r=0;r<Y[i][o].length;r++){let d=Y[i][o][r].sold-Y[i][o][r].recovered,c=Math.floor(d*e);Y[i][o][r].sold-=c;let _=Math.floor(c/n);t[i][o][r]||(t[i][o][r]={...Y[i][o][r]}),t[a][o][r]||(Y[a]?.[o]?.[r]?t[a][o][r]={...Y[a][o][r]}:t[a][o][r]={sold:0,recovered:0}),t[a][o][r].sold+=_}})}}),wa(t)}function ws({is_group:e,value:t,how_many_sold:i}){let n=1,s,a;return e?(s=qc,a=Mc):(s=kc,a=xc),i>=s?n=.1:i>0&&(n=n*a/(a+i)),Math.round(t*n)/t}function bs({region:e,group_key:t,group_tier:i}){if(!Y[e][t])return 0;let n=[];for(let a=0;a<Y[e][t]?.length;a++)n[a]=Y[e][t][a].sold-Y[e][t][a].recovered;let s=t.startsWith($e)?un:cn;return dn({sold_by_tier:n,target_tier:i,cap:s})}function dn({sold_by_tier:e,target_tier:t,cap:i}){if(!e)return 0;let n=0;for(let s=t-1;s>=0;s--)n+=Math.max(e[s]??0)*.25**(t-s);n=Math.min(i/2,n),n+=e[t]??0;for(let s=t+1;s<e.length;s++)n+=Math.max(e[s]??0);return n}function Jo({value:e,start_count:t,how_many_to_trade:i,is_group:n,is_selling:s=!0,stop_multiplier_at:a}){let o=0;if(s)for(let r=t;r<t+i;r++)o+=ws({value:e,how_many_sold:Math.min(t+a,r),is_group:n});else for(let r=t;r>t-i;r--)o+=ws({value:e,how_many_sold:Math.min(t+a,Math.max(r,0)),is_group:n});return o}function Xo({base_value:e,group_key:t,group_tier:i,region:n}){let s=bs({region:n,group_key:t,group_tier:i});return Math.max(1,Oe(Math.ceil(e*ws({value:e,how_many_sold:s,is_group:t.startsWith($e)}))))}function Zo({group_key:e,group_tier:t,count:i,region:n}){Y[n][e]||(Y[n][e]=new Array(t+1).fill({sold:0,recovered:0})),Y[n][e][t]||Y[n][e].push(...new Array(t+1-Y[n][e].length).fill({sold:0,recovered:0})),Y[n][e][t].sold+=i||1}function el({group_key:e,group_tier:t,count:i,region:n}){!Y[n][e]||!Y[n][e][t]||(Y[n][e][t].sold=Math.max(Y[n][e][t].sold-(i||1),0),Y[n][e][t].recovered=Math.min(Y[n][e][t].recovered,Y[n][e][t].sold))}var _i=class{constructor(){this.inventory={}}add_to_inventory(t){let i=!1;for(let n=0;n<t.length;n++){let s;if(t[n].item_key)s=t[n].item_key;else{let a;t[n].quality?a=de({...u[t[n].item_id],quality:t[n].quality}):a=de({...u[t[n].item_id]}),s=a.getInventoryKey()}if(s in this.inventory)if(t[n].count===void 0)this.inventory[s].count+=1;else if(typeof t[n].count=="number"&&!isNaN(t[n].count))this.inventory[s].count+=t[n].count;else throw new TypeError(`Tried to add "${t[n].count}" items, which is not a valid number!`);else{t[n].count||(t[n].count=1);let a=ye(s);this.inventory[s]={item:a,count:t[n].count},i=!0}}return i}remove_from_inventory(t){for(let i=0;i<t.length;i++)if(t[i].item_key in this.inventory){if(typeof t[i].item_count=="number"&&Number.isInteger(t[i].item_count)&&t[i].item_count>=1?this.inventory[t[i].item_key].count-=t[i].item_count:this.inventory[t[i].item_key].count-=1,this.inventory[t[i].item_key].count==0)delete this.inventory[t[i].item_key];else if(this.inventory[t[i].item_key].count<0||isNaN(this.inventory[t[i].item_key].count))throw new Error(`Item count for key "${t[i].item_key}" reached an illegal value of "${this.inventory[t[i].item_key].count}"`)}else throw new Error("Tried to remove item that was not present in inventory")}};var K={items:{},components:{},equipment:{}},Ut={items:{}},_n={items:{}},Fe={items:{},components:{}},Ii={items:{}},Re={items:{}},Kt={items:{},components:{}};function mi(e){return{components:Math.min(Math.round(100+2*R(e)),200),equipment:Math.min(Math.round(100+2.8*R(e)),250)}}var ba=class{constructor({name:t,id:i,is_unlocked:n=!0,recipe_type:s,result:a,getResult:o,recipe_level:r=[1,1],recipe_skill:d}){this.name=t,this.id=i||t,this.is_unlocked=n,this.recipe_type=s,this.result=a,this.getResult=o||function(){return this.result},this.recipe_level=r,this.recipe_skill=d}},O=class extends ba{constructor({name:t,id:i,materials:n=[],is_unlocked:s=!0,recipe_type:a,result:o,getResult:r,recipe_level:d,recipe_skill:c,success_chance:_=[1,1]}){super({name:t,id:i,is_unlocked:s,recipe_type:a,result:o,getResult:r,recipe_level:d,recipe_skill:c}),this.materials=n,this.success_chance=_,this.success_chance[0]==0&&(this.success_chance[0]=.1)}get_success_chance(t=1){let i=Math.min(this.recipe_level[1]-this.recipe_level[0]+1,Math.max(0,R(this.recipe_skill)-this.recipe_level[0]+1)),n=Math.min(1,(i+(t-1))/(this.recipe_level[1]-this.recipe_level[0]+1));return this.success_chance[0]*(this.success_chance[1]/this.success_chance[0])**n}get_availability(){let t=1/0,i=[];for(let n=0;n<this.materials.length;n++)if(this.materials[n].material_id){let s=u[this.materials[n].material_id].getInventoryKey();if(!l.inventory[s])return 0;t=Math.floor(Math.min(l.inventory[s].count/this.materials[n].count,t))}else if(this.materials[n].material_type){let s=[];if(Object.keys(l.inventory).forEach(a=>{l.inventory[a].item.material_type===this.materials[n].material_type&&l.inventory[a].count>=this.materials[n].count&&s.push(l.inventory[a])}),s.length==0)return 0;s=s.sort((a,o)=>a.item.getBaseValue()-o.item.getBaseValue()),t=Math.floor(Math.min(s[0].count/this.materials[n].count,t)),i.push(s[0].item.id)}return{available_ammount:t,materials:i}}},J=class extends O{constructor({name:t,id:i,materials:n=[],is_unlocked:s=!0,result:a,component_type:o,recipe_skill:r,item_type:d}){super({name:t,id:i,materials:n,is_unlocked:s,recipe_type:"component",result:a,recipe_level:[1,1],recipe_skill:r,getResult:null,success_rate:[1,1]}),this.component_type=o,this.item_type=d,this.getResult=function(c,_=1){let h=u[this.materials.filter(y=>y.material_id===c.id)[0].result_id],f=this.get_quality(_-h.component_tier||0);if(h.tags.clothing)return new Q({...u[h.id],quality:f});if(h.tags["armor component"])return new ae({...u[h.id],quality:f});if(h.tags["weapon component"])return new V({...u[h.id],quality:f});if(h.tags["shield component"])return new Qe({...u[h.id],quality:f});throw new Error(`Component recipe ${this.name} does not produce a valid result!`)}}get_quality_range(t=0){let i=p[this.recipe_skill],n=(130+(3*R(this.recipe_skill)-i.max_level)+15*t)/100;return[Math.max(10,Math.min(this.get_quality_cap(),Math.round(25*(n-.15))*4)),Math.max(10,Math.min(this.get_quality_cap(),Math.round(25*(n+.1))*4))]}get_quality_cap(){return this.item_type==="Armor"?mi(this.recipe_skill).equipment:mi(this.recipe_skill).components}get_is_quality_capped(){return this.get_quality_range()[0]>=this.get_quality_cap()}get_quality(t=0){let i=this.get_quality_range(t);return Math.round(((i[1]-i[0])*Math.random()+i[0])/4)*4}},vs=class extends O{constructor({name:t,id:i,materials:n=[],is_unlocked:s=!0,result:a,recipe_skill:o,item_type:r}){super({name:t,id:i,materials:n,is_unlocked:s,recipe_type:"componentless",result:a,recipe_level:[1,1],recipe_skill:o,getResult:null,success_rate:[1,1]}),this.item_type=r,this.getResult=function(d,c=1){let _=u[this.materials.filter(f=>f.material_id===d.id)[0].result_id],h=this.get_quality(c-_.item_tier||0);return new Bt({...u[_.id],quality:h})}}get_quality_range(t=0){let i=p[this.recipe_skill],n=(130+(3*R(this.recipe_skill)-i.max_level)+15*t)/100;return[Math.max(10,Math.min(this.get_quality_cap(),Math.round(25*(n-.15))*4)),Math.max(10,Math.min(this.get_quality_cap(),Math.round(25*(n+.1))*4))]}get_quality_cap(){return mi(this.recipe_skill).equipment}get_is_quality_capped(){return this.get_quality_range()[0]>=this.get_quality_cap()}get_quality(t=0){let i=this.get_quality_range(t);return Math.round(((i[1]-i[0])*Math.random()+i[0])/4)*4}},lt=class extends ba{constructor({name:t,id:i,components:n=[],is_unlocked:s=!0,result:a=null,recipe_skill:o="Crafting",item_type:r}){super({name:t,id:i,is_unlocked:s,recipe_type:"equipment",result:a,getResult:null,recipe_level:[1,1],recipe_skill:o,success_rate:[1,1]}),this.components=n,this.item_type=r,this.getResult=function(d,c,_=1){let h=this.get_component_quality_weighted(d,c),f=this.get_quality(h,_-Math.max(d.component_tier,c.component_tier)||0);if(this.item_type==="Weapon")return new pe({components:{head:d.id,handle:c.id},quality:f});if(this.item_type==="Armor")return new Q({components:{internal:d.id,external:c.id},quality:f});if(this.item_type==="Shield")return new nt({components:{shield_base:d.id,handle:c.id},quality:f});throw new Error(`Recipe "${this.name}" has an incorrect item_type provided ("${this.item_type}")`)}}get_quality_range(t,i=0){let n=p[this.recipe_skill],s=50+t+(3*R(this.recipe_skill)-n.max_level)+10*i;return[Math.max(10,Math.min(this.get_quality_cap(),Math.round(s-15))),Math.max(10,Math.min(this.get_quality_cap(),Math.round(s+15)))]}get_quality_cap(){return mi(this.recipe_skill).equipment}get_quality(t,i=0){let n=this.get_quality_range(t,i);return Math.round(((n[1]-n[0])*Math.random()+n[0])/2)*2}get_component_quality_weighted(t,i){return(t.quality*t.component_tier+i.quality*i.component_tier)/(t.component_tier+i.component_tier)}};function wt({category:e,subcategory:t,recipe_id:i,material_count:n,result_tier:s,selected_components:a,rarity_multiplier:o}){if(!e||!t||!i)throw new Error(`Tried to use a recipe but either category, subcategory, or recipe id was not passed: ${e} - ${t} - ${i}`);let r=4,d=G[e][t][i],c=p[d.recipe_skill].current_level;if(!d)throw new Error(`Tried to use a recipe that doesn't exist: ${e} -> ${t} -> ${i}`);if(t==="items")r=Math.max(r,1.5*d.recipe_level[1])**1.1,d.recipe_level[1]<c&&(r=Math.max(1,r*Math.max(0,Math.min(5,d.recipe_level[1]+6-c)/5)));else if(t==="components"||d.recipe_type==="component"||d.recipe_type==="componentless"){let _=8*s;r=Math.max(r**1.2,(s*4)**1.1*n),_>c*o**.5?r=Math.max(.5*n,r*o):r=Math.max(.5*n,r*o*Math.max(0,Math.min(5,_*o**.5+5-c))/5)}else{let _=8*Math.max(a[0].component_tier,a[1].component_tier);r=Math.max(r,(a[0].component_tier+a[1].component_tier)*4)**1.1,_>c*o**.5?r=Math.max(1,r*o):r=Math.max(1,r*o*Math.max(0,Math.min(5,_*o**.5+5-c))/5)}return Math.round(10*r)/10}Fe.components["Short blade"]=new J({name:"Short blade",materials:[{material_id:"Low quality iron ingot",count:2,result_id:"Cheap short iron blade"},{material_id:"Iron ingot",count:2,result_id:"Short iron blade"},{material_id:"Steel ingot",count:2,result_id:"Short steel blade"}],item_type:"Component",recipe_skill:"Forging"}),Fe.components["Long blade"]=new J({name:"Long blade",materials:[{material_id:"Low quality iron ingot",count:3,result_id:"Cheap long iron blade"},{material_id:"Iron ingot",count:3,result_id:"Long iron blade"},{material_id:"Steel ingot",count:3,result_id:"Long steel blade"}],item_type:"Component",recipe_skill:"Forging"}),Fe.components["Axe head"]=new J({name:"Axe head",materials:[{material_id:"Low quality iron ingot",count:4,result_id:"Cheap iron axe head"},{material_id:"Iron ingot",count:4,result_id:"Iron axe head"},{material_id:"Steel ingot",count:4,result_id:"Steel axe head"}],item_type:"Component",recipe_skill:"Forging"}),Fe.components["Hammer head"]=new J({name:"Hammer head",materials:[{material_id:"Low quality iron ingot",count:4,result_id:"Cheap iron hammer head"},{material_id:"Iron ingot",count:4,result_id:"Iron hammer head"},{material_id:"Steel ingot",count:4,result_id:"Steel hammer head"}],item_type:"Component",recipe_skill:"Forging"}),Fe.components["Short hilt"]=new J({name:"Short hilt",materials:[{material_id:"Low quality iron ingot",count:1,result_id:"Cheap short iron hilt"},{material_id:"Iron ingot",count:1,result_id:"Short iron hilt"},{material_id:"Steel ingot",count:1,result_id:"Short steel hilt"}],item_type:"Component",recipe_skill:"Forging"}),Fe.components["Medium handle"]=new J({name:"Medium handle",materials:[{material_id:"Low quality iron ingot",count:2,result_id:"Cheap medium iron handle"},{material_id:"Iron ingot",count:2,result_id:"Medium iron handle"},{material_id:"Steel ingot",count:2,result_id:"Medium steel handle"}],item_type:"Component",recipe_skill:"Forging"}),Fe.components["Long shaft"]=new J({name:"Long shaft",materials:[{material_id:"Low quality iron ingot",count:4,result_id:"Cheap long iron shaft"},{material_id:"Iron ingot",count:4,result_id:"Long iron shaft"},{material_id:"Steel ingot",count:4,result_id:"Long steel shaft"}],item_type:"Component",recipe_skill:"Forging"}),K.components["Short hilt"]=new J({name:"Short hilt",materials:[{material_id:"Processed weak monster bone",count:1,result_id:"Short weak bone hilt"}],item_type:"Component",recipe_skill:"Crafting"}),K.components["Medium handle"]=new J({name:"Medium handle",materials:[{material_id:"Processed weak monster bone",count:2,result_id:"Medium weak bone handle"}],item_type:"Component",recipe_skill:"Crafting"}),K.components["Long shaft"]=new J({name:"Long shaft",materials:[{material_id:"Processed weak monster bone",count:4,result_id:"Long weak bone shaft"}],item_type:"Component",recipe_skill:"Crafting"}),Kt.components["Short hilt"]=new J({name:"Short hilt",materials:[{material_id:"Processed rough wood",count:1,result_id:"Simple short wooden hilt"},{material_id:"Processed wood",count:1,result_id:"Short wooden hilt"},{material_id:"Processed ash wood",count:1,result_id:"Short ash wood hilt"}],item_type:"Component",recipe_skill:"Woodworking"}),Kt.components["Medium handle"]=new J({name:"Medium handle",materials:[{material_id:"Processed rough wood",count:2,result_id:"Simple medium wooden handle"},{material_id:"Processed wood",count:2,result_id:"Medium wooden handle"},{material_id:"Processed ash wood",count:2,result_id:"Medium ash wood handle"}],item_type:"Component",recipe_skill:"Woodworking"}),Kt.components["Long shaft"]=new J({name:"Long shaft",materials:[{material_id:"Processed rough wood",count:4,result_id:"Simple long wooden shaft"},{material_id:"Processed wood",count:4,result_id:"Long wooden shaft"},{material_id:"Processed ash wood",count:4,result_id:"Long ash wood shaft"}],item_type:"Component",recipe_skill:"Woodworking"});Kt.components["Shield base"]=new J({name:"Shield base",materials:[{material_id:"Processed rough wood",count:6,result_id:"Crude wooden shield base"},{material_id:"Processed wood",count:6,result_id:"Wooden shield base"},{material_id:"Processed ash wood",count:6,result_id:"Ash wood shield base"}],item_type:"Component",recipe_skill:"Woodworking",component_type:"shield base"}),Kt.components["Shield handle"]=new J({name:"Shield handle",materials:[{material_id:"Processed rough wood",count:4,result_id:"Basic shield handle"},{material_id:"Processed wood",count:4,result_id:"Wooden shield handle"},{material_id:"Processed ash wood",count:4,result_id:"Ash wood shield handle"}],item_type:"Component",recipe_skill:"Woodworking",component_type:"shield handle"}),Fe.components["Shield base"]=new J({name:"Shield base",materials:[{material_id:"Low quality iron ingot",count:5,result_id:"Crude iron shield base"},{material_id:"Iron ingot",count:5,result_id:"Iron shield base"},{material_id:"Steel ingot",count:5,result_id:"Steel shield base"}],item_type:"Component",recipe_skill:"Forging",component_type:"shield base"});K.components["Helmet exterior"]=new J({name:"Helmet exterior",materials:[{material_id:"Piece of wolf leather",count:3,result_id:"Wolf leather helmet armor"},{material_id:"Piece of boar leather",count:3,result_id:"Boar leather helmet armor"},{material_id:"Piece of bear leather",count:3,result_id:"Bear leather helmet armor"}],item_type:"Component",recipe_skill:"Crafting",component_type:"helmet exterior"}),Fe.components["Helmet exterior"]=new J({name:"Helmet exterior",materials:[{material_id:"Iron chainmail",count:3,result_id:"Iron chainmail helmet armor"},{material_id:"Steel chainmail",count:3,result_id:"Steel chainmail helmet armor"}],item_type:"Component",recipe_skill:"Forging",component_type:"helmet exterior"}),K.components["Chestplate exterior"]=new J({name:"Chestplate exterior",materials:[{material_id:"Piece of wolf leather",count:5,result_id:"Wolf leather chestplate armor"},{material_id:"Piece of boar leather",count:5,result_id:"Boar leather chestplate armor"},{material_id:"Piece of bear leather",count:5,result_id:"Bear leather chestplate armor"}],item_type:"Component",recipe_skill:"Crafting",component_type:"chestplate exterior"}),Fe.components["Chestplate exterior"]=new J({name:"Chestplate exterior",materials:[{material_id:"Iron chainmail",count:5,result_id:"Iron chainmail vest"},{material_id:"Steel chainmail",count:5,result_id:"Steel chainmail vest"}],item_type:"Component",recipe_skill:"Forging",component_type:"chestplate exterior"}),K.components["Leg armor exterior"]=new J({name:"Leg armor exterior",materials:[{material_id:"Piece of wolf leather",count:4,result_id:"Wolf leather greaves"},{material_id:"Piece of boar leather",count:4,result_id:"Boar leather greaves"},{material_id:"Piece of bear leather",count:4,result_id:"Bear leather greaves"}],item_type:"Component",recipe_skill:"Crafting",component_type:"leg armor exterior"}),Fe.components["Leg armor exterior"]=new J({name:"Leg armor exterior",materials:[{material_id:"Iron chainmail",count:4,result_id:"Iron chainmail greaves"},{material_id:"Steel chainmail",count:4,result_id:"Steel chainmail greaves"}],item_type:"Component",recipe_skill:"Forging",component_type:"leg armor exterior"}),K.components["Glove exterior"]=new J({name:"Glove exterior",materials:[{material_id:"Piece of wolf leather",count:3,result_id:"Wolf leather glove armor"},{material_id:"Piece of boar leather",count:3,result_id:"Boar leather glove armor"},{material_id:"Piece of bear leather",count:3,result_id:"Bear leather glove armor"}],item_type:"Component",recipe_skill:"Crafting",component_type:"glove exterior"}),Fe.components["Glove exterior"]=new J({name:"Glove exterior",materials:[{material_id:"Iron chainmail",count:3,result_id:"Iron chainmail glove"},{material_id:"Steel chainmail",count:3,result_id:"Steel chainmail glove"}],item_type:"Component",recipe_skill:"Forging",component_type:"Glove exterior"}),K.components["Shoes exterior"]=new J({name:"Shoes exterior",materials:[{material_id:"Piece of wolf leather",count:3,result_id:"Wolf leather shoe armor"},{material_id:"Piece of boar leather",count:3,result_id:"Boar leather shoe armor"},{material_id:"Piece of bear leather",count:3,result_id:"Bear leather shoe armor"}],item_type:"Component",recipe_skill:"Crafting",component_type:"shoes exterior"}),Fe.components["Shoes exterior"]=new J({name:"Shoes exterior",materials:[{material_id:"Iron chainmail",count:3,result_id:"Iron chainmail shoes"},{material_id:"Steel chainmail",count:3,result_id:"Steel chainmail shoes"}],item_type:"Component",recipe_skill:"Forging",component_type:"shoes exterior"});K.equipment.Axe=new lt({name:"Axe",components:["axe head","medium handle"],item_type:"Weapon"}),K.equipment.Dagger=new lt({name:"Dagger",components:["short blade","short handle"],item_type:"Weapon"}),K.equipment.Hammer=new lt({name:"Hammer",components:["hammer head","medium handle"],item_type:"Weapon"}),K.equipment.Spear=new lt({name:"Spear",components:["short blade","long handle"],item_type:"Weapon"}),K.equipment.Sword=new lt({name:"Sword",components:["long blade","short handle"],item_type:"Weapon"}),K.equipment.Shield=new lt({name:"Shield",components:["shield base","shield handle"],item_type:"Shield"}),K.equipment.Helmet=new lt({name:"Helmet",components:["helmet interior","helmet exterior"],item_type:"Armor"}),K.equipment.Chestplate=new lt({name:"Chestplate",components:["chestplate interior","chestplate exterior"],item_type:"Armor"}),K.equipment["Leg armor"]=new lt({name:"Leg armor",components:["leg armor interior","leg armor exterior"],item_type:"Armor"}),K.equipment.Gauntlets=new lt({name:"Gauntlets",components:["glove interior","glove exterior"],item_type:"Armor"}),K.equipment["Armored shoes"]=new lt({name:"Armored shoes",components:["shoes interior","shoes exterior"],item_type:"Armor"});K.equipment.Hat=new J({name:"Hat",materials:[{material_id:"Piece of wolf leather",count:3,result_id:"Leather hat"},{material_id:"Wool cloth",count:3,result_id:"Wool hat"},{material_id:"Piece of goat leather",count:3,result_id:"Goat leather hat"}],item_type:"Armor",component_type:"helmet interior",recipe_skill:"Crafting"}),K.equipment.Shirt=new J({name:"Shirt",materials:[{material_id:"Piece of wolf rat leather",count:5,result_id:"Cheap leather vest"},{material_id:"Piece of wolf leather",count:5,result_id:"Leather vest"},{material_id:"Wool cloth",count:5,result_id:"Wool shirt"},{material_id:"Piece of goat leather",count:5,result_id:"Goat leather vest"}],item_type:"Armor",component_type:"chestplate interior",recipe_skill:"Crafting"}),K.equipment.Pants=new J({name:"Pants",materials:[{material_id:"Piece of wolf rat leather",count:3,result_id:"Cheap leather pants"},{material_id:"Piece of wolf leather",count:3,result_id:"Leather pants"},{material_id:"Wool cloth",count:3,result_id:"Wool pants"},{material_id:"Piece of goat leather",count:3,result_id:"Goat leather pants"}],item_type:"Armor",component_type:"leg armor interior",recipe_skill:"Crafting"}),K.equipment.Gloves=new J({name:"Gloves",materials:[{material_id:"Piece of wolf leather",count:2,result_id:"Leather gloves"},{material_id:"Wool cloth",count:2,result_id:"Wool gloves"},{material_id:"Piece of goat leather",count:2,result_id:"Goat leather gloves"}],item_type:"Armor",component_type:"glove interior",recipe_skill:"Crafting"}),K.equipment.Shoes=new J({name:"Shoes",materials:[{material_id:"Piece of wolf rat leather",count:2,result_id:"Cheap leather shoes"},{material_id:"Piece of wolf leather",count:2,result_id:"Leather shoes"},{material_id:"Piece of goat leather",count:2,result_id:"Goat leather shoes"}],item_type:"Armor",component_type:"shoes interior",recipe_skill:"Crafting"});K.equipment.Cape=new vs({name:"Cape",materials:[{material_id:"Processed rat pelt",count:12,result_id:"Rat pelt cape"},{material_id:"Processed wolf pelt",count:8,result_id:"Wolf pelt cape"},{material_id:"Processed boar hide",count:8,result_id:"Boar hide cape"},{material_id:"Processed goat hide",count:8,result_id:"Goat hide cape"}],item_type:"Cape",recipe_skill:"Crafting"});(function(){Re.items["Piece of wolf rat leather"]=new O({name:"Piece of wolf rat leather",recipe_type:"material",materials:[{material_id:"Rat pelt",count:6}],result:{result_id:"Piece of wolf rat leather",count:1},success_chance:[.4,1],recipe_level:[1,5],recipe_skill:"Butchering"}),Re.items["Piece of wolf leather"]=new O({name:"Piece of wolf leather",recipe_type:"material",materials:[{material_id:"Wolf pelt",count:6}],result:{result_id:"Piece of wolf leather",count:1},success_chance:[.2,1],recipe_skill:"Butchering",recipe_level:[1,10]}),Re.items["Piece of boar leather"]=new O({name:"Piece of boar leather",recipe_type:"material",materials:[{material_id:"Boar hide",count:6}],result:{result_id:"Piece of boar leather",count:1},success_chance:[.2,1],recipe_skill:"Butchering",recipe_level:[5,15]}),Re.items["Piece of goat leather"]=new O({name:"Piece of goat leather",recipe_type:"material",materials:[{material_id:"Mountain goat hide",count:6}],result:{result_id:"Piece of goat leather",count:1},success_chance:[.2,1],recipe_skill:"Butchering",recipe_level:[5,15]}),Re.items["Piece of bear leather"]=new O({name:"Piece of bear leather",recipe_type:"material",materials:[{material_id:"Bear hide",count:6}],result:{result_id:"Piece of bear leather",count:1},success_chance:[.2,1],recipe_skill:"Butchering",recipe_level:[12,25]}),Re.items["Processed rat pelt"]=new O({name:"Processed rat pelt",recipe_type:"material",materials:[{material_id:"Rat pelt",count:6}],result:{result_id:"Processed rat pelt",count:1},success_chance:[.4,1],recipe_level:[1,5],recipe_skill:"Butchering"}),Re.items["Processed wolf pelt"]=new O({name:"Processed wolf pelt",recipe_type:"material",materials:[{material_id:"Wolf pelt",count:6}],result:{result_id:"Processed wolf pelt",count:1},success_chance:[.2,1],recipe_level:[1,10],recipe_skill:"Butchering"}),Re.items["Processed boar hide"]=new O({name:"Processed boar hide",recipe_type:"material",materials:[{material_id:"Boar hide",count:6}],result:{result_id:"Processed boar hide",count:1},success_chance:[.2,1],recipe_level:[5,15],recipe_skill:"Butchering"}),Re.items["Processed goat hide"]=new O({name:"Processed goat hide",recipe_type:"material",materials:[{material_id:"Mountain goat hide",count:6}],result:{result_id:"Processed goat hide",count:1},success_chance:[.2,1],recipe_level:[5,15],recipe_skill:"Butchering"}),Re.items["Processed bear hide"]=new O({name:"Processed bear hide",recipe_type:"material",materials:[{material_id:"Bear hide",count:6}],result:{result_id:"Processed bear hide",count:1},success_chance:[.2,1],recipe_level:[12,25],recipe_skill:"Butchering"}),K.items["Wool cloth"]=new O({name:"Wool cloth",recipe_type:"material",materials:[{material_id:"Wool",count:5}],result:{result_id:"Wool cloth",count:1},success_chance:[.1,1],recipe_skill:"Crafting",recipe_level:[5,15]}),K.items["Glass phial"]=new O({name:"Glass phial",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Raw Glass",count:1}],result:{result_id:"Glass phial",count:1},success_chance:[.1,1],recipe_level:[15,25],recipe_skill:"Crafting"}),K.items["Glass bottle"]=new O({name:"Glass bottle",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Raw Glass",count:3}],result:{result_id:"Glass bottle",count:1},success_chance:[.1,1],recipe_level:[15,25],recipe_skill:"Crafting"}),Fe.items["Iron chainmail"]=new O({name:"Iron chainmail",recipe_type:"material",materials:[{material_id:"Iron ingot",count:5}],result:{result_id:"Iron chainmail",count:1},success_chance:[.1,1],recipe_skill:"Forging",recipe_level:[5,15]}),Fe.items["Steel chainmail"]=new O({name:"Steel chainmail",recipe_type:"material",materials:[{material_id:"Steel ingot",count:5}],result:{result_id:"Steel chainmail",count:1},success_chance:[.1,1],recipe_skill:"Forging",recipe_level:[10,20]}),Re.items["Rat meat chunks"]=new O({name:"Rat meat chunks",recipe_type:"material",materials:[{material_id:"Rat tail",count:3}],result:{result_id:"Rat meat chunks",count:1},success_chance:[.4,1],recipe_level:[1,5],recipe_skill:"Butchering"}),_n.items["Low quality iron ingot"]=new O({name:"Low quality iron ingot",recipe_type:"material",materials:[{material_id:"Low quality iron ore",count:5},{material_type:"coal",count:1}],result:{result_id:"Low quality iron ingot",count:1},success_chance:[.6,1],recipe_level:[1,5],recipe_skill:"Smelting"}),_n.items["Iron ingot"]=new O({name:"Iron ingot",recipe_type:"material",materials:[{material_id:"Iron ore",count:5},{material_type:"coal",count:1}],result:{result_id:"Iron ingot",count:1},success_chance:[.4,1],recipe_level:[5,15],recipe_skill:"Smelting"}),_n.items["Steel ingot (inefficient)"]=new O({name:"Steel ingot (inefficient)",recipe_type:"material",materials:[{material_id:"Iron ore",count:5},{material_id:"Atratan ore",count:4},{material_type:"coal",count:2}],result:{result_id:"Steel ingot",count:1},success_chance:[.3,1],recipe_level:[10,20],recipe_skill:"Smelting",is_unlocked:!1}),_n.items["Raw Glass"]=new O({name:"Raw Glass",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Silica Sand",count:2},{material_id:"Potash",count:1}],result:{result_id:"Raw Glass",count:1},success_chance:[.2,1],recipe_level:[10,20],recipe_skill:"Smelting"}),Kt.items["Processed rough wood"]=new O({name:"Processed rough wood",recipe_type:"material",materials:[{material_id:"Piece of rough wood",count:5}],result:{result_id:"Processed rough wood",count:1},success_chance:[.6,1],recipe_level:[1,5],recipe_skill:"Woodworking"}),Kt.items["Processed wood"]=new O({name:"Processed wood",recipe_type:"material",materials:[{material_id:"Piece of wood",count:5}],result:{result_id:"Processed wood",count:1},success_chance:[.4,1],recipe_level:[5,15],recipe_skill:"Woodworking"}),Kt.items["Processed ash wood"]=new O({name:"Processed ash wood",recipe_type:"material",materials:[{material_id:"Piece of ash wood",count:5}],result:{result_id:"Processed ash wood",count:1},success_chance:[.4,1],recipe_level:[10,20],recipe_skill:"Woodworking"}),Re.items["Processed weak monster bone"]=new O({name:"Processed weak monster bone",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Weak monster bone",count:5}],result:{result_id:"Processed weak monster bone",count:1},success_chance:[.1,1],recipe_level:[10,20],recipe_skill:"Butchering"}),_n.items.Charcoal=new O({name:"Charcoal",recipe_type:"material",materials:[{material_type:"raw wood",count:5}],result:{result_id:"Charcoal",count:1},success_chance:[.4,1],recipe_level:[1,10],recipe_skill:"Smelting"}),Ut.items["Animal fat"]=new O({name:"Animal fat",is_unlocked:!1,recipe_type:"usable",materials:[{material_id:"Boar meat",count:3}],result:{result_id:"Animal fat",count:1},success_chance:[.1,1],recipe_level:[7,20],recipe_skill:"Cooking"}),Re.items["High quality wolf fang"]=new O({name:"High quality wolf fang",recipe_type:"material",materials:[{material_id:"Wolf fang",count:50}],result:{result_id:"High quality wolf fang",count:1},success_chance:[.5,1],recipe_level:[1,7],recipe_skill:"Butchering"}),Re.items["High quality boar tusk"]=new O({name:"High quality boar tusk",recipe_type:"material",materials:[{material_id:"Boar tusk",count:50}],result:{result_id:"High quality boar tusk",count:1},success_chance:[.5,1],recipe_level:[5,12],recipe_skill:"Butchering"}),Re.items["Pristine mountain goat horn"]=new O({name:"Pristine mountain goat horn",recipe_type:"material",materials:[{material_id:"Mountain goat horn",count:50}],result:{result_id:"Pristine mountain goat horn",count:1},success_chance:[.5,1],recipe_level:[10,17],recipe_skill:"Butchering"}),Re.items["Sharp bear claw"]=new O({name:"Sharp bear claw",recipe_type:"material",materials:[{material_id:"Bear claw",count:50}],result:{result_id:"Sharp bear claw",count:1},success_chance:[.5,1],recipe_level:[13,20],recipe_skill:"Butchering"}),Ii.items.Potash=new O({name:"Potash",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Charcoal",count:10}],result:{result_id:"Potash",count:1},success_chance:[.5,1],recipe_level:[10,20],recipe_skill:"Alchemy"})})();(function(){K.items.Bonemeal=new O({name:"Bonemeal",is_unlocked:!0,recipe_type:"material",materials:[{material_type:"animal tooth",count:20}],result:{result_id:"Bonemeal",count:1},success_chance:[.1,1],recipe_level:[1,12],recipe_skill:"Crafting"})})();(function(){Ut.items["Roasted rat meat"]=new O({name:"Roasted rat meat",recipe_type:"usable",materials:[{material_id:"Rat meat chunks",count:2}],result:{result_id:"Roasted rat meat",count:1},success_chance:[.7,1],recipe_level:[1,5],recipe_skill:"Cooking"}),Ut.items["Roasted purified rat meat"]=new O({name:"Roasted purified rat meat",recipe_type:"usable",materials:[{material_id:"Rat meat chunks",count:2},{material_id:"Belmart leaf",count:1}],result:{result_id:"Roasted purified rat meat",count:1},success_chance:[.4,1],recipe_level:[1,10],recipe_skill:"Cooking"}),Ut.items["Fried pork"]=new O({name:"Fried pork",recipe_type:"usable",materials:[{material_id:"Boar meat",count:2}],result:{result_id:"Fried pork",count:1},success_chance:[.5,1],recipe_level:[7,15],recipe_skill:"Cooking"}),Ut.items["Fried goat meat"]=new O({name:"Fried goat meat",recipe_type:"usable",materials:[{material_id:"Goat meat",count:2}],result:{result_id:"Fried goat meat",count:1},success_chance:[.4,1],recipe_level:[10,15],recipe_skill:"Cooking"}),Ut.items["Pork roast"]=new O({name:"Pork roast",recipe_type:"usable",materials:[{material_id:"Boar meat",count:2},{material_id:"Cooking herbs",count:3}],result:{result_id:"Pork roast",count:1},success_chance:[.5,1],recipe_level:[10,20],recipe_skill:"Cooking"}),Ut.items["Goat stew"]=new O({name:"Goat stew",recipe_type:"usable",materials:[{material_id:"Goat meat",count:2},{material_id:"Cooking herbs",count:2}],result:{result_id:"Goat stew",count:1},success_chance:[.4,1],recipe_level:[15,25],recipe_skill:"Cooking"}),Ut.items["Bread kwas"]=new O({name:"Bread kwas",recipe_type:"usable",materials:[{material_type:"bread",count:2},{material_id:"Glass bottle",count:1}],result:{result_id:"Bread kwas",count:1},success_chance:[.3,1],recipe_level:[10,15],recipe_skill:"Cooking"}),Ii.items["Weak healing powder"]=new O({name:"Weak healing powder",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Golmoon leaf",count:5}],result:{result_id:"Weak healing powder",count:1},success_chance:[.4,1],recipe_level:[1,10],recipe_skill:"Alchemy"}),Ii.items["Healing powder"]=new O({name:"Healing powder",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Golmoon leaf",count:3},{material_id:"Silver thistle",count:3}],result:{result_id:"Healing powder",count:1},success_chance:[.1,1],recipe_level:[5,15],recipe_skill:"Alchemy"}),Ii.items["Oneberry juice"]=new O({name:"Oneberry juice",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Oneberry",count:10},{material_id:"Glass phial",count:1}],result:{result_id:"Oneberry juice",count:1},success_chance:[.5,1],recipe_level:[2,12],recipe_skill:"Alchemy"}),Ii.items["Healing potion"]=new O({name:"Healing potion",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Oneberry",count:8},{material_id:"Silver thistle",count:4},{material_id:"Glass phial",count:1}],result:{result_id:"Healing potion",count:1},success_chance:[.1,1],recipe_level:[7,17],recipe_skill:"Alchemy"}),Ii.items["Healing balm"]=new O({name:"Healing balm",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Oneberry",count:10},{material_id:"Golmoon leaf",count:5},{material_id:"Animal fat",count:1}],result:{result_id:"Healing balm",count:1},success_chance:[.1,1],recipe_level:[7,15],recipe_skill:"Alchemy"})})();(function(){K.items["Wolf trophy"]=new O({name:"Wolf trophy",recipe_type:"equipment",materials:[{material_id:"High quality wolf fang",count:4}],result:{result_id:"Wolf trophy",count:1},success_chance:[.5,1],recipe_level:[1,10],recipe_skill:"Crafting"}),K.items["Boar trophy"]=new O({name:"Boar trophy",recipe_type:"equipment",materials:[{material_id:"High quality boar tusk",count:4}],result:{result_id:"Boar trophy",count:1},success_chance:[.5,1],recipe_level:[5,15],recipe_skill:"Crafting"}),K.items["Mountain goat trophy"]=new O({name:"Mountain goat trophy",recipe_type:"equipment",materials:[{material_id:"Pristine mountain goat horn",count:4}],result:{result_id:"Mountain goat trophy",count:1},success_chance:[.5,1],recipe_level:[10,20],recipe_skill:"Crafting"}),K.items["Bear trophy"]=new O({name:"Bear trophy",recipe_type:"equipment",materials:[{material_id:"Sharp bear claw",count:4}],result:{result_id:"Bear trophy",count:1},success_chance:[.3,1],recipe_level:[15,25],recipe_skill:"Crafting"})})();var G={crafting:K,cooking:Ut,smelting:_n,forging:Fe,alchemy:Ii,butchering:Re,woodworking:Kt};var p={},Ci={},Rn={axe:"Axes",dagger:"Daggers",hammer:"Hammers",sword:"Swords",spear:"Spears",staff:"Staffs",wand:"Wands"},hi="Crafting",ks=.1,xs=.25,tl="?????",rt={},T=class{constructor({skill_id:t,names:i,description:n,flavour_text:s,max_level:a=60,max_level_coefficient:o=1,max_level_bonus:r=0,base_xp_cost:d=40,visibility_treshold:c=10,get_effect_description:_=()=>"",parent_skill:h=null,milestones:f={},xp_scaling:y=1.8,is_unlocked:b=!0,category:w}){if(t==="all"||t==="hero"||t==="all_skill")throw new Error(`Id "${t}" is not allowed for skills`);if(this.skill_id=t,this.names=i,this.description=n,this.flavour_text=s,this.current_level=0,this.max_level=a,this.max_level_coefficient=o,this.max_level_bonus=r,this.current_xp=0,this.total_xp=0,this.base_xp_cost=d,d<1/ks&&console.warn(`Skill "${this.skill_id}" has base xp cost lower than what would be needed due to skill xp gains cap!`),this.visibility_treshold=c<d?c:d,this.is_unlocked=b,this.xp_to_next_lvl=d,this.total_xp_to_next_lvl=d,this.get_effect_description=_,this.is_parent=!1,w?this.category=w:(console.warn(`Skill "${this.skill_id}" has no category defined and was defaulted to miscellaneous`),this.category="Miscellaneous"),Ci[this.category]=!0,h)if(p[h])this.parent_skill=h,p[h].is_parent=!0;else throw new Error(`Skill "${h}" doesn't exist, so it can't be set as a parent skill`);this.milestones=f,this.xp_scaling=y>1?y:1.6}name(){if(this.visibility_treshold>this.total_xp||!this.is_unlocked)return tl;let t=Object.keys(this.names);if(t.length==1)return this.names[t[0]];{let n;for(var i=0;i<=t.length&&this.current_level>=parseInt(t[i]);i++)n=this.names[t[i]];return n}}add_xp({xp_to_add:t=0}){if(t==0||!this.is_unlocked)return{};t=Math.round(t*100)/100;let i=this.name();if(this.total_xp=Math.round(100*(this.total_xp+t))/100,this.current_level<this.max_level)if(Math.round(100*(t+this.current_xp))/100<this.xp_to_next_lvl)this.current_xp=Math.round(100*(this.current_xp+t))/100;else{let n=0,s={skills:[],recipes:[],quests:[]};for(;this.total_xp>=this.total_xp_to_next_lvl;)n+=1,this.total_xp_to_next_lvl=Math.round(100*this.base_xp_cost*(1-this.xp_scaling**(n+1))/(1-this.xp_scaling))/100,this.milestones[n]?.unlocks?.skills&&s.skills.push(...this.milestones[n].unlocks.skills),this.milestones[n]?.unlocks?.recipes&&s.recipes.push(...this.milestones[n].unlocks.recipes),this.milestones[n]?.unlocks?.quests&&s.quests.push(...this.milestones[n].unlocks.quests);let a=Math.round(100*this.base_xp_cost*(1-this.xp_scaling**n)/(1-this.xp_scaling))/100;n==0&&console.warn(`Something went wrong, calculated level of skill "${this.skill_id}" after a levelup was 0.
xp_added: ${t};
previous level: ${this.current_level};
total xp: ${this.total_xp};
total xp for that level: ${a};
total xp for next level: ${this.total_xp_to_next_lvl}`);let o;n<this.max_level?(o=this.get_bonus_stats(n),this.xp_to_next_lvl=Math.round(100*(this.total_xp_to_next_lvl-a))/100,this.current_level=n,this.current_xp=Math.round(100*(this.total_xp-a))/100):(o=this.get_bonus_stats(this.max_level),this.current_level=this.max_level,this.total_xp_to_next_lvl="Already reached max lvl",this.current_xp="Max",this.xp_to_next_lvl="Max"),i=i===tl?this.name():i;let r=`${i} has reached level ${this.current_level}`;return(Object.keys(o.stats).length>0||Object.keys(o.xp_multipliers).length>0)&&(r+=`<br><br> Thanks to ${i} reaching new milestone, %HeroName% gained: `,o.stats&&Object.keys(o.stats).forEach(d=>{o.stats[d].flat&&(r+=`<br> +${o.stats[d].flat} ${We[d].replace("_"," ")}`),o.stats[d].multiplier&&(r+=`<br> x${Math.round(100*o.stats[d].multiplier)/100} ${We[d].replace("_"," ")}`)}),o.xp_multipliers&&Object.keys(o.xp_multipliers).forEach(d=>{let c;d!=="all"&&d!=="hero"&&d!=="all_skill"&&!d.includes("category_")?(c=p[d].name(),p[d]||console.warn(`Skill ${this.skill_id} tried to reward an xp multiplier for something that doesn't exist: ${d}. I could be a misspelled skill name`)):c=d.replace("_"," "),d.includes("category_")?r+=`<br> x${Math.round(100*o.xp_multipliers[d])/100} ${c.replace("category_","")} skills xp gain`:r+=`<br> x${Math.round(100*o.xp_multipliers[d])/100} ${c} xp gain`})),{message:r,gains:o,unlocks:s}}return{}}get_bonus_stats(t){let i={stats:{},xp_multipliers:{}},n,s;for(let a=this.current_level+1;a<=t;a++)this.milestones[a]&&(n=this.milestones[a].stats,s=this.milestones[a].xp_multipliers,n&&Object.keys(n).forEach(o=>{i.stats[o]||(i.stats[o]={}),n[o].flat&&(i.stats[o].flat=(i.stats[o].flat||0)+n[o].flat),n[o].multiplier&&(i.stats[o].multiplier=(i.stats[o].multiplier||1)*n[o].multiplier)}),s&&Object.keys(s).forEach(o=>{i.xp_multipliers[o]=(i.xp_multipliers[o]||1)*s[o],rt[o]?rt[o].includes(this.skill_id)||rt[o].push(this.skill_id):rt[o]=[this.skill_id]}));return Object.keys(i.stats).forEach(a=>{i.stats[a].multiplier&&(i.stats[a].multiplier=Math.round(100*i.stats[a].multiplier)/100)}),i}get_coefficient({scaling_type:t,skill_level:i}){switch(t){case"flat":return 1+Math.round((this.max_level_coefficient-1)*(i||this.current_level)/this.max_level*1e3)/1e3;case"multiplicative":return Math.round(Math.pow(this.max_level_coefficient,(i||this.current_level)/this.max_level)*1e3)/1e3;default:return Math.round(Math.pow(this.max_level_coefficient,(i||this.current_level)/this.max_level)*1e3)/1e3}}get_level_bonus(t){return this.max_level_bonus*(t||this.current_level)/this.max_level}get_parent_xp_multiplier(){return this.parent_skill?1.1**Math.max(0,p[this.parent_skill].current_level-this.current_level):1}};function qs(e){let t="",i=p[e],n=Object.keys(i.milestones).filter(s=>s<=i.current_level);if(n.length>0){t=`lvl ${n[0]}: ${il(i.milestones[n[0]])}`;for(let s=1;s<n.length;s++)t+=`<br>

lvl ${n[s]}: ${il(i.milestones[n[s]])}`}else return"";return t}function Ms(e){return Object.keys(p[e].milestones).find(t=>t>p[e].current_level)}function il(e){let t="";if(e.stats){let i="";Object.keys(e.stats).forEach(n=>{e.stats[n].flat&&(t?t+=`, +${e.stats[n].flat} ${We[n]}`:t=`+${e.stats[n].flat} ${We[n]}`),e.stats[n].multiplier&&(i?i+=`, x${e.stats[n].multiplier} ${We[n]}`:i=`x${e.stats[n].multiplier} ${We[n]}`)}),t?i&&(t+=", "+i):t=i}if(e.xp_multipliers){let i=Object.keys(e.xp_multipliers),n;i[0]!=="all"&&i[0]!=="hero"&&i[0]!=="all_skill"?i[0].includes("category_")?n=i[0].replace("category_","")+" skills":n=p[i[0]].name():n=i[0].replace("_"," "),t?t+=`, x${e.xp_multipliers[i[0]]} ${n} xp gain`:t=`x${e.xp_multipliers[i[0]]} ${n} xp gain`;for(let s=1;s<i.length;s++){let a;i[s]!=="all"&&i[s]!=="hero"&&i[s]!=="all_skill"?i[s].includes("category_")?a=i[s].replace("category_","")+" skills":a=p[i[s]].name():a=i[s].replace("_"," "),t+=`, x${e.xp_multipliers[i[s]]} ${a} xp gain`}}if(e.unlocks){if(e.unlocks.skills){let i=e.unlocks.skills;t?t+=`, <br> Unlocked skill "${e.unlocks.skills[0]}"`:t=`Unlocked skill "${e.unlocks.skills[0]}"`;for(let n=1;n<i.length;n++)t+=`, "${e.unlocks.skills[n]}"`}if(e.unlocks.recipes){let i=e.unlocks.recipes.length>1?"new recipes":"a new recipe";t?t+=`, <br> Unlocked ${i}`:t=`Unlocked ${i}`}}return t}(function(){p.Combat=new T({names:{0:"Combat"},category:"Combat",description:"Overall combat ability",max_level_coefficient:2,base_xp_cost:60,get_effect_description:()=>`Multiplies AP by ${Math.round(C({skill_id:"Combat",scaling_type:"multiplicative"})*1e3)/1e3}`}),p["Pest killer"]=new T({names:{0:"Pest killer",15:"Pest slayer"},description:"Small enemies might not seem very dangerous, but it's not that easy to hit them!",max_level_coefficient:2,category:"Combat",base_xp_cost:100,get_effect_description:()=>`Multiplies AP against small-type enemies by ${Math.round(C({skill_id:"Pest killer",scaling_type:"multiplicative"})*1e3)/1e3}`,milestones:{1:{xp_multipliers:{Combat:1.05}},2:{xp_multipliers:{category_Combat:1.05}},3:{stats:{dexterity:{flat:1}}},5:{stats:{dexterity:{multiplier:1.05}},xp_multipliers:{Evasion:1.05,"Shield blocking":1.05}},7:{stats:{dexterity:{flat:1}},xp_multipliers:{Combat:1.05}},10:{stats:{dexterity:{multiplier:1.05}},xp_multipliers:{category_Combat:1.05}},12:{stats:{dexterity:{flat:2}},xp_multipliers:{Combat:1.05}}}}),p["Giant slayer"]=new T({names:{0:"Giant killer",15:"Giant slayer"},description:"Large opponents might seem scary, but just don't get hit and you should be fine!",max_level_coefficient:2,category:"Combat",get_effect_description:()=>`Multiplies EP against large-type enemies by ${Math.round(C({skill_id:"Giant slayer",scaling_type:"multiplicative"})*1e3)/1e3}`}),p.Evasion=new T({names:{0:"Evasion"},description:"Ability to evade attacks",max_level_coefficient:2,base_xp_cost:20,category:"Combat",get_effect_description:()=>`Multiplies EP by ${Math.round(C({skill_id:"Evasion",scaling_type:"multiplicative"})*1e3)/1e3}`,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{agility:{flat:1}},xp_multipliers:{Equilibrium:1.05}},5:{stats:{agility:{flat:1,multiplier:1.05}}},7:{stats:{agility:{flat:2}},xp_multipliers:{Equilibrium:1.05}},10:{stats:{agility:{flat:1,multiplier:1.05}}},12:{stats:{agility:{flat:2}},xp_multipliers:{Equilibrium:1.05}}}}),p["Shield blocking"]=new T({names:{0:"Shield blocking"},description:"Ability to block attacks with shield",max_level:30,max_level_bonus:.2,category:"Combat",get_effect_description:()=>`Increases block chance by flat ${Math.round(bt("Shield blocking")*1e3)/10}%. Increases blocked damage by ${Math.round(bt("Shield blocking")*5e3)/10}%`}),p.Unarmed=new T({names:{0:"Unarmed",10:"Brawling",20:"Martial arts"},description:"It's definitely, unquestionably, undoubtedly better to just use a weapon instead of doing this. But sure, why not?",category:"Combat",get_effect_description:()=>`Multiplies damage dealt in unarmed combat by ${Math.round(C({skill_id:"Unarmed",scaling_type:"multiplicative"})*1e3)/1e3}. 
Multiplies attack speed, EP and AP in unarmed combat by ${Math.round(C({skill_id:"Unarmed",scaling_type:"multiplicative"})**.3333*1e3)/1e3}.
Adds ${p.Unarmed.current_level/10} base damage to unarmed attacks.`,max_level_coefficient:64,milestones:{2:{stats:{strength:{flat:1}},xp_multipliers:{Weightlifting:1.05}},4:{stats:{strength:{flat:1},dexterity:{flat:1}}},6:{stats:{strength:{flat:1},dexterity:{flat:1},agility:{flat:1}},xp_multipliers:{Weightlifting:1.1}},8:{stats:{strength:{flat:1},dexterity:{flat:1},agility:{flat:1}}},10:{stats:{strength:{flat:2},dexterity:{flat:1},agility:{flat:1}},xp_multipliers:{Running:1.2}},12:{stats:{strength:{flat:2},dexterity:{flat:2},agility:{flat:2}}}}})})();(function(){p["Stance mastery"]=new T({names:{0:"Stance proficiency",10:"Stance mastery"},description:"Knowledge on how to apply different stances in combat",base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Increases xp gains of all combat stance skills of level lower than this, x1.1 per level of difference"}),p["Quick steps"]=new T({names:{0:"Quick steps"},parent_skill:"Stance mastery",description:"A swift and precise technique that abandons strength in favor of greater speed",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Improves efficiency of the 'Quick Steps' stance"}),p["Heavy strike"]=new T({names:{0:"Crushing force"},parent_skill:"Stance mastery",description:"A powerful and dangerous technique that abandons speed in favor of overwhelmingly strong attacks",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>'Improves efficiency of the "Crushing force" stance'}),p["Wide swing"]=new T({names:{0:"Broad arc"},parent_skill:"Stance mastery",description:"A special technique that allows striking multiple enemies at once, although at a cost of lower damage",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>'Improves efficiency of the "Broad arc" stance'}),p["Defensive measures"]=new T({names:{0:"Defensive measures"},parent_skill:"Stance mastery",description:"A careful technique focused much more on defense than on attacking",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Improves efficiency of the 'Defensive Measures' stance"}),p["Berserker's stride"]=new T({names:{0:"Berserker's stride"},parent_skill:"Stance mastery",description:"A wild and dangerous technique that focuses on dealing as much damage as possible, while completely ignoring own defense",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Improves efficiency of the 'Berserker's Stride' stance"}),p["Flowing water"]=new T({names:{0:"Flowing water"},parent_skill:"Stance mastery",description:"A wild and dangerous technique that focuses on dealing as much damage as possible, while completely ignoring own defense",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Improves efficiency of the 'Flowing Water' stance"})})();(function(){p["Spatial awareness"]=new T({names:{0:"Spatial awareness"},description:"Understanding where you are in relation to other creatures and objects",get_effect_description:()=>"Reduces environmental penalty in open areas.",category:"Environmental",milestones:{1:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1}},3:{xp_multipliers:{Combat:1.1}},5:{xp_multipliers:{category_Combat:1.1},stats:{intuition:{flat:1}}},8:{xp_multipliers:{all_skill:1.1}},10:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1,Combat:1.1},stats:{intuition:{flat:1}}}}}),p["Tight maneuvers"]=new T({names:{0:"Tight maneuvers"},description:"Learn how to fight in narrow environment, where there's not much space for dodging attacks",category:"Environmental",get_effect_description:()=>"Reduces environmental penalty in narrow areas.",milestones:{3:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1}},5:{xp_multipliers:{Combat:1.1}},7:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1}},10:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1,Combat:1.1}}}}),p["Night vision"]=new T({names:{0:"Night vision"},description:"Ability to see in darkness",base_xp_cost:600,xp_scaling:1.9,max_level:10,category:"Environmental",get_effect_description:()=>"Reduces environmental penalty in dark areas (except for 'pure darkness').",milestones:{2:{stats:{intuition:{flat:1}}},3:{xp_multipliers:{Evasion:1.05,"Shield blocking":1.05}},5:{stats:{intuition:{flat:1}},xp_multipliers:{"Presence sensing":1.05}},7:{xp_multipliers:{Combat:1.1},stats:{intuition:{multiplier:1.05}}},8:{xp_multipliers:{"Presence sensing":1.1}},10:{xp_multipliers:{"Presence sensing":1.2,Evasion:1.05,"Shield blocking":1.05},stats:{intuition:{multiplier:1.05}}}}}),p["Presence sensing"]=new T({names:{0:"Presence sensing"},description:"Ability to sense a presence without using your eyes",base_xp_cost:60,xp_scaling:2,max_level:20,category:"Environmental",get_effect_description:()=>"Reduces environmental penalty in extremly dark areas.",milestones:{1:{stats:{intuition:{flat:1}},xp_multipliers:{"Night vision":1.2}},2:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.2}},4:{stats:{intuition:{flat:1}},xp_multipliers:{Combat:1.1}},5:{xp_multipliers:{all_skill:1.05,"Night vision":1.2},stats:{intuition:{multiplier:1.1}}},7:{stats:{intuition:{flat:1}},xp_multipliers:{hero:1.05,"Night vision":1.2}},10:{xp_multipliers:{all_skill:1.05,"Night vision":1.2}},12:{xp_multipliers:{all:1.05},stats:{intuition:{multiplier:1.1}}}}}),p["Strength of mind"]=new T({names:{0:"Strength of mind"},description:"Resist and reject the unnatural influence. Turn your psyche into an iron fortress.",category:"Environmental",base_xp_cost:400,max_level:40,xp_scaling:1.7,get_effect_description:()=>"Reduces eldritch effects",milestones:{1:{xp_multipliers:{all_skill:1.05}},2:{stats:{intuition:{flat:1}},xp_multipliers:{Literacy:1.05,Persistence:1.05,Fortitude:1.05}},3:{xp_multipliers:{hero:1.05}},5:{xp_multipliers:{all_skill:1.05}},7:{stats:{intuition:{flat:1}},xp_multipliers:{Literacy:1.05,Persistence:1.05,Fortitude:1.05}},8:{xp_multipliers:{hero:1.05}},10:{xp_multipliers:{all:1.05}},12:{stats:{intuition:{multiplier:1.2}},xp_multipliers:{Literacy:1.05,Persistence:1.05,Fortitude:1.05}}}}),p["Heat resistance"]=new T({names:{0:"Heat resistance"},description:"Ability to survive and function in high temperatures",base_xp_cost:100,max_level:40,category:"Environmental"}),p["Cold resistance"]=new T({names:{0:"Cold resistance"},description:"Ability to survive and function in low temperatures",base_xp_cost:200,xp_scaling:1.8,max_level:40,category:"Environmental",get_effect_description:()=>`Increases cold tolerance by ${p["Cold resistance"].current_level*.5}`}),p["Dazzle resistance"]=new T({names:{0:"Dazzle resistance"},description:"Don't look at the sun, it's bad for your eyes",base_xp_cost:60,max_level:30,category:"Environmental",get_effect_description:()=>"Reduces hit and evasion penalty in super bright areas",max_level_bonus:.5})})();(function(){p["Weapon mastery"]=new T({names:{0:"Weapon proficiency",15:"Weapon mastery"},description:"Knowledge of all weapons",category:"Weapon",get_effect_description:()=>"Increases xp gains of all weapon skills of level lower than this, x1.1 per level of difference"}),p.Swords=new T({parent_skill:"Weapon mastery",names:{0:"Swordsmanship"},category:"Weapon",description:"The noble art of swordsmanship",get_effect_description:()=>`Multiplies damage dealt with swords by ${Math.round(C({skill_id:"Swords",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with swords by ${Math.round(C({skill_id:"Swords",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{dexterity:{flat:1}}},3:{stats:{agility:{flat:1}}},5:{stats:{strength:{flat:1},crit_rate:{flat:.01}}},7:{stats:{dexterity:{flat:1}}},10:{stats:{agility:{flat:1},crit_multiplier:{flat:.1}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),p.Axes=new T({parent_skill:"Weapon mastery",names:{0:"Axe combat"},category:"Weapon",description:"Ability to fight with use of axes",get_effect_description:()=>`Multiplies damage dealt with axes by ${Math.round(C({skill_id:"Axes",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with axes by ${Math.round(C({skill_id:"Axes",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{dexterity:{flat:1}}},3:{stats:{strength:{flat:1}}},5:{stats:{dexterity:{flat:1},strength:{flat:1}}},7:{stats:{dexterity:{flat:1}}},10:{stats:{strength:{multiplier:1.05}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),p.Spears=new T({parent_skill:"Weapon mastery",names:{0:"Spearmanship"},category:"Weapon",description:"The ability to fight with the most deadly weapon in the history",get_effect_description:()=>`Multiplies damage dealt with spears by ${Math.round(C({skill_id:"Spears",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with spears by ${Math.round(C({skill_id:"Spears",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{dexterity:{flat:1}}},3:{stats:{dexterity:{flat:1}}},5:{stats:{strength:{flat:1},crit_rate:{flat:.01}}},7:{stats:{dexterity:{flat:1}}},10:{stats:{strength:{flat:1},crit_multiplier:{flat:.1}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),p.Hammers=new T({parent_skill:"Weapon mastery",names:{0:"Hammer combat"},category:"Weapon",description:"Ability to fight with use of battle hammers. Why bother trying to cut someone, when you can just crack all their bones?",get_effect_description:()=>`Multiplies damage dealt with battle hammers by ${Math.round(C({skill_id:"Hammers",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with hammers by ${Math.round(C({skill_id:"Hammers",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{strength:{flat:1}}},3:{stats:{strength:{flat:1}}},5:{stats:{strength:{flat:1},dexterity:{flat:1}}},7:{stats:{strength:{flat:1}}},10:{stats:{strength:{flat:1},dexterity:{flat:1}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),p.Daggers=new T({parent_skill:"Weapon mastery",names:{0:"Dagger combat"},category:"Weapon",description:"The looked down on art of fighting (and stabbing) with daggers",get_effect_description:()=>`Multiplies damage dealt with daggers by ${Math.round(C({skill_id:"Daggers",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with daggers by ${Math.round(C({skill_id:"Daggers",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{dexterity:{flat:1}}},3:{stats:{agility:{flat:1}}},5:{stats:{crit_multiplier:{flat:.1},crit_rate:{flat:.01}}},7:{stats:{dexterity:{flat:1}}},10:{stats:{crit_rate:{flat:.02},crit_multiplier:{flat:.1}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),p.Wands=new T({parent_skill:"Weapon mastery",names:{0:"Wand casting"},category:"Weapon",description:"Ability to cast spells with magic wands, increases damage dealt",get_effect_description:()=>`Multiplies damage dealt with wands by ${Math.round(C({skill_id:"Wands",scaling_type:"multiplicative"})*1e3)/1e3}`,max_level_coefficient:8}),p.Staffs=new T({parent_skill:"Weapon mastery",names:{0:"Staff casting"},category:"Weapon",description:"Ability to cast spells with magic staffs, increases damage dealt",get_effect_description:()=>`Multiplies damage dealth with staffs by ${Math.round(C({skill_id:"Staffs",scaling_type:"multiplicative"})*1e3)/1e3}`,max_level_coefficient:8})})();(function(){p.Farming=new T({names:{0:"Farming"},description:"Even a simple action of plowing some fields, can be performed better with skills and experience",base_xp_cost:40,category:"Activity",max_level:10,xp_scaling:1.6,max_level_coefficient:2,milestones:{1:{stats:{max_stamina:{flat:2}}},2:{stats:{strength:{flat:1}}},3:{stats:{dexterity:{flat:1},max_stamina:{flat:2}}},4:{stats:{strength:{flat:1},max_stamina:{flat:2}}},5:{stats:{strength:{flat:1},max_stamina:{flat:2}},xp_multipliers:{Herbalism:1.05}},6:{stats:{strength:{flat:1}},xp_multipliers:{Weightlifting:1.1}},7:{stats:{dexterity:{flat:1},max_stamina:{flat:2}},xp_multipliers:{Unarmed:1.05}},8:{stats:{strength:{flat:1},max_stamina:{flat:2}}},9:{stats:{strength:{flat:1},dexterity:{flat:1}}},10:{stats:{max_stamina:{flat:4},strength:{multiplier:1.05},dexterity:{multiplier:1.05}},xp_multipliers:{Unarmed:1.1,Herbalism:1.1}}}})})();(function(){p.Sleeping=new T({names:{0:"Sleeping"},description:"Good, regular sleep is the basis of getting stronger and helps your body heal.",get_effect_description:()=>`Multiplies health restored when sleeping by ${Math.round(100*(1+R("Sleeping")/p.Sleeping.max_level))/100}`,base_xp_cost:1e3,flavour_text:"One rat, two rats, three rats...",visibility_treshold:300,xp_scaling:2,category:"Activity",max_level:10,max_level_coefficient:2.5,milestones:{2:{stats:{max_health:{flat:10,multiplier:1.04}},xp_multipliers:{all:1.05}},4:{stats:{max_health:{flat:20,multiplier:1.04}},xp_multipliers:{all:1.05}},5:{unlocks:{skills:["Meditation"]}},6:{stats:{max_health:{flat:30,multiplier:1.04}},xp_multipliers:{all:1.05,Meditation:1.1}},8:{stats:{max_health:{flat:30,multiplier:1.04}},xp_multipliers:{all:1.05}},10:{stats:{max_health:{flat:40,multiplier:1.1}},xp_multipliers:{all:1.1,Meditation:1.1}}}}),p.Meditation=new T({names:{0:"Meditation"},description:"Focus your mind",base_xp_cost:200,category:"Activity",max_level:30,max_level_coefficient:2,is_unlocked:!1,visibility_treshold:0,milestones:{2:{stats:{intuition:{flat:1}},xp_multipliers:{all:1.05,"Presence sensing":1.05}},4:{stats:{intuition:{flat:1,multiplier:1.05}},xp_multipliers:{all:1.05,"Strength of mind":1.05}},5:{xp_multipliers:{Sleeping:1.1,Breathing:1.1,"Presence sensing":1.05}},6:{stats:{intuition:{flat:2}},xp_multipliers:{"Strength of mind":1.05}},8:{stats:{intuition:{multiplier:1.05}},xp_multipliers:{all:1.05,Sleeping:1.1,Breathing:1.1,"Presence sensing":1.05}},10:{stats:{intuition:{flat:2,multiplier:1.05}},xp_multipliers:{all:1.1,Sleeping:1.1,Breathing:1.1,"Presence sensing":1.1,"Strength of mind":1.1}},12:{stats:{intuition:{flat:2}},xp_multipliers:{all:1.05,"Presence sensing":1.1}}},get_effect_description:()=>{let e=C({skill_id:"Meditation",scaling_type:"multiplicative"});return`Multiplies intuition ${Math.round(e*100)/100}`}}),p.Running=new T({description:"Great way to improve the efficiency of the body",names:{0:"Running"},max_level:50,category:"Activity",max_level_coefficient:2,base_xp_cost:50,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{agility:{flat:1}},xp_multipliers:{Breathing:1.1}},5:{stats:{agility:{flat:1},max_stamina:{multiplier:1.05}}},7:{stats:{agility:{flat:1,multiplier:1.05}},xp_multipliers:{Breathing:1.05}},10:{stats:{agility:{flat:1,multiplier:1.05},max_stamina:{multiplier:1.05}},xp_multipliers:{Breathing:1.1}},12:{stats:{agility:{flat:2},max_stamina:{flat:5}},xp_multipliers:{Breathing:1.05},unlocks:{quests:["Swimming/climbing unlock","Swimming alternative unlock"]}}},get_effect_description:()=>{let e=C({skill_id:"Running",scaling_type:"multiplicative"});return`Multiplies stamina efficiency by ${Math.round(e*100)/100}`}}),p.Weightlifting=new T({description:"No better way to get stronger than by lifting heavy things",names:{0:"Weightlifting"},max_level:50,category:"Activity",max_level_coefficient:4,base_xp_cost:50,milestones:{1:{stats:{strength:{flat:1}}},3:{stats:{strength:{flat:1}},xp_multipliers:{Unarmed:1.05}},5:{stats:{strength:{flat:1,multiplier:1.05},max_stamina:{multiplier:1.05}}},7:{stats:{strength:{flat:1}},xp_multipliers:{Unarmed:1.1}},10:{stats:{strength:{flat:1,multiplier:1.05},max_stamina:{multiplier:1.05}}},12:{stats:{strength:{flat:2},max_stamina:{flat:5}},unlocks:{quests:["Swimming/climbing unlock","Swimming alternative unlock"]}}},get_effect_description:()=>{let e=C({skill_id:"Weightlifting",scaling_type:"multiplicative"});return`Multiplies strength by ${Math.round(e*100)/100}`}}),p.Swimming=new T({description:"A nice, gentle, and relaxing exercise. Just remember to be careful.",names:{0:"Swimming"},max_level:50,category:"Activity",max_level_coefficient:2,base_xp_cost:50,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{strength:{flat:1}},xp_multipliers:{Breathing:1.05}},5:{stats:{agility:{multiplier:1.05},max_stamina:{multiplier:1.05}}},7:{stats:{agility:{flat:1}},xp_multipliers:{Breathing:1.1}},10:{stats:{agility:{multiplier:1.05},max_stamina:{multiplier:1.05}}},12:{stats:{agility:{flat:2},max_stamina:{flat:10}}}},get_effect_description:()=>{let e=C({skill_id:"Swimming",scaling_type:"multiplicative"});return`Multiplies agility and stamina by ${Math.round(e*100)/100}`}}),p.Equilibrium=new T({description:"Nothing will throw you off your balance (at least the physical one)",names:{0:"Equilibrium"},category:"Activity",max_level:50,max_level_coefficient:4,base_xp_cost:50,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{intuition:{flat:1}}},5:{stats:{agility:{flat:1,multiplier:1.05},strength:{flat:1},max_stamina:{multiplier:1.05}},xp_multipliers:{Unarmed:1.1}},7:{stats:{intuition:{flat:1}}},9:{stats:{strength:{flat:1}}},10:{stats:{agility:{flat:1},intuition:{multiplier:1.05},max_stamina:{multiplier:1.05}}},12:{stats:{agility:{flat:1},strength:{flat:1}}}},get_effect_description:()=>{let e=C({skill_id:"Equilibrium",scaling_type:"multiplicative"});return`Multiplies agility by ${Math.round(e*100)/100}`}}),p.Climbing=new T({description:"Intense and slightly dangerous form of training that involves majority of your muscles",names:{0:"Climbing"},max_level:50,category:"Activity",max_level_coefficient:2,base_xp_cost:50,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{strength:{flat:1}}},5:{stats:{agility:{multiplier:1.05},max_stamina:{multiplier:1.03}}},7:{stats:{strength:{flat:1}}},10:{stats:{strength:{multiplier:1.05},max_stamina:{multiplier:1.03}}},12:{stats:{strength:{flat:2},agility:{flat:2}}}},get_effect_description:()=>{let e=C({skill_id:"Climbing",scaling_type:"multiplicative"});return`Multiplies strength, dexterity and agility by ${Math.round(e*100)/100}`}})})();(function(){p.Woodcutting=new T({names:{0:"Woodcutting"},description:"Get better with chopping the wood",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6}),p.Mining=new T({names:{0:"Mining"},description:"Get better with mining the ores",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6}),p.Digging=new T({names:{0:"Digging"},description:"Get better with swinging the shovel",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6}),p.Herbalism=new T({names:{0:"Herbalism"},description:"Knowledge of useful plants and mushrooms",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6}),p["Animal handling"]=new T({names:{0:"Animal handling"},description:"Knowledge and skills required to deal with a wide variety of animals",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6})})();(function(){p["Crafting mastery"]=new T({skill_id:"Crafting mastery",names:{0:"Crafting mastery"},description:"A mastery of the minor crafting branches like tinkering, woodworking, or butchering",category:hi,base_xp_cost:40,xp_scaling:1.5,max_level:60,milestones:{5:{stats:{dexterity:{multiplier:1.05}}},10:{stats:{dexterity:{multiplier:1.05}}},15:{stats:{dexterity:{multiplier:1.05}}},20:{stats:{dexterity:{multiplier:1.05}}},25:{stats:{dexterity:{multiplier:1.05}}},30:{stats:{dexterity:{multiplier:1.05}}}}}),p.Crafting=new T({names:{0:"Tinkering"},description:"Turn smaller pieces into one bigger thing",category:hi,parent_skill:"Crafting mastery",base_xp_cost:40,xp_scaling:1.5,max_level:60,get_effect_description:()=>`Quality cap: ${mi("Crafting").components}% for comps, ${mi("Crafting").equipment}% for eq`}),p.Smelting=new T({names:{0:"Smelting"},description:"Turning raw ore into raw metal",category:hi,base_xp_cost:40,xp_scaling:1.5,max_level:60}),p.Forging=new T({names:{0:"Forging"},description:"Turning raw metal into something useful",category:hi,base_xp_cost:40,xp_scaling:1.5,max_level:60,get_effect_description:()=>`Quality cap: ${mi("Forging").components}% for components`,milestones:{10:{unlocks:{recipes:[{category:"smelting",subcategory:"items",recipe_id:"Steel ingot (inefficient)"}]}}}}),p.Cooking=new T({names:{0:"Cooking"},description:"Making the inedible edible",category:hi,base_xp_cost:40,xp_scaling:1.5,max_level:60}),p.Alchemy=new T({names:{0:"Alchemy"},description:"Extracting and enhancing useful properties of the ingredients",category:hi,base_xp_cost:40,xp_scaling:1.5,max_level:60}),p.Butchering=new T({skill_id:"Butchering",names:{0:"Butchering"},description:"Making the most of what you kill",category:hi,parent_skill:"Crafting mastery",base_xp_cost:40,xp_scaling:1.5,max_level_coefficient:2,max_level:60,is_unlocked:!1,visibility_treshold:0,get_effect_description:()=>{let e=C({skill_id:"Butchering",scaling_type:"multiplicative"});return`Multiplies drop chances from Beasts by ${Math.round(e*100)/100}`}}),p.Woodworking=new T({skill_id:"Woodworking",names:{0:"Woodworking"},description:"Turning wood logs into something useful",category:hi,parent_skill:"Crafting mastery",base_xp_cost:40,xp_scaling:1.5,max_level:60})})();(function(){p["Iron skin"]=new T({category:"Combat",names:{0:"Tough skin",10:"Wooden skin",20:"Stone skin",30:"Iron skin"},description:"As it gets damaged, your skin regenerates to be tougher and tougher",base_xp_cost:400,xp_scaling:1.9,max_level:30,max_level_bonus:30,get_effect_description:()=>`Increases base defense by ${Math.round(bt("Iron skin"))}`,milestones:{3:{stats:{max_health:{multiplier:1.01}}},5:{stats:{max_health:{multiplier:1.01},unarmed_power:{flat:.4}}},7:{stats:{max_health:{multiplier:1.02}},xp_multipliers:{Fortitude:1.05}},10:{stats:{max_health:{multiplier:1.02},unarmed_power:{flat:.6}}},12:{stats:{max_health:{multiplier:1.02}},xp_multipliers:{Fortitude:1.05}}}}),p.Fortitude=new T({category:"Combat",names:{0:"Fortitude"},description:"Pretend the wounds are not there",base_xp_cost:200,xp_scaling:1.6,max_level:60,max_level_coefficient:4,get_effect_description:()=>`Increases max health by ${Math.round(100*C({scaling_type:"multiplicative",skill_id:"Fortitude"}))/100}`,milestones:{3:{stats:{max_health:{multiplier:1.01}}},5:{stats:{defense:{flat:1}},xp_multipliers:{"Iron skin":1.05}},7:{stats:{max_health:{multiplier:1.02}}},10:{stats:{defense:{flat:1}},xp_multipliers:{"Iron skin":1.05}},12:{stats:{max_health:{multiplier:1.02}}}}})})();(function(){p.Persistence=new T({names:{0:"Persistence"},description:"Do not give up, no matter what",flavour_text:"Believe in me that believes in you!",base_xp_cost:60,category:"Character",max_level:30,get_effect_description:()=>`Increases low stamina stat multiplier to x${(50+Math.round(bt("Persistence")*1e5)/1e3)/100} (originally x0.5)`,milestones:{2:{stats:{max_stamina:{flat:5}},xp_multipliers:{all_skill:1.05}},4:{stats:{max_stamina:{flat:5}},xp_multipliers:{hero:1.05}},6:{stats:{max_stamina:{flat:10},heat_tolerance:{flat:1},cold_tolerance:{flat:1}},xp_multipliers:{all:1.05,"Strength of mind":1.05}},8:{stats:{max_stamina:{flat:10}},xp_multipliers:{all:1.05}},10:{stats:{max_stamina:{multiplier:1.1}},xp_multipliers:{hero:1.05,"Strength of mind":1.05}},12:{stats:{max_stamina:{flat:10},heat_tolerance:{flat:1},cold_tolerance:{flat:1}},xp_multipliers:{hero:1.05}},14:{stats:{stamina_efficiency:{multiplier:1.1}},xp_multipliers:{all_skill:1.05,"Strength of mind":1.05}}},max_level_bonus:.3}),p.Perception=new T({names:{0:"Perception"},description:"Better grasp on your senses allows you to notice small and hidden things, as well as to discern the true nature of what you obsere",category:"Character",max_level_coefficient:2,get_effect_description:()=>"",milestones:{}}),p.Literacy=new T({names:{0:"Literacy"},description:"Ability to read and understand written text",category:"Character",base_xp_cost:120,max_level:10,xp_scaling:2,milestones:{1:{xp_multipliers:{hero:1.05,"Strength of mind":1.05}},2:{xp_multipliers:{all_skill:1.05}},3:{xp_multipliers:{all:1.05}},5:{xp_multipliers:{hero:1.05,"Strength of mind":1.05}}}}),p.Medicine=new T({names:{0:"Medicine"},description:"Create better medicaments and improve your skill at treating wounds.",category:"Character",max_level:30,visibility_treshold:5,max_level_coefficient:2,get_effect_description:()=>{let e=C({skill_id:"Medicine",scaling_type:"multiplicative"});return`Multiplies additive effects of medicines by ${Math.round(e**2*100)/100} and multiplicative effects by ${Math.round(e*100)/100}`}}),p.Gluttony=new T({names:{0:"Gluttony"},description:"The more you eat the better you will be at digesting, right?",category:"Character",max_level:30,visibility_treshold:5,max_level_coefficient:2,get_effect_description:()=>{let e=C({skill_id:"Gluttony",scaling_type:"multiplicative"});return`Multiplies additive effects of foods by ${Math.round(e**2*100)/100} and multiplicative effects by ${Math.round(e*100)/100}`},milestones:{3:{xp_multipliers:{hero:1.05}},5:{stats:{max_health:{flat:20}},xp_multipliers:{Regeneration:1.1}},7:{stats:{health_regeneration_flat:{flat:.1}}},10:{stats:{stamina_regeneration_flat:{flat:.1},cold_tolerance:{flat:1}},xp_multipliers:{hero:1.05}},12:{stats:{health_regeneration_flat:{flat:.2}},xp_multipliers:{Regeneration:1.1}}}}),p.Breathing=new T({names:{0:"Breathing"},description:"Oxygen is the most important resource for improving the performance of your body. Learn how to take it in more efficiently.",flavour_text:"You are now breathing manually",base_xp_cost:400,visibility_treshold:390,xp_scaling:1.6,category:"Character",max_level_coefficient:2,max_level:40,milestones:{3:{xp_multipliers:{Running:1.1,Meditation:1.1},stats:{attack_speed:{multiplier:1.02}}},5:{stats:{agility:{multiplier:1.05},stamina_efficiency:{multiplier:1.05}}},7:{xp_multipliers:{Running:1.1,Meditation:1.1},stats:{stamina_regeneration_flat:{flat:.1}}},10:{stats:{strength:{multiplier:1.05},max_stamina:{multiplier:1.05},attack_speed:{multiplier:1.02}}},12:{stats:{strength:{flat:2},agility:{flat:2},stamina_regeneration_flat:{flat:.1}},xp_multipliers:{Running:1.1,Meditation:1.1}},14:{xp_multipliers:{Running:1.1,Meditation:1.1},stats:{attack_speed:{multiplier:1.03},stamina_efficiency:{multiplier:1.05}}}},get_effect_description:()=>{let e=C({skill_id:"Breathing",scaling_type:"multiplicative"});return`Multiplies strength, agility and stamina by ${Math.round(e*100)/100}. Reduces thin air effects.`}}),p.Regeneration=new T({names:{0:"Regeneration"},description:"As your body regenerates more and more, it slowly becomes more proficient in this task.",get_effect_description:()=>`Multiplies health restored when resting or sleeping by ${Math.round(100*(1+3*R("Regeneration")/p.Regeneration.max_level))/100}`,base_xp_cost:600,visibility_treshold:500,xp_scaling:1.4,category:"Character",max_level:40,max_level_coefficient:2.5,milestones:{1:{stats:{max_health:{flat:10}}},3:{stats:{max_health:{flat:10}}},5:{stats:{health_regeneration_flat:{flat:.1}}},7:{stats:{max_health:{flat:20}}},10:{stats:{max_health:{flat:20},health_regeneration_flat:{flat:.2}}},12:{stats:{max_health:{flat:20}}},15:{stats:{health_regeneration_flat:{flat:.4}}}}})})();(function(){p.Haggling=new T({names:{0:"Haggling"},description:"The art of the deal",category:"Character",base_xp_cost:100,max_level:25,get_effect_description:()=>`Lowers trader cost multiplier to ${Math.round((1-bt("Haggling"))*100)}% of original value`,max_level_bonus:.5,milestones:{2:{stats:{intuition:{flat:1}}},3:{xp_multipliers:{Literacy:1.05}},5:{stats:{intuition:{flat:2}},xp_multipliers:{Literacy:1.05,Persistence:1.05}},7:{stats:{intuition:{flat:2}}},10:{stats:{intuition:{flat:2}},xp_multipliers:{Literacy:1.05,Persistence:1.05}}}})})();Object.keys(p).forEach(e=>{p[e].skill_id=e});var j={},va={},Gn=class extends _i{constructor({name:t,display_name:i,trade_text:n,location_name:s,refresh_time:a=4,refresh_shift:o=0,inventory_template:r,profit_margin:d=3,is_unlocked:c=!0}){super(),this.name=t,this.display_name=i||t,this.trade_text=n||`Trade with ${this.display_name}`,this.location_name=s,this.last_refresh=-1,this.refresh_time=a,this.refresh_shift=o,this.inventory_template=r,this.profit_margin=d,this.is_unlocked=c,this.is_finished=!1}refresh(){return this.can_refresh()?(this.inventory=this.get_inventory_from_template(),this.last_refresh=M.day_count+1-M.day_count%this.refresh_time,!0):!1}can_refresh(){return this.last_refresh<0||M.day_count-(this.last_refresh+this.refresh_shift)>=this.refresh_time}get_inventory_from_template(){let t={},i=va[this.inventory_template];for(let n=0;n<i.length;n++)if(i[n].chance>=Math.random()){let s=i[n].count.length==1?i[n].count[0]:Math.round(Math.random()*(i[n].count[1]-i[n].count[0])+i[n].count[0]);if(i[n].quality){let a=Math.round(Math.random()*(i[n].quality[1]-i[n].quality[0])+i[n].quality[0]),o=de({...u[i[n].item_name],quality:a});t[o.getInventoryKey()]={item:o,count:s}}else t[u[i[n].item_name].getInventoryKey()]={item:de(u[i[n].item_name]),count:s}}return t}getProfitMargin(){return 1+(this.profit_margin-1)*(1-bt("Haggling"))}getItemPrice(t){let i=Math.ceil(t*this.getProfitMargin());return i>=100?Math.round(i/10)*10:i>=1e3?Math.round(i/100)*100:i}},g=class{constructor({item_name:t,chance:i=1,count:n=[1],quality:s=null}){this.item_name=t,this.chance=i,this.count=n,this.quality=s}};(function(){j["village trader"]=new Gn({name:"village trader",inventory_template:"Basic",is_unlocked:!1,location_name:"Village"}),j["suspicious trader"]=new Gn({name:"suspicious trader",inventory_template:"Basic plus",is_unlocked:!0,location_name:"Slums",profit_margin:5}),j["suspicious trader 2"]=new Gn({name:"suspicious trader 2",display_name:"suspicious trader",inventory_template:"Intermediate",is_unlocked:!1,location_name:"Slums",profit_margin:4})})();(function(){va.Basic=[new g({item_name:"Cheap iron spear",count:[1],quality:[40,90],chance:.8}),new g({item_name:"Cheap iron dagger",count:[1],quality:[40,90],chance:.8}),new g({item_name:"Cheap iron sword",count:[1],quality:[40,90],chance:.8}),new g({item_name:"Cheap iron axe",count:[1],quality:[40,90],chance:.8}),new g({item_name:"Cheap iron battle hammer",count:[1],quality:[40,90],chance:.8}),new g({item_name:"Cheap iron spear",count:[1],quality:[91,120],chance:.4}),new g({item_name:"Cheap iron dagger",count:[1],quality:[91,120],chance:.4}),new g({item_name:"Cheap iron sword",count:[1],quality:[91,120],chance:.4}),new g({item_name:"Cheap iron axe",count:[1],quality:[91,120],chance:.4}),new g({item_name:"Cheap iron battle hammer",count:[1],quality:[91,120],chance:.4}),new g({item_name:"Cheap wooden shield",count:[1],quality:[40,90]}),new g({item_name:"Cheap wooden shield",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Crude wooden shield",count:[1],chance:.7,quality:[40,90]}),new g({item_name:"Crude wooden shield",count:[1],chance:.4,quality:[91,120]}),new g({item_name:"Cheap leather vest",count:[1],quality:[40,90]}),new g({item_name:"Cheap leather vest",count:[1],chance:.5,quality:[91,120]}),new g({item_name:"Cheap leather pants",count:[1],quality:[40,90]}),new g({item_name:"Cheap leather pants",count:[1],chance:.5,quality:[91,120]}),new g({item_name:"Cheap leather hat",count:[1],quality:[40,90]}),new g({item_name:"Cheap leather hat",count:[1],chance:.5,quality:[91,120]}),new g({item_name:"Cheap leather shoes",count:[1],chance:.5,quality:[91,120]}),new g({item_name:"Leather shoes",count:[1],chance:.4,quality:[91,120]}),new g({item_name:"Leather vest",count:[1],chance:.7,quality:[70,120]}),new g({item_name:"Leather pants",count:[1],chance:.7,quality:[70,120]}),new g({item_name:"Leather hat",count:[1],chance:.7,quality:[70,120]}),new g({item_name:"Leather gloves",count:[1],chance:.7,quality:[70,120]}),new g({item_name:"Wolf leather armor",count:[1],chance:.3,quality:[60,120]}),new g({item_name:"Wolf leather armored pants",count:[1],chance:.3,quality:[60,120]}),new g({item_name:"Wolf leather helmet",count:[1],chance:.3,quality:[60,120]}),new g({item_name:"Rat pelt cape",count:[1,3],chance:1,quality:[70,120]}),new g({item_name:"Stale bread",count:[4,10]}),new g({item_name:"Bread kwas",count:[1],chance:.6}),new g({item_name:"Fresh bread",count:[2,5]}),new g({item_name:"Weak healing powder",count:[2,5]}),new g({item_name:"Cooking herbs",count:[1,3]},.5),new g({item_name:"ABC for kids",count:[1],chance:1}),new g({item_name:"Old combat manual",count:[1],chance:.5}),new g({item_name:"Butchering and you",count:[1],chance:.2}),new g({item_name:"Medicine for dummies",count:[1],chance:.2}),new g({item_name:"Ode to Whimsy, and other poems",count:[1],chance:.2}),new g({item_name:"A Glint On The Sand",count:[1],chance:.2}),new g({item_name:"Glass phial",count:[5,10],chance:1}),new g({item_name:"Glass bottle",count:[4,8],chance:1}),new g({item_name:"Camping supplies",count:[1],chance:1}),new g({item_name:"Coil of rope",count:[1],chance:1})],va["Basic plus"]=[new g({item_name:"Iron spear",count:[1],quality:[70,90],chance:.8}),new g({item_name:"Iron dagger",count:[1],quality:[70,90],chance:.8}),new g({item_name:"Iron sword",count:[1],quality:[70,90],chance:.8}),new g({item_name:"Iron axe",count:[1],quality:[70,90],chance:.8}),new g({item_name:"Iron battle hammer",count:[1],quality:[40,80],chance:.8}),new g({item_name:"Iron spear",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Iron dagger",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Iron sword",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Iron axe",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Iron battle hammer",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Steel spear",count:[1],quality:[70,100],chance:.6}),new g({item_name:"Steel dagger",count:[1],quality:[70,100],chance:.6}),new g({item_name:"Steel sword",count:[1],quality:[70,100],chance:.6}),new g({item_name:"Steel axe",count:[1],quality:[70,100],chance:.6}),new g({item_name:"Steel battle hammer",count:[1],quality:[70,100],chance:.6}),new g({item_name:"Steel spear",count:[1],quality:[81,120],chance:.4}),new g({item_name:"Steel dagger",count:[1],quality:[81,120],chance:.4}),new g({item_name:"Steel sword",count:[1],quality:[81,120],chance:.4}),new g({item_name:"Steel axe",count:[1],quality:[81,120],chance:.4}),new g({item_name:"Steel battle hammer",count:[1],quality:[81,120],chance:.4}),new g({item_name:"Wooden shield",count:[1],quality:[40,80]}),new g({item_name:"Wooden shield",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Crude iron shield",count:[1],quality:[40,80]}),new g({item_name:"Crude iron shield",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Iron shield",count:[1],chance:.6,quality:[40,80]}),new g({item_name:"Iron shield",count:[1],chance:.4,quality:[81,120]}),new g({item_name:"Steel shield",count:[1],chance:.3,quality:[81,100]}),new g({item_name:"Ash wood shield",count:[1],chance:.3,quality:[81,100]}),new g({item_name:"Leather vest",count:[1],chance:.9,quality:[81,120]}),new g({item_name:"Leather pants",count:[1],chance:.9,quality:[81,120]}),new g({item_name:"Leather hat",count:[1],chance:.9,quality:[81,120]}),new g({item_name:"Leather shoes",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Leather gloves",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Wolf leather armor",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Wolf leather armored pants",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Wolf leather helmet",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Rat pelt cape",count:[1,2],chance:.6,quality:[70,120]}),new g({item_name:"Wolf pelt cape",count:[1],chance:.9,quality:[70,120]}),new g({item_name:"Iron chainmail armor",count:[1],chance:.8,quality:[40,80]}),new g({item_name:"Iron chainmail armor",count:[1],chance:.6,quality:[81,120]}),new g({item_name:"Iron chainmail pants",count:[1],chance:.8,quality:[40,80]}),new g({item_name:"Iron chainmail pants",count:[1],chance:.6,quality:[81,120]}),new g({item_name:"Iron chainmail helmet",count:[1],chance:.8,quality:[40,80]}),new g({item_name:"Iron chainmail helmet",count:[1],chance:.6,quality:[81,120]}),new g({item_name:"Stale bread",count:[4,10]}),new g({item_name:"Fresh bread",count:[2,5]}),new g({item_name:"Bread kwas",count:[1,3]}),new g({item_name:"Weak healing powder",count:[2,5]}),new g({item_name:"Oneberry juice",count:[2,5]}),new g({item_name:"Cooking herbs",count:[1,4]},.6),new g({item_name:"Twist liek a snek",count:[1],chance:.8}),new g({item_name:"Butchering and you",count:[1],chance:.6}),new g({item_name:"Medicine for dummies",count:[1],chance:.6}),new g({item_name:"Ode to Whimsy, and other poems",count:[1],chance:.4}),new g({item_name:"A Glint On The Sand",count:[1],chance:.4}),new g({item_name:"Glass phial",count:[5,10],chance:1}),new g({item_name:"Glass bottle",count:[4,8],chance:1}),new g({item_name:"Camping supplies",count:[1],chance:1}),new g({item_name:"Coil of rope",count:[1],chance:1}),new g({item_name:"Iron sickle",count:[1],chance:.8}),new g({item_name:"Iron pickaxe",count:[1],chance:.8}),new g({item_name:"Iron chopping axe",count:[1],chance:.8})],va.Intermediate=[new g({item_name:"Iron spear",count:[1],quality:[100,120],chance:.8}),new g({item_name:"Iron dagger",count:[1],quality:[100,120],chance:.8}),new g({item_name:"Iron sword",count:[1],quality:[100,120],chance:.8}),new g({item_name:"Iron axe",count:[1],quality:[100,120],chance:.8}),new g({item_name:"Iron battle hammer",count:[1],quality:[100,120],chance:.8}),new g({item_name:"Steel spear",count:[1],quality:[80,100],chance:.8}),new g({item_name:"Steel dagger",count:[1],quality:[80,100],chance:.8}),new g({item_name:"Steel sword",count:[1],quality:[80,100],chance:.8}),new g({item_name:"Steel axe",count:[1],quality:[80,100],chance:.8}),new g({item_name:"Steel battle hammer",count:[1],quality:[80,100],chance:.8}),new g({item_name:"Steel spear",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Steel dagger",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Steel sword",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Steel axe",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Steel battle hammer",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Wooden shield",count:[1],quality:[40,80]}),new g({item_name:"Wooden shield",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Crude iron shield",count:[1],quality:[40,80]}),new g({item_name:"Crude iron shield",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Iron shield",count:[1],chance:.6,quality:[40,80]}),new g({item_name:"Iron shield",count:[1],chance:.4,quality:[81,120]}),new g({item_name:"Steel shield",count:[1],chance:.4,quality:[81,120]}),new g({item_name:"Ash wood shield",count:[1],chance:.4,quality:[81,120]}),new g({item_name:"Leather vest",count:[1],chance:.9,quality:[81,120]}),new g({item_name:"Leather pants",count:[1],chance:.9,quality:[81,120]}),new g({item_name:"Leather hat",count:[1],chance:.9,quality:[81,120]}),new g({item_name:"Leather shoes",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Leather gloves",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Goat leather vest",count:[1],chance:.5,quality:[81,120]}),new g({item_name:"Goat leather pants",count:[1],chance:.5,quality:[81,120]}),new g({item_name:"Goat leather hat",count:[1],chance:.5,quality:[81,120]}),new g({item_name:"Goat leather shoes",count:[1],chance:.5,quality:[81,120]}),new g({item_name:"Goat leather gloves",count:[1],chance:.5,quality:[81,120]}),new g({item_name:"Wolf leather armor",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Wolf leather armored pants",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Wolf leather helmet",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Iron chainmail armor",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Iron chainmail pants",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Iron chainmail helmet",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Steel chainmail armor",count:[1],chance:.6,quality:[81,120]}),new g({item_name:"Steel chainmail pants",count:[1],chance:.6,quality:[81,120]}),new g({item_name:"Steel chainmail helmet",count:[1],chance:.6,quality:[81,120]}),new g({item_name:"Wolf pelt cape",count:[1],chance:.9,quality:[70,120]}),new g({item_name:"Boar hide cape",count:[1],chance:.9,quality:[70,120]}),new g({item_name:"Goat hide cape",count:[1],chance:.9,quality:[70,120]}),new g({item_name:"Fresh bread",count:[4,10]}),new g({item_name:"Bread kwas",count:[2,5]}),new g({item_name:"Weak healing powder",count:[2,5]}),new g({item_name:"Oneberry juice",count:[2,5]}),new g({item_name:"Healing powder",count:[2,5]}),new g({item_name:"Healing potion",count:[2,5]}),new g({item_name:"Cooking herbs",count:[2,5]},.8),new g({item_name:"Twist liek a snek",count:[1],chance:1}),new g({item_name:"Butchering and you",count:[1],chance:1}),new g({item_name:"Medicine for dummies",count:[1],chance:1}),new g({item_name:"Ode to Whimsy, and other poems",count:[1],chance:.4}),new g({item_name:"A Glint On The Sand",count:[1],chance:.4}),new g({item_name:"Glass phial",count:[10,16],chance:1}),new g({item_name:"Glass bottle",count:[6,12],chance:1}),new g({item_name:"Camping supplies",count:[1],chance:1}),new g({item_name:"Coil of rope",count:[1],chance:1}),new g({item_name:"Iron sickle",count:[1],chance:1}),new g({item_name:"Iron pickaxe",count:[1],chance:1}),new g({item_name:"Iron chopping axe",count:[1],chance:1})]})();var Be=null,L={value:0,items:[],groups:{}},E={value:0,items:[],groups:{}},ka=class{constructor(t){this.count=new Array(t+1).fill(0),this.needs_resort=!1,this.unsorted=[],this.sorted=[],this.group_value=0}};function al(e){j[e].refresh(),Be=e,_l(),we({is_trade:!0})}function sl(){E.items=[],E.groups={},E.value=0,L.items=[],L.groups={},L.value=0,we({is_trade:!0}),Ht()}function ol(){let e;if(L.items.length==0&&E.items.length==0?e=l.money:e=l.money+L.value-E.value,e<0)throw new Error("Trying to make a trade that can't be afforded");{l.money=e;let t=[],i=[];for(;E.items.length>0;){let n=E.items.pop();n.item_count=n.count,i.push(n),t.push({item_key:n.item_key,count:n.count});let s=ye(n.item_key),{group_key:a,group_tier:o}=s.getMarketSaturationGroup();s.saturates_market&&el({group_key:a,group_tier:o,count:s.count,region:v.market_region})}if(i.length>0){ze(t),$c(Be,i);for(let n=0;n<t.length;n++)we({item_key:t[n].item_key})}for(t=[],i=[];L.items.length>0;){let n=L.items.pop();n.item_count=n.count,i.push(n),t.push({item_key:n.item_key,count:n.count});let s=ye(n.item_key),{group_key:a,group_tier:o}=s.getMarketSaturationGroup();s.saturates_market&&Zo({group_key:a,group_tier:o,count:n.count,region:v.market_region})}if(i.length>0){Es(Be,t),ct(i);for(let n=0;n<t.length;n++)Ht({item_key:t[n].item_key})}}z({skill:p.Haggling,xp_to_add:(L.value+E.value)/10,cap_gained_xp:!1}),E.value=0,E.groups={},L.value=0,L.groups={},we({is_trade:!0}),Ht(),mn()}function ll(){Be=null,E.items=[],E.groups={},E.value=0,L.items=[],L.groups={},L.value=0,ml(),we()}function rl(e){let t=ye(e.item_key),{group_key:i,group_tier:n}=t.getMarketSaturationGroup(),s=E.items.find(r=>r.item_key===e.item_key),a=e.count,o=j[Be].inventory[e.item_key].count;return s?(o-s.count<e.count?(a=o-s.count,s.count=o):s.count+=a,E.groups[i].count[n]+=a,E.groups[i].unsorted.find(r=>e.item_key===r.item_key).count+=a):(o<e.count&&(e.count=o),E.groups[i]?E.groups[i].count.length<n+1&&E.groups[i].count.push(...new Array(n+1-E.groups[i].count.length).fill(0)):E.groups[i]=new ka(n),E.items.push(e),E.groups[i].unsorted.push({...e}),E.groups[i].count[n]+=e.count,E.groups[i].needs_resort=!0),xa()}function cl(e){let t=ye(e.item_key),{group_key:i,group_tier:n}=t.getMarketSaturationGroup(),s=e.count,a=E.items.find(o=>o.item_key===e.item_key);if(a?.count<s&&(s=a.count),!E.groups[i]||E.groups[i].count.length<n+1)throw new Error(`Tried to remove an item of trade group '${i}:${n}' from the buying list, but nothing of such group was present in it!`);if(E.groups[i].count[n]<s)throw new Error(`Tried to remove an item of trade group '${i}:${n}' from the buying list, but provided count of '${s}' would lead to a negative number!`);return a?.count>e.count?(a.count-=s,E.groups[i].unsorted.find(o=>e.item_key===o.item_key).count-=s):(s=a.count,a.count=0,E.items.splice(E.items.indexOf(a),1),E.groups[i].unsorted=E.groups[i].unsorted.filter(o=>e.item_key!==o.item_key),E.groups[i].sorted=E.groups[i].sorted.filter(o=>e.item_key!==o.item_key)),E.groups[i].count[n]-=s,xa()}function $s(){return!!Be}function ul(e){let t=ye(e.item_key),{group_key:i,group_tier:n}=t.getMarketSaturationGroup(),s=L.items.find(o=>o.item_key===e.item_key),a=l.inventory[e.item_key].count;return s?(a-s.count<e.count?(e.count=a-s.count,s.count=a):s.count+=e.count,L.groups[i].count[n]+=e.count,L.groups[i].unsorted.find(o=>e.item_key===o.item_key).count+=e.count):(a<e.count&&(e.count=a),L.groups[i]?L.groups[i].count.length<n+1&&L.groups[i].count.push(...new Array(n+1-L.groups[i].count.length).fill(0)):L.groups[i]=new ka(n),L.items.push(e),L.groups[i].unsorted.push({...e}),L.groups[i].count[n]+=e.count,L.groups[i].needs_resort=!0),xa()}function dl(e){let t=ye(e.item_key),{group_key:i,group_tier:n}=t.getMarketSaturationGroup(),s=e.count,a=L.items.find(o=>o.item_key===e.item_key);if(a?.count<s&&(s=a.count),!L.groups[i]||L.groups[i].count.length<n+1)throw new Error(`Tried to remove an item of trade group '${i}:${n}' from the selling list, but nothing of such group was present in it!`);if(L.groups[i].count[n]<s)throw new Error(`Tried to remove an item of trade group '${i}:${n}' from the selling list, but provided count of '${s}' would lead to a negative number!`);return a?.count>e.count?(a.count-=s,L.groups[i].unsorted.find(o=>e.item_key===o.item_key).count-=s):(s=a.count,a.count=0,L.items.splice(L.items.indexOf(a),1),L.groups[i].unsorted=L.groups[i].unsorted.filter(o=>e.item_key!==o.item_key),L.groups[i].sorted=L.groups[i].sorted.filter(o=>e.item_key!==o.item_key)),L.groups[i].count[n]-=s,xa()}function Es(e,t){j[e].add_to_inventory(t),Be===e&&Ht()}function $c(e,t){j[e].remove_from_inventory(t),Be===e&&Ht()}function xa(){let e={buying_precalculated:{},selling:{},buying:{}};return E.value=0,L.value=0,Object.keys(E.groups).forEach(t=>{e.buying_precalculated[t]||(e.buying_precalculated[t]=[]);for(let i=0;i<E.groups[t].sorted.length;i++){let n=ye(E.groups[t].sorted[i].item_key),{group_tier:s}=n.getMarketSaturationGroup();e.buying_precalculated[t].length<s+1&&e.buying_precalculated[t].push(...new Array(s+1-e.buying_precalculated[t].length).fill(0)),e.buying_precalculated[t][s]+=E.groups[t].sorted[i].count}}),Object.keys(L.groups).forEach(t=>{L.groups[t].group_value=0,L.groups[t].needs_resort&&(L.groups[t].sorted=L.groups[t].unsorted.sort((i,n)=>nl(i,n)),L.groups[t].needs_resort=!1);for(let i=0;i<L.groups[t].sorted.length;i++){let n=ye(L.groups[t].sorted[i].item_key),{group_tier:s,group_key:a}=n.getMarketSaturationGroup();e.selling[t]||(e.selling[t]=[]);let o;a.startsWith($e)?o=un:o=cn;let r=dn({sold_by_tier:e.selling[t],target_tier:s,cap:o}),d=dn({sold_by_tier:e.buying_precalculated[t],target_tier:s,cap:o});L.groups[t].group_value+=n.getValueOfMultiple({additional_traded_count:r,stop_multiplier_at:Math.max(0,r-d+L.groups[t].sorted[i].count),count:L.groups[t].sorted[i].count,region:v.market_region});for(let c=0;c<L.groups[t].sorted.length;c++){let _=ye(L.groups[t].sorted[c].item_key),{group_tier:h}=_.getMarketSaturationGroup();e.selling[t].length<h+1&&e.selling[t].push(...new Array(h+1-e.selling[t].length).fill(0)),e.selling[t][h]+=L.groups[t].sorted[c].count}}L.value+=L.groups[t].group_value}),Object.keys(E.groups).forEach(t=>{E.groups[t].group_value=0,E.groups[t].needs_resort&&(E.groups[t].sorted=E.groups[t].unsorted.sort((i,n)=>nl(i,n)),E.groups[t].needs_resort=!1);for(let i=0;i<E.groups[t].sorted.length;i++){let n=ye(E.groups[t].sorted[i].item_key),{group_tier:s,group_key:a}=n.getMarketSaturationGroup();e.buying[t]||(e.buying[t]=[]);let o;a.startsWith($e)?o=un:o=cn;let r=dn({sold_by_tier:e.selling[t],target_tier:s,cap:o}),d=dn({sold_by_tier:e.buying[t],target_tier:s,cap:o});E.groups[a].group_value+=n.getValueOfMultiple({additional_traded_count:d,stop_multiplier_at:Math.max(0,r-d-E.groups[t].sorted[i].count),count:E.groups[t].sorted[i].count,region:v.market_region,price_multiplier:j[Be].getProfitMargin(),is_selling:!1})}for(let i=0;i<E.groups[t].sorted.length;i++){let n=ye(E.groups[t].sorted[i].item_key),{group_tier:s}=n.getMarketSaturationGroup();e.buying[t].length<s+1&&e.buying[t].push(...new Array(s+1-e.buying[t].length).fill(0)),e.buying[t][s]+=E.groups[t].sorted[i].count}E.value+=E.groups[t].group_value}),L.value-E.value}function nl(e,t){let i=ye(e.item_key),n=ye(t.item_key),s=i.getMarketSaturationGroup().group_tier,a=n.getMarketSaturationGroup().group_tier;return s!=a?a-s:n.getBaseValue()-i.getBaseValue()}var Ai=(e,t)=>{let i=1;if(e.length==0)return 1;if(e[0].money&&t.money<e[0].money)return i=0,i;if(e[1]?.money&&e[1].money>e[0].money&&t.money<e[1].money&&(i*=(t.money-e[0].money)/(e[1].money-e[0].money)),!i||(e[0].skills&&Object.keys(e[0].skills).forEach(n=>{R(n)<e[0].skills[n]?i=0:e[1]?.skills&&e[1].skills[n]>e[0].skills[n]&&R(n)<e[1].skills[n]&&(i*=(R(n)-e[0].skills[n])/(e[1].skills[n]-e[0].skills[n]))}),!i)||(e[0].items_by_id&&Object.keys(e[0].items_by_id).forEach(n=>{let s=!1;Object.keys(t.inventory).forEach(a=>{if(s)return;let{id:o}=JSON.parse(a);o===n&&t.inventory[a].count>=e[0].items_by_id[n].count&&(s=!0)}),s||(i=0)}),!i))return i;if(e[0].stats&&Object.keys(e[0].stats).forEach(n=>{t.stats.full[n]<e[0].stats[n]?i=0:e[1]?.stats&&e[1].stats[n]>e[0].stats[n]&&t.stats.full[n]<e[1].stats[n]&&(i*=(t.stats.full[n]-e[0].stats[n])/(e[1].stats[n]-e[0].stats[n]))}),e[0].season&&(e[0].season.yes?M.getSeason()!==e[0].season.yes&&(i=0):e[0].season.not&&M.getSeason()===e[0].season.not&&(i=0)),e[0].tools_by_slot){for(let n=0;n<e[0].tools_by_slot.length;n++)if(!t.equipment[e[0].tools_by_slot[n]]){i=0;break}}if(e[0].flags){for(let n=0;n<e[0].flags.length;n++)if(!Ne[e[0].flags[n]]){i=0;break}}return i};var Pe=class{constructor({starting_text:t,action_id:i,action_name:n,description:s,action_text:a,success_text:o,failure_texts:r={},required:d={},display_conditions:c={},conditions:_=[],rewards:h={},attempt_duration:f=0,success_chances:y=[1,1],is_unlocked:b=!1,repeatable:w=!1,check_conditions_on_finish:k=!0,unlock_text:H}){if(this.starting_text=t,this.action_name=n||t,this.action_id=i,this.description=s,this.action_text=a,this.failure_texts=r,this.failure_texts.conditional_loss||(this.failure_texts.conditional_loss=[]),this.failure_texts.random_loss||(this.failure_texts.random_loss=[]),this.failure_texts.unable_to_begin||(this.failure_texts.unable_to_begin=[]),this.success_text=o,this.required=d,_.length>2)throw new Error("LocationAction cannot have more than 2 sets of conditions!");this.conditions=_,this.display_conditions=c,this.check_conditions_on_finish=k,this.rewards=h,this.attempt_duration=f,this.success_chances=y,this.is_unlocked=b,this.is_finished=!1,this.repeatable=w,this.unlock_text=H}get_conditions_status(t){return Ai(this.conditions,t)}can_be_started(t){return Ai([this.required],t)}can_be_displayed(t){return Ai([this.display_conditions],t)}};var $={},Jt=class{constructor({name:t,id:i,starting_text:n=`Talk to the ${t}`,ending_text:s="Go back",is_unlocked:a=!0,is_finished:o=!1,textlines:r={},actions:d={},description:c="",getDescription:_=()=>this.description,location_name:h}){this.name=t,this.id=i||this.name,this.starting_text=n,this.ending_text=s,this.is_unlocked=a,this.is_finished=o,this.textlines=r,this.actions=d,this.description=c,this.getDescription=_,this.location_name=h,Object.keys(this.textlines).forEach(f=>{let y=this.textlines[f];y.locks_lines&&(y.rewards.locks.textlines[this.id]||(y.rewards.locks.textlines[this.id]=[]),y.rewards.locks.textlines[this.id].push(...y.locks_lines))})}},A=class{constructor({name:t,text:i,getText:n,is_unlocked:s=!0,is_finished:a=!1,is_branch_only:o=!1,rewards:r={textlines:[],locations:[],dialogues:[],traders:[],stances:[],flags:[],items:[],locks:{textlines:{}}},branches_into:d=[],locks_lines:c=[],otherUnlocks:_,required_flags:h,display_conditions:f=[]}){this.name=t,this.text=i,this.getText=n||function(){return this.text},this.otherUnlocks=_||function(){},this.is_unlocked=s,this.is_finished=a,this.is_branch_only=o,this.rewards=r||{},this.branches_into=d,this.rewards.textlines=r.textlines||[],this.rewards.locations=r.locations||[],this.rewards.dialogues=r.dialogues||[],this.rewards.traders=r.traders||[],this.rewards.stances=r.stances||[],this.rewards.flags=r.flags||[],this.rewards.items=r.items||[],this.display_conditions=[f],this.required_flags=h,this.locks_lines=c,this.rewards.locks=r.locks||{},this.rewards.locks.textlines||(this.rewards.locks.textlines={})}},Fn=class extends Pe{constructor(t){super(t),this.giveup_text=t.giveup_text,this.floating_click_effects=t.floating_click_effects}};(function(){$["village elder"]=new Jt({name:"village elder",textlines:{hello:new A({name:"elder hello",text:"elder hello answ",rewards:{textlines:[{dialogue:"village elder",lines:["what happened","where am i","dont remember","about"]}]},locks_lines:["hello"]}),"what happened":new A({name:"elder head hurts",text:"elder head hurts answ",is_unlocked:!1,locks_lines:["what happened","where am i","dont remember"],rewards:{textlines:[{dialogue:"village elder",lines:["ask to leave 1"]}],quest_progress:[{quest_id:"Lost memory",task_index:0}]}}),"where am i":new A({name:"elder where",text:"elder where answ",is_unlocked:!1,locks_lines:["what happened","where am i","dont remember"],rewards:{textlines:[{dialogue:"village elder",lines:["ask to leave 1"]}],quest_progress:[{quest_id:"Lost memory",task_index:0}]}}),"dont remember":new A({name:"elder remember",text:"elder remember answ",is_unlocked:!1,locks_lines:["what happened","where am i","dont remember"],rewards:{textlines:[{dialogue:"village elder",lines:["ask to leave 1"]}],quest_progress:[{quest_id:"Lost memory",task_index:0}]}}),about:new A({name:"elder who",text:"elder who answ",is_unlocked:!1,locks_lines:["about"]}),"ask to leave 1":new A({name:"elder leave 1",text:"elder leave 1 answ",is_unlocked:!1,rewards:{textlines:[{dialogue:"village elder",lines:["need to"]}]},locks_lines:["ask to leave 1"]}),"need to":new A({name:"elder need to",text:"elder need to answ",is_unlocked:!1,rewards:{textlines:[{dialogue:"village elder",lines:["rats","ask to leave 2","equipment"]}],locations:[{location:"Infested field"}],activities:[{location:"Village",activity:"weightlifting"},{location:"Village",activity:"running"}],quest_progress:[{quest_id:"Lost memory",task_index:1}]},locks_lines:["need to"]}),equipment:new A({name:"elder eq",text:"elder eq answ",is_unlocked:!1,locks_lines:["equipment"],rewards:{textlines:[{dialogue:"village elder",lines:["money"]}],traders:[{trader:"village trader"}]}}),money:new A({name:"elder money",text:"elder money answ",is_unlocked:!1,locks_lines:["money"],rewards:{activities:[{location:"Village",activity:"fieldwork"}]}}),"ask to leave 2":new A({name:"elder leave 2",text:"elder leave 2 answ",is_unlocked:!1,rewards:{}}),rats:new A({name:"elder rats",text:"elder rats answ",is_unlocked:!1}),"cleared field":new A({name:"elder cleared 1",text:"elder cleared 1 answ",is_unlocked:!1,rewards:{locations:[{location:"Nearby cave"},{location:"Infested field"},{location:"Shack"}],textlines:[{dialogue:"village elder",lines:["ask to leave 3"]}],dialogues:["old craftsman"]},locks_lines:["ask to leave 2","cleared field"]}),"ask to leave 3":new A({name:"elder leave 3",text:"elder leave 3 answ",rewards:{locations:[{location:"Nearby cave"},{location:"Infested field"}],dialogues:["old craftsman"]},is_unlocked:!1}),"cleared cave":new A({name:"elder cave clear",text:"elder cave clear answ",is_unlocked:!1,rewards:{textlines:[{dialogue:"village elder",lines:["ask to leave 4"]}],locations:[{location:"Forest road"},{location:"Infested field"},{location:"Nearby cave"}],dialogues:["village guard"],quest_progress:[{quest_id:"Lost memory",task_index:2}]},locks_lines:["ask to leave 3","rats","cleared cave"]}),"ask to leave 4":new A({name:"elder leave 4",text:"elder leave 4 answ",is_unlocked:!1,rewards:{locations:[{location:"Forest road"},{location:"Infested field"},{location:"Nearby cave"}],dialogues:["village guard","old craftsman"]}}),"new tunnel":new A({name:"elder tunnel",text:"elder tunnel answ",is_unlocked:!1,locks_lines:["new tunnel"]}),"more training":new A({name:"elder training",getText:e=>e?.season==="Winter"?"elder training answ 2":"elder training answ 1",is_unlocked:!1,locks_lines:["more training"],rewards:{global_activities:["swimming","climbing"],actions:[{location:"Nearby cave",action:"climb the mountain"}],locks:{quests:["Swimming alternative unlock"]}}})},description:"elder description"}),$["old craftsman"]=new Jt({name:"old craftsman",is_unlocked:!1,textlines:{hello:new A({name:"craftsman hello",text:"craftsman hello answ",rewards:{textlines:[{dialogue:"old craftsman",lines:["learn","leave"]}]},locks_lines:["hello"]}),learn:new A({name:"craftsman learn",text:"craftsman learn answ",rewards:{textlines:[{dialogue:"old craftsman",lines:["remind1","remind2","remind3","remind4"]}],items:["Old pickaxe","Old axe","Old sickle","Old shovel"],flags:["is_gathering_unlocked","is_crafting_unlocked"]},locks_lines:["learn","leave"],is_unlocked:!1}),leave:new A({name:"craftsman leave",text:"craftsman leave answ",is_unlocked:!1}),remind1:new A({name:"craftsman remind 1",text:"craftsman remind 1 answ",is_unlocked:!1,rewards:{textlines:[{dialogue:"old craftsman",lines:["remind4"]}]}}),remind2:new A({name:"craftsman remind 2",text:"craftsman remind 2 answ",is_unlocked:!1,rewards:{textlines:[{dialogue:"old craftsman",lines:["remind4"]}]}}),remind3:new A({name:"craftsman remind 3",text:"craftsman remind 3 answ",is_unlocked:!1,rewards:{textlines:[{dialogue:"old craftsman",lines:["remind4"]}]}}),remind4:new A({name:"craftsman remind 4",text:"craftsman remind 4 answ",is_unlocked:!1})},description:"craftsman description"}),$["village guard"]=new Jt({name:"village guard",is_unlocked:!1,textlines:{hello:new A({name:"guard hello",text:"guard hello answ",rewards:{textlines:[{dialogue:"village guard",lines:["tips","job"]}]},locks_lines:["hello"]}),job:new A({name:"guard job",is_unlocked:!1,text:"guard job answ",rewards:{activities:[{location:"Village",activity:"patrolling"}]},locks_lines:["job"]}),tips:new A({name:"guard tips",is_unlocked:!1,text:"guard tips answ",rewards:{textlines:[{dialogue:"village guard",lines:["teach"]}]}}),teach:new A({name:"guard teach",is_unlocked:!1,text:"guard teach answ",rewards:{locations:[{location:"Sparring with the village guard (quick)"},{location:"Sparring with the village guard (heavy)"}]},locks_lines:["teach"]}),quick:new A({name:"guard quick",is_unlocked:!1,text:"guard quick answ",otherUnlocks:()=>{$["village guard"].textlines.heavy.is_finished&&($["village guard"].textlines.wide.is_unlocked=!0)},locks_lines:["quick"],rewards:{stances:["quick"]}}),heavy:new A({name:"guard heavy",is_unlocked:!1,text:"guard heavy answ",otherUnlocks:()=>{$["village guard"].textlines.quick.is_finished&&($["village guard"].textlines.wide.is_unlocked=!0)},locks_lines:["heavy"],rewards:{stances:["heavy"]}}),wide:new A({name:"guard wide",is_unlocked:!1,text:"guard wide answ",locks_lines:["wide"],rewards:{stances:["wide"]}})},description:"guard description"}),$["gate guard"]=new Jt({name:"gate guard",textlines:{enter:new A({name:"g guard hello",text:"g guard hello answ"})},description:"g guard description"}),$["suspicious man"]=new Jt({name:"suspicious man",textlines:{hello:new A({name:"sus hello",text:"sus hello answ",rewards:{locations:[{location:"Fight off the assailant"}]},locks_lines:["hello"]}),defeated:new A({name:"sus defeated",is_unlocked:!1,text:"sus defeated answ",locks_lines:["defeated"],rewards:{textlines:[{dialogue:"suspicious man",lines:["behave","situation"]}],quest_progress:[{quest_id:"Lost memory",task_index:3}]}}),behave:new A({name:"sus behave",is_unlocked:!1,text:"sus behave answ",locks_lines:["defeated"],rewards:{textlines:[{dialogue:"suspicious man",lines:["situation","boss"]}]}}),boss:new A({name:"sus boss",is_unlocked:!1,text:"sus boss answ",locks_lines:["boss"]}),situation:new A({name:"sus situation",is_unlocked:!1,text:"sus situation answ",locks_lines:["situation"],rewards:{textlines:[{dialogue:"suspicious man",lines:["gang","boss"]}]}}),gang:new A({name:"sus gang",is_unlocked:!1,text:"sus gang answ",locks_lines:["gang","behave"],rewards:{textlines:[{dialogue:"suspicious man",lines:["gang","behave 2"]}],locations:[{location:"Gang hideout"}],quest_progress:[{quest_id:"Light in the darkness",task_index:0}]}}),"defeated gang":new A({name:"sus gang defeated",is_unlocked:!1,text:"sus gang defeated answ",locks_lines:["defeated gang"],rewards:{textlines:[{dialogue:"suspicious man",lines:["tricks"]}],dialogues:["old woman of the slums"]}}),"behave 2":new A({name:"sus behave 2",is_unlocked:!1,text:"sus behave 2 answ"}),"behave 3":new A({name:"sus behave 3",is_unlocked:!1,text:"sus behave 3 answ",rewards:{textlines:[{dialogue:"suspicious man",lines:["tricks"]}],dialogues:["old woman of the slums"],actions:[{dialogue:"suspicious man",action:"headpat"}]}}),tricks:new A({name:"sus tricks",is_unlocked:!1,text:"sus tricks answ",rewards:{stances:["defensive"]},locks_lines:["tricks"]})},getDescription:()=>$["suspicious man"].textlines["defeated gang"].is_finished?"sus description 2":"sus description 1",actions:{headpat:new Fn({action_id:"headpat",is_unlocked:!1,repeatable:!0,starting_text:"sus headpat",floating_click_effects:["(* ^ \u03C9 ^)	","<(\uFFE3\uFE36\uFFE3)>	","(*\u2267\u03C9\u2266*)	","(\u15D2\u2A4A\u15D5)","(= \u2A4A =)"],description:"",action_text:"",success_text:"sus headpat answ",display_conditions:{flags:["is_mofu_mofu_enabled"]},attempt_duration:0,success_chances:[1]})}}),$["old woman of the slums"]=new Jt({name:"old woman of the slums",is_unlocked:!1,textlines:{hello:new A({name:"old hello",text:"old hello answ",locks_lines:["hello"],rewards:{textlines:[{dialogue:"old woman of the slums",lines:["dinner"]}]}}),dinner:new A({name:"old dinner",is_unlocked:!1,text:"old dinner answ",locks_lines:["dinner"],rewards:{textlines:[{dialogue:"old woman of the slums",lines:["ingredients"]}]}}),ingredients:new A({name:"old ingredients",is_unlocked:!1,text:"old ingredients answ",locks_lines:["ingredients"],rewards:{activities:[{location:"Town outskirts",activity:"herbalism"}]}})},getDescription:()=>$["old woman of the slums"].textlines.hello.is_finished?"old description 2":"old description 1"}),$["farm supervisor"]=new Jt({name:"farm supervisor",textlines:{hello:new A({name:"sup hello",text:"sup hello answ",rewards:{textlines:[{dialogue:"farm supervisor",lines:["things","work","animals","fight","fight0","anything"]}]},locks_lines:["hello"]}),work:new A({name:"sup work",is_unlocked:!1,text:"sup work answ",rewards:{activities:[{location:"Town farms",activity:"fieldwork"}]},locks_lines:["work"]}),anything:new A({name:"sup anything",is_unlocked:!1,text:"sup anything answ",rewards:{actions:[{dialogue:"farm supervisor",action:"bonemeal1"}],quests:["Bonemeal delivery"]},locks_lines:["anything"]}),"more bonemeal":new A({name:"sup bonemeal",is_unlocked:!1,text:"sup bonemeal answ",rewards:{actions:[{dialogue:"farm supervisor",action:"bonemeal2"}]},locks_lines:["more bonemeal"]}),animals:new A({name:"sup animals",is_unlocked:!1,text:"sup animals answ",required_flags:{yes:["is_gathering_unlocked"]},rewards:{activities:[{location:"Town farms",activity:"animal care"}]},locks_lines:["animals"]}),fight0:new A({name:"sup fight0",is_unlocked:!1,text:"sup fight0 answ",required_flags:{no:["is_strength_proved"]},rewards:{quests:["Ploughs to swords"]}}),fight:new A({name:"sup fight",is_unlocked:!1,text:"sup fight answ",required_flags:{yes:["is_strength_proved"]},rewards:{actions:[{location:"Forest road",action:"search for boars"}],quests:["Ploughs to swords"],quest_progress:[{quest_id:"Ploughs to swords",task_index:0}]},locks_lines:["fight"]}),things:new A({is_unlocked:!1,name:"sup things",text:"sup things answ",rewards:{textlines:[{dialogue:"farm supervisor",lines:["animals","fight","fight0","anything"]}]}}),"defeated boars":new A({is_unlocked:!1,name:"sup defeated boars",text:"sup defeated boars answ",locks_lines:["defeated boars"],rewards:{money:4e3,quest_progress:[{quest_id:"Ploughs to swords",task_index:1}],textlines:[{dialogue:"farm supervisor",lines:["troubled"]}]}}),troubled:new A({is_unlocked:!1,name:"sup troubled",text:"sup troubled answ",locks_lines:["troubled"],display_conditions:{season:{not:"Winter"}},rewards:{quest_progress:[{quest_id:"Ploughs to swords",task_index:2}],actions:[{location:"Town farms",action:"dig for ants 1"}]}}),"eliminated ants":new A({is_unlocked:!1,name:"sup eliminated",text:"sup eliminated answ",locks_lines:["eliminated ants"],rewards:{quest_progress:[{quest_id:"Ploughs to swords",task_index:3}]}})},actions:{bonemeal1:new Fn({action_id:"bonemeal1",starting_text:"sup deliver",description:"",action_text:"",success_text:"sup deliver answ",failure_texts:{unable_to_begin:["sup deliver not"]},required:{items_by_id:{Bonemeal:{count:50,remove_on_success:!0}}},attempt_duration:0,success_chances:[1],rewards:{quest_progress:[{quest_id:"Bonemeal delivery",task_index:0}],textlines:[{dialogue:"farm supervisor",lines:["more bonemeal"]}]}}),bonemeal2:new Fn({action_id:"bonemeal2",starting_text:"sup deliver 2",description:"",action_text:"",success_text:"sup deliver 2 answ",repeatable:!0,failure_texts:{unable_to_begin:["sup deliver 2 not"]},required:{items_by_id:{Bonemeal:{count:50,remove_on_success:!0}}},attempt_duration:0,success_chances:[1],rewards:{money:2e3}})},description:"sup description"})})();var x={},qa=class{constructor({name:t,description:i,action_text:n,base_skills_names:s,is_unlocked:a=!1,getBackgroundNoises:o}){this.name=t,this.description=i,this.action_text=n,this.base_skills_names=s,this.tags=[],this.is_unlocked=a,this.getBackgroundNoises=o||function(){return[]}}},Ma=class extends qa{constructor(t){super(t),this.type="JOB",this.payment_type=t.payment_type}},Xt=class extends qa{constructor(t){super(t),this.type="TRAINING"}},Bi=class extends Xt{constructor({name:t,description:i,action_text:n,base_skills_names:s,is_unlocked:a=!1,required_tool_type:o,getBackgroundNoises:r=null}){super({name:t,description:i,action_text:n,base_skills_names:s,is_unlocked:a,getBackgroundNoises:r}),this.type="GATHERING",this.tags.gathering=!0,this.required_tool_type=o}};(function(){x.fieldwork=new Ma({name:"fieldwork",action_text:"Working on the fields",description:"It's tiring and doesn't pay much, but it's better than doing nothing",base_skills_names:["Farming"],is_unlocked:!0}),x.patrolling=new Ma({name:"patrolling",action_text:"Patrolling",description:"Nothing ever happens",base_skills_names:["Spatial awareness"],is_unlocked:!0})})();(function(){x.running=new Xt({name:"running",action_text:"Just running around",description:"One of the most basic exercises",base_skills_names:["Running"],is_unlocked:!0}),x.weightlifting=new Xt({name:"weightlifting",action_text:"Carrying heavy things",description:"One of the most basic exercises",base_skills_names:["Weightlifting"],is_unlocked:!0}),x.balancing=new Xt({name:"balancing",action_text:"Trying to keep your balance",description:"One of the most basic exercises",base_skills_names:["Equilibrium"],is_unlocked:!0}),x.swimming=new Xt({name:"swimming",action_text:"Splish, splash, splosh",description:"A rather basic, although somewhat risky exercise",base_skills_names:["Swimming"],is_unlocked:!1}),x.meditating=new Xt({name:"meditating",action_text:"Focusing your mind",description:"A somewhat basic exercise",base_skills_names:["Meditation"],is_unlocked:!0}),x.climbing=new Xt({name:"climbing",action_text:"Looking for next grip to hold to",description:"An advanced exercise that uses majority of muscles in the body",base_skills_names:["Climbing"],is_unlocked:!1})})();(function(){x.mining=new Bi({name:"mining",action_text:"Swinging the pickaxe",description:"Swing you pickaxe against the hard rock",base_skills_names:["Mining"],is_unlocked:!0,required_tool_type:"pickaxe",getBackgroundNoises:()=>["clang clang","clink clink","tink tink","crunch","*Your pickaxe strikes the heart of the rock*"]}),x.digging=new Bi({name:"digging",action_text:"Swinging the shovel",description:"Dig up useful materials with a shovel",base_skills_names:["Digging"],is_unlocked:!0,required_tool_type:"shovel",getBackgroundNoises:()=>["plap plap","plop plop","crunch","thwack","scrape","squelch"]}),x.woodcutting=new Bi({name:"woodcutting",action_text:"Gathering wood",description:"Chop chop",base_skills_names:["Woodcutting"],is_unlocked:!0,required_tool_type:"axe",getBackgroundNoises:()=>["chop","CHOP chop","chop CHOP","chop chop","creeeak","Sap oozes from the gash","*Splinters burst from under your axe*","*A pinecone falls on you*","*A squirrel is upset with you*"]}),x.herbalism=new Bi({name:"herbalism",action_text:"Searching for herbs",description:"Look for any useful plants and mushrooms",base_skills_names:["Herbalism"],is_unlocked:!0,required_tool_type:"sickle",getBackgroundNoises:()=>["*rustle*","A frog is watching you work","You find a particularly impressive snail under a leaf"]}),x["animal care"]=new Bi({name:"animal care",action_text:"Tending to animals",description:"Take care of animals",base_skills_names:["Animal handling"],is_unlocked:!0})})();var X={},Ot={},fe={SMALL:"small",MEDIUM:"medium",LARGE:"large"},$a={beast:"Butchering"},Ea={};Object.keys($a).forEach(e=>{Ea[$a[e]]=e});var ue=class{constructor({name:t,id:i,description:n,xp_value:s=1,stats:a,rank:o,loot_list:r=[],size:d="small",add_to_bestiary:c=!0,tags:_=[]}){this.name=t,this.id=i||t,this.rank=o,this.description=n,this.xp_value=s,this.stats=a,this.stats.max_health=a.health,this.loot_list=r,this.tags={};for(let h=0;h<_.length;h++)this.tags[_[h]]=!0;if(this.tags[d]=!0,this.add_to_bestiary=c,d!==fe.SMALL&&d!==fe.MEDIUM&&d!==fe.LARGE)throw new Error(`No such enemy size option as "${d}"!`);this.size=d}get_loot({drop_chance_modifier:t=1}={}){let i=[],n;for(let s=0;s<this.loot_list.length;s++)if(n=this.loot_list[s],n.chance*this.get_droprate_modifier(t)>=Math.random()){let a=1;"count"in n&&(a=Math.round(Math.random()*(n.count.max-n.count.min)+n.count.min)),i.push({item_id:n.item_name,count:a})}return i}get_droprate_modifier(t=1){let i=1*t;return Object.keys(this.tags).forEach(n=>{$a[n]&&(i*=C({skill_id:$a[n],scaling_type:"multiplicative"}))}),i}};(function(){X["Starving wolf rat"]=new ue({name:"Starving wolf rat",description:"Rat with size of a dog, starved and weakened",xp_value:1,rank:1,size:"small",tags:["living","beast","wolf rat"],stats:{health:20,attack:4,agility:5,dexterity:4,magic:0,intuition:5,attack_speed:.8,defense:1},loot_list:[{item_name:"Rat tail",chance:.04},{item_name:"Rat fang",chance:.04},{item_name:"Rat pelt",chance:.01}]}),X["Wolf rat"]=new ue({name:"Wolf rat",description:"Rat with size of a dog",xp_value:1,rank:1,size:"small",tags:["living","beast","wolf rat"],stats:{health:30,attack:6,agility:6,dexterity:5,intuition:6,magic:0,attack_speed:1,defense:2},loot_list:[{item_name:"Rat tail",chance:.04},{item_name:"Rat fang",chance:.04},{item_name:"Rat pelt",chance:.01}]}),X["Elite wolf rat"]=new ue({name:"Elite wolf rat",description:"Rat with size of a dog, much more ferocious than its relatives",xp_value:4,rank:1,size:fe.SMALL,tags:["living","beast","wolf rat"],stats:{health:80,attack:32,agility:30,dexterity:24,intuition:24,magic:0,attack_speed:1.5,defense:8},loot_list:[{item_name:"Rat tail",chance:.04},{item_name:"Rat fang",chance:.04},{item_name:"Rat pelt",chance:.02}]}),X["Elite wolf rat guardian"]=new ue({name:"Elite wolf rat guardian",description:"It's no longer dog-sized, but rather around the size of an average wolf, with thicker skin, longer claws and pure insanity in the eyes",xp_value:15,rank:4,size:fe.MEDIUM,tags:["living","beast","wolf rat","monster"],stats:{health:600,attack:60,agility:50,dexterity:50,intuition:50,magic:0,attack_speed:1.2,defense:30},loot_list:[{item_name:"Rat tail",chance:.04},{item_name:"Rat fang",chance:.04},{item_name:"Rat pelt",chance:.02},{item_name:"Weak monster bone",chance:.005}]}),X["Wall rat"]=new ue({name:"Wall rat",description:"They don't live in the walls, they ARE the walls. Insane writhing masses of teeth, fangs, and tails, that make no logical sense. An abomination that cannot exist, and yet it does.",xp_value:30,rank:6,size:fe.LARGE,tags:["living","beast","wolf rat","monster","eldritch"],stats:{health:2e3,attack:70,agility:2,dexterity:120,intuition:90,magic:0,attack_speed:2,attack_count:3,defense:20},loot_list:[{item_name:"Rat tail",chance:.08},{item_name:"Rat fang",chance:.08}]}),X["Starving wolf"]=new ue({name:"Starving wolf",description:"A big, wild and hungry canine",xp_value:3,rank:2,tags:["living","beast"],stats:{health:200,attack:22,agility:34,dexterity:34,intuition:32,magic:0,attack_speed:1,defense:12},loot_list:[{item_name:"Wolf fang",chance:.03},{item_name:"Wolf pelt",chance:.01}],size:fe.MEDIUM}),X["Young wolf"]=new ue({name:"Young wolf",description:"A small, wild canine",xp_value:3,rank:2,tags:["living","beast"],stats:{health:150,attack:25,agility:34,dexterity:30,intuition:24,magic:0,attack_speed:1.4,defense:6},loot_list:[{item_name:"Wolf fang",chance:.03},{item_name:"Wolf pelt",chance:.01}],size:fe.SMALL}),X.Wolf=new ue({name:"Wolf",description:"A large, wild canine",xp_value:6,rank:3,tags:["living","beast"],stats:{health:250,attack:40,agility:50,dexterity:50,intuition:40,magic:0,attack_speed:1.3,defense:20},loot_list:[{item_name:"Wolf fang",chance:.04},{item_name:"Wolf pelt",chance:.02},{item_name:"High quality wolf fang",chance:5e-4}],size:fe.MEDIUM}),X.Direwolf=new ue({name:"Direwolf",description:"A powerful wild wolf variant of unmatched ferocity",xp_value:20,rank:7,tags:["living","beast"],stats:{health:1e3,attack:160,agility:160,dexterity:70,intuition:70,magic:0,attack_speed:1.4,defense:30},loot_list:[{item_name:"Wolf fang",chance:.08},{item_name:"Wolf pelt",chance:.04},{item_name:"High quality wolf fang",chance:.001},{item_name:"Weak monster bone",chance:.02}],size:fe.MEDIUM}),X["Direwolf hunter"]=new ue({name:"Direwolf hunter",description:"A powerful wild wolf variant of unmatched ferocity, the strongest and heaviest out of all direwolves",xp_value:30,rank:8,tags:["living","beast"],stats:{health:2e3,attack:240,agility:130,dexterity:80,intuition:90,magic:0,attack_speed:1.1,defense:40},loot_list:[{item_name:"Wolf fang",chance:.12},{item_name:"Wolf pelt",chance:.06},{item_name:"Weak monster bone",chance:.02},{item_name:"High quality wolf fang",chance:.0015}],size:fe.MEDIUM}),X.Boar=new ue({name:"Boar",description:"A big wild creature, with thick skin and large tusks",xp_value:10,rank:4,tags:["living","beast"],stats:{health:600,attack:50,agility:30,dexterity:50,intuition:60,magic:0,attack_speed:1,defense:35},loot_list:[{item_name:"Boar hide",chance:.04},{item_name:"Boar meat",chance:.02},{item_name:"Boar tusk",chance:.02},{item_name:"High quality boar tusk",chance:5e-4}],size:fe.MEDIUM}),X["Angry mountain goat"]=new ue({name:"Angry mountain goat",description:"It's a mountain goat and it's angry",xp_value:15,rank:6,tags:["living","beast"],size:fe.MEDIUM,stats:{health:600,attack:120,agility:100,dexterity:60,magic:0,intuition:60,attack_speed:.5,defense:50},loot_list:[{item_name:"Mountain goat hide",chance:.04},{item_name:"Goat meat",chance:.02},{item_name:"Mountain goat horn",chance:.02},{item_name:"Pristine mountain goat horn",chance:5e-4}]}),X["Forest bear"]=new ue({name:"Forest bear",description:"A mighty and dangerous predator with thick skin, sharp teeth, and dangerous claws",xp_value:50,rank:9,tags:["living","beast"],stats:{health:3e3,attack:300,agility:160,dexterity:200,intuition:100,magic:0,attack_speed:.7,defense:300},loot_list:[{item_name:"Bear hide",chance:.05},{item_name:"Bear claw",chance:.1},{item_name:"Sharp bear claw",chance:.002}],size:fe.LARGE}),X["Red ant swarm"]=new ue({name:"Red ant swarm",description:"A swarm of angry red ants, each the size of a regular rat",xp_value:20,rank:7,tags:["living","insect"],stats:{health:600,attack:4,agility:100,dexterity:200,intuition:100,magic:0,attack_speed:1.5,attack_count:30,defense:10},size:fe.SMALL}),X["Red ant queen"]=new ue({name:"Red ant queen",description:"A red ant queen, despite her decent size she's not much of a fighter",xp_value:10,rank:5,tags:["living","insect"],stats:{health:200,attack:20,agility:50,dexterity:200,intuition:100,magic:0,attack_speed:.5,defense:20},size:fe.SMALL}),X["Slums thug"]=new ue({name:"Slums thug",description:"A nasty thug with shabby equipment",xp_value:10,rank:5,tags:["living","human"],size:fe.MEDIUM,stats:{health:500,attack:60,agility:60,dexterity:60,magic:0,intuition:60,attack_speed:1.7,defense:45}})})();(function(){X["Village guard (heavy)"]=new ue({name:"Village guard (heavy)",description:"",add_to_bestiary:!1,xp_value:1,rank:4,tags:["living","human"],size:fe.MEDIUM,stats:{health:300,attack:50,agility:20,dexterity:80,magic:0,intuition:20,attack_speed:.2,defense:30}}),X["Village guard (quick)"]=new ue({name:"Village guard (quick)",description:"",add_to_bestiary:!1,xp_value:1,rank:4,tags:["living","human"],size:fe.MEDIUM,stats:{health:300,attack:20,agility:20,dexterity:50,magic:0,intuition:20,attack_speed:2,defense:10}}),X["Suspicious wall"]=new ue({name:"Suspicious wall",description:"",add_to_bestiary:!1,xp_value:1,rank:1,tags:["inanimate"],size:fe.LARGE,stats:{health:1e4,attack:0,agility:0,dexterity:0,magic:0,intuition:0,attack_speed:1e-6,defense:100}}),X["Suspicious man"]=new ue({name:"Suspicious man",description:"",add_to_bestiary:!1,xp_value:1,rank:5,tags:["living","human"],size:fe.MEDIUM,stats:{health:400,attack:60,agility:60,dexterity:60,magic:0,intuition:60,attack_speed:2,defense:30}}),X["Angry-looking mountain goat"]=new ue({name:"Angry-looking mountain goat",description:"It's a mountain goat and it's angry",add_to_bestiary:!1,xp_value:1,rank:6,tags:["living","beast"],size:fe.MEDIUM,stats:{health:1200,attack:150,agility:100,dexterity:70,magic:0,intuition:60,attack_speed:.5,defense:60}})})();var m={},Ke={},at={},Ue=class{constructor({name:t,id:i,description:n,connected_locations:s=[],is_unlocked:a=!0,is_finished:o=!1,dialogues:r=[],traders:d=[],market_region:c=null,types:_=[],housing:h={},light_level:f="normal",getDescription:y,background_noises:b=[],getBackgroundNoises:w,crafting:k=null,tags:H={},is_temperature_static:W=!1,static_temperature:ce=null,reverse_day_night_temperatures:qe=!1,temperature_range_modifier:He=1,temperature_modifier:Ie=0,is_under_roof:Ce=!1,entrance_rewards:Dt}){this.name=t,this.id=i||t,this.description=n,this.getDescription=y||function(){return n},this.background_noises=b,this.getBackgroundNoises=w||function(){return b},this.connected_locations=s,this.is_unlocked=a,this.is_finished=o,this.dialogues=r,this.traders=d,this.market_region=c,this.activities={},this.actions={},this.types=_,this.housing=h,this.light_level=f,this.crafting=k,this.tags=H,this.tags.safe_zone=!0,this.entrance_rewards=Dt,this.is_temperature_static=W,this.static_temperature=ce,this.reverse_day_night_temperatures=qe,this.temperature_range_modifier=He,this.temperature_modifier=Ie,this.is_under_roof=Ce}},be=class{constructor({name:t,id:i,description:n,getDescription:s,is_unlocked:a=!0,is_finished:o=!1,types:r=[],enemy_groups_list:d=[],is_enemy_groups_list_random:c=!0,predefined_lineup_on_nth_group:_=1,enemies_list:h=[],enemy_group_size:f=[1,1],enemy_count:y=30,enemy_stat_variation:b=0,parent_location:w,leave_text:k,first_reward:H={},repeatable_reward:W={},rewards_with_clear_requirement:ce=[],otherUnlocks:qe,unlock_text:He,is_challenge:Ie=!1,tags:Ce={},is_temperature_static:Dt=!1,static_temperature:Yt=null,reverse_day_night_temperatures:tt=!1,temperature_range_modifier:gt=1,temperature_modifier:D=0,is_under_roof:Me=!1}){if(this.name=t,this.id=i||t,this.unlock_text=He,this.description=n,this.getDescription=s||function(){return n},this.otherUnlocks=qe||function(){},this.is_unlocked=a,this.is_finished=o,this.types=r,this.enemy_groups_list=d,this.is_enemy_groups_list_random=c,this.predefined_lineup_on_nth_group=_,this.enemies_list=h,this.enemy_group_size=f,this.enemy_groups_list||(this.enemy_group_size[0]<1&&(this.enemy_group_size[0]=1,console.error(`Minimum enemy group size in zone "${this.name}" is set to unallowed value of ${this.enemy_group_size[0]} and was corrected to lowest value possible of 1`)),this.enemy_group_size[0]>8&&(this.enemy_group_size[0]=8,console.error(`Minimum enemy group size in zone "${this.name}" is set to unallowed value of ${this.enemy_group_size[0]} and was corrected to highest value possible of 8`)),this.enemy_group_size[1]<1&&(this.enemy_group_size[1]=1,console.error(`Maximum enemy group size in zone "${this.name}" is set to unallowed value of ${this.enemy_group_size[1]} and was corrected to lowest value possible of 1`)),this.enemy_group_size[1]>8&&(this.enemy_group_size[1]=8,console.error(`Maximum enemy group size in zone "${this.name}" is set to unallowed value of ${this.enemy_group_size[1]} and was corrected to highest value possible of 8`))),this.enemy_count=y,this.enemy_groups_list.length==0&&this.enemies_list.length==0)throw new Error(`No enemies provided for zone "${this.name}"`);if(this.enemy_groups_killed=0,this.enemy_stat_variation=b,this.enemy_stat_variation<0&&(this.enemy_stat_variation=0,console.error(`Stat variation for enemies in zone "${this.name}" is set to unallowed value and was corrected to a default 0`)),this.parent_location=w,!m[this.parent_location.id])throw new Error(`Couldn't add parent location "${this.parent_location.name}" to zone "${this.name}"`);this.leave_text=k,this.first_reward=H,this.repeatable_reward=W,this.rewards_with_clear_requirement=ce,this.is_challenge=Ie,this.gained_skills=this.types?.map(se=>({skill:p[Ke[se.type].stages[se.stage||1].related_skill],xp:se.xp_gain})).filter(se=>se.skill);let it=this.types.map(se=>se.type);it.includes("bright")?this.light_level="bright":it.includes("dark")?this.light_level="dark":this.light_level="normal",this.tags=Ce,this.tags["Combat zone"]=!0,this.is_temperature_static=Dt,this.static_temperature=Yt,this.reverse_day_night_temperatures=tt,this.temperature_range_modifier=gt,this.temperature_modifier=D,this.is_under_roof=Me}get_next_enemies(){let t=[],i=[];if(this.enemy_groups_list.length>0&&this.enemy_groups_killed%this.predefined_lineup_on_nth_group==0&&(this.enemy_groups_killed>0||this.predefined_lineup_on_nth_group==0))if(this.is_enemy_groups_list_random){let n=Math.floor(Math.random()*this.enemy_groups_list.length);i=this.enemy_groups_list[n].enemies}else{let n=this.enemy_groups_killed%this.enemy_groups_list.length;i=this.enemy_groups_list[n].enemies}else{let n=this.enemy_group_size[0]+Math.round(Math.random()*(this.enemy_group_size[1]-this.enemy_group_size[0]));for(let s=0;s<n;s++)i.push(this.enemies_list[Math.floor(Math.random()*this.enemies_list.length)])}for(let n=0;n<i.length;n++){let s=X[i[n]],a;if(this.enemy_stat_variation!=0){let o=Math.random()*this.enemy_stat_variation,r=1+o,d=2*o;a=new ue({name:s.name,description:s.description,xp_value:s.xp_value,stats:{health:Math.round(s.stats.health*(r-Math.random()*d)),attack:Math.round(s.stats.attack*(r-Math.random()*d)),agility:Math.round(s.stats.agility*(r-Math.random()*d)),dexterity:Math.round(s.stats.dexterity*(r-Math.random()*d)),magic:Math.round(s.stats.magic*(r-Math.random()*d)),intuition:Math.round(s.stats.intuition*(r-Math.random()*d)),attack_speed:Math.round(s.stats.attack_speed*(r-Math.random()*d)*100)/100,attack_count:Math.round((s.stats.attack_count||1)*(r-Math.random()*d)),defense:Math.round(s.stats.defense*(r-Math.random()*d))},loot_list:s.loot_list,add_to_bestiary:s.add_to_bestiary,size:s.size})}else a=new ue({name:s.name,description:s.description,xp_value:s.xp_value,stats:{health:s.stats.health,attack:s.stats.attack,agility:s.stats.agility,dexterity:s.stats.dexterity,magic:s.stats.magic,intuition:s.stats.intuition,attack_speed:s.stats.attack_speed,attack_count:s.stats.attack_count||1,defense:s.stats.defense},loot_list:s.loot_list,add_to_bestiary:s.add_to_bestiary,size:s.size});a.is_alive=!0,t.push(a)}return t}get_total_effect(){let t={multipliers:{},flats:{}},i={multipliers:{},flats:{}};for(let n=0;n<this.types.length;n++){let s=Ke[this.types[n].type].stages[this.types[n].stage];!s.related_skill||!s.effects||Object.keys(s.effects).forEach(a=>{s.effects[a].multiplier&&(t.multipliers[a]=(t.multipliers[a]||1)*s.effects[a].multiplier,i.multipliers[a]=(i.multipliers[a]||1)*zn(this.types[n].type,this.types[n].stage,a,"multiplier")),s.effects[a].flat&&(t.flats[a]=(t.flats[a]||0)+s.effects[a].flat,i.flats[a]=(i.flats[a]||0)+zn(this.types[n].type,this.types[n].stage,a,"flat"))})}return{base_penalty:t,hero_penalty:i}}},Hi=class extends be{constructor({name:t,description:i,getDescription:n,is_unlocked:s=!0,types:a=[],enemy_groups_list:o=[],enemies_list:r=[],enemy_group_size:d=[1,1],enemy_count:c=30,parent_location:_,leave_text:h,first_reward:f={},repeatable_reward:y={},otherUnlocks:b,is_finished:w,unlock_text:k}){super({name:t,description:i,getDescription:n,is_unlocked:s,types:a,enemy_groups_list:o,enemies_list:r,enemy_group_size:d,enemy_count:c,enemy_stat_variation:0,parent_location:_,leave_text:h,first_reward:f,repeatable_reward:y,is_challenge:!0,otherUnlocks:b,is_finished:w,unlock_text:k})}},oe=class{constructor({activity_name:t,starting_text:i,get_payment:n=()=>1,is_unlocked:s=!0,working_period:a=60,infinite:o=!1,availability_time:r,availability_seasons:d,skill_xp_per_tick:c=1,unlock_text:_,gained_resources:h,require_tool:f=!1,applied_effects:y=[]}){Nn(this,"getActivityEfficiency",function(){let t=1;if(this.gained_resources.scales_with_skill){let s=0;for(let a=0;a<x[this.activity_name].base_skills_names?.length;a++)s+=Math.min(this.gained_resources.skill_required[1]-this.gained_resources.skill_required[0]+1,Math.max(0,R(x[this.activity_name].base_skills_names[a])-this.gained_resources.skill_required[0]+1))/(this.gained_resources.skill_required[1]-this.gained_resources.skill_required[0]+1);t=s/(x[this.activity_name].base_skills_names?.length||1)}let i=Math.floor(this.gained_resources.time_period[0]*(this.gained_resources.time_period[1]/this.gained_resources.time_period[0])**t),n=[];for(let s=0;s<this.gained_resources.resources.length;s++){let a=this.gained_resources.resources[s].chance[0]*(this.gained_resources.resources[s].chance[1]/this.gained_resources.resources[s].chance[0])**t,o=Math.round(this.gained_resources.resources[s].ammount[0][0]*(this.gained_resources.resources[s].ammount[1][0]/this.gained_resources.resources[s].ammount[0][0])**t),r=Math.round(this.gained_resources.resources[s].ammount[0][1]*(this.gained_resources.resources[s].ammount[1][1]/this.gained_resources.resources[s].ammount[0][1])**t);n.push({name:this.gained_resources.resources[s].name,count:[o,r],chance:a})}return{gathering_time_needed:i,gained_resources:n}});if(this.activity_name=t,this.starting_text=i,this.get_payment=n,this.is_unlocked=s,this.unlock_text=_,this.working_period=a,this.infinite=o,this.infinite&&(r||d)&&console.error("Activity is set to be available all the time, so availability_time value will be ignored!"),!this.infinite&&!(r||d))throw new Error("LocationActivities that are not infinitely available, require a specified time of availability!");this.availability_time=r,this.availability_seasons=d,this.skill_xp_per_tick=c,this.require_tool=f,this.applied_effects=y,this.gained_resources=h}},pi=class{constructor({name:t,related_skill:i,scaling_lvl:n,stages:s={}}){if(this.name=t,this.scaling_lvl=n,i)if(p[i])this.related_skill=i;else throw new Error(`No such skill as "${i}"`);this.stages=s}};function zn(e,t,i,n){let s=p[Ke[e].stages[t].related_skill],a=Ke[e].stages[t].scaling_lvl||s.max_level;if(n==="multiplier")return Ke[e].stages[t].effects[i].multiplier**(1-Math.min(a,R(s.skill_id))/a);if(n==="flat")return Ke[e].stages[t].effects[i].flat*(1-Math.min(a,R(s.skill_id))/a)**.66667;throw new Error(`Unsupported category of stat effects "${n}", should be either "flat" or "multiplier"!`)}(function(){Ke.bright=new pi({name:"bright",stages:{1:{description:"A place that's always lit, no matter the time of the day"},2:{description:"An extremely bright place, excessive light makes it hard to keep eyes open",related_skill:"Dazzle resistance",effects:{attack_points:{multiplier:.5},evasion_points:{multiplier:.5}}},3:{description:"A place with so much light that an average person would go blind in an instant",related_skill:"Dazzle resistance",effects:{attack_points:{multiplier:.1},evasion_points:{multiplier:.1}}}}}),Ke.dark=new pi({name:"dark",stages:{1:{description:"It's dark here, comparable to a bright night",related_skill:"Night vision"},2:{description:"An extremely dark place, darker than most of the nights",related_skill:"Night vision",effects:{attack_points:{multiplier:.8},evasion_points:{multiplier:.8}}},3:{description:"Pure darkness with not even a tiniest flicker of light",related_skill:"Presence sensing",effects:{attack_points:{multiplier:.15},evasion_points:{multiplier:.15}}}}}),Ke.narrow=new pi({name:"narrow",stages:{1:{description:"A narrow area where there's not much place for maneuvering",related_skill:"Tight maneuvers",scaling_lvl:20,effects:{evasion_points:{multiplier:.5}}},2:{description:"A very tight and narrow area where there's not much place for maneuvering",related_skill:"Tight maneuvers",effects:{evasion_points:{multiplier:.333}},scaling_lvl:40},3:{description:"An area so cramped that it's a miracle you can even move",related_skill:"Tight maneuvers",effects:{evasion_points:{multiplier:.1},dexterity:{multiplier:.5}}}}}),Ke.open=new pi({name:"open",stages:{1:{description:"A completely open area where attacks can come from any direction",related_skill:"Spatial awareness",scaling_lvl:30,effects:{evasion_points:{multiplier:.75}}},2:{description:"An area that's completely open and simultanously obstructs your view, making it hard to predict where an attack will come from",related_skill:"Spatial awareness",effects:{evasion_points:{multiplier:.5}}}}}),Ke["thin air"]=new pi({name:"thin air",stages:{1:{description:"Place with thinner air, which negatively impacts your body",related_skill:"Breathing",scaling_lvl:25,effects:{stamina_efficiency:{multiplier:.5},agility:{multiplier:.8},strength:{multiplier:.8},dexterity:{multiplier:.8},intuition:{multiplier:.8}}},2:{description:"Place with very thin air, heavily affecting your body",related_skill:"Breathing",effects:{stamina_efficiency:{multiplier:.1},agility:{multiplier:.5},strength:{multiplier:.5},dexterity:{multiplier:.5},intuition:{multiplier:.5}}}}}),Ke.eldritch=new pi({name:"eldritch",stages:{1:{description:"This place brings a strong sense of unease",related_skill:"Strength of mind",scaling_lvl:30,effects:{agility:{multiplier:.8},dexterity:{multiplier:.8},intuition:{multiplier:.5},stamina_efficiency:{multiplier:.75},health_loss_flat:{flat:-5}}},2:{description:"This place goes against the laws of the world",related_skill:"Strength of mind",effects:{agility:{multiplier:.3},dexterity:{multiplier:.3},intuition:{multiplier:.2},stamina_efficiency:{multiplier:.5},health_loss_flat:{flat:-50}}}}})})();(function(){m.Village=new Ue({getDescription:function(){return m["Infested field"].enemy_groups_killed>=5*m["Infested field"].enemy_count?"Medium-sized village, built next to a small and calm river at the foot of the mountains. It's surrounded by many fields, a few of them infested by huge rats, which, while an annoyance, don't seem possible to fully eradicate. Other than that, there's nothing interesting around":m["Infested field"].enemy_groups_killed>=2*m["Infested field"].enemy_count?"Medium-sized village, built next to a small and calm river at the foot of the mountains. It's surrounded by many fields, many of them infested by huge rats. Other than that, there's nothing interesting around":"Medium-sized village, built next to a small and calm river at the foot of the mountains. It's surrounded by many fields, most of them infested by huge rats. Other than that, there's nothing interesting around"},getBackgroundNoises:function(){let e=["*You hear some rustling*"];return M.hour>4&&M.hour<=20&&(e.push("Anyone seen my cow?","Mooooo!","Tomorrow I'm gonna fix the roof","Look, a bird!"),m["Infested field"].enemy_groups_killed<=3?(e.push("These nasty rats almost ate my cat!"),Oi()&&e.push("These nasty rats almost ate my rat!","These nasty rats almost ate my rat!","These nasty rats almost ate my rat!")):Oi()&&e.push("These nasty rats almost ate my rat!")),M.hour>3&&M.hour<10?e.push("\u266B\u266B Heigh ho, heigh ho, it's off to work I go~ \u266B\u266B","Cock-a-doodle-doo!"):M.hour>18&&M.hour<22&&e.push("\u266B\u266B Heigh ho, heigh ho, it's home from work I go~ \u266B\u266B"),e},dialogues:["village elder","village guard","old craftsman"],traders:["village trader"],market_region:"Village",name:"Village",crafting:{is_unlocked:!0,use_text:"Try to craft something",tiers:{crafting:1,forging:1,smelting:1,cooking:1,alchemy:1,butchering:1,woodworking:1}}}),m.Shack=new Ue({connected_locations:[{location:m.Village,custom_text:"Go outside to [Village]",travel_time:10}],description:"This small shack was the only spare building in the village. It's surprisingly tidy.",name:"Shack",is_unlocked:!1,housing:{is_unlocked:!0,text_to_sleep:"Take a nap",sleeping_xp_per_tick:1},temperature_range_modifier:.4,is_under_roof:!0}),m.Village.connected_locations.push({location:m.Shack,travel_time:10}),m["Infested field"]=new be({description:"Field infested with wolf rats. You can see the grain stalks move as these creatures scurry around.",enemy_count:15,enemies_list:["Starving wolf rat","Wolf rat"],types:[{type:"open",stage:1,xp_gain:1}],enemy_stat_variation:.1,is_unlocked:!1,name:"Infested field",parent_location:m.Village,first_reward:{xp:10,reputation:{village:20}},repeatable_reward:{textlines:[{dialogue:"village elder",lines:["cleared field"]}],xp:5},rewards_with_clear_requirement:[{required_clear_count:1,reputation:{village:10}},{required_clear_count:4,reputation:{village:30}},{required_clear_count:10,reputation:{village:50}}]}),m.Village.connected_locations.push({location:m["Infested field"],travel_time:15}),m["Nearby cave"]=new Ue({connected_locations:[{location:m.Village,custom_text:"Go outside and to the [Village]",travel_time:45}],getDescription:function(){return m["Pitch black tunnel"].enemy_groups_killed>=m["Pitch black tunnel"].enemy_count?"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the cave walls, providing a dim light. Your efforts have secured a decent space and many of the tunnels. It seems like you almost reached the deepest part.":m["Hidden tunnel"].enemy_groups_killed>=m["Hidden tunnel"].enemy_count?"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the walls, providing a dim light. Your efforts have secured a major space and some tunnels, but there are still more places left to clear out.":m["Cave depths"].enemy_groups_killed>=m["Cave depths"].enemy_count?"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the walls, providing a dim light. Your efforts have secured a decent space and even a few tunnels, yet somehow you can still hear the sounds of the wolf rats.":m["Cave room"].enemy_groups_killed>=m["Cave room"].enemy_count?"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the walls, providing a dim light. Your efforts have secured some space, but you can hear more wolf rats in some deeper tunnels.":"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the walls, providing a dim light. You can hear sounds of wolf rats from the nearby room."},getBackgroundNoises:function(){return["*You hear rocks rumbling somewhere*","Squeak!"]},temperature_range_modifier:.8,name:"Nearby cave",is_unlocked:!1,is_under_roof:!0}),m.Village.connected_locations.push({location:m["Nearby cave"],travel_time:45}),m["Cave room"]=new be({description:"It's full of rats. At least the glowing mushrooms provide some light.",enemy_count:25,types:[{type:"narrow",stage:1,xp_gain:3},{type:"bright",stage:1}],enemies_list:["Wolf rat"],enemy_group_size:[2,3],enemy_stat_variation:.2,is_unlocked:!0,name:"Cave room",leave_text:"Go back to entrance",parent_location:m["Nearby cave"],first_reward:{xp:20},repeatable_reward:{locations:[{location:"Cave depths"}],xp:10,activities:[{location:"Nearby cave",activity:"weightlifting"},{location:"Nearby cave",activity:"mining"},{location:"Village",activity:"balancing"}]},rewards_with_clear_requirement:[{required_clear_count:1,reputation:{village:10}},{required_clear_count:4,reputation:{village:20}}],temperature_range_modifier:.7,is_under_roof:!0}),m["Nearby cave"].connected_locations.push({location:m["Cave room"],travel_time:5}),m["Cave depths"]=new be({description:"It's dark. And full of rats.",enemy_count:40,types:[{type:"narrow",stage:1,xp_gain:3},{type:"dark",stage:2,xp_gain:3}],enemies_list:["Wolf rat"],enemy_group_size:[5,8],enemy_stat_variation:.2,is_unlocked:!1,name:"Cave depths",leave_text:"Climb out",parent_location:m["Nearby cave"],first_reward:{xp:30},repeatable_reward:{textlines:[{dialogue:"village elder",lines:["cleared cave"]}],xp:15},rewards_with_clear_requirement:[{required_clear_count:4,locations:[{location:"Suspicious wall"}],reputation:{village:40}}],temperature_range_modifier:.6,is_under_roof:!0}),m["Hidden tunnel"]=new be({description:"There is, in fact, even more rats here.",enemy_count:50,types:[{type:"narrow",stage:1,xp_gain:3},{type:"dark",stage:3,xp_gain:1}],enemies_list:["Elite wolf rat"],enemy_group_size:[1,2],enemy_stat_variation:.2,is_unlocked:!1,name:"Hidden tunnel",leave_text:"Retreat for now",parent_location:m["Nearby cave"],first_reward:{xp:100},repeatable_reward:{locations:[{location:"Pitch black tunnel"}],xp:50,activities:[{location:"Nearby cave",activity:"mining2"}]},is_temperature_static:!1,temperature_range_modifier:.5,is_under_roof:!0,unlock_text:"As the wall falls apart, you find yourself in front of a new tunnel, leading even deeper. And of course, it's full of wolf rats."}),m["Pitch black tunnel"]=new be({description:"There is no light here. Only rats.",enemy_count:50,types:[{type:"narrow",stage:1,xp_gain:6},{type:"dark",stage:3,xp_gain:3}],enemies_list:["Elite wolf rat"],enemy_group_size:[6,8],enemy_stat_variation:.2,is_unlocked:!1,name:"Pitch black tunnel",leave_text:"Retreat for now",parent_location:m["Nearby cave"],first_reward:{xp:200,messages:["As you descend deeper and deeper, a sudden thought strikes you - what if you instead tried going up?"]},repeatable_reward:{xp:100,global_activities:["climbing"],actions:[{location:"Nearby cave",action:"climb the mountain"}]},rewards_with_clear_requirement:[{required_clear_count:4,locations:[{location:"Mysterious gate"}]}],is_temperature_static:!0,static_temperature:16,is_under_roof:!0,unlock_text:"As you keep going deeper, you barely notice a pitch black hole. Not even a tiniest speck of light reaches it."}),m["Mysterious gate"]=new be({description:"It's dark. And full of rats.",enemy_count:50,types:[{type:"dark",stage:3,xp_gain:5}],enemies_list:["Elite wolf rat guardian"],enemy_group_size:[6,8],enemy_stat_variation:.2,is_unlocked:!1,name:"Mysterious gate",leave_text:"Get away",parent_location:m["Nearby cave"],first_reward:{xp:500},repeatable_reward:{xp:250,activities:[{location:"Nearby cave",activity:"meditating"},{location:"Nearby cave",activity:"mining3"}],actions:[{action:"open the gate",location:"Nearby cave"}],quest_progress:[{quest_id:"The Infinite Rat Saga",task_index:0}],flags:["is_strength_proved"]},is_temperature_static:!0,static_temperature:18,is_under_roof:!0,unlock_text:"After a long and ardous fight, you reach a chamber that ends with a massive stone gate. You can see it's guarded by some kind of wolf rats, but much bigger than the ones you fought until now."}),m["Nearby cave"].connected_locations.push({location:m["Cave depths"],travel_time:10},{location:m["Hidden tunnel"],custom_text:"Enter the [Hidden tunnel]",travel_time:20},{location:m["Pitch black tunnel"],custom_text:"Go into the [Pitch black tunnel]",travel_time:35},{location:m["Mysterious gate"],custom_text:"Go to the [Mysterious gate]",travel_time:50}),m["Writhing tunnel"]=new be({description:"The walls are moving...",enemy_count:50,types:[{type:"dark",stage:3,xp_gain:5},{type:"narrow",stage:2,xp_gain:5},{type:"eldritch",stage:1,xp_gain:1}],enemies_list:["Wall rat"],enemy_group_size:[4,4],enemy_stat_variation:.2,is_unlocked:!1,name:"Writhing tunnel",leave_text:"Run away...",parent_location:m["Nearby cave"],first_reward:{xp:2500},repeatable_reward:{xp:1250,locations:[{location:"Mysterious depths"}],quest_progress:[{quest_id:"The Infinite Rat Saga",task_index:2}]},is_temperature_static:!0,static_temperature:20,is_under_roof:!0,unlock_text:"You see something. You struggle to comprehend it. When you finally understand, you regret it instantly. It might have been better to be born blind."}),m["Nearby cave"].connected_locations.push({location:m["Writhing tunnel"],travel_time:55}),m["Mysterious depths"]=new Ue({connected_locations:[{location:m["Nearby cave"],custom_text:"Climb back up to the main level of [Nearby cave]",travel_time:65}],getDescription:function(){return`You find yourself in a large chamber with smooth walls and vaulted ceiling. The floor is covered in square tiles in the center, yet you cannot help but notice that all these squares make a circle, in some impossible to understand way.
There's another gate on the wall in front of you, but you have a strange feeling that you won't be able to open it with brute strength.`},getBackgroundNoises:function(){return["*You hear rocks rumbling somewhere*","Squeak!","*Air vibrates in an impossible to describe manner*","*You feel an immense sense of something being wrong*",'"All these squares make a circle... All these squares make a circle..."']},name:"Mysterious depths",is_unlocked:!1,unlock_text:"You manage to find a way to another chamber.",is_temperature_static:!0,static_temperature:20,is_under_roof:!0}),m["Nearby cave"].connected_locations.push({location:m["Mysterious depths"],custom_text:"Climb down to [Mysterious depths]",travel_time:65}),m["Forest road"]=new Ue({connected_locations:[{location:m.Village,travel_time:180}],description:"Old trodden road leading through a dark forest, the only path connecting the village to the town. You can hear some animals from the surrounding woods.",name:"Forest road",getBackgroundNoises:function(){return["*You hear some rustling*","Roar!","*You almost tripped on some roots*","*You hear some animal running away*"]},is_unlocked:!1}),m.Village.connected_locations.push({location:m["Forest road"],custom_text:"Leave the village towards [Forest road]",travel_time:180}),m.Forest=new be({description:"Forest surrounding the village, a dangerous place",enemies_list:["Starving wolf","Young wolf"],types:[{type:"narrow",stage:1,xp_gain:1}],enemy_count:30,enemy_stat_variation:.2,name:"Forest",parent_location:m["Forest road"],first_reward:{xp:40},repeatable_reward:{xp:20,locations:[{location:"Deep forest"}],activities:[{location:"Forest road",activity:"herbalism"}]}}),m["Forest road"].connected_locations.push({location:m.Forest,custom_text:"Leave the safe path and walk into the [Forest]",travel_time:20}),m["Deep forest"]=new be({description:"Deeper part of the forest, a dangerous place",enemies_list:["Wolf","Starving wolf","Young wolf"],types:[{type:"narrow",stage:1,xp_gain:2}],enemy_count:50,enemy_group_size:[2,3],enemy_stat_variation:.2,is_unlocked:!1,name:"Deep forest",parent_location:m["Forest road"],first_reward:{xp:70},repeatable_reward:{xp:35,flags:["is_strength_proved"],activities:[{location:"Forest road",activity:"woodcutting"}]},rewards_with_clear_requirement:[{required_clear_count:4,actions:[{action:"follow the trail",location:"Forest road"}]}]}),m["Forest road"].connected_locations.push({location:m["Deep forest"],custom_text:"Venture into the [Deep forest]",travel_time:40}),m["Forest clearing"]=new be({description:"A surprisingly big clearing hidden in the northern part of the forest, covered with very tall grass and filled with a mass of wild boars",enemies_list:["Boar"],enemy_count:50,enemy_group_size:[4,7],is_unlocked:!1,enemy_stat_variation:.2,name:"Forest clearing",types:[{type:"open",stage:2,xp_gain:3}],parent_location:m["Forest road"],first_reward:{xp:200},repeatable_reward:{xp:100,textlines:[{dialogue:"farm supervisor",lines:["defeated boars"]}],activities:[{location:"Forest road",activity:"woodcutting2"}]}}),m["Forest road"].connected_locations.push({location:m["Forest clearing"],custom_text:"Go towards the [Forest clearing] in the north",travel_time:40}),m["Forest den"]=new be({description:"A relatively large cave in the depths of the forest, filled with hordes of direwolves.",enemies_list:["Direwolf"],enemy_count:50,enemy_group_size:[2,3],enemy_groups_list:[{enemies:["Direwolf hunter"]}],predefined_lineup_on_nth_group:4,is_unlocked:!1,enemy_stat_variation:.2,name:"Forest den",types:[{type:"narrow",stage:2,xp_gain:5},{type:"dark",stage:2,xp_gain:5}],parent_location:m["Forest road"],first_reward:{xp:2e3,items:["Warrior's necklace"]},repeatable_reward:{xp:1e3},rewards_with_clear_requirement:[{required_clear_count:2,actions:[{action:"search predator",location:"Forest road"}]}],temperature_range_modifier:.8,is_under_roof:!0}),m["Forest road"].connected_locations.push({location:m["Forest den"],custom_text:"Enter the [Forest den]",travel_time:90}),m["Bears' den"]=new be({description:"A relatively large cave in the depths of the forest, filled with hordes of direwolves.",enemies_list:["Forest bear"],enemy_count:20,enemy_group_size:[1,1],is_unlocked:!1,enemy_stat_variation:.2,name:"Bears' den",types:[{type:"narrow",stage:2,xp_gain:10},{type:"dark",stage:2,xp_gain:10}],parent_location:m["Forest road"],first_reward:{xp:4e3},repeatable_reward:{xp:2e3},temperature_range_modifier:.8,is_under_roof:!0}),m["Forest ant nest"]=new be({description:"A labyrinthine nest of red ants",enemies_list:["Red ant swarm"],enemy_groups_list:[{enemies:["Red ant queen","Red ant swarm","Red ant swarm","Red ant swarm","Red ant swarm","Red ant swarm","Red ant swarm","Red ant swarm"]}],predefined_lineup_on_nth_group:99,types:[{type:"narrow",stage:3,xp_gain:10},{type:"dark",stage:2,xp_gain:7}],enemy_count:100,is_unlocked:!1,enemy_group_size:[8,8],enemy_stat_variation:.1,id:"Forest ant nest",name:"Red ant nest",parent_location:m["Forest road"],first_reward:{xp:2e3},repeatable_reward:{xp:1e3},temperature_range_modifier:.7,is_under_roof:!0}),m["Forest road"].connected_locations.push({location:m["Forest ant nest"],custom_text:"Enter the [Red ant nest]",travel_time:120}),m["Town outskirts"]=new Ue({connected_locations:[{location:m["Forest road"],custom_text:"Return to the [Forest road]",travel_time:180}],description:"The town is surrounded by a tall stone wall. The only gate seems to be closed, with a lone guard outside. You can see farms to the north and slums to the south.",name:"Town outskirts",is_unlocked:!0,dialogues:["gate guard"]}),m["Forest road"].connected_locations.push({location:m["Town outskirts"],custom_text:"Go towards the [Town outskirts]",travel_time:180}),m.Slums=new Ue({connected_locations:[{location:m["Town outskirts"],travel_time:60}],getDescription:function(){return m["Gang hideout"].is_finished?"A wild settlement next to city walls, filled with decaying buildings, poverty, and occasional thieves":"A wild settlement next to city walls, filled with decaying buildings, poverty, and violent criminals"},name:"Slums",is_unlocked:!0,dialogues:["suspicious man","old woman of the slums"],traders:["suspicious trader","suspicious trader 2"],market_region:"Slums",entrance_rewards:{quests:["Light in the darkness"]},temperature_range_modifier:.9,getBackgroundNoises:function(){let e=["Cough cough","Cough cough cough","*You hear someone sobbing*","*You see someone sleeping in an alleyway.*","I'm so hungry...","Even rotten food is better than nothing"];return M.hour>4&&M.hour<=20?e.push("Please, do you have a coin to spare?"):m["Gang hideout"].is_finished||e.push("*Sounds of someone getting repeatedly stabbed*","Scammed some fools for money today, time to get drunk!","Damn, I need a new dagger"),m["Gang hideout"].is_finished?e.push("You're the one who took out that gang, aren't you? Thank you so much.","Things got a lot better since those thugs left...","The crime isn't as bad as it used to be"):e.push("*You hear a terrified scream.*"),e}}),m["Town farms"]=new Ue({connected_locations:[{location:m["Town outskirts"],travel_time:40}],description:"Semi-private farms under jurisdiction of the city council. Full of life and sounds of heavy work.",name:"Town farms",is_unlocked:!0,dialogues:["farm supervisor"],getBackgroundNoises:function(){let e=[];return M.hour>4&&M.hour<=20?e.push("Mooooo!","Look, a bird!","Bark bark!","*You notice a goat staring at you menacingly*","Neigh!","Oink oink"):e.push("*You can hear some rustling*","*You can hear snoring workers*"),M.hour>3&&M.hour<10?e.push("\u266B\u266B Heigh ho, heigh ho, it's off to work I go~ \u266B\u266B","Cock-a-doodle-doo!"):M.hour>18&&M.hour<22&&e.push("\u266B\u266B Heigh ho, heigh ho, it's home from work I go~ \u266B\u266B"),e}}),m["Red ant nest 1"]=new be({description:"A labyrinthine nest of red ants",enemies_list:["Red ant swarm"],enemy_groups_list:[{enemies:["Red ant queen"]}],predefined_lineup_on_nth_group:99,types:[{type:"narrow",stage:3,xp_gain:10},{type:"dark",stage:2,xp_gain:7}],enemy_count:100,is_unlocked:!1,enemy_group_size:[5,6],enemy_stat_variation:.1,id:"Red ant nest 1",name:"Red ant nest",parent_location:m["Town farms"],first_reward:{xp:1e3},repeatable_reward:{locks:{locations:["Red ant nest 1"]},move_to:{location:"Town farms"},actions:[{location:"Town farms",action:"dig for ants 2"}]},temperature_range_modifier:.7,is_under_roof:!0}),m["Red ant nest 2"]=new be({description:"A labyrinthine nest of red ants",enemies_list:["Red ant swarm"],enemy_groups_list:[{enemies:["Red ant queen"]}],predefined_lineup_on_nth_group:99,types:[{type:"narrow",stage:3,xp_gain:10},{type:"dark",stage:2,xp_gain:7}],enemy_count:100,is_unlocked:!1,enemy_group_size:[5,6],enemy_stat_variation:.1,id:"Red ant nest 2",name:"Red ant nest",parent_location:m["Town farms"],first_reward:{xp:1e3},repeatable_reward:{locks:{locations:["Red ant nest 2"]},move_to:{location:"Town farms"},actions:[{location:"Town farms",action:"dig for ants 3"}]},temperature_range_modifier:.7,is_under_roof:!0}),m["Red ant nest 3"]=new be({description:"A labyrinthine nest of red ants",enemies_list:["Red ant swarm"],enemy_groups_list:[{enemies:["Red ant queen"]}],predefined_lineup_on_nth_group:99,types:[{type:"narrow",stage:3,xp_gain:10},{type:"dark",stage:2,xp_gain:7}],enemy_count:100,is_unlocked:!1,enemy_group_size:[5,6],enemy_stat_variation:.1,id:"Red ant nest 3",name:"Red ant nest",parent_location:m["Town farms"],first_reward:{xp:1e3},repeatable_reward:{locks:{locations:["Red ant nest 3"]},move_to:{location:"Town farms"},actions:[{location:"Town farms",action:"follow ant trail"}],textlines:[{dialogue:"farm supervisor",lines:["eliminated ants"]}]},temperature_range_modifier:.7,is_under_roof:!0}),m["Town farms"].connected_locations.push({location:m["Red ant nest 1"],custom_text:"Enter the [Red ant nest]",travel_time:10},{location:m["Red ant nest 2"],custom_text:"Enter the [Red ant nest]",travel_time:10},{location:m["Red ant nest 3"],custom_text:"Enter the [Red ant nest]",travel_time:10}),m["Gang hideout"]=new be({description:"Hideout of a local gang. Old building with a labirynth of narrow corridors.",enemies_list:["Slums thug"],types:[{type:"narrow",stage:2,xp_gain:3},{type:"dark",stage:1,xp_gain:3}],enemy_count:30,is_unlocked:!1,enemy_group_size:[4,5],enemy_stat_variation:.1,name:"Gang hideout",parent_location:m.Slums,first_reward:{xp:1e3,reputation:{slums:200,town:50}},repeatable_reward:{traders:[{trader:"suspicious trader 2",skip_message:!0}],textlines:[{dialogue:"suspicious man",lines:["defeated gang","behave 3"]}],locks:{traders:["suspicious trader"],locations:["Gang hideout"],textlines:{"suspicious man":["behave 2"]}},move_to:{location:"Slums"},quest_progress:[{quest_id:"Light in the darkness",task_index:1}]},temperature_range_modifier:.6,is_under_roof:!0}),m.Slums.connected_locations.push({location:m["Gang hideout"],travel_time:10}),m["Town square"]=new Ue({connected_locations:[{location:m["Town outskirts"],travel_time:20}],description:"The town's center of life, connected to all the markets, guilds, and other important places",name:"Town square",is_unlocked:!1,getBackgroundNoises:function(){return[]}}),m["Town outskirts"].connected_locations.push({location:m["Town farms"],travel_time:40},{location:m.Slums,travel_time:60},{location:m["Town square"],travel_time:20}),m["Cat caf\xE9"]=new Ue({connected_locations:[{location:m["Town square"],travel_time:4}],description:`A cat caf\xE9 in the center of town. There are multiple kitties of all kinds, but two females especially catch your eyes
 - a chubby mackerel tabby with a white belly and neck, and a slender tortoishell that seems blind on the right eye. There's a single worker in the caf\xE9, a person of ambiguous gender with with long ponytail and glasses.`,name:"Cat caf\xE9",is_unlocked:!0,getBackgroundNoises:function(){return["Meow","Nya","Mrrr","Mrrrp meow","*A cat jumps on your lap*","*A cat brushes on your leg*"]},is_under_roof:!0,is_temperature_static:!0,static_temperature:20}),m["Town square"].connected_locations.push({location:m["Cat caf\xE9"],travel_time:4}),m["Mountain path"]=new Ue({connected_locations:[{location:m["Nearby cave"],custom_text:"Climb down to [Nearby Cave]",travel_time:20,travel_time_skills:["Climbing"]}],description:"A treacherus path high above the village",name:"Mountain path",is_unlocked:!1,getBackgroundNoises:function(){return["You hear a rock tumble and fall down. It takes a very long time to hit the ground...","Strong wind whooshes past you"]},temperature_modifier:-2,unlock_text:"Thanks to your hard effort, you reached a narrow safe spot where you can rest a bit."}),m["Nearby cave"].connected_locations.push({location:m["Mountain path"],custom_text:"Climb up to [Mountain path]",travel_time:60,travel_time_skills:["Climbing"]}),m["Small flat area in mountains"]=new Ue({connected_locations:[{location:m["Mountain path"],travel_time:120}],description:"A piece of flatland somewhere in the mountains, very high above the village. It's not that big, but more than enough for a camp.",name:"Small flat area in mountains",is_unlocked:!1,getBackgroundNoises:function(){return["You hear a rock tumble and fall down. It takes a very long time to hit the ground...","Strong wind whooshes past you","A pair of birds flies right above you"]},temperature_modifier:-2,unlock_text:"You finally got to a place where a camp can be established"}),m["Mountain path"].connected_locations.push({location:m["Small flat area in mountains"],travel_time:120}),m["Mountain camp"]=new Ue({connected_locations:[{location:m["Nearby cave"],custom_text:"Climb down to [Nearby cave]",travel_time:140,travel_time_skills:["Climbing","Running"]}],description:"A nice safe camp with a crackling fire, created by you to be a perfect base for further exploration.",name:"Mountain camp",housing:{is_unlocked:!0,sleeping_xp_per_tick:8,text_to_sleep:"Take a nap on the bedroll"},is_unlocked:!1,getBackgroundNoises:function(){return["You hear a rock tumble and fall down. It takes a very long time to hit the ground...","Strong wind whooshes past you","A pair of birds flies right above you"]},temperature_range_modifier:.5}),m["Nearby cave"].connected_locations.push({location:m["Mountain camp"],travel_time:140,travel_time_skills:["Climbing","Running"]}),m["Mountain path"].connected_locations.push({location:m["Mountain camp"],travel_time:120}),m["Gentle mountain slope"]=new be({description:"A surprisingly gentle clearing, with a herd of angry goats protecting it.",enemies_list:["Angry mountain goat"],enemy_count:50,enemy_group_size:[3,4],is_unlocked:!1,enemy_stat_variation:.2,name:"Gentle mountain slope",types:[{type:"open",stage:1,xp_gain:5},{type:"thin air",stage:1,xp_gain:3}],parent_location:m["Mountain camp"],first_reward:{xp:2e3,flags:["is_strength_proved"]},repeatable_reward:{xp:1e3},temperature_modifier:-2}),m["Mountain camp"].connected_locations.push({location:m["Gentle mountain slope"],travel_time:90})})();(function(){m["Sparring with the village guard (heavy)"]=new Hi({description:"He's showing you a technique that makes his attacks slow but deadly",enemy_count:1,enemies_list:["Village guard (heavy)"],enemy_group_size:[1,1],is_unlocked:!1,name:"Sparring with the village guard (heavy)",leave_text:"Give up",parent_location:m.Village,first_reward:{xp:30,reputation:{village:10}},repeatable_reward:{textlines:[{dialogue:"village guard",lines:["heavy"]}]},unlock_text:"You can now spar with the guard (heavy stance) in the Village"}),m["Sparring with the village guard (quick)"]=new Hi({description:"He's showing you a technique that makes his attacks slow but deadly",enemy_count:1,enemies_list:["Village guard (quick)"],enemy_group_size:[1,1],is_unlocked:!1,name:"Sparring with the village guard (quick)",leave_text:"Give up",parent_location:m.Village,first_reward:{xp:30,reputation:{village:10}},repeatable_reward:{textlines:[{dialogue:"village guard",lines:["quick"]}]},unlock_text:"You can now spar with the guard (quick stance) in the Village"}),m.Village.connected_locations.push({location:m["Sparring with the village guard (heavy)"],custom_text:"Spar with the guard [heavy]",travel_time:0},{location:m["Sparring with the village guard (quick)"],custom_text:"Spar with the guard [quick]",travel_time:0}),m["Suspicious wall"]=new Hi({description:"It can be broken with enough force, you can feel it",enemy_count:1,types:[],enemies_list:["Suspicious wall"],enemy_group_size:[1,1],enemy_stat_variation:0,is_unlocked:!1,name:"Suspicious wall",leave_text:"Leave it for now",parent_location:m["Nearby cave"],repeatable_reward:{locations:[{location:"Hidden tunnel"}],textlines:[{dialogue:"village elder",lines:["new tunnel"]}],xp:20,quests:["The Infinite Rat Saga"]},unlock_text:"At some point, one of wolf rats tries to escape through a previously unnoticed hole in a nearby wall. There might be another tunnel behind it!",is_under_roof:!0,temperature_range_modifier:.8}),m["Nearby cave"].connected_locations.push({location:m["Suspicious wall"],custom_text:"Try to break the suspicious wall",travel_time:0}),m["Fight off the assailant"]=new Hi({description:"He attacked you out of nowhere",enemy_count:1,types:[],enemies_list:["Suspicious man"],enemy_group_size:[1,1],enemy_stat_variation:0,is_unlocked:!1,name:"Fight off the assailant",leave_text:"Run away for now",parent_location:m.Slums,repeatable_reward:{textlines:[{dialogue:"suspicious man",lines:["defeated"]}],xp:40},unlock_text:"Defend yourself!"}),m.Slums.connected_locations.push({location:m["Fight off the assailant"],custom_text:"Fight off the suspicious man",travel_time:0}),m["Fight the angry mountain goat"]=new Hi({description:"It won't let you pass...",enemy_count:1,types:[{type:"narrow",stage:1,xp_gain:1},{type:"thin air",stage:1,xp_gain:3}],enemies_list:["Angry-looking mountain goat"],enemy_group_size:[1,1],enemy_stat_variation:0,is_unlocked:!1,name:"Fight the angry mountain goat",leave_text:"Run away and hope it won't follow",parent_location:m["Mountain path"],repeatable_reward:{locations:[{location:"Small flat area in mountains"}],xp:500},unlock_text:"A very angry goat blocks your way!",temperature_modifier:-2}),m["Mountain path"].connected_locations.push({location:m["Fight the angry mountain goat"],custom_text:"Fight the angry goat",travel_time:0})})();(function(){m.Village.activities={fieldwork:new oe({activity_name:"fieldwork",starting_text:"Work on the fields",get_payment:()=>15+Math.round(25*R("Farming")/p.Farming.max_level),is_unlocked:!1,working_period:60*2,availability_time:{start:6,end:20},availability_seasons:["Spring","Summer","Autumn"],skill_xp_per_tick:1}),running:new oe({activity_name:"running",infinite:!0,starting_text:"Go for a run around the village",skill_xp_per_tick:1,is_unlocked:!1}),weightlifting:new oe({activity_name:"weightlifting",infinite:!0,starting_text:"Try to carry some bags of grain",skill_xp_per_tick:1,is_unlocked:!1}),swimming:new oe({activity_name:"swimming",starting_text:"Swim in the river",availability_seasons:["Spring","Summer","Autumn"],skill_xp_per_tick:1,is_unlocked:!0,applied_effects:[{effect:"Wet",duration:30}]}),balancing:new oe({activity_name:"balancing",infinite:!0,starting_text:"Try to keep your balance on rocks in the river",unlock_text:"All this fighting while surrounded by stone and rocks gives you a new idea",skill_xp_per_tick:1,is_unlocked:!1}),meditating:new oe({activity_name:"meditating",infinite:!0,starting_text:"Sit down and meditate",skill_xp_per_tick:1,is_unlocked:!0}),patrolling:new oe({activity_name:"patrolling",starting_text:"Go on a patrol around the village.",get_payment:()=>50,is_unlocked:!1,infinite:!0,working_period:60*2,skill_xp_per_tick:1}),woodcutting:new oe({activity_name:"woodcutting",infinite:!0,starting_text:"Gather wood on the outskirts",skill_xp_per_tick:1,is_unlocked:!0,gained_resources:{resources:[{name:"Piece of rough wood",ammount:[[1,1],[1,3]],chance:[.5,1]}],time_period:[20,10],skill_required:[0,10],scales_with_skill:!0},require_tool:!0}),sand:new oe({activity_id:"sand",activity_name:"digging",infinite:!0,starting_text:"Dredge up some sand from the riverbed",skill_xp_per_tick:1,is_unlocked:!1,gained_resources:{resources:[{name:"Silica Sand",ammount:[[1,1],[1,3]],chance:[.4,1]}],time_period:[120,60],skill_required:[0,10],scales_with_skill:!0},require_tool:!0,unlock_text:"You realize that the river near the village might contain the type of sand you need"})},m["Nearby cave"].activities={weightlifting:new oe({activity_name:"weightlifting",infinite:!0,starting_text:"Try lifting some of the rocks",skill_xp_per_tick:4,is_unlocked:!1,unlock_text:"After the fight, you realize there's quite a lot of rocks of different sizes that could be used for exercises"}),climbing:new oe({activity_name:"climbing",infinite:!0,starting_text:"Attempt climbing the mountain walls outside",skill_xp_per_tick:1,is_unlocked:!0}),meditating:new oe({activity_name:"meditating",infinite:!0,starting_text:"Sit down and meditate in front of the gate",skill_xp_per_tick:4,is_unlocked:!1,unlock_text:"As you finish fighting your enemies and it becomes quiet, you feel a strange sense of tranquility. This spot in front of the mysterious gate, surrounded by calm and darkness, seems perfect to sit down and focus your mind."}),mining:new oe({activity_name:"mining",infinite:!0,starting_text:"Mine the strange looking iron vein",skill_xp_per_tick:1,is_unlocked:!1,gained_resources:{resources:[{name:"Low quality iron ore",ammount:[[1,1],[1,3]],chance:[.4,.8]}],time_period:[60,30],skill_required:[0,10],scales_with_skill:!0},unlock_text:"As you clear the area of wolf rats, you notice a vein of an iron ore"}),mining2:new oe({activity_name:"mining",infinite:!0,starting_text:"Mine the deeper iron vein",skill_xp_per_tick:5,is_unlocked:!1,gained_resources:{resources:[{name:"Iron ore",ammount:[[1,1],[1,3]],chance:[.3,.7]}],time_period:[90,40],skill_required:[7,17],scales_with_skill:!0},unlock_text:"Going deeper, you find a vein of an iron ore that seems to be of much higher quality"}),mining3:new oe({activity_name:"mining",infinite:!0,starting_text:"Mine the atratan vein",skill_xp_per_tick:12,is_unlocked:!1,gained_resources:{resources:[{name:"Atratan ore",ammount:[[1,1],[1,3]],chance:[.3,.7]}],time_period:[120,60],skill_required:[12,25],scales_with_skill:!0},unlock_text:"As you finish the fight and get a time to look around, you notice a metal vein of different color than iron. You recall another ore called Atratan, this must be it."})},m["Forest road"].activities={running:new oe({activity_name:"running",infinite:!0,starting_text:"Go for a run through the forest",skill_xp_per_tick:4}),woodcutting:new oe({activity_name:"woodcutting",infinite:!0,starting_text:"Gather wood from nearby trees",skill_xp_per_tick:5,is_unlocked:!1,gained_resources:{resources:[{name:"Piece of wood",ammount:[[1,1],[1,3]],chance:[.3,1]}],time_period:[90,40],skill_required:[7,17],scales_with_skill:!0}}),woodcutting2:new oe({activity_name:"woodcutting",infinite:!0,starting_text:"Gather wood from sturdy trees",skill_xp_per_tick:12,is_unlocked:!1,gained_resources:{resources:[{name:"Piece of ash wood",ammount:[[1,1],[1,3]],chance:[.3,1]}],time_period:[120,60],skill_required:[12,25],scales_with_skill:!0},unlock_text:"Finishing your fight, you notice that the trees on the side of the clearing look really healthy and sturdy, they could be a useful material."}),herbalism:new oe({activity_name:"herbalism",infinite:!0,starting_text:"Gather useful herbs throughout the forest",skill_xp_per_tick:2,is_unlocked:!1,gained_resources:{resources:[{name:"Oneberry",ammount:[[1,1],[1,1]],chance:[.1,.5]},{name:"Golmoon leaf",ammount:[[1,1],[1,1]],chance:[.1,.7]},{name:"Belmart leaf",ammount:[[1,1],[1,1]],chance:[.1,.7]}],time_period:[120,45],skill_required:[0,10],scales_with_skill:!0},require_tool:!0})},m["Town outskirts"].activities={herbalism:new oe({activity_name:"herbalism",infinite:!0,starting_text:"Search for useful herbs by the roadside",skill_xp_per_tick:4,is_unlocked:!1,gained_resources:{resources:[{name:"Cooking herbs",ammount:[[1,1],[1,3]],chance:[.1,.8]}],time_period:[120,50],skill_required:[5,15],scales_with_skill:!0},require_tool:!0,unlock_text:"You learned that some useful herbs can be found right under your nose."})},m["Town farms"].activities={fieldwork:new oe({activity_name:"fieldwork",starting_text:"Work on the fields",get_payment:()=>30+Math.round(30*R("Farming")/p.Farming.max_level),is_unlocked:!1,working_period:60*2,availability_time:{start:6,end:20},availability_seasons:["Spring","Summer","Autumn"],skill_xp_per_tick:2}),"animal care":new oe({activity_name:"animal care",infinite:!0,starting_text:"Take care of local sheep in exchange for some wool",skill_xp_per_tick:3,is_unlocked:!1,gained_resources:{resources:[{name:"Wool",ammount:[[1,1],[1,3]],chance:[.1,1]}],time_period:[120,60],skill_required:[0,10],scales_with_skill:!0}})},m["Mountain path"].activities={balancing:new oe({activity_name:"balancing",infinite:!0,starting_text:"Stupidly risk your life by trying to balance on some stones on the very edge of the cliff",skill_xp_per_tick:4,is_unlocked:!0})},m["Mountain camp"].activities={herbalism:new oe({activity_name:"herbalism",infinite:!0,starting_text:"Search for useful herbs on the mountainside",skill_xp_per_tick:6,is_unlocked:!1,gained_resources:{resources:[{name:"Silver thistle",ammount:[[1,1],[1,1]],chance:[.1,.5]}],time_period:[120,60],skill_required:[7,17],scales_with_skill:!0},require_tool:!0}),balancing:new oe({activity_name:"balancing",infinite:!0,starting_text:"Stupidly risk your life by trying to balance on some stones on the very edge of the cliff",skill_xp_per_tick:4,is_unlocked:!0}),climbing:new oe({activity_name:"climbing",infinite:!0,starting_text:"Take a lesson from the goats and try to climb a wall near the camp",skill_xp_per_tick:4,is_unlocked:!0})}})();(function(){m["Nearby cave"].actions={"open the gate":new Pe({action_id:"open the gate",starting_text:"Try to push the mysterious gate open",description:"It's an ancient massive gate, but maybe with enough strength and training you could actually manage to push it at least a tiny bit to create enough space to walk through.",action_text:"Huffing and puffing",success_text:"When you are almost ready to give up, you hear the ancient hinges creak, as the gate slowly moves. Finally, you can continue deeper!",failure_texts:{conditional_loss:["Despite trying your best, you can feel that you are just too weak for it. You should get stronger first."]},conditions:[{stats:{strength:150}}],attempt_duration:10,success_chances:[1],rewards:{locations:[{location:"Writhing tunnel"}],quest_progress:[{quest_id:"The Infinite Rat Saga",task_index:1}]}}),"climb the mountain":new Pe({action_id:"climb the mountain",starting_text:"Try to climb up the mountain",description:"It is an ardous task that will require some good long rope and actual skill in climbing, together with good physical abilities. It will take some time, so you need to make sure you won't run out of energy halfway through.",action_text:"Climbing up",success_text:"Somehow you did it, you climbed all the way up! Thanks to the rope you tied on your way, further trips up and down will be much easier.",failure_texts:{conditional_loss:["Despite trying your best, you can feel that you won't manage to do it without more training"],random_loss:["You almost had it, but at some point you grabbed a rock that turned out to be unstable. Be more careful next time!","You were really close, but a gust of wind at a bad moment knocked you off balance.","You failed to notice a falling rock and got knocked down."],unable_to_begin:["While seemingly prepared, you realize you're missing an important accessory - some nice long rope is gonna be a necessity for this, especially if you want to go back down at some point."]},required:{items_by_id:{"Coil of rope":{count:1,remove_on_success:!0}}},conditions:[{skills:{Climbing:7},stats:{strength:50,agility:50,max_stamina:50}},{skills:{Climbing:12},stats:{strength:120,agility:120,max_stamina:50}}],attempt_duration:60,success_chances:[.3,1],rewards:{locations:[{location:"Mountain path"}],move_to:{location:"Mountain path"}}})},m["Mountain path"].actions={explore:new Pe({action_id:"explore",starting_text:"Explore the area",description:"Now that you are here, it's time to find if there's anything worthy of your time. Too bad you couldn't do it beforehand.",action_text:"Looking around",success_text:"The good news: you noticed a nice little piece of flat land that would be perfect for a camp. The bad news: there's a very angry-looking mountain goat blocking your way.",failure_texts:{random_loss:["You looked under rocks and between the bushes, but you found nothing. Keep looking!","You looked and looked, but you couldn't find anything. Rest a bit and go back to it!"]},conditions:[],is_unlocked:!0,attempt_duration:60,success_chances:[.6],rewards:{locations:[{location:"Fight the angry mountain goat"}]}})},m["Small flat area in mountains"].actions={"create camp":new Pe({action_id:"create camp",starting_text:"Establish a camp here",description:"Prepare a tent, a fireplace, and a storage here to create a new base. It will be necessary before exploring further up the mountains.",action_text:"Working",success_text:"After a few hours of hard work, your camp is ready. You can rest here before venturing further in the mountains",conditions:[{items_by_id:{"Camping supplies":{count:1,remove:!0}}}],is_unlocked:!0,check_conditions_on_finish:!1,failure_texts:{conditional_loss:["You lack camping supplies!"]},attempt_duration:180,success_chances:[1],rewards:{locations:[{location:"Mountain camp"}],move_to:{location:"Mountain camp"},locks:{locations:["Mountain path","Small flat area in mountains"]}}})},m["Mountain camp"].actions={explore1:new Pe({action_id:"explore1",starting_text:"Explore the area further",description:"With the camp created, it's time to keep exploring",action_text:"Looking around",success_text:"You find a reasonably gentle mountain slope with green grass and... more angry goats. At least they seem slightly smaller.",failure_texts:{random_loss:["You looked under rocks and between the bushes, but you found nothing. Keep looking!","You looked and looked, but you couldn't find anything. Rest a bit and go back to it!"]},conditions:[],is_unlocked:!0,attempt_duration:60,success_chances:[.6],rewards:{locations:[{location:"Gentle mountain slope"}],actions:[{location:"Mountain camp",action:"explore2"}]}}),explore2:new Pe({action_id:"explore2",starting_text:"Keep exploring",description:"You have a feeling that there must be something more of value than just goats.",action_text:"Looking around",success_text:"You notice some plants, that you soon recognize as a potent healing ingredient that was mentioned to you by that old craftsman. It's gonna be useful if you know proper recipes.",failure_texts:{random_loss:["You looked under rocks and between the bushes, but you found nothing. Keep looking!","You looked and looked, but you couldn't find anything. Rest a bit and go back to it!"],conditional_loss:["You spot a lot of curious plants. You have a hunch that at least some of them must be useful for something, but you fail to recognize any of them. If only you knew more about herbs..."]},conditions:[{skills:{Herbalism:6}},{skills:{Herbalism:10}}],is_unlocked:!1,attempt_duration:60,success_chances:[.5],rewards:{activities:[{location:"Mountain camp",activity:"herbalism"}]}})},m["Forest road"].actions={"search for boars":new Pe({action_id:"search for boars",starting_text:"Search forest for the clearing with boars",description:"It might take some time and a few attempts, but you are sure you can manage",action_text:"Searching the forest",success_text:"There they are! You see a clearing with tall grass and hear unmistakeable grunts and squeals",failure_texts:{random_loss:["You search for some time, but end up with nothing. Next time you will try a slightly different direction"]},attempt_duration:90,success_chances:[.5],rewards:{locations:[{location:"Forest clearing"}]}}),"follow the trail":new Pe({action_id:"follow the trail",starting_text:"Follow the mysterious trail deeper into the forest...",description:"It doesn't seem to be a smart thing to do",action_text:"Following the trail",success_text:"The trail leads you to a large cave. There are some broken bones lying around the entrance",failure_texts:{random_loss:["At some point you got distracted and lost your way"]},attempt_duration:180,success_chances:[.7],rewards:{locations:[{location:"Forest den"}]},unlock_text:"At some point during your fights, you notice a path trodden by animals. There's a lot of footprints that look like wolf's, except much larger..."}),"search predator":new Pe({action_id:"search predator",starting_text:"Search for the predator that hunts direwolves",description:"It's a terrible idea",action_text:"Searching for the predator",success_text:"You end up finding another large cave. There's a lot of bones around the entrance, some belonging to direwolves and boars",failure_texts:{random_loss:["At some point you got distracted and lost your way"]},attempt_duration:180,success_chances:[.4],rewards:{locations:[{location:"Bears' den"}]},unlock_text:"At some point during your fights you notice a direwolf with terrible scars, clearly inflicted by an even larger predator. What could have it been?"})},m["Town farms"].actions={"dig for ants 1":new Pe({action_id:"dig for ants 1",action_name:"Search for ant nests",starting_text:"Dig in search of red ant nests",description:"They live somewhere down there",action_text:"Digging",success_text:"You find an ant tunnel, just barely wide enough for you to enter",attempt_duration:180,success_chances:[1],rewards:{locations:[{location:"Red ant nest 1"}],skill_xp:{Digging:20}}}),"dig for ants 2":new Pe({action_id:"dig for ants 2",action_name:"Search for ant nests",starting_text:"Dig in search of red ant nests",description:"They live somewhere down there",action_text:"Digging",success_text:"You find an ant tunnel, just barely wide enough for you to enter",attempt_duration:240,success_chances:[1],rewards:{locations:[{location:"Red ant nest 2"}],skill_xp:{Digging:30}}}),"dig for ants 3":new Pe({action_id:"dig for ants 3",action_name:"Search for ant nests",starting_text:"Dig in search of red ant nests",description:"They live somewhere down there",action_text:"Digging",success_text:"You find an ant tunnel, just barely wide enough for you to enter",attempt_duration:300,success_chances:[1],rewards:{locations:[{location:"Red ant nest 3"}],skill_xp:{Digging:40}}}),"follow ant trail":new Pe({action_id:"follow ant trail",action_name:"Follow ant trail towards the forest",starting_text:"Follow ant trail towards the forest",description:"There must be other nests out there",action_text:"Searching",success_text:"You find a massive complex of ant tunnels, just barely wide enough for you to enter",attempt_duration:600,success_chances:[1],failure_texts:{unable_to_begin:["You can't do that without a shovel!"]},conditions:[{tools_by_slot:["shovel"]}],rewards:{locations:[{location:"Forest ant nest"}],move_to:{location:"Forest road"},skill_xp:{Digging:50}},unlock_text:"While your task is finished, it seems that you might be able to find more ants away from the farms"})}})();(function(){Object.keys(m).forEach(e=>{Object.keys(m[e].activities||{}).forEach(t=>{m[e].activities[t].activity_id=t})})})();var Z={},_e=class{constructor({name:t,id:i,duration:n,effects:s,tags:a,potency:o,group_tags:r,affected_by_travel:d=!0}){this.name=t,this.id=i||t,this.duration=n??0,this.effects=s,this.effects.bonus_skill_levels||(this.effects.bonus_skill_levels={}),this.effects.stats||(this.effects.stats={}),this.affected_by_travel=d,this.tags=a||{},this.group_tags=r||{},this.tags.effect=!0,this.potency=o||0}};Z.Wet=new _e({name:"Wet",effects:{stats:{cold_tolerance:{flat:-5}}}}),Z.Cold=new _e({name:"Cold",effects:{stats:{stamina_efficiency:{multiplier:.8},strength:{multiplier:.9}}},group_tags:{cold:1}}),Z["Very cold"]=new _e({name:"Very cold",effects:{stats:{stamina_efficiency:{multiplier:.6},dexterity:{multiplier:.8},agility:{multiplier:.8},strength:{multiplier:.8}}},group_tags:{cold:2}}),Z.Freezing=new _e({name:"Freezing",effects:{stats:{stamina_efficiency:{multiplier:.3},dexterity:{multiplier:.6},agility:{multiplier:.6},strength:{multiplier:.6},health_regeneration_flat:{multiplier:.6},health_regeneration_percent:{multiplier:.6}},xp_multipliers:{all:.6}},group_tags:{cold:3}}),Z.Hypothermia=new _e({name:"Hypothermia",effects:{stats:{stamina_efficiency:{multiplier:.1},dexterity:{multiplier:.3},agility:{multiplier:.3},strength:{multiplier:.4},health_regeneration_flat:{multiplier:.2},health_regeneration_percent:{multiplier:.2}},xp_multipliers:{all:.3}},group_tags:{cold:4}});Z["Basic meal"]=new _e({name:"Basic meal",effects:{stats:{stamina_regeneration_flat:{flat:.5}}},tags:{buff:!0}}),Z["Well hydrated"]=new _e({name:"Well hydrated",effects:{stats:{stamina_regeneration_flat:{flat:1}}},tags:{buff:!0}}),Z["Weak healing powder"]=new _e({name:"Weak healing powder",effects:{stats:{health_regeneration_flat:{flat:2}}},tags:{buff:!0,medicine:!0}}),Z["Healing powder"]=new _e({name:"Healing powder",effects:{stats:{health_regeneration_flat:{flat:5}}},tags:{buff:!0,medicine:!0}}),Z["Weak healing potion"]=new _e({name:"Weak healing potion",effects:{stats:{health_regeneration_flat:{flat:8},health_regeneration_percent:{flat:1}}},tags:{buff:!0,medicine:!0}}),Z["Healing potion"]=new _e({name:"Healing potion",effects:{stats:{health_regeneration_flat:{flat:20},health_regeneration_percent:{flat:2}}},tags:{buff:!0,medicine:!0}}),Z["Weak healing balm"]=new _e({name:"Weak healing balm",effects:{stats:{health_regeneration_flat:{flat:5},health_regeneration_percent:{flat:.5}}},tags:{buff:!0,medicine:!0}}),Z["Cheap meat meal"]=new _e({name:"Cheap meat meal",effects:{stats:{stamina_regeneration_flat:{flat:1}}},tags:{buff:!0}}),Z["Simple meat meal"]=new _e({name:"Simple meat meal",effects:{stats:{stamina_regeneration_flat:{flat:1.5},health_regeneration_flat:{flat:1}}},tags:{buff:!0}}),Z["Decent meat meal"]=new _e({name:"Decent meat meal",effects:{stats:{stamina_regeneration_flat:{flat:3},health_regeneration_flat:{flat:2}}},tags:{buff:!0}}),Z["Hot meal"]=new _e({name:"Hot meal",effects:{stats:{cold_tolerance:{flat:3}}},tags:{buff:!0}}),Z["Slight food poisoning"]=new _e({name:"Slight food poisoning",effects:{stats:{health_loss_flat:{flat:-.5}}},tags:{debuff:!0,poison:!0}});Z.Recovering=new _e({name:"Recovering",effects:{xp_multipliers:{all:.2}},tags:{debuff:!0},affected_by_travel:!1});Z["Spark of Inspiration"]=new _e({name:"Spark of Inspiration",effects:{xp_multipliers:{all:1.5}},tags:{buff:!0},affected_by_travel:!1});var st=new _i,Ss=!1;function Ec(e){st.add_to_inventory(e),Sa()}function Sc(e){st.remove_from_inventory(e),Sa()}function hl(e){Sa(e),Ss=!0}function pl(e){wl(e),Ss=!1}function fl(e){let t=Math.min(e.count,l.inventory[e.item_key].count);ct([{...e,item_count:t}]),Ec([{...e,count:t}])}function gl(e){let t=Math.min(e.count,st.inventory[e.item_key].count);ze([{...e,count:t}]),Sc([{...e,item_count:t}])}function yl(){return Ss}var N={},Je={},ge=class{constructor({task_description:t="",task_condition:i={},task_rewards:n={},is_hidden:s=!1,is_finished:a=!1}){this.task_description=t,this.task_condition=i,this.task_rewards=n,this.is_hidden=s,this.is_finished=a,Object.keys(this.task_condition).forEach(o=>{Object.keys(this.task_condition[o]).forEach(r=>{Object.keys(this.task_condition[o][r]).forEach(d=>{this.task_condition[o][r][d].current=0})})})}},Nt=class{constructor({quest_name:t,quest_id:i,quest_description:n,questline:s,quest_tasks:a=[],quest_condition:o,quest_rewards:r,display_priority:d=1/0,is_hidden:c=!1,is_finished:_=!1,is_repeatable:h=!1,getQuestName:f=()=>this.quest_name,getQuestDescription:y=()=>this.quest_description}){this.quest_name=t,this.quest_id=i,this.questline=s,this.quest_tasks=a,this.quest_description=n,this.quest_rewards=r||{},this.display_priority=d,this.is_hidden=c,this.is_finished=_,this.is_repeatable=h,this.quest_condition=o,this.getQuestName=f,this.getQuestDescription=y}getCompletedTaskCount(){return this.quest_tasks.length==0?0:this.quest_tasks.filter(t=>t.is_finished).length}},me={startQuest({quest_id:e,should_inform:t=!0}){let i=N[e];(!i.is_finished||i.is_repeatable)&&!this.isQuestActive(e)&&(Je[e]=new Nt(N[e])),i.is_hidden||(bl(e),t&&S(`Started a new quest: ${N[e].getQuestName()}`))},isQuestActive(e){return e in Je},finishQuest({quest_id:e,only_unlocks:t,is_from_loading:i,skip_rewards:n}){if(this.isQuestActive(e)){let s=N[e];s.is_repeatable||(s.is_finished=!0),delete Je[e],N[e].is_hidden||Dn(e),n||De({rewards:N[e].quest_rewards,source_type:"Quest",source_name:N[e].getQuestName(),only_unlocks:t,is_from_loading:i})}},finishQuestTask({quest_id:e,task_index:t,only_unlocks:i,skip_warning:n=!1,allowed_to_finish_quest:s=!0,skip_message:a=!1}){if(this.isQuestActive(e)){let o=N[e];o.quest_tasks[t].is_finished=!0,N[e].is_hidden||(Dn(e),a||(N[e].quest_tasks[t].is_hidden?S(`Made some progress in quest: "${N[e].getQuestName()}"`):S(`Finished a task for a quest: "${N[e].getQuestName()}"`))),De({rewards:o.quest_tasks[t].task_rewards,source_type:"Quest",source_name:N[e].getQuestName(),only_unlocks:i});let r=Je[e].quest_tasks.filter(d=>!d.is_finished);s&&r.length==0&&this.finishQuest({quest_id:e})}else n||console.warn(`Cannot finish task at index ${t} for quest "${e}", as it's not a currently active quest!`)},catchQuestEvent({quest_event_type:e,quest_event_target:t,quest_event_count:i,additional_quest_tags:n={}}){Object.keys(Je).forEach(s=>{if(!(s in Je))return;let a=Je[s].quest_tasks.findIndex(_=>!_.is_finished),o=Je[s].quest_tasks[a];if(!("any"in o.task_condition)&&!("all"in o.task_condition))return;let r=!1,d=!0;Object.keys(o.task_condition).forEach(_=>{Object.keys(o.task_condition[_]).forEach(h=>{Object.keys(o.task_condition[_][h]).forEach(f=>{if(o.task_condition[_][h][f].current||(o.task_condition[_][h][f].current=0),e===h&&t===f){let y=!0,b=o.task_condition[_][h][f].requirements;if(Object.keys(b||{}).forEach(w=>{(!n[w]||n[w]!=b[w])&&(y=!1)}),y){let w=o.task_condition[_][h][f].restrictions;Object.keys(w||{}).forEach(k=>{n[k]&&n[k]===w[k]&&(y=!1)})}if(!y){d=!1;return}h==="reach_skill"?o.task_condition[_][h][f].current=i:o.task_condition[_][h][f].current+=i}_==="any"&&o.task_condition[_][h][f].current>=o.task_condition[_][h][f].target?r=!0:_==="all"&&o.task_condition[_][h][f].current<o.task_condition[_][h][f].target&&(d=!1)})})}),(r||!("any"in o.task_condition))&&(d||!("all"in o.task_condition))?this.finishQuestTask({quest_id:s,task_index:a,allowed_to_finish_quest:!1}):!Je[s].is_hidden&&!Je[s].quest_tasks[a.is_hidden]&&vl(s,a),Je[s].quest_tasks.filter(_=>!_.is_finished).length==0&&this.finishQuest({quest_id:s})})}};N["Lost memory"]=new Nt({quest_name:"Lost memory",display_priority:0,getQuestDescription:()=>{let e=N["Lost memory"].getCompletedTaskCount();if(e==0)return"You woke up in some village and you have no idea how you got here or who you are. Just what could have happened?";if(e==1)return"You lost your memories after being attacked by unknown assailants and were rescued by local villagers. You need to find out who, why, and if possible, how to recover them."},questline:"Lost memory",quest_tasks:[new ge({task_description:"Find out what happened"}),new ge({is_hidden:!0}),new ge({task_description:"Help with the wolf rat infestation"}),new ge({task_description:"Continue your search"}),new ge({task_description:"Get into the town (tbc)"})]}),N["The Infinite Rat Saga"]=new Nt({quest_name:"The Infinite Rat Saga",display_priority:0,getQuestDescription:()=>"You found more rats in the caves. You might as well try getting to the bottom of that issue.",questline:"The Infinite Rat Saga",quest_tasks:[new ge({task_description:"Go deeper"}),new ge({task_description:"Open the mysterious gate"}),new ge({task_description:"Get through the corrupted tunnel"}),new ge({task_description:"Go even deeper (tbc)"})]});N["Bonemeal delivery"]=new Nt({quest_name:"Bonemeal delivery",quest_description:"The farm supervisor is in a dire need of 50 packs of bonemeal, and he needs the entire order delivered in one go.",quest_tasks:[new ge({task_description:"Bring 50 packs of bonemeal"})],quest_rewards:{money:6e3,xp:5e3,reputation:{town:40}}}),N["Light in the darkness"]=new Nt({quest_name:"Light in the darkness",display_priority:1,getQuestDescription:()=>"People of the slums live in suffering and fear. Maybe you could improve their situation at least a bit?",quest_tasks:[new ge({is_hidden:!0}),new ge({task_description:"Deal with the gang"}),new ge({task_description:"[To be continued]"})]}),N["Ploughs to swords"]=new Nt({quest_name:"Ploughs to swords",display_priority:1,getQuestDescription:()=>"Supervisor of the town's farms seems to have some interesting task, but first requires you to be strong enough for it.",quest_tasks:[new ge({task_description:"Prove your strength"}),new ge({task_description:"Deal with the boars and then report back"}),new ge({is_hidden:!0}),new ge({task_description:"Exterminate the red ants under the farm and then report back"})],quest_rewards:{money:5e3,xp:1e5,reputation:{town:60}}});N["Swimming/climbing unlock"]=new Nt({is_hidden:!0,quest_tasks:[new ge({task_condition:{all:{reach_skill:{Running:{target:12},Weightlifting:{target:12}}}}})],quest_rewards:{textlines:[{dialogue:"village elder",lines:["more training"],skip_message:!0}]}}),N["Swimming alternative unlock"]=new Nt({is_hidden:!0,quest_rewards:{global_activities:["swimming"],messages:["With all the training you have done so far, the idea of submerging yourself in the river passing by the village is really tempting"]},quest_tasks:[new ge({task_condition:{all:{reach_skill:{Running:{target:15},Weightlifting:{target:15}}}}}),new ge({task_condition:{all:{enter_location:{Village:{target:1,restrictions:{season:"Winter"}}}}}})]});Object.keys(N).forEach(e=>{N[e].quest_id=e});var Lc=20,hn,Tc={Winter:-20,Spring:-5,Summer:0,Autumn:-8},Ic={Plus:3,Minus:-8},Cc={0:0,1:-1,2:0,3:-2,4:3,5:6,6:1,7:-2,8:0,9:-5,10:-1},kl={0:0,1:0,2:0,3:0,4:-1,5:-2,6:-2,7:-2,8:0,9:0,10:0,11:-1,12:0};function Ac(e){return e.hour>=14||e.hour<5?"Plus":"Minus"}function La(e){return Tc[e.getSeason()]+Ic[Ac(e)]+Cc[e.day_count%11]+kl[e.day_count%13]}function Ta(){if(!v)return 0;hn||(hn=La(M));let e,t,i;if(M.hour>=14?(t={hours:5,days:1},e={hour:14},i=900,hn=La(M)):M.hour<5?(t={hours:5,days:0},e={hour:14},i=900):M.hour>=5&&(t={hours:14,days:0},e={hour:5},i=540,hn=La(M)),v.is_temperature_static)return v.static_temperature;let n;M.hour<e.hour?n=60*(24-e.hour+M.hour)+M.minute:n=60*(M.hour-e.hour)+M.minute;let s=n/i,a=La(new ya({year:M.year,month:M.month,day:M.day+t.days,hour:t.hours,minute:0,day_count:M.day_count+t.days})),o=v.temperature_range_modifier;if(isNaN(o))throw new Error(`Temperature modifier for "${v.name}" is not a number!`);return Math.round(10*(Lc+(v.temperature_modifier||0)+o*(hn+s*(a-hn))))/10}function Yn(){return kl[M.day_count%13]<0}var Vn=class{constructor({canvas:t,size:i}){this.x=Math.random()*(t.width-i-1)+i+1,this.starting_x=this.x,this.distance=Math.random()*50+1,this.opacity=Math.random()*.5+.5,this.radians=Math.random()*Math.PI*2,this.y=Math.random()*(t.height-i-1)+i+1}},Ia=class extends Vn{constructor({canvas:t}){let i=Math.random()*2+2;super({canvas:t,size:i}),this.size=i,this.fall_speed=10,this.context=t.getContext("2d"),this.draw=()=>{this.y>t.height+this.size?this.y=-this.size:this.y+=this.fall_speed,this.x=this.starting_x+this.distance,this.context.fillStyle=`rgba(128,128,255, ${this.opacity})`,this.context.fillRect(this.x,this.y,this.size,this.size)}}},Ca=class extends Vn{constructor({canvas:t}){let i=Math.random()*2+2;super({canvas:t,size:i}),this.size=i,this.fall_speed=Math.random()*1.5+.5,this.context=t.getContext("2d"),this.draw=()=>{this.y>t.height+this.size?this.y=-this.size:this.y+=this.fall_speed,this.radians+=.02,this.x=this.starting_x+this.distance*Math.sin(this.radians),this.context.fillStyle=`rgba(255,255,255,${this.opacity})`,this.context.fillRect(this.x,this.y,this.size,this.size)}}};var Aa=class extends Vn{constructor({canvas:t}){let i=Math.random()*6+6;super({canvas:t,size:i}),this.size=i,this.context=t.getContext("2d");let n=45;this.draw=()=>{this.radians+=.01,this.tempSize=Math.max(4,this.size*Math.abs(Math.sin(this.radians))),this.tempX=this.x-this.tempSize/2,this.tempY=this.y-this.tempSize/2,this.context.save(),this.context.fillStyle=`rgba(255,255,100,${this.opacity})`,this.context.fillRect(this.tempX,this.tempY,this.tempSize,this.tempSize),this.context.translate(this.tempX+this.tempSize/2,this.tempY+this.tempSize/2),this.context.rotate(n*Math.PI/180),this.context.fillStyle=`rgba(255,255,100,${this.opacity})`,this.context.fillRect(-this.tempSize/2,-this.tempSize/2,this.tempSize,this.tempSize),this.context.restore()}}};var Ls="v0.5.0.1";function Ba(){return Ls}var Qn={getText:(e,t)=>(Zt[e]?.[t]||(e.startsWith("mofu")&&Zt[e.replace("mofu_","")]?.[t]?e=e.replace("mofu_",""):e="english"),Zt[e][t]?Zt[e][t]:"text not found, id: "+t)},Zt={english:{"elder description":"You see an older man with white hair, but with a still strong posture as if still ready to fight if need be. He eyes you with curiosity.","elder hello":"Hello?","elder hello answ":"Hello. Glad to see you got better","elder head hurts":"My head hurts.. What happened?","elder head hurts answ":"Some of our people found you unconscious in the forest, wounded and with nothing but pants and an old sword, so they brought you to our village. It would seem you were on your way to a nearby town when someone attacked you and hit you really hard in the head.","elder where":"Where am I?","elder where answ":"Some of our people found you unconscious in the forest, wounded and with nothing but pants and an old sword, so they brought you to our village. It would seem you were on your way to a nearby town when someone attacked you and hit you really hard in the head.","elder remember":"I don't remember how I got here, what happened?","elder remember answ":"Some of our people found you unconscious in the forest, wounded and with nothing but pants and an old sword, so they brought you to our village. It would seem you were on your way to a nearby town when someone attacked you and hit you really hard in the head.","elder who":"Who are you?","elder who answ":"I'm the unofficial leader of this village. If you have any questions, come to me","elder leave 1":"Great... Thank you for help, but I think I should go there then. Maybe it will help me remember more.","elder leave 1 answ":"Nearby lands are dangerous and you are still too weak to leave. Do you plan on getting ambushed again?","elder need to":"But I want to leave","elder need to answ":"You first need to recover, to get some rest and maybe also training, as you seem rather frail... Well, you know what? Killing a few wolf rats could be a good exercise. You could help us clear some field of them, how about that?","elder eq":"Is there any way I could get a weapon and proper clothes?","elder eq answ":"We don't have anything to spare, but you can talk with our trader. He should be somewhere nearby. If you need money, try selling him some rat remains. Fangs, tails or pelts, he will buy them all. I have no idea what he does with this stuff...","elder leave 2":"Can I leave the village?","elder leave 2 answ":"We talked about this, you are still too weak","elder money":"Are there other ways to make money?","elder money answ":"You could help us with some fieldwork. I'm afraid it won't pay too well.","elder rats":"Are wolf rats a big issue?","elder rats answ":"Oh yes, quite a big one. Not literally, no, though they are much larger than normal rats... They are a nasty vermin that's really hard to get rid of. And with their numbers they can be seriously life-threatening. Only in a group though, single wolf rat is not much of a threat","elder cleared 1":"I cleared the field, just as you asked me to","elder cleared 1 answ":"You did? That's good. How about a stronger target? Nearby cave is just full of this vermin. Before that, maybe get some sleep? Some folks prepared that shack over there for you. It's clean, it's dry, and it will give you some privacy. Oh, and before I forget, our old craftsman wanted to talk to you.","elder leave 3":"Can I leave the village?","elder leave 3 answ":"You still need to get stronger.","elder cave clear":"I cleared the cave. Most of it, at least","elder cave clear answ":`Then I can't call you "too weak" anymore, can I? You are free to leave whenever you want, but still, be careful. You might also want to ask the guard for some tips about the outside. He used to be an adventurer.`,"elder leave 4":"Can I leave the village?","elder leave 4 answ":"You are strong enough, you can leave and come whenever you want.","elder tunnel":"I found an even deeper tunnel in the cave","elder tunnel answ":"The what? I have a very bad feeling about this... You better avoid it until you get better equipment and some solid shield, I can bet it's gonna be a lot more dangerous.","elder training":"I think I went far enough with basic training, do you have any other suggestions?","elder training answ 1":"You did? Well, let me think... You could try swimming in the river nearby if you haven't done that yet, just remember not to do it in cold weather. Or you could try some wall climbing, but be sure to start with low heights to be safe.","elder training answ 2":"You did? Well, let me think... Swimming in the river nearby would be a good exercise, but it's mostly frozen now in winter. You could try some wall climbing though, but be sure to start with low heights to be safe.","craftsman description":"You see an old man who clearly experienced a lot in life. He's wearing some handmade accessories. Despite his age, his fingers seem exceptionally nimble.","craftsman hello":"Hello, I heard you wanted to talk to me?","craftsman hello answ":"Ahh, good to see you traveler. I just thought of a little something that could be of help for someone like you. See, young people this days don't care about the good old art of crafting and prefer to buy everything from the store, but I have a feeling that you just might be different. Would you like a quick lesson?","craftsman learn":"Sure, I'm in no hurry.","craftsman learn answ":`Ahh, that's great. Well then... 
*[Old man spends some time explaining all the important basics of crafting and providing you with tips]*
Ahh, and before I forget, here, take these. They will be helpful for gathering necessary materials.`,"craftsman leave":"I'm not interested.","craftsman leave answ":"Ahh, I see. Maybe some other time then, when you change your mind, hmm?","craftsman remind 1":"Could you remind me how to create equipment for myself?","craftsman remind 1 answ":"Ahh, of course. Unless you are talking about something simple like basic clothing, then you will first need to create components that can then be assembled together. For weapons, you generally need a part that you use to hit an enemy and a part that you hold in your hand. For armor, you will need some actual armor and then something softer to wear underneath, which would mostly mean some clothes.","craftsman remind 2":"Could you remind me how to improve my creations?","craftsman remind 2 answ":"Ahh, that's simple, you just need more experience. This alone will be a great boon to your efforts. For equipment, you might also want to start with better components. After all, even with the most perfect assembling you can't turn a bent blade into a legendary sword.","craftsman remind 3":"Could you remind me how to get crafting materials?","craftsman remind 3 answ":"Ahh, there's multiple ways of that. You can gain them from fallen foes, you can gather them around, or you can even buy them if you have some spare coin.","craftsman remind 4":"How do I get better at crafting?","craftsman remind 4 answ":"Ahh, there aren't any secrets, you just need to keep practicing it. Just don't spend your entire life working on same louse materials, try to work on stronger stuff when you feel confident. There's a limit to how much you can learn by working with rat leather, isn't there?","guard description":"You see a man in light armor, with a spear in his hand and two daggers on his belt.","guard hello":"Hello?","guard hello answ":"Hello. I see you are finally leaving, huh?","guard job":"Do you maybe have any jobs for me?","guard job answ":"You are somewhat combat capable now, so how about you help me and the boys on patrolling? Not much happens, but it pays better than working on fields","guard tips":"Can you give me any tips for the journey?","guard tips answ":"First and foremost, don't rush. It's fine to spend some more time here, to better prepare yourself. There's a lot of dangerous animals out there, much stronger than those damn rats, and in worst case you might even run into some bandits. If you see something that is too dangerous to fight, try to run away.","guard teach":"Could you maybe teach me something that would be of use?","guard teach answ":`Lemme take a look... Yes, it looks like you know some basics. Do you know any proper techniques? No? I thought so. I could teach you the most standard three. They might be more tiring than fighting the "normal" way, but if used in a proper situation, they will be a lot more effective. Two can be easily presented through some sparring, so let's start with it. The third I'll just have to explain. How about that?`,"guard quick":"So about the quick stance...","guard quick answ":`It's usually called "quick steps". As you have seen, it's about being quick on your feet. While power of your attacks will suffer, it's very fast, making it perfect against more fragile enemies`,"guard heavy":"So about the heavy stance...","guard heavy answ":`It's usually called "crushing force". As you have seen, it's about putting all your strength in attacks. It will make your attacks noticeably slower, but it's a perfect solution if you face an enemy that's too tough for normal attacks`,"guard wide":"What's the third technique?","guard wide answ":`It's usually called "broad arc". Instead of focusing on a single target, you make a wide swing to hit as many as possible. It might work great against groups of weaker enemies, but it will also significantly reduce the power of your attacks and will be even more tiring than the other two stances.`,"g guard description":"You see a massive man in a steel chainmail, with a spear in his hand and a sword on his belt.","g guard hello":"Hello, can I get in?","g guard hello answ":"The town is currently closed to everyone who isn't a citizen or a merchant guild's member. No exceptions.","sus description 1":"You see a young man in shabby clothes and with messy hair, who keeps looking around. He appears to have some nervous ticks, or maybe he's just really stressed. He notices you and stares.","sus description 2":"You see a young man in shabby clothes and with messy hair, who keeps calmly looking around. The moment he notices you, he appears to get calmer.","sus hello":"Hello? Why are you looking at me like that?","sus hello answ":"Y-you! You should be dead! *the man pulls out a dagger*","sus defeated":"What was that about?","sus defeated answ":"I... We... It was my group that robbed you. I thought you came back from your grave for revenge... Please, I don't know anything. If you want answers, ask my ex-boss. He's somewhere in the town.","sus behave":"Are you behaving yourself?","sus behave answ":"Y-yes, boss! Please don't beat me again!","sus boss":"Stop calling me 'boss'","sus boss answ":"Yes, boss! Sorry, boss!","sus situation":"By the way, how are things in this slum?","sus situation answ":"A-as you can see and hear boss, it's pretty b-bad, but it can't be helped without taking out the g-gang...","sus gang":"What gang?","sus gang answ":"It's j-just a gang, they don't have any name, boss. Their hideout is over t-there, you should stay away from it. Almost every k-killer and thug around t-the slum is a part of their group...","sus gang defeated":"That gang you mentioned? I dealt with them.","sus gang defeated answ":"I know boss, we all heard the commotion! You're the best! I think the local trader already pulled out some gear he was hiding from them, you should check it out! <br><strong>*Pauses for a moment*</strong> I wish I had shown you my defensive tricks before that, it might have made your job easier...","sus behave 2":"Are you behaving yourself?","sus behave 2 answ":"Y-yes, I didn't do anything bad since the last time, boss!","sus behave 3":"Are you behaving yourself?","sus behave 3 answ":"Of course boss!","sus tricks":"You said something about defensive tricks? Show me","sus tricks answ":"Sure, boss! So, it's really about focusing on your legs to either jump away faster or to better brace the shield, and... <strong>*He continues explaining for a while*</strong>","sus headpat":"[Pat his head]","sus headpat answ":"[He smiles like a little puppy]","old description 1":"With some safety returned to the area, more folk are now out on the streets. One of them, an elderly lady, is looking at you.","old description 2":"You see a gentle elderly lady with warm look in her eyes","old hello":"[Let her approach you.]","old hello answ":"Hello young warrior. I understand it is you who we have to thank for freeing us from those thugs. Few these days have the gumption, and even fewer the strength to take them on. Well done! Such heroism deserves a reward, and while none of us have much to offer as you can see, but the least I can do is make sure our hero doesn't go hungry. Would you care to join me for dinner?","old dinner":"[Accept the offer.]","old dinner answ":"[You join the woman in her shack for a humble, yet satisfying meal. While the main ingredients are simple, they are well flavoured and garnished with herbs.]","old ingredients":"[Compliment the food and ask where she gets ingredients.]","old ingredients answ":"Surprised? Live here long enough, and you learn how to get by without a lot of pricey things. No, I'm not talking about stealing - I may be poor, but I still have my pride! No, I'm talking about the plants that grow all around. Most people pass them by, without realizing how useful they can be. Ha! Maybe there IS another way I can reward you! I can teach you what to look for, if you're interested.","sup hello":"Hello","sup hello answ":"Hello stranger","sup work":"Do you have any work with decent pay?","sup work answ":"We sure could use more hands. Feel free to help my boys on the fields whenever you have time!","sup anything":"Is there anything I can help you with?","sup anything answ":"I don't think so, nothing aside from normal work... Actually there is one thing. We're in a dire need of 50 packs of bonemeal and lost our supplier on top of that, so I'm willing to pay you a triple price. Bad news is, you will have to bring all 50 in a single delivery.","sup bonemeal":"More bonemeal, you say?","sup bonemeal answ":"Absolutely! I know the lower price might not be the most appealing, but at least it's stable, unlike the market, and at times might be a lot better than what any trader would pay you for it.","sup animals":"Do you sell anything?","sup animals answ":"Sorry, I'm not allowed to. However if you were to help us produce something, I could let you take part of it. It just so happens our sheep need shearing, if you're interested in some free wool.","sup fight0":"Do you have any task that requires some good old violence?","sup fight0 answ":"I kinda do, but you don't seem strong enough for that. I'm sorry.","sup fight":"Do you have any task that requires some good old violence?","sup fight answ":"Actually yes. There's that annoying group of boars that keep destroying our fields. They don't do enough damage to cause any serious problems, but I would certainly be calmer if someone took care of them. Go to the forest and search for a clearing in north, that's where they usually roam when they aren't busy eating our crops. I will of course pay you for that. 4 silver coins is most I can offer, I'm running on a strict budget here.","sup things":"How are things around here?","sup things answ":"Nothing to complain about. Trouble is rare, pay is good, and the soil is as fertile as my wife!","sup defeated boars":"I took care of those boars","sup defeated boars answ":"Really? That's great! Here, this is for you.","sup troubled":"You look troubled","sup troubled answ":"Troubled? I'm fuming, I'm going insane here! Those damn accursed ants, they keep destroying crops by eating their roots over and over again! If I could, I would drop everything, grab a sword and a shovel and go find their damn nests, and then slaughter every last one of them! Not just soldiers and workers, but queens and larvae too! Destroy their nests for me and you will have my gratitude, I will even pay you out of my own pocket!... Oh, and you can borrow a shovel from the farm if you don't have your own.","sup eliminated":"The ants are gone, though there are some trails leading to the forest","sup eliminated answ":"That's just... thank you, thank you so much! Here, take this, you earned it! As for the forest, I don't really care, as long as they don't come back.","sup deliver":"[Deliver the bonemeal]","sup deliver answ":"Thank you very much, here's your money! If you ever want to make more deliveries of this size, we will gladly take them, although it will have to be for the regular price","sup deliver not":"I'm sorry, but that's not enough","sup deliver 2":"[Deliver the bonemeal]","sup deliver 2 answ":"Thank you very much, here's your money! We will gladly take more, whenever you have it!","sup deliver 2 not":"I'm sorry, but that's not enough","sup description":"You see a well dressed man with a notebook on his belt and a hat on his head. Despite seeming more like a scribe, he's buff and tanned."},mofu_english:{"elder description":"You see an older man with curly white hair and dull, heavy horns. Despite his years, he stands with a strong posture, ready to ram any threat to the village. He eyes you with curiosity.","craftsman description":"You see an old man with a medium length white tail, who clearly experienced a lot in life. His hair is composed of a black and a white part, with the former very dulled by age. He's wearing some handmade accessories. Despite his age and his massive hands, his fingers seem exceptionally nimble.","craftsman learn answ":`Ahh, that's great. Well then... 
*[Old man spends some time explaining all the important basics of crafting and providing you with tips, his large fingers proving to be as nimble as they seemed]*
Ahh, and before I forget, here, take these. They will be helpful for gathering necessary materials.`,"guard description":"You see a man in light armor, with a spear in his hand and two daggers on his belt. His sharp fuzzy ears rotate every now end then towards any new sound.","g guard description":"You see a massive, hairy man with round ears and a tiny tail. He's clad in a steel chainmail, with a spear in his hand and a sword on his belt.","sus description 1":"You see a young man in shabby clothes and with messy hair, who keeps looking around. He appears to have some nervous ticks, or maybe he's just really stressed. Both his doggy ears and his tail are lowered and not moving. He notices you and stares.","sus description 2":"You see a young man in shabby clothes and with messy hair, who keeps calmly looking around, with ears straight up and occasionally turning towards new sounds. The moment he notices you, he appears to get calmer and his tail starts slowly wagging.","sus headpat answ":"[He smiles like a little puppy, his tail wagging a lot faster]","old description 1":"With some safety returned to the area, more folk are now out on the streets. One of them, an elderly tanuki lady, is looking at you.","old description 2":"You see a gentle elderly tanuki lady with warm look in her eyes","sup description":"You see a well dressed man with a notebook on his belt and a hat on his head, awkwardly placed between a pair of antlers. Despite seeming more like a scribe, he's buff and tanned."}};var Cl,ve={},U=document.getElementById("location_actions_div"),Al=document.getElementById("trade_div"),Bl=document.getElementById("storage_div"),Hl=document.getElementById("location_name_span"),Ts=document.getElementById("location_icon_span"),Wa=document.getElementById("location_types_div"),js=document.getElementById("location_name_tooltip"),Ye,Di,Ol,Nl,Pa=[],gn=document.getElementById("inventory_content_div"),te={},Ee={},ut={},fi={},gi={},ea=document.getElementById("trader_inventory_div"),ja=document.getElementById("storage_inventory_div"),Un=document.getElementById("message_box_div"),Pl=document.getElementById("combat_div"),Ge=document.getElementById("enemies_div"),Ws=document.getElementById("enemy_count_div"),Bc=document.getElementById("character_health_value"),Hc=document.getElementById("character_healthbar_current"),xl=document.getElementById("character_health_tooltip"),Oc=document.getElementById("character_stamina_value"),Nc=document.getElementById("character_stamina_bar_current"),Ha=document.getElementById("character_stamina_tooltip"),ql=document.getElementById("character_xp_div"),Pc=document.getElementById("character_level_div"),pn=document.getElementById("character_xp_tooltip"),Is=document.getElementById("effects_tooltip"),jc=document.getElementById("active_effect_count"),Wc=document.getElementById("time_div"),Kn=document.getElementById("weather_div"),ne={},_t=document.getElementById("skill_list"),Se=[],ot={},Ni=document.getElementById("stance_list"),ni={},Cs=document.getElementById("books_list"),Gi={},As=document.getElementById("bestiary_list"),wi=document.getElementById("switch_to_combat"),jl=document.getElementById("switch_to_inventory"),Rs={},Gs=document.getElementById("quest_list"),Ml={reputation:document.getElementById("data_tab_reputation_div")},Jn="name",Pi="asc",$l="name",ji="asc",El="name",Wi="asc",Sl="name",Ri="asc",ee={message_combat:0,message_unlocks:0,message_loot:0,message_events:0,message_background:0,message_crafting:0},Fi={strength:document.getElementById("strength_slot"),agility:document.getElementById("agility_slot"),dexterity:document.getElementById("dexterity_slot"),intuition:document.getElementById("intuition_slot"),magic:document.getElementById("magic_slot"),attack_speed:document.getElementById("attack_speed_slot"),attack_power:document.getElementById("attack_power_slot"),defense:document.getElementById("defense_slot"),crit_rate:document.getElementById("crit_rate_slot"),crit_multiplier:document.getElementById("crit_multiplier_slot")},ii={attack_points:document.getElementById("hit_chance_slot"),defensive_action:document.getElementById("defensive_action_slot"),defensive_points:document.getElementById("defensive_action_chance_slot")},zi={},Rc=document.getElementById("character_attack_bar"),yi={head:document.getElementById("head_slot"),torso:document.getElementById("torso_slot"),arms:document.getElementById("arms_slot"),ring:document.getElementById("ring_slot"),weapon:document.getElementById("weapon_slot"),"off-hand":document.getElementById("off-hand_slot"),legs:document.getElementById("legs_slot"),feet:document.getElementById("feet_slot"),amulet:document.getElementById("amulet_slot"),artifact:document.getElementById("artifact_slot"),cape:document.getElementById("cape_slot"),pickaxe:document.getElementById("pickaxe_slot"),axe:document.getElementById("axe_slot"),sickle:document.getElementById("sickle_slot"),shovel:document.getElementById("shovel_slot")},Pt={trash:"lightgray",common:"white",uncommon:"lightgreen",rare:"blue",epic:"pink",legendary:"purple",mythical:"orange"},Xe={},Vs,Fs,Gc=document.getElementById("loading_screen_loading_progress"),ei=document.getElementById("backup_load_button"),vt=document.getElementById("import_other_save_button"),Ll=document.getElementById("export_button_tooltip"),Fc="Nevermind";function dt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Wl(e,t){let i=document.createElement("div");t.x=t.x+Math.random()*80-40,i.style.top=t.y+"px",i.style.left=t.x+"px",i.classList.add("floating_effect"),i.innerText=e,i.posX=t.x,i.posY=t.y,document.body.appendChild(i);let n=0,s;Math.random()>.5?s=setInterval(()=>{i.style.top=i.posY-2*n**.95+"px",i.style.left=i.posX-Math.sin(n/10)*20+"px",i.style.opacity=(100-n**.95)/100,n++},30):s=setInterval(()=>{i.style.top=i.posY-2*n**.95+"px",i.style.left=i.posX-Math.cos(n/8)*16+"px",i.style.opacity=(100-n**.95)/100,n++},30),setTimeout(()=>{clearInterval(s),i.remove()},4*1e3)}function Vi(){for(;U.lastElementChild;)U.removeChild(U.lastElementChild),ve={}}function Qi(e,t={},i=!1){let n=document.createElement("span");return n.classList.add(t?.class_name||"item_tooltip"),n.innerHTML=yn({item:e,options:t,is_trade:i}),n}function yn({item:e,options:t={},is_trade:i=!1}){let n="",s=i?"getValue":"getBaseValue";n=`<b>${e.getName()}</b>`,e.description&&(n+=`<br>${e.description}`);let a=e.quality;if(e.item_type==="EQUIPPABLE"){if(t?.quality&&t.quality[0]&&(a=t.quality[0]),e.ignore_quality||(!t.skip_quality&&t?.quality?.length==2?(n+=`<br><br><b>Quality: <span style="color: ${Pt[e.getRarity(t.quality[0])]}"> ${t.quality[0]}% </span> - <span style="color: ${Pt[e.getRarity(t.quality[1])]}"> ${t.quality[1]}% </span>`,n+=`<br>[<span style="color: ${Pt[e.getRarity(t.quality[0])]}">${e.getRarity(t.quality[0])}</span>-<span style="color: ${Pt[e.getRarity(t.quality[1])]}">${e.getRarity(t.quality[1])}</span>] </b>`):n+=`<br><br><b style="color: ${Pt[e.getRarity(a)]}">Quality: ${a}% [${e.getRarity(a)}]</b>`),n+=`<br><br>Slot: <b>${e.equip_slot}</b>`,e.equip_slot==="weapon"&&(n+=`<br>Type: <b>${e.weapon_type}</b>`),e.components){let r='<br><br><span class="item_component_list">',d=Object.keys(e.components);e.components&&(r+=`[${u[e.components[d[0]]].name}]`,e.components[d[1]]?r+=`<br>+<br>[${u[e.components[d[1]]].name}]`:r+=`<br>+<br>no [${d[1]}]`),r+="</span>",n+=r}if(!t.skip_quality&&t?.quality?.length==2){e.getAttack?n+=`<br><br>Attack: ${Math.round(10*e.getAttack(t.quality[0]),!0)/10} - ${Math.round(10*e.getAttack(t.quality[1],!0))/10}`:e.getDefense?n+=`<br><br>Defense: ${Math.round(10*e.getDefense(t.quality[0]))/10} - ${Math.round(10*e.getDefense(t.quality[1]))/10}`:e.offhand_type==="shield"&&(n+=`<br><br>Can block up to: ${Math.round(10*e.getShieldStrength(t.quality[0])*l.stats.total_multiplier.block_strength)/10} - ${Math.round(10*e.getShieldStrength(t.quality[1])*l.stats.total_multiplier.block_strength)/10} damage [base: ${e.getShieldStrength(t.quality[0])}-${e.getShieldStrength(t.quality[1])}]`);let r=e.getStats(t.quality[0]),d=e.getStats(t.quality[1]);Object.keys(r).length>0&&(n+="<br>"),Object.keys(r).forEach(c=>{r[c].flat!=null&&(n+=`<br>${dt(c).replace("_"," ")}: +${r[c].flat} - ${d[c].flat}`),r[c].multiplier!=null&&(n+=`<br>${dt(c).replace("_"," ")}: x${r[c].multiplier} - ${d[c].multiplier}`)})}else{e.getAttack?n+=`<br><br>Attack: ${Math.round(10*e.getAttack())/10}`:e.getDefense?n+=`<br><br>Defense: ${Math.round(10*e.getDefense())/10}`:e.offhand_type==="shield"&&(n+=`<br><br>Can block up to: ${Math.round(10*e.getShieldStrength()*l.stats.total_multiplier.block_strength)/10} damage [base: ${e.getShieldStrength()}]`);let r=e.getStats();Object.keys(r).length>0&&(n+="<br>"),Object.keys(r).forEach(function(d){r[d].flat!=null&&(n+=`<br>${dt(d).replace("_"," ")}: +${r[d].flat}`),r[d].multiplier!=null&&(n+=`<br>${dt(d).replace("_"," ")}: x${r[d].multiplier}`)})}let o=e.getBonusSkillLevels();Object.keys(o).length>0&&(n+="<br>"),Object.keys(o).forEach(r=>{r.includes("category_")?n+=`<br>${r} skills level: +${o[r]}`:n+=`<br>${p[r].name()} level: +${o[r]}`}),n+="<br>"}else if(e.item_type==="USABLE"){n+="<br>",e.effects.length>0&&(n+="<br>Effects: ");for(let o=0;o<e.effects.length;o++)n+=Rl({effect_name:e.effects[o].effect,duration:e.effects[o].duration,add_bonus:!0}).outerHTML}else e.item_type==="BOOK"?(F[e.name].is_finished?(n+=`<br><br>Reading it provided ${l.name} with:`,Object.keys(F[e.name].bonuses).length>0&&(n+=`<br>- ${zc(F[e.name].bonuses)}`),F[e.name].rewards?.skills&&(F[e.name].rewards.skills.length==1?n+="<br>- a new skill":n+="<br>- new skills"),F[e.name].rewards?.recipes&&(F[e.name].rewards.recipes.length==1?n+="<br>- a new recipe":n+="<br>- new recipes")):n+=`<br><br>Time to read: ${e.getRemainingTime()} minutes`,n+="<br>"):(e.tags.component&&(t?.quality&&t.quality[0]&&(a=t.quality[0]),!t.skip_quality&&t?.quality?.length==2?(n+=`<br><br><b>Quality: <span style="color: ${Pt[e.getRarity(t.quality[0])]}"> ${t.quality[0]}% </span> - <span style="color: ${Pt[e.getRarity(t.quality[1])]}"> ${t.quality[1]}% </span>`,n+=`<br>[<span style="color: ${Pt[e.getRarity(t.quality[0])]}"> ${e.getRarity(t.quality[0])}</span> - <span style="color: ${Pt[e.getRarity(t.quality[1])]}"> ${e.getRarity(t.quality[1])}</span>]</b>`):n+=`<br><br><b style="color: ${Pt[e.getRarity(a)]}">Quality: ${a}% [${e.getRarity(a)}]</b>`,e.component_tier&&(n+=`<br><br>Component tier: ${e.component_tier}`),(Object.keys(e.component_stats).length>0||e?.attack_value!==0||e?.attack_multiplier!==1||e?.defense_value!==0)&&(n+="<br><br>Basic stats: "),e?.attack_value&&(n+=`<br>Attack power: +${e.attack_value}`),e?.attack_multiplier&&e.attack_multiplier!==1&&(n+=`<br>Size-specific attack power: x${e.attack_multiplier}`),e?.defense_value&&(n+=`<br>Defense: +${e.defense_value}`),Object.keys(e.component_stats).forEach(function(o){e.component_stats[o].flat!=null&&(n+=`<br>${dt(o).replace("_"," ")}: +${e.component_stats[o].flat}`),e.component_stats[o].multiplier!=null&&(n+=`<br>${dt(o).replace("_"," ")}: x${e.component_stats[o].multiplier}`)})),n+="<br>");return e.material_type&&(n+=`<br>Material type: ${e.material_type}<br>`),!t.skip_quality&&t?.quality?.length==2?n+=`<br>Value: ${je(Oe(e[s]({quality:t.quality[0],region:v?.market_region})))} - ${je(Oe(e.getBaseValue({quality:t.quality[1]})))}`:(n+=`<br>Value: ${je(Oe(e[s]({quality:a,region:v?.market_region})*(t&&t.trader?j[Be].getProfitMargin():1)||1))}`,e.saturates_market&&(n+=` [originally ${je(Oe(e.getBaseValue({quality:a,region:v?.market_region})*(t&&t.trader?j[Be].getProfitMargin():1)||1))}]`)),n}function Rl({effect_name:e,duration:t,add_bonus:i=!1}){let n=Z[e],s=document.createElement("div");s.classList.add("active_effect_tooltip");let a=document.createElement("span");a.classList.add("active_effect_name"),a.innerHTML=`'${n.name}' : `;let o=document.createElement("span");o.classList.add("active_effect_duration"),o.innerHTML=""+yt({time:{minutes:t}});let r=document.createElement("div");r.classList.add("active_effect_name_and_duration"),r.appendChild(a),r.appendChild(o),s.appendChild(r);let d=document.createElement("div"),c;i?c=bo(n):c=n.effects;for(let[h,f]of Object.entries(c.stats)){s.innerHTML+=`<br>${dt(We[h])}`;let y=!1;if(f.flat){let b=f.flat>0?"+":"";s.innerHTML+=`: ${b}${Math.round(100*f.flat)/100}`,y=!0}f.multiplier&&(y?s.innerHTML+=`, x${Math.round(100*f.multiplier)/100}`:s.innerHTML+=`: x${Math.round(100*f.multiplier)/100}`)}let _=Object.keys(c.xp_multipliers);if(_.length>0){let h;_[0]!=="all"&&_[0]!=="hero"&&_[0]!=="all_skill"?h=p[_[0]].name():h=_[0].replace("_"," "),h=dt(h),s.innerHTML?s.innerHTML+=`<br>${h} xp gain: x${c.xp_multipliers[_[0]]}`:s.innerHTML=`${h} xp gain: x${c.xp_multipliers[_[0]]}`;for(let f=1;f<_.length;f++){let y;_[f]!=="all"&&_[f]!=="hero"&&_[f]!=="all_skill"?y=p[_[f]].name():y=_[f].replace("_"," "),s.innerHTML+=`<br>${y} xp gain: x${c.xp_multipliers[_[f]]}`}}return s.appendChild(d),s}function ai(e){clearInterval(Cl);let t=document.getElementById("action_status_div");e&&t&&(t.innerHTML="")}function S(e,t){if(typeof e>"u")return;let i=document.createElement("div");i.classList.add("message_common");let n="message_default",s="message_events";switch(t){case"enemy_defeated":n="message_victory",s="message_combat",ee.message_combat+=1;break;case"hero_defeat":n="message_hero_defeated",s="message_combat",ee.message_combat+=1;break;case"enemy_attacked":n="message_enemy_attacked",s="message_combat",ee.message_combat+=1;break;case"enemy_attacked_critically":n="message_enemy_attacked_critically",s="message_combat",ee.message_combat+=1;break;case"hero_attacked":n="message_hero_attacked",s="message_combat",ee.message_combat+=1;break;case"hero_missed":s="message_combat",ee.message_combat+=1;break;case"hero_blocked":s="message_combat",ee.message_combat+=1;break;case"enemy_missed":s="message_combat",ee.message_combat+=1;break;case"hero_attacked_critically":n="message_hero_attacked_critically",s="message_combat",ee.message_combat+=1;break;case"combat_loot":n="message_items_obtained",s="message_loot",ee.message_loot+=1;break;case"gathered_loot":n="message_items_obtained",s="message_loot",ee.message_loot+=1;break;case"total_gathered_loot":n="message_total_items_obtained",s="message_loot",ee.message_loot+=1;break;case"location_reward":s="message_loot",ee.message_loot+=1;break;case"skill_raised":n="message_skill_leveled_up",s="message_unlocks",ee.message_unlocks+=1;break;case"level_up":s="message_unlocks",ee.message_unlocks+=1;break;case"activity_unlocked":s="message_unlocks",ee.message_unlocks+=1;break;case"location_unlocked":n="message_location_unlocked",s="message_unlocks",ee.message_unlocks+=1;break;case"dialogue_unlocked":s="message_unlocks",ee.message_unlocks+=1;break;case"message_travel":n="message_travel",s="message_events",ee.message_events+=1;break;case"export_reward":n="message_export_reward",s="message_events",ee.message_events+=1;break;case"activity_finished":s="message_events",ee.message_events+=1;break;case"activity_money":s="message_events",ee.message_events+=1;break;case"notification":ee.message_events+=1,s="message_events",n="message_notification";break;case"background":ee.message_background+=1,s="message_background";break;case"crafting":ee.message_crafting+=1,s="message_crafting";break;case"message_critical":ee.message_events+=1,s="message_events",n="message_critical";break}(s==="message_combat"&&ee.message_combat>80||s==="message_loot"&&ee.message_loot>28||s==="message_unlocks"&&ee.message_unlocks>40||s==="message_events"&&ee.message_events>40||s==="message_background"&&ee.message_background>28||s==="message_crafting"&&ee.message_crafting>28)&&Un.removeChild(Un.getElementsByClassName(s)[0]),i.classList.add(n,s),i.innerHTML=e+"<div class='message_border'> </>",Un.appendChild(i);let a=s.replace("_","_show_");document.getElementById(a).classList.contains("active_selection_button")&&(Un.scrollTop=Un.scrollHeight)}function zc(e){let t="";if(e.stats){let i=Object.keys(e.stats);t=`+${e.stats[i[0]]} ${We[i[0]]}`;for(let n=1;n<i.length;n++)t+=`, +${e.stats[i[n]]} ${We[i[n]]}`}if(e.multipliers){let i=Object.keys(e.multipliers);t?t+=`, x${e.multipliers[i[0]]} ${We[i[0]]}`:t=`x${e.multipliers[i[0]]} ${We[i[0]]}`;for(let n=1;n<i.length;n++)t+=`, x${e.multipliers[i[n]]} ${We[i[n]]}`}if(e.xp_multipliers){let i=Object.keys(e.xp_multipliers),n;i[0]!=="all"&&i[0]!=="hero"&&i[0]!=="all_skill"?n=p[i[0]].name():n=i[0].replace("_"," "),t?t+=`, x${e.xp_multipliers[i[0]]} ${n} xp gain`:t=`x${e.xp_multipliers[i[0]]} ${n} xp gain`;for(let s=1;s<i.length;s++){let a;i[s]!=="all"&&i[s]!=="hero"&&i[s]!=="all_skill"?a=p[i[s]].name():a=i[s].replace("_"," "),t+=`, x${e.xp_multipliers[i[s]]} ${a} xp gain`}}return t}function Ra({loot_list:e,is_combat:t=!1,is_a_summary:i=!1}){if(e.length==0)return;let n;e[0].item_id?n=u[e[0].item_id]:e[0].item_key&&(n=ye(e[0].item_key));let s,a;if(t?(a="combat_loot",s='Looted "'):i?(a="total_gathered_loot",s='Gained in total: "'):(a="gathered_loot",s='Gained "'),s+=n.getName()+'" x'+e[0].count,e.length>1)for(let o=1;o<e.length;o++)e[o].item_id?n=u[e[o].item_id]:e[o].item_key&&(n=ye(e[o].item_key)),s+=', "'+n.getName()+'" x'+e[o].count;S(s,a)}function Ga(e){ai(),Cl=setInterval(()=>{let t=document.getElementById("action_status_div"),i="";t.innerHTML.endsWith("...")?i="...":t.innerHTML.endsWith("..")?i="..":t.innerHTML.endsWith(".")&&(i="."),e?.book_title&&(t.innerHTML=t.innerHTML.split(",")[0]+`, ${Ti(u[e.book_title].getRemainingTime())} left`,t.innerHTML+=i),i.length<3?t.innerHTML+=".":t.innerHTML=t.innerHTML.substring(0,t.innerHTML.length-3)},600)}function _l(){U.style.display="none",Al.style.display="inherit",document.getElementById("trader_cost_mult_value").textContent=`${Math.round(100*j[Be].getProfitMargin())}%`,Ht()}function Sa(){U.style.display="none",Bl.style.display="inherit",Qs()}function mn(){document.getElementById("money_div").innerHTML=`Your purse contains: ${je(l.money)}`}function Gl(e){document.getElementById("trade_price_value").innerHTML=je(e)}function Dc(){let e=document.createElement("div");e.classList.add("trade_ammount_buttons");let t=document.createElement("div");t.classList.add("trade_ammount_button"),t.innerText="5",t.setAttribute("data-trade_ammount",5),e.appendChild(t);let i=document.createElement("div");i.classList.add("trade_ammount_button"),i.innerText="10",i.setAttribute("data-trade_ammount",10),e.appendChild(i);let n=document.createElement("div");return n.classList.add("trade_ammount_button"),n.innerText="all",n.setAttribute("data-trade_ammount",1/0),e.appendChild(n),e}function vn({sort_by:e="name",target:t="character",change_direction:i=!1}){let n,s;if(t==="trader")i&&(e&&e===$l?ji==="asc"?ji="desc":ji="asc":e==="price"?ji="desc":ji="asc"),t=ea,n=ji==="asc"?1:-1,s=ji==="asc"?-1:1,$l=e||"name";else if(t==="character")i&&(e&&e===Sl?Ri==="asc"?Ri="desc":Ri="asc":e==="price"?Ri="desc":Ri="asc"),t=gn,n=Ri==="asc"?1:-1,s=Ri==="asc"?-1:1,Sl=e||"name";else if(t==="storage")i&&(e&&e===El?Wi==="asc"?Wi="desc":Wi="asc":e==="price"?Wi="desc":Wi="asc"),t=ja,n=Wi==="asc"?1:-1,s=Wi==="asc"?-1:1,El=e||"name";else{console.warn(`Something went wrong, no such inventory as '${t}'`);return}[...t.children].sort((a,o)=>{if(a.classList.contains("equipped_item_control")&&!o.classList.contains("equipped_item_control"))return-1;if(!a.classList.contains("equipped_item_control")&&o.classList.contains("equipped_item_control")||a.classList.contains("item_to_trade")&&!o.classList.contains("item_to_trade"))return 1;if(!a.classList.contains("item_to_trade")&&o.classList.contains("item_to_trade"))return-1;if(a.classList.contains("character_item_equippable")&&!o.classList.contains("character_item_equippable"))return 1;if(!a.classList.contains("character_item_equippable")&&o.classList.contains("character_item_equippable"))return-1;if(a.classList.contains("trader_item_equippable")&&!o.classList.contains("trader_item_equippable"))return 1;if(!a.classList.contains("trader_item_equippable")&&o.classList.contains("trader_item_equippable"))return-1;if(a.classList.contains("storage_item_equippable")&&!o.classList.contains("storage_item_equippable"))return 1;if(!a.classList.contains("storage_item_equippable")&&o.classList.contains("storage_item_equippable"))return-1;if(a.children[0].children[0].children[0].innerText==="[Comp]"&&o.children[0].children[0].children[0].innerText!=="[Comp]")return 1;if(a.children[0].children[0].children[0].innerText!=="[Comp]"&&o.children[0].children[0].children[0].innerText==="[Comp]")return-1;if(a.children[0].children[0].children[0].innerText==="[Book]"&&o.children[0].children[0].children[0].innerText!=="[Book]")return 1;if(a.children[0].children[0].children[0].innerText!=="[Book]"&&o.children[0].children[0].children[0].innerText==="[Book]")return-1;let r=a.dataset.item_slot,d=o.dataset.item_slot;if(!Xn.includes(r)&&Xn.includes(d))return 1;if(Xn.includes(r)&&!Xn.includes(d))return-1;if(e==="type"){if(r!=d)return Object.keys(yi).indexOf(a.dataset.item_slot)-Object.keys(yi).indexOf(o.dataset.item_slot);if(a.classList.contains("character_item_usable")!=o.classList.contains("character_item_usable"))return o.classList.contains("character_item_usable")-a.classList.contains("character_item_usable");if(a.classList.contains("trader_item_usable")!=o.classList.contains("trader_item_usable"))return o.classList.contains("trader_item_usable")-a.classList.contains("trader_item_usable");if(a.classList.contains("storage_item_usable")!=o.classList.contains("storage_item_usable"))return o.classList.contains("storage_item_usable")-a.classList.contains("storage_item_usable");let c=null,_=null;if(t===gn?(c=u[JSON.parse(a.dataset.character_item).id],_=u[JSON.parse(o.dataset.character_item).id]):t===ea?(c=u[JSON.parse(a.dataset.trader_item).id],_=u[JSON.parse(o.dataset.trader_item).id]):t===ja&&(c=u[JSON.parse(a.dataset.storage_item).id],_=u[JSON.parse(o.dataset.storage_item).id]),c&&_){if(c.material_type!=_.material_type)return c.material_type>_.material_type?n:s;if(c.component_type!=_.component_type)return c.component_type>_.component_types?n:s;if(c.component_tier!=_.component_tier)return c.component_tier>_.component_tier?n:s}}if(e==="name"||e==="type"){let c=a.children[0].children[0].children[1].innerText.toLowerCase().replaceAll('"',""),_=o.children[0].children[0].children[1].innerText.toLowerCase().replaceAll('"',"");if(c>_)return n;if(c<_)return s;{let h=Number.parseInt(a.dataset.item_quality),f=Number.parseInt(o.dataset.item_quality);return h>f?n:s}}else if(e==="price"){let c=Number.parseInt(a.getAttribute("data-item_value")),_=Number.parseInt(o.getAttribute("data-item_value"));return c>_||c===_&&"item_quality"in a.dataset&&"item_quality"in o.dataset&&Number.parseInt(a.dataset.item_quality)>Number.parseInt(o.dataset.item_quality)?n:s}}).forEach(a=>t.appendChild(a))}function Ht({item_key:e,trader_sorting:t="name",sorting_direction:i="asc",was_anything_new_added:n=!1}={}){let s=j[Be];if(e||(Object.keys(Ee).forEach(a=>{s.inventory[a]||(Ee[a].remove(),delete Ee[a])}),Object.keys(gi).forEach(a=>{L.items.filter(o=>o.item_key===a).length===0&&(gi[a].remove(),delete gi[a])})),e){let a=s.inventory[e].count;n=Ee[e];let o=Wt({key:e,item_count:a,target:"trader",is_trade:!0});Ee[e]?(Ee[e].replaceWith(o),Ee[e]=o):(Ee[e]=o,ea.appendChild(o))}else{Object.keys(s.inventory).forEach(a=>{let o=s.inventory[a].count;for(let r=0;r<E.items.length;r++)if(a===E.items[r].item_key){if(o-=Number(E.items[r].count),o==0){Ee[a]?.remove(),delete Ee[a];return}if(o<0)throw new Error("Something is wrong with trader item count");break}if(!Ee[a])Ee[a]=Wt({key:a,item_count:o,target:"trader",is_trade:!0}),ea.appendChild(Ee[a]),n=!0;else{let r=Number.parseInt(Ee[a].getElementsByClassName("item_count")[0].innerText.replace("x",""));Number.isNaN(r)&&(r=0),r!=o&&(o>1?Ee[a].getElementsByClassName("item_count")[0].innerText=` x${o}`:Ee[a].getElementsByClassName("item_count")[0].innerText=""),Ee[a].querySelector(".item_tooltip").replaceWith(Qi(s.inventory[a].item,I));let c=Ee[a].getElementsByClassName("item_value")[0];c.innerHTML=`${je(Oe(s.inventory[a].item.getValue({region:v.market_region})*(j[Be].getProfitMargin()||1)),!0)}`}});for(let a=0;a<L.items.length;a++){let o=L.items[a].item_key;if(!gi[o])gi[o]=Wt({target:"trader",trade_index:a,is_trade:!0}),ea.appendChild(gi[o]);else{let r=Ee[o]?.dataset.item_count??0,d=L.items[a].count;r!==d&&(d>1?gi[o].getElementsByClassName("item_count")[0].innerText=` x${d}`:gi[o].getElementsByClassName("item_count")[0].innerText="")}}}n&&vn({target:"trader",sort_by:t,direction:i})}function we({item_key:e,equip_slot:t,character_sorting:i="name",sorting_direction:n="asc",was_anything_new_added:s=!1,is_trade:a=!1}={}){if(e||(Object.keys(te).forEach(o=>{if(te[o].classList.contains("equipped_item_control")){let r=te[o].dataset.character_item;(!l.equipment[o]||r!==l.equipment[o].getInventoryKey())&&(te[o].remove(),delete te[o])}else l.inventory[o]||(te[o].remove(),delete te[o])}),Object.keys(fi).forEach(o=>{E.items.filter(r=>r.item_key===o).length===0&&(fi[o].remove(),delete fi[o])})),e){let o=l.inventory[e].count;s=Ee[e];let r=Wt({key:e,item_count:o,target:"character",is_trade:!0});te[e]?(te[e].replaceWith(r),te[e]=r):(te[e]=r,gn.appendChild(r))}else if(t)te[t]=Wt({key:t,target:"character",is_equipped:!0,is_trade:a});else{Object.keys(l.inventory).forEach(o=>{let r=l.inventory[o].count;for(let d=0;d<L.items.length;d++)if(o===L.items[d].item_key){if(r-=Number(L.items[d].count),r==0){te[o]?.remove(),delete te[o];return}if(r<0)throw new Error("Something is wrong with character item count");break}if(!te[o])te[o]=Wt({key:o,item_count:r,target:"character",is_trade:a}),gn.appendChild(te[o]),s=!0;else{let d=Number.parseInt(te[o].getElementsByClassName("item_count")[0].innerText.replace("x",""));Number.isNaN(d)&&(d=0),d!=r&&(r>1?te[o].getElementsByClassName("item_count")[0].innerText=` x${r}`:te[o].getElementsByClassName("item_count")[0].innerText=""),te[o].querySelector(".item_tooltip").replaceWith(Qi(l.inventory[o].item,I,a));let _=te[o].getElementsByClassName("item_value")[0];a?_.innerHTML=`${je(Oe(l.inventory[o].item.getValue({region:v.market_region})),!0)}`:_.innerHTML=`${je(Oe(l.inventory[o].item.getBaseValue()),!0)}`}}),Object.keys(l.equipment).forEach(o=>{if(!te[o]&&l.equipment[o]){if(l.equipment[o]?.tags.tool)return;te[o]=Wt({key:o,target:"character",is_equipped:!0,is_trade:a}),gn.appendChild(te[o]),s=!0}});for(let o=0;o<E.items.length;o++){let r=E.items[o].item_key;if(!fi[r])fi[r]=Wt({target:"character",trade_index:o,is_trade:a}),gn.appendChild(fi[r]);else{let d=te[r]?.dataset.item_count??0,c=E.items[o].count;d!==c&&(c>1?fi[r].getElementsByClassName("item_count")[0].innerText=` x${c}`:fi[r].getElementsByClassName("item_count")[0].innerText="")}}}s&&vn({target:"character",sort_by:i,direction:n})}function Qs({item_key:e,storage_sorting:t="name",sorting_direction:i="asc",was_anything_new_added:n=!1}={}){if(e||Object.keys(ut).forEach(s=>{st.inventory[s]||(ut[s].remove(),delete ut[s])}),e){let s=st.inventory[e].count;ut[e].remove(),delete ut[e],ut[e]=Wt({key:e,item_count:s,target:"storage"}),ja.appendChild(ut[e]),n=!0}else Object.keys(st.inventory).forEach(s=>{let a=st.inventory[s].count;if(!ut[s])ut[s]=Wt({key:s,item_count:a,target:"storage"}),ja.appendChild(ut[s]),n=!0;else{let o=Number.parseInt(ut[s].getElementsByClassName("item_count")[0].innerText.replace("x",""));Number.isNaN(o)&&(o=0),o!=a&&(a>1?ut[s].getElementsByClassName("item_count")[0].innerText=` x${a}`:ut[s].getElementsByClassName("item_count")[0].innerText="")}});!e&&n&&vn({target:"storage",sort_by:t,direction:i})}function wl(){U.style.display="",Bl.style.display="none"}function Wt({key:e,item_count:t,target:i,is_equipped:n,trade_index:s,is_trade:a=!1}){let o=document.createElement("div"),r=document.createElement("div"),d=document.createElement("div"),c=document.createElement("div");c.classList.add("item_additional_content");let _,h,f,y={},b=1;if(i==="trader"?(y.trader=!0,b=j[Be].getProfitMargin()||b):i==="storage"&&(y.storage=!0),n)_=l.equipment[e],t=t??1,f="equipped_item",h="character_item";else if(f="inventory_item",i==="character")typeof s>"u"?(_=l.inventory[e].item,t=t||l.inventory[e].count):(_=j[Be].inventory[E.items[s].item_key].item,t=t||E.items[s].count),h="character_item";else if(i==="trader")typeof s>"u"?(_=j[Be].inventory[e].item,t=t||j[Be].inventory[e].count):(_=l.inventory[L.items[s].item_key].item,t=t||L.items[s].count),h="trader_item";else if(i==="storage")_=st.inventory[e].item,t=t||st.inventory[e].count,h="storage_item";else throw new Error(`"${i}" is not a correct inventory owner`);if("quality"in _&&(o.dataset.item_quality=_.quality),_.tags?.equippable?(_.tags.tool?d.innerHTML=`<span class = "item_slot" >[tool]</span> <span>${_.getName()}</span>`:d.innerHTML=`<span class = "item_slot" >[${_.equip_slot}]</span> <span>${_.getName()}</span>`,d.classList.add(`${f}_name`),r.appendChild(d),o.classList.add(`${f}_control`,`${h}_control`,`${h}_equippable`),o.appendChild(r),typeof s<"u"?r.classList.add(`${f}`,`${h}`,"trade_item_equippable"):r.classList.add(`${f}`,`${h}`,"item_equippable"),o.dataset.item_slot=_.equip_slot):_.tags.component?(d.innerHTML=`<span class = "item_category">[Comp]</span> <span class="item_name">${_.getName()}</span>`,d.classList.add(`${f}_name`),r.appendChild(d),o.classList.add(`${f}_control`,`${h}_control`,`${h}_component`),o.appendChild(r),r.classList.add(`${f}`,`${h}`,"item_component")):_.tags.book?(d.innerHTML='<span class = "item_category">[Book]</span>',d.classList.add(`${f}`),d.innerHTML+=` <span class = "book_name item_name">"${_.name}"</span>`,F[_.name].is_finished?r.classList.add("book_finished"):vo()===_.name&&o.classList.add("book_active")):d.innerHTML=`<span class = "item_category"></span> <span class = "item_name">${_.getName()}</span>`,t>1?d.innerHTML+=`<span class="item_count"> x${t}</span>`:d.innerHTML+='<span class="item_count"></span>',d.classList.add(`${f}_name`),r.appendChild(d),r.classList.add(`${f}`,`${h}`,`item_${_.item_type.toLowerCase()}`),r.appendChild(Qi(_,y,a)),o.classList.add(`${f}_control`,`${h}_control`,`${h}_${_.item_type.toLowerCase()}`),o.setAttribute(`data-${h}`,`${_.getInventoryKey()}`),o.setAttribute("data-item_count",`${t}`),o.setAttribute("data-item_value",`${_.getBaseValue()}`),o.appendChild(r),i==="character"){if(_.item_type==="USABLE"){let k=document.createElement("div");k.classList.add("item_use_button"),k.innerText="[use]";let H=document.createElement("div");H.classList.add("item_auto_use_button"),H.innerText="auto",Tt[_.id]&&H.classList.add("item_auto_use_button_active"),c.appendChild(k),c.appendChild(H)}else if(_.item_type==="BOOK"){let k=document.createElement("div");k.classList.add("item_use_button"),k.innerText="[read]",c.appendChild(k),r.classList.add("item_book")}if(typeof s>"u"&&_.tags.equippable)if(n){let k=document.createElement("div");k.innerHTML="[take off]",k.classList.add("unequip_item_button","item_controls"),c.appendChild(k)}else{let k=document.createElement("span");k.innerHTML="[equip]",k.classList.add("equip_item_button","item_controls"),c.appendChild(k)}}c.appendChild(Dc());let w=document.createElement("span");return w.innerHTML=`${je(Oe(_.getValue({region:v?.market_region})*b),!0)}`,w.classList.add("item_value","item_controls"),c.appendChild(w),o.appendChild(c),typeof s<"u"&&o.classList.add("item_to_trade"),o}function Ui(){Object.keys(yi).forEach(function(e){let t;l.equipment[e]==null?(t=document.createElement("span"),t.classList.add("item_tooltip"),yi[e].innerHTML=`${e} slot`,yi[e].classList.add("equipment_slot_empty"),t.innerHTML=`Your ${e} slot`):(yi[e].innerHTML=l.equipment[e].getName(),yi[e].classList.remove("equipment_slot_empty"),t=Qi(l.equipment[e])),yi[e].appendChild(t)})}function Fa(e){let t=u[e],i=t.getInventoryKey();F[t.name].is_finished?(te[i].classList.add("book_finished"),te[i].classList.remove("book_active")):vo()===t.name?te[i].classList.add("book_active"):te[i].classList.remove("book_active"),te[i].getElementsByClassName("item_tooltip")[0].remove(),te[i].getElementsByClassName("item_book")[0].appendChild(Qi(t))}function Us(){for(let e=0;e<8;e++)if(e<P.length){Ge.children[e].children[0].style.display=null,Ge.children[e].children[0].children[0].innerHTML=P[e].name;let t;P[e].stats.attack_speed>20?t=Math.round(P[e].stats.attack_speed):P[e].stats.attack_speed>2?t=Math.round(P[e].stats.attack_speed*10)/10:t=Math.round(P[e].stats.attack_speed*100)/100;let i=P.filter(o=>o.is_alive).length**(-1/4);P[e].size==="small"&&(i*=C({scaling_type:"multiplicative",skill_id:"Pest killer"}));let n=P.filter(o=>o.is_alive).length**(-1/3);P[e].size==="large"&&(n*=C({scaling_type:"multiplicative",skill_id:"Giant slayer"}));let s=1-rn(l.stats.full.attack_points*i,P[e].stats.agility*Math.sqrt(P[e].stats.intuition??1)),a=rn(P[e].stats.dexterity*Math.sqrt(P[e].stats.intuition??1),l.stats.full.evasion_points*n);l.equipment["off-hand"]?.offhand_type==="shield"&&(a=1),Ge.children[e].children[0].children[1].children[0].innerHTML=`Atk pwr: ${P[e].stats.attack}`,P[e].stats.attack_count>1&&(Ge.children[e].children[0].children[1].children[0].innerHTML+=`x${P[e].stats.attack_count}`),Ge.children[e].children[0].children[1].children[1].innerHTML=`Atk spd: ${t}`,Ge.children[e].children[0].children[1].children[2].innerHTML=`Hit: ${Math.min(100,Math.max(0,Math.round(100*a)))}%`,Ge.children[e].children[0].children[1].children[3].innerHTML=`Ddg: ${Math.min(100,Math.max(0,Math.round(100*s)))}%`,Ge.children[e].children[0].children[1].children[4].innerHTML=`Def: ${P[e].stats.defense}`}else Ge.children[e].children[0].style.display="none"}function Ks(){for(let e=0;e<P.length;e++)P[e].is_alive?Ge.children[e].children[0].style.filter="brightness(100%)":(Ge.children[e].children[0].style.filter="brightness(30%)",Us()),Ge.children[e].children[0].children[2].children[0].children[0].style.width=Math.max(0,100*P[e].stats.health/P[e].stats.max_health)+"%",Ge.children[e].children[0].children[2].children[1].innerText=`${Math.ceil(P[e].stats.health)}/${Math.ceil(P[e].stats.max_health)} hp`}function za(e){if(Vi(),Wa.innerHTML="",Pl.style.display="none",js.innerText="",document.documentElement.style.setProperty("--location_desc_tooltip_visibility","hidden"),Ws.style.display="none",document.documentElement.style.setProperty("--actions_div_height",getComputedStyle(document.body).getPropertyValue("--actions_div_height_default")),document.documentElement.style.setProperty("--actions_div_top",getComputedStyle(document.body).getPropertyValue("--actions_div_top_default")),jl.click(),wi.style.pointerEvents="none",wi.style.cursor="default",wi.style.color="gray",Hl.innerText=v.name,document.getElementById("location_description_div").innerText=v.getDescription(),ta(e),Ne.is_crafting_unlocked&&e.crafting?.is_unlocked){let c=document.createElement("div");c.classList.add("location_choices","choice_craft"),c.setAttribute("onclick","openCraftingWindow()"),c.innerHTML=`<i class="material-icons">construction</i> ${e.crafting.use_text}`,U.appendChild(c)}if(e.housing?.is_unlocked){let c=document.createElement("div");c.innerHTML='<i class="material-icons">bed</i>  '+e.housing.text_to_sleep,c.id="start_sleeping_div",c.setAttribute("onclick","start_sleeping()");let _=document.createElement("div");_.innerHTML='<i class="material-icons">inventory_2</i>  Open your personal chest',_.id="open_storage_div",_.setAttribute("onclick","openStorage()"),U.appendChild(c),U.appendChild(_)}e.dialogues.filter(c=>{if(!$[c].is_unlocked||$[c].is_finished)return!1;{let _=!1;return Object.keys($[c].textlines).forEach(h=>{_||(_=$[c].textlines[h].is_unlocked&&!$[c].textlines[h].is_finished)}),_}}).length>0&&(ve.dialogues=ti({name:"Talk to someone",icon:"question_answer",class_name:"choice_dialogue"}),ve.dialogues.append(...jt({location:e,category:"talk"}))),e.traders.filter(c=>j[c].is_unlocked&&!j[c].is_finished).length>0&&(ve.traders=ti({name:"Visit a merchant",icon:"storefront",class_name:"choice_trade"}),ve.traders.append(...jt({location:e,category:"trade"}))),Object.values(e.activities).filter(c=>x[c.activity_name].type==="JOB"&&x[c.activity_name].is_unlocked&&c.is_unlocked&&x[c.activity_name].base_skills_names.filter(_=>!p[_].is_unlocked).length==0).length>0&&(ve.jobs=ti({name:"Find work",icon:"work_outline",class_name:"choice_work"}),ve.jobs.append(...jt({location:e,category:"work"}))),Object.values(e.activities).filter(c=>x[c.activity_name].type==="TRAINING"&&x[c.activity_name].is_unlocked&&c.is_unlocked&&x[c.activity_name].base_skills_names.filter(_=>!p[_].is_unlocked).length==0).length>0&&(ve.trainings=ti({name:"Train",icon:"fitness_center",class_name:"choice_train"}),ve.trainings.append(...jt({location:e,category:"train"}))),Ne.is_gathering_unlocked&&Object.values(e.activities).filter(_=>x[_.activity_name].type==="GATHERING"&&x[_.activity_name].is_unlocked&&_.is_unlocked&&x[_.activity_name].base_skills_names.filter(h=>!p[h].is_unlocked).length==0).length>0&&(ve.gatherings=ti({name:"Gather resources",icon:"search",class_name:"choice_gather"}),ve.gatherings.append(...jt({location:e,category:"gather"}))),Object.values(e.actions).filter(c=>c.is_unlocked&&!c.is_finished).length>0&&(ve.actions=ti({name:"Take an action",icon:"circle",class_name:"choice_action"}),ve.actions.append(...jt({location:e,category:"action"}))),e.connected_locations.filter(c=>c.location.is_unlocked&&!c.location.is_finished&&!c.location.is_challenge).length>0&&(ve.locations=ti({name:"Move somewhere else",icon:"directions",class_name:"choice_travel"}),ve.locations.append(...jt({location:e,category:"travel"}))),e.connected_locations.filter(c=>c.location.is_challenge&&c.location.is_unlocked&&!c.location.is_finished).length>0&&(ve.challenges=ti({name:"Take on a challenge",icon:"warning_amber",class_name:"choice_travel"}),ve.challenges.append(...jt({location:e,category:"challenge"}))),[...Object.keys(at).filter(c=>c!==v.id),...Object.keys($n).filter(c=>c!==v.id&&m[c].is_unlocked&&!m[c].is_finished)].length+(kt?1:0)>0&&(ve.fast_travel=ti({name:"Fast travel",icon:"directions",class_name:"choice_travel"}),ve.fast_travel.append(...jt({location:e,category:"fast_travel"}))),U.append(...Object.values(ve))}function ta(){v.housing&&v.housing.is_unlocked?Ts.innerHTML='<i class="material-icons location_bed_icon">bed</i>':at[v.id]?Ts.innerHTML='<i class="material-icons">star</i>':Ts.innerHTML='<i class="material-icons">star_border</i>'}function ti({name:e,icon:t,class_name:i}){let n=document.createElement("div");return n.innerHTML=`<i class="material-icons">${t}</i> ${e}`,n.classList.add("location_choice_dropdown",i),n.addEventListener("click",s=>{let a=s.target;a.classList.contains("material-icons")&&(a=a.parentNode),a.classList.contains("location_choice_dropdown")&&(a.classList.toggle("location_choice_dropdown_expanded"),a.classList.contains("location_choice_dropdown_expanded")&&a.scrollIntoView({block:"end",inline:"nearest",behavior:"smooth"}))}),n}function jt({location:e,category:t,is_combat:i=!1}){let n=[];if(t==="talk")for(let s=0;s<e.dialogues.length;s++){if(!$[e.dialogues[s]].is_unlocked||$[e.dialogues[s]].is_finished||!(e.dialogues.filter(r=>{let d=!1;return Object.keys($[r].textlines).forEach(c=>{d||(d=$[r].textlines[c].is_unlocked&&!$[r].textlines[c].is_finished)}),d}).length>0))continue;let o=document.createElement("div");o.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+$[e.dialogues[s]].starting_text,o.classList.add("start_dialogue","location_choice"),o.setAttribute("data-dialogue",e.dialogues[s]),o.setAttribute("onclick","start_dialogue(this.getAttribute('data-dialogue'));"),n.push(o)}else if(t==="trade")for(let s=0;s<e.traders.length;s++){if(!j[e.traders[s]].is_unlocked||j[e.traders[s]].is_finished)continue;let a=document.createElement("div");a.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+j[e.traders[s]].trade_text,a.classList.add("start_trade","location_choice"),a.setAttribute("data-trader",e.traders[s]),a.setAttribute("onclick","startTrade(this.getAttribute('data-trader'));"),n.push(a)}else if(t==="work")Object.keys(e.activities).forEach(s=>{if(!x[e.activities[s].activity_name]?.is_unlocked||!e.activities[s]?.is_unlocked||x[e.activities[s].activity_name].type!=="JOB")return;let a=document.createElement("div");a.classList.add("activity_div","location_choice"),a.setAttribute("data-activity",s),a.setAttribute("onclick","start_activity(this.getAttribute('data-activity'));"),En(e.activities[s])?a.classList.add("start_activity"):a.classList.add("activity_unavailable");let o=document.createElement("div");if(o.classList.add("job_tooltip"),!e.activities[s].infinite&&(e.activities[s].availability_time&&(o.innerHTML=`Available from ${e.activities[s].availability_time.start} to ${e.activities[s].availability_time.end} <br>`),e.activities[s].availability_seasons))if(e.activities[s].availability_seasons.length===3){let r=Ei.filter(d=>!e.activities[s].availability_seasons.includes(d));o.innerHTML+=`Not available during ${r.toString().replaceAll(",",", ")} <br>`}else o.innerHTML+=`Available during ${e.activities[s].availability_seasons.toString().replaceAll(",",", ")} <br>`;o.innerHTML+=`Pays ${je(e.activities[s].get_payment())} per every ${Pn(e.activities[s].working_period)} worked`,a.appendChild(o),a.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+e.activities[s].starting_text,n.push(a)});else if(t==="train")Object.keys(e.activities).forEach(s=>{if(!x[e.activities[s].activity_name]?.is_unlocked||!e.activities[s]?.is_unlocked||x[e.activities[s].activity_name].type!=="TRAINING"||x[e.activities[s].activity_name].base_skills_names.filter(o=>!p[o].is_unlocked).length>0)return;let a=document.createElement("div");if(a.classList.add("activity_div","start_activity","location_choice"),a.setAttribute("data-activity",s),a.setAttribute("onclick","start_activity(this.getAttribute('data-activity'));"),e.activities[s].availability_seasons){let o=document.createElement("div");if(o.classList.add("job_tooltip"),e.activities[s].availability_seasons.length===3){let r=Ei.filter(d=>!e.activities[s].availability_seasons.includes(d));o.innerHTML=`Not available during ${r.toString().replaceAll(",",", ")} <br>`}else o.innerHTML=`Available during ${e.activities[s].availability_seasons.toString().replaceAll(",",", ")} <br>`;a.appendChild(o)}a.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+e.activities[s].starting_text,n.push(a)});else if(t==="gather")Object.keys(e.activities).forEach(s=>{if(!x[e.activities[s].activity_name]?.is_unlocked||!e.activities[s]?.is_unlocked||x[e.activities[s].activity_name].type!=="GATHERING"||x[e.activities[s].activity_name].base_skills_names.filter(o=>!p[o].is_unlocked).length>0)return;let a=document.createElement("div");a.classList.add("activity_div","start_activity","location_choice"),a.setAttribute("data-activity",s),a.setAttribute("onclick","start_activity(this.getAttribute('data-activity'));"),a.appendChild(Zl(e.activities[s])),a.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+e.activities[s].starting_text,n.push(a)});else if(t==="travel"){if(i){let s=document.createElement("div");s.classList.add("travel_normal","action_travel","location_choice");let a=yt({time:{minutes:xt[e.id][e.parent_location.id]}}),o="";a&&(o=" ["+a+"]"),e.leave_text?s.innerHTML=e.leave_text+o:s.innerHTML="Go back to ["+e.parent_location.name+"]"+o,s.setAttribute("data-travel",e.parent_location.id),s.setAttribute("onclick","change_location({location_id:this.getAttribute('data-travel')});"),n.push(s)}else for(let s=0;s<e.connected_locations.length;s++){if(!e.connected_locations[s].location.is_unlocked||e.connected_locations[s].location.is_finished||e.connected_locations[s].location.is_challenge)continue;let a=document.createElement("div"),o=yt({time:{minutes:xt[e.id][e.connected_locations[s].location.id]}});"connected_locations"in e.connected_locations[s].location?(a.classList.add("travel_normal"),"custom_text"in e.connected_locations[s]?a.innerHTML=`<div class='location_choice_icon_box'><i class="material-icons location_choice_icon">check_box_outline_blank</i></div> `+e.connected_locations[s].custom_text+" ["+o+"]":a.innerHTML=`<div class='location_choice_icon_box'><i class="material-icons location_choice_icon">check_box_outline_blank</i></div> Go to [`+e.connected_locations[s].location.name+"] ["+o+"]"):(a.classList.add("travel_combat"),"custom_text"in e.connected_locations[s]?a.innerHTML=`<div class='location_choice_icon_box'><i class="material-icons">warning_amber</i></div> `+e.connected_locations[s].custom_text+" ["+o+"]":a.innerHTML=`<div class='location_choice_icon_box'><i class="material-icons">warning_amber</i></div>  Enter the [`+e.connected_locations[s].location.name+"] ["+o+"]"),a.classList.add("action_travel","location_choice"),a.setAttribute("data-travel",e.connected_locations[s].location.id),a.setAttribute("onclick","change_location({location_id: this.getAttribute('data-travel')});"),n.push(a)}if(vi&&!e.housing?.is_unlocked&&!e.connected_locations){let s=m[vi],a=document.createElement("div");a.classList.add("action_travel","travel_normal","location_choice");let o=yt({time:{minutes:xt[e.id][s.id]}});i||(a.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '),o?a.innerHTML+=`Quick return to [${s.name}] [`+o+"]":a.innerHTML+=`Quick return to [${s.name}]`,a.setAttribute("data-travel",s.name),a.setAttribute("onclick","change_location({location_id:this.getAttribute('data-travel')});"),n.push(a)}n.sort((s,a)=>a.classList.contains("travel_normal")-s.classList.contains("travel_normal"))}else if(t==="challenge"){let s=e.connected_locations.filter(a=>a.location.is_challenge&&a.location.is_unlocked&&!a.location.is_finished);for(let a=0;a<s.length;a++){let o=document.createElement("div");o.classList.add("travel_combat","location_choice"),"custom_text"in s[a]?o.innerHTML='<i class="material-icons">warning_amber</i>  '+s[a].custom_text:o.innerHTML='<i class="material-icons">warning_amber</i>  Enter the '+s[a].location.name,o.classList.add("action_travel"),o.setAttribute("data-travel",s[a].location.id),o.setAttribute("onclick","change_location({location_id:this.getAttribute('data-travel')});"),n.push(o)}}else t==="action"?Object.keys(e.actions).forEach(s=>{if(e.actions[s].is_finished||!e.actions[s].is_unlocked)return;let a=document.createElement("div");a.classList.add("location_action_div","start_game_action","location_choice"),a.setAttribute("data-location_action",s),a.setAttribute("onclick","start_game_action(this.getAttribute('data-location_action'));"),a.appendChild(Qc(e.actions[s])),a.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+e.actions[s].starting_text,n.push(a)}):t==="fast_travel"&&(n=Yc());return n}function Yc(){let e=[],t=[...Object.keys(at).filter(i=>i!==v.id),...Object.keys($n).filter(i=>i!==v.id&&m[i].is_unlocked&&!m[i].is_finished)];kt&&!t.includes(kt)&&t.push(kt),t=t.sort((i,n)=>m[i].housing?.is_unlocked&&!m[n].housing?.is_unlocked?-1:!m[i].housing?.is_unlocked&&m[n].housing?.is_unlocked?1:m[i].tags.safe_zone&&!m[n].tags.safe_zone?-1:!m[i].tags.safe_zone&&m[n].tags.safe_zone?1:0);for(let i=0;i<t.length;i++){if(!m[t[i]].is_unlocked||m[t[i]].is_finished||t[i]===v.id)continue;let n=document.createElement("div"),s=yt({time:{minutes:xt[v.id][t[i]]}});if(m[t[i]].tags.safe_zone?(n.classList.add("travel_normal"),m[t[i]].housing?.is_unlocked?n.innerHTML='<i class="material-icons">bed</i> <span class="fast_travel_name">Travel to ['+m[t[i]].name+"] ["+s+"]</span>":n.innerHTML='<i class="material-icons location_choice_icon">check_box_outline_blank</i> <span class="fast_travel_name">Travel to ['+m[t[i]].name+"] ["+s+"]</span>",n.classList.add("action_travel","location_choice"),n.setAttribute("data-travel",m[t[i]].id),n.setAttribute("onclick","change_location({location_id:this.getAttribute('data-travel'), event});")):(n.classList.add("travel_combat"),n.innerHTML=`<i class="material-icons">warning_amber</i> <span class="fast_travel_name">Travel to [${m[t[i]].name}] [${s}] </span>`,n.classList.add("action_travel","location_choice"),n.setAttribute("data-travel",m[t[i]].id),n.setAttribute("onclick","change_location({location_id: this.getAttribute('data-travel'), event});")),!m[t[i]].housing?.is_unlocked&&m[t[i]].id!==kt){let a=document.createElement("span");a.innerHTML='<i class="material-icons fast_travel_removal_button">close</i>',a.setAttribute("onclick","remove_location_from_favourites({location_id:this.parentNode.getAttribute('data-travel')})"),n.appendChild(a)}e.push(n)}return e}function Da({location_id:e}){let t=ve.fast_travel.querySelector(`[data-travel="${e}"`);e===kt||m[e].housing?.is_unlocked?t.getElementsByClassName("fast_travel_removal_button")[0].parentNode.remove():t.remove()}function Fl(e){document.documentElement.style.setProperty("--location_desc_tooltip_visibility","visible"),Vi(),Wa.innerHTML="";let t;ta(e),Ws.style.display="block",Pl.style.display="block",I.disable_combat_autoswitch||(wi.click(),wi.classList.add("active_selection_button"),jl.classList.remove("active_selection_button")),wi.style.pointerEvents="auto",wi.style.cursor="pointer",wi.style.color="white",document.documentElement.style.setProperty("--actions_div_height",getComputedStyle(document.body).getPropertyValue("--actions_div_height_combat")),document.documentElement.style.setProperty("--actions_div_top",getComputedStyle(document.body).getPropertyValue("--actions_div_top_combat")),Ws.children[0].children[1].innerHTML=e.enemy_count-e.enemy_groups_killed%e.enemy_count,t=jt({location:e,category:"travel",is_combat:!0}),U.append(...t),Hl.innerText=v.name,v.types.length==0?document.documentElement.style.setProperty("--location_name_div_width","390px"):document.documentElement.style.setProperty("--location_name_div_width","250px"),js.innerText=v.getDescription(),js.classList.add("location_tooltip"),document.getElementById("location_description_div").innerText=v.getDescription(),zl(v)}function zl(e){for(let t=0;t<e.types?.length;t++){let i=document.createElement("div");i.innerHTML=e.types[t].type+(e.types[t].stage>1?` ${"I".repeat(e.types[t].stage)}`:""),i.classList.add("location_type_div");let n=document.createElement("div");n.innerHTML=Ke[e.types[t].type].stages[e.types[t].stage].description,n.classList.add("location_type_tooltip");let{type:s,stage:a}=e.types[t],{effects:o}=Ke[s].stages[a];Object.keys(o||{}).length>0&&(n.innerHTML+="<br>",Object.keys(o).forEach(r=>{if(o[r].multiplier){let d=o[r].multiplier,c=zn(s,a,r,"multiplier");n.innerHTML+=`<br>${We[r]} x${Math.round(1e3*c)/1e3}`,d!=c&&(n.innerHTML+=` [base: x${o[r].multiplier}]`)}if(o[r].flat){let d=o[r].flat,c=zn(s,a,r,"flat");n.innerHTML+=`<br>${We[r]}: ${Math.round(1e3*c)/1e3}`,d!=c&&(n.innerHTML+=` [base: ${o[r].flat}]`)}})),i.appendChild(n),Wa.appendChild(i)}}function Dl(e){Wa.innerHTML="",zl(e)}function Yl(){U.style.display="none",document.getElementById("crafting_window").style.display="block",(!Vs||!Fs)&&Js("crafting"),Zs()}function Vl(){U.style.display="block",document.getElementById("crafting_window").style.display="none",za(v)}function Js(e){Vs=e;let t=document.getElementById("crafting_subpage_buttons").children;for(let i=0;i<t.length;i++)t[i].style.display=G[e][t[i].dataset.crafting_subcategory]?"":"none";t[0].click(),Ul()}function Ql(e){Fs=e;let t=document.querySelectorAll("[data-crafting_category][data-crafting_subcategory]");for(let i=0;i<t.length;i++)t[i].dataset.crafting_category==Vs&&t[i].dataset.crafting_subcategory==Fs?t[i].style.display="":t[i].style.display="none";Ul()}function Ul(){let e=["selected_recipe","selected_component_list","selected_component_category"];for(let t=0;t<e.length;t++){let i=document.getElementsByClassName(e[t]);for(let n=0;n<i.length;n++)i[n].classList.remove(e[t])}}function Kl(e,t){if(Xe[e]||(Xe[e]={}),Xe[e][t]||(Xe[e][t]=document.querySelector(`[data-crafting_category="${e}"][data-crafting_subcategory="${t}"]`)),!Xe[e][t]){let i=document.createElement("div");i.classList.add("crafting_category"),i.classList.add("crafting_recipe_list"),i.dataset.crafting_category=e,i.dataset.crafting_subcategory=t,Xe[e][t]=document.getElementById("recipe_categories").appendChild(i)}return Xe[e][t]}function Xs(){Object.keys(G).forEach(e=>{Object.keys(G[e]).forEach(t=>{t==="items"&&(Kl(e,t).innerHTML=""),Object.keys(G[e][t]).forEach(i=>{Jl({category:e,subcategory:t,recipe_id:i})})})}),io()}function Jl({category:e,subcategory:t,recipe_id:i}){let n=G[e][t][i];if(!n.is_unlocked)return;let s=document.createElement("div"),a=document.createElement("span");if(a.innerHTML=n.name,s.append(a),s.classList.add("recipe_div"),s.dataset.recipe_id=i,t==="items"){a.classList.add("recipe_item_name"),s.children[0].innerHTML='<i class="material-icons icon" style="visibility:hidden"> keyboard_double_arrow_down </i>'+s.children[0].innerHTML,n.get_availability().available_ammount||s.classList.add("recipe_unavailable"),s.addEventListener("click",_=>{_.target.classList.contains("recipe_item_name")&&!_.target.parentNode.classList.contains("recipe_unavailable")?window.useRecipe(_.target):_.target.classList.contains("craft_ammount_button")&&window.useRecipe(_.target.parentNode,Number(_.target.dataset.craft_ammount))});let o=document.createElement("div");o.classList.add("craft_ammount_buttons");let r=document.createElement("div");r.innerHTML="5",r.dataset.craft_ammount=5,r.classList.add("craft_ammount_button"),o.append(r);let d=document.createElement("div");d.innerHTML="10",d.dataset.craft_ammount=10,d.classList.add("craft_ammount_button"),o.append(d);let c=document.createElement("div");c.innerHTML="all",c.dataset.craft_ammount=1/0,c.classList.add("craft_ammount_button"),o.append(c),s.append(o),s.append(zs({category:e,subcategory:t,recipe_id:i}))}else if(t==="components"){a.classList.add("recipe_name"),s.children[0].innerHTML='<i class="material-icons icon crafting_dropdown_icon"> keyboard_double_arrow_down </i>'+s.children[0].innerHTML;let o=document.createElement("div");o.classList.add("folded_material_list"),s.addEventListener("click",r=>{(r.target.classList.contains("recipe_name")||r.target.classList.contains("crafting_dropdown_icon"))&&(window.updateDisplayedMaterialChoice({category:e,subcategory:t,recipe_id:i}),Na({element:s,class_name:"selected_recipe"}))}),s.append(o)}else if(n.recipe_type==="component"||n.recipe_type==="componentless"){a.classList.add("recipe_name"),n.item_type==="Armor"&&s.classList.add("clothing_recipe"),s.children[0].innerHTML='<i class="material-icons icon crafting_dropdown_icon"> keyboard_double_arrow_down </i>'+s.children[0].innerHTML;let o=document.createElement("div");o.classList.add("folded_material_list"),s.addEventListener("click",r=>{(r.target.classList.contains("recipe_name")||r.target.classList.contains("crafting_dropdown_icon"))&&(Oa("selected_component_list"),Oa("selected_component_category"),window.updateDisplayedMaterialChoice({category:e,subcategory:t,recipe_id:i}),Na({element:s,class_name:"selected_recipe"}))}),s.append(o)}else if(t==="equipment"){n.item_type==="Armor"?s.classList.add("armor_recipe"):n.item_type==="Weapon"?s.classList.add("weapon_recipe"):n.item_type==="Shield"?s.classList.add("shield_recipe"):console.warn(`Recipe "${e}" -> "${t}" -> "${i}" has wrong type of resulting item ("${n.item_type}")`),a.classList.add("recipe_name"),s.children[0].innerHTML='<i class="material-icons icon crafting_dropdown_icon"> keyboard_double_arrow_down </i>'+s.children[0].innerHTML;let o=document.createElement("div");o.innerHTML=`<span class="crafting_selection"><i class="material-icons icon subcrafting_dropdown_icon"> keyboard_double_arrow_down </i>Select a [${n.components[0]}]</span>`;let r=document.createElement("div");r.classList.add("folded_crafting_selection"),o.appendChild(r);let d=document.createElement("div");d.innerHTML=`<span class="crafting_selection"><i class="material-icons icon subcrafting_dropdown_icon"> keyboard_double_arrow_down </i>Select a [${n.components[1]}]</span>`;let c=document.createElement("div");c.classList.add("folded_crafting_selection"),d.appendChild(c);let _=document.createElement("div");_.append(o),_.append(d),s.addEventListener("click",k=>{(k.target.classList.contains("recipe_name")||k.target.classList.contains("crafting_dropdown_icon"))&&(Oa("selected_component_list"),Oa("selected_component_category"),Na({element:s,class_name:"selected_recipe"}),window.updateDisplayedComponentChoice({category:e,subcategory:t,recipe_id:i}),Yi({category:e,subcategory:t,recipe_id:i,components:[]}))}),o.parentNode.children[0].addEventListener("click",k=>{(k.target.classList.contains("crafting_selection")||k.target.classList.contains("subcrafting_dropdown_icon"))&&(o.children[1].classList.toggle("selected_component_list"),o.children[0].classList.toggle("selected_component_category"),s.querySelectorAll(".folded_crafting_selection").item(0).lastChild&&!Ys(s.querySelectorAll(".folded_crafting_selection").item(0).lastChild,document.getElementById("exit_crafting_button"))&&s.querySelectorAll(".folded_crafting_selection").item(0).lastChild.scrollIntoView({block:"end",inline:"nearest"}))}),d.parentNode.children[1].addEventListener("click",k=>{(k.target.classList.contains("crafting_selection")||k.target.classList.contains("subcrafting_dropdown_icon"))&&(d.children[1].classList.toggle("selected_component_list"),d.children[0].classList.toggle("selected_component_category"),Ys(s.querySelector(".recipe_creation_button"),document.getElementById("exit_crafting_button"))||s.querySelector(".recipe_creation_button").scrollIntoView({block:"end",inline:"nearest"}))});let h=document.createElement("div");h.innerHTML="<span class='recipe_creation_span'>Create</span>",h.classList.add("recipe_creation_button");let f=document.createElement("div");f.classList.add("craft_ammount_buttons");let y=document.createElement("div");y.innerHTML="5",y.dataset.craft_ammount=5,y.classList.add("craft_ammount_button"),f.append(y);let b=document.createElement("div");b.innerHTML="10",b.dataset.craft_ammount=10,b.classList.add("craft_ammount_button"),f.append(b);let w=document.createElement("div");w.innerHTML="all",w.dataset.craft_ammount=1/0,w.classList.add("craft_ammount_button"),f.append(w),h.append(f),h.addEventListener("click",k=>{k.target.classList.contains("recipe_creation_button")?window.useRecipe(k.target):k.target.classList.contains("craft_ammount_button")?window.useRecipe(k.target.parentNode.parentNode,Number(k.target.dataset.craft_ammount)):window.useRecipe(k.target.parentNode)}),s.append(_),s.append(h),h.append(zs({category:e,subcategory:t,recipe_id:i,components:[]}))}else throw new Error(`No such crafting subcategory as "${t}"`);Kl(e,t).appendChild(s)}function Zs(){Object.keys(G).forEach(e=>{Object.keys(G[e]).forEach(t=>{Object.keys(G[e][t]).forEach(i=>{G[e][t][i].is_unlocked&&(Xe[e][t].querySelector(`[data-recipe_id="${i}"]`)?Vc({category:e,subcategory:t,recipe_id:i}):Jl({category:e,subcategory:t,recipe_id:i}))})})})}function Vc({category:e,subcategory:t,recipe_id:i}){let n=Xe[e][t].querySelector(`[data-recipe_id="${i}"]`),s=G[e][t][i];t==="items"?(s.get_availability().available_ammount?n.classList.remove("recipe_unavailable"):n.classList.add("recipe_unavailable"),Yi({category:e,subcategory:t,recipe_id:i})):t==="components"||s.recipe_type==="component"?Yi({category:e,subcategory:t,recipe_id:i}):t==="equipment"||console.error(`No such crafting subcategory as "${t}"`)}function zs({category:e,subcategory:t,recipe_id:i,material:n,components:s}){let a=G[e][t][i],o=document.createElement("div");if(o.classList.add("recipe_tooltip"),t==="items")o.innerHTML=wn({category:e,subcategory:t,recipe_id:i}),o.classList.add("items_recipe_tooltip");else if(t==="components"||a.recipe_type==="component"){if(!n)throw new Error(`Component recipes require passing a material, but recipe "${e}" -> "${t}" -> "${i}" had none!`);o.innerHTML=wn({category:e,subcategory:t,recipe_id:i,material:n}),o.classList.add("component_recipe_tooltip")}else t==="equipment"?(o.innerHTML=wn({category:e,subcategory:t,recipe_id:i,material:n,components:s}),o.classList.add("equipment_recipe_tooltip")):console.error(`No such crafting subcategory as "${t}"`);return o}function Xl(){Object.keys(G).forEach(e=>{Object.keys(G[e]).forEach(t=>{t==="items"&&Object.keys(G[e][t]).forEach(i=>{G[e][t][i].is_unlocked&&Yi({category:e,subcategory:"items",recipe_id:i})})})})}function Yi({category:e,subcategory:t,recipe_id:i,components:n}){let s=Xe[e][t].querySelector(`[data-recipe_id="${i}"]`).querySelector(`.${t}_recipe_tooltip`),a=G[e][t][i];if(t==="items")s.innerHTML=wn({category:e,subcategory:t,recipe_id:i});else if(t==="components"||a.recipe_type==="component"||a.recipe_type==="componentless"){let o=Xe[e][t].querySelector(`[data-recipe_id='${i}']`).children[1];for(let r=0;r<o.children.length;r++){let d=o.children[r].dataset.item_key,{id:c}=JSON.parse(d),_=a.materials.filter(h=>h.material_id===c);o.children[r].children[1].innerHTML=wn({category:e,subcategory:t,recipe_id:i,material:_[0]})}}else t==="equipment"?s.innerHTML=wn({category:e,subcategory:t,recipe_id:i,components:n}):console.error(`No such crafting subcategory as "${t}"`)}function wn({category:e,subcategory:t,recipe_id:i,material:n,components:s}){let a=G[e][t][i],o=v?.crafting?.tiers[e]||1,r="";if(t==="items"){let d=Math.round(100*a.get_success_chance(o));r+=`Success chance: <b><span style="color:${d>74?"lime":d>49?"yellow":d>24?"orange":"red"}">${d}%</span></b><br><br>Materials required:<br>`;for(let _=0;_<a.materials.length;_++)if(a.materials[_].material_id){let h=u[a.materials[_].material_id].getInventoryKey();l.inventory[h]?.count>=a.materials[_].count?r+=`<span style="color:lime"><b>${u[a.materials[_].material_id].getName()} x${l.inventory[h]?.count||0}/${a.materials[_].count}</b></span><br>`:r+=`<span style="color:red"><b>${u[a.materials[_].material_id].getName()} x${l.inventory[h]?.count||0}/${a.materials[_].count}</b></span><br>`}else if(a.materials[_].material_type){let h=[];Object.keys(l.inventory).forEach(b=>{l.inventory[b].item.material_type===a.materials[_].material_type&&h.push(l.inventory[b])}),h=h.sort((b,w)=>b.item.getBaseValue()-w.item.getBaseValue());let f=!1,y="";for(let b=0;b<h.length;b++)h[b].count>=a.materials[_].count?(f=!0,y+=`<span style="color:lime"><b>${h[b].item.getName()} x${h[b].count||0}/${a.materials[_].count}</b></span><br>`):y+=`<span style="color:red"><b>${h[b].item.getName()} x${h[b].count||0}/${a.materials[_].count}</b></span><br>`;h.length>0?(f?r+=`<span style="color:lime"><b>Any ${a.materials[_].material_type} x${a.materials[_].count}:</b></span><br>`:r+=`<span style="color:red"><b>Any ${a.materials[_].material_type} x${a.materials[_].count}:</b></span><br>`,r+=`<div class="crafting_tooltip_mat_list">${y}</div>`):r+=`<span style="color:red"><b>Any ${a.materials[_].material_type} x${a.materials[_].count}:</b></span><br>`}let c=wt({category:e,subcategory:t,recipe_id:i});r+=`<br>XP value: ${c}`,r+=`<br>Result:<br><div class="recipe_result">${yn({item:u[a.getResult().result_id],options:{skip_quality:!0,anchor_tooltip:!0}})}</div>`}else if(t==="components"||a.recipe_type==="component"){r+="Material required:<br>",l.inventory[u[n.material_id].getInventoryKey()]?.count>=n.count?r+=`<span style="color:lime"><b>${u[n.material_id].getName()} x${l.inventory[u[n.material_id].getInventoryKey()]?.count||0}/${n.count}</b></span><br>`:r+=`<span style="color:red"><b>${u[n.material_id].getName()} x${l.inventory[u[n.material_id].getInventoryKey()]?.count||0}/${n.count}</b></span><br>`;let d=a.get_quality_range(o-u[n.result_id].component_tier),c=wt({category:e,subcategory:t,recipe_id:i,material_count:n.count,result_tier:u[n.result_id].component_tier,rarity_multiplier:ke[Ve(d[0])]}),_=wt({category:e,subcategory:t,recipe_id:i,material_count:n.count,result_tier:u[n.result_id].component_tier,rarity_multiplier:ke[Ve(d[1])]});r+=`<br>XP value: ${c} - ${_}<br>`,r+=`<br>Result:<br><div class="recipe_result">${yn({item:u[n.result_id],options:{quality:d}})}</div>`}else if(t==="equipment")if(s)if(s.length<2)r+='Result:<br><div class="recipe_result">Select one component from each category</div>';else if(s.length==2){let d="";if(a.item_type==="Weapon")d=new pe({components:{head:s[0].item.id,handle:s[1].item.id}});else if(a.item_type==="Armor")d=new Q({components:{internal:s[0].item.id,external:s[1].item.id}});else if(a.item_type==="Shield")d=new nt({components:{shield_base:s[0].item.id,handle:s[1].item.id}});else throw new Error(`Recipe "${e}" -> "${t}" -> "${i}" has an incorrect item type "${a.item_type}"`);let c=a.get_quality_range(a.get_component_quality_weighted(s[0].item,s[1].item),o-Math.max(s[0].item.component_tier,s[1].item.component_tier)||0),_=wt({category:e,subcategory:t,recipe_id:i,selected_components:[u[s[0].item.id],u[s[1].item.id]],rarity_multiplier:ke[Ve(c[0])]}),h=wt({category:e,subcategory:t,recipe_id:i,selected_components:[u[s[0].item.id],u[s[1].item.id]],rarity_multiplier:ke[Ve(c[1])]});r+=`<br>XP value: ${_} - ${h}<br>`,r+=`Result:<br><div class="recipe_result">${yn({item:d,options:{quality:c}})}</div>`}else throw new Error(`Somehow recipe "${e}" -> "${t}" -> "${i}" received more components than there should be (${s.length} instead of 2)`);else{r+="Material required:<br>",l.inventory[u[n.material_id].getInventoryKey()]?.count>=n.count?r+=`<span style="color:lime"><b>${u[n.material_id].getName()} x${l.inventory[u[n.material_id].getInventoryKey()]?.count||0}/${n.count}</b></span><br>`:r+=`<span style="color:red"><b>${u[n.material_id].getName()} x${l.inventory[u[n.material_id].getInventoryKey()]?.count||0}/${n.count}</b></span><br>`;let d=a.get_quality_range(o-u[n.result_id].item_tier),c=wt({category:e,subcategory:t,recipe_id:i,material_count:n.count,result_tier:u[n.result_id].item_tier,rarity_multiplier:ke[Ve(d[0])]}),_=wt({category:e,subcategory:t,recipe_id:i,material_count:n.count,result_tier:u[n.result_id].item_tier,rarity_multiplier:ke[Ve(d[1])]});r+=`<br>XP value: ${c} - ${_}<br>`,r+=`<br>Result:<br><div class="recipe_result">${yn({item:u[n.result_id],options:{quality:d}})}</div>`}else console.error(`No such crafting subcategory as "${t}"`);return r}function eo({category:e,recipe_id:t,component_keys:i={}}){let n=Xe[e].equipment.querySelector(`[data-recipe_id="${t}"]`),s=G[e].equipment[t],a=Xe[e].equipment.querySelector(`[data-recipe_id='${t}']`).children[1].children;a[0].children[1].innerHTML="",a[1].children[1].innerHTML="";let o=[];o.push(Object.values(l.inventory).filter(r=>s.components[0]===r.item.component_type)),o.push(Object.values(l.inventory).filter(r=>s.components[1]===r.item.component_type));for(let r=0;r<2;r++)for(let d=0;d<o[r].length;d++){let c=document.createElement("div");c.innerHTML=`<i class="material-icons icon selected_component_icon"> check </i>${o[r][d].item.name}, ${o[r][d].item.quality}%, x${o[r][d].count}`,c.classList.add("selectable_component"),c.dataset.item_key=o[r][d].item.getInventoryKey(),c.dataset.item_quality=o[r][d].item.quality,c.dataset.item_name=o[r][d].item.getName(),c.dataset.component_tier=o[r][d].item.component_tier,c.appendChild(Qi(o[r][d].item,{class_name:"recipe_tooltip"})),c.addEventListener("click",()=>{Na({element:c,siblings_only:!0,class_name:"selected_component"});let _=[],h=n.children[1].children[0].children[1].querySelector(".selected_component")?.dataset.item_key;h&&_.push(l.inventory[h]);let f=n.children[1].children[1].children[1].querySelector(".selected_component")?.dataset.item_key;f&&_.push(l.inventory[f]),Yi({category:e,subcategory:"equipment",recipe_id:t,components:_})}),a[r].children[1].appendChild(c),i[c.dataset.item_key]&&c.click()}Ys(n.querySelector(".recipe_creation_button"),document.getElementById("exit_crafting_button"))||n.querySelector(".recipe_creation_button").scrollIntoView({block:"end",inline:"nearest"});for(let r=0;r<2;r++)[...a[r].children[1].children].sort((d,c)=>Number.parseInt(d.dataset.component_tier)>Number.parseInt(c.dataset.component_tier)?-1:Number.parseInt(d.dataset.component_tier)<Number.parseInt(c.dataset.component_tier)||d.dataset.item_name>c.dataset.item_name?1:d.dataset.item_name<c.dataset.item_name||Number.parseInt(d.dataset.item_quality)>Number.parseInt(c.dataset.item_quality)?-1:1).forEach(d=>a[r].children[1].appendChild(d))}function to({category:e,subcategory:t,recipe_id:i,refreshing:n}){let s=G[e][t][i],a=Xe[e][t].querySelector(`[data-recipe_id='${i}']`).children[1];a.innerHTML="";let o=Object.values(l.inventory).filter(r=>s.materials.filter(d=>d.material_id===r.item?.id).length>0);for(let r=0;r<o.length;r++){let d=s.materials.filter(w=>w.material_id===o[r].item.id)[0],c=document.createElement("div"),_=document.createElement("span");_.innerHTML=`<i class="material-icons icon selected_material_icon"> check </i>${u[d.result_id].getName()}`,_.classList.add("recipe_comp_name"),c.append(_),c.classList.add("selectable_material"),c.dataset.item_key=o[r].item.getInventoryKey(),d.count<=o[r].count?c.addEventListener("click",w=>{c.classList.add("selected_material"),w.target.classList.contains("selectable_material")?window.useRecipe(w.target.parentNode):w.target.classList.contains("craft_ammount_button")?window.useRecipe(w.target.parentNode.parentNode.parentNode,Number(w.target.dataset.craft_ammount)):window.useRecipe(w.target.parentNode.parentNode),c.classList.remove("selected_material")}):c.classList.add("recipe_unavailable");let h=document.createElement("div");h.classList.add("craft_ammount_buttons");let f=document.createElement("div");f.innerHTML="5",f.dataset.craft_ammount=5,f.classList.add("craft_ammount_button"),h.append(f);let y=document.createElement("div");y.innerHTML="10",y.dataset.craft_ammount=10,y.classList.add("craft_ammount_button"),h.append(y);let b=document.createElement("div");b.innerHTML="all",b.dataset.craft_ammount=1/0,b.classList.add("craft_ammount_button"),h.append(b),c.append(h),c.append(zs({category:e,subcategory:t,recipe_id:i,material:d})),a.appendChild(c)}n||a.lastChild?.scrollIntoView()}function io(){Object.keys(G).forEach(e=>{Object.keys(G[e]).forEach(t=>{t==="items"&&Object.keys(G[e][t]).forEach(i=>{if(!G[e][t][i].is_unlocked)return;let n=Xe[e][t].querySelector(`[data-recipe_id="${i}"`);G[e][t][i].get_availability().available_ammount?n.classList.remove("recipe_unavailable"):n.classList.add("recipe_unavailable")})})})}function Qc(e){let t=document.createElement("div");return t.id="location_action_tooltip",t.classList.add("job_tooltip"),t.innerHTML=e.description,t}function Zl(e){let t=document.createElement("div");t.classList.add("job_tooltip"),t.dataset.job_tooltip=e.activity_id;let{gathering_time_needed:i,gained_resources:n}=e.getActivityEfficiency(),s="";for(let a=0;a<x[e.activity_name].base_skills_names.length;a++)s+=p[x[e.activity_name].base_skills_names[a]].name();e.gained_resources.scales_with_skill&&(t.innerHTML=`<span class="activity_efficiency_info">Efficiency scaling:<br>"${s}" skill lvl ${e.gained_resources.skill_required[0]} to ${e.gained_resources.skill_required[1]}</span><br><br>`),t.innerHTML+=`Every ${yt({time:{minutes:i},round:!1})}, chance to find:`;for(let a=0;a<n.length;a++){let o=u[n[a].name].getName();t.innerHTML+=`<br>x${n[a].count[0]===n[a].count[1]?n[a].count[0]:`${n[a].count[0]}-${n[a].count[1]}`} "${o}" at ${Math.round(100*n[a].chance)}%`}return t}function Ya(e){let t=document.querySelector(`[data-activity="${e.activity_id}"]`),i;if(t?i=t.getElementsByClassName("job_tooltip")[0]:i=document.getElementById("gathering_progress_bar_max")?.querySelector(`[data-job_tooltip="${e.activity_id}"]`),!i)return;let{gathering_time_needed:n,gained_resources:s}=e.getActivityEfficiency(),a="";for(let o=0;o<x[e.activity_name].base_skills_names.length;o++)a+=p[x[e.activity_name].base_skills_names[o]].name();e.gained_resources.scales_with_skill&&(i.innerHTML=`<span class="activity_efficiency_info">Efficiency scaling:<br>"${a}" skill lvl ${e.gained_resources.skill_required[0]} to ${e.gained_resources.skill_required[1]}</span><br><br>`),i.innerHTML+=`Every ${Pn(n)}, chance to find:`;for(let o=0;o<s.length;o++)i.innerHTML+=`<br>x${s[o].count[0]===s[o].count[1]?s[o].count[0]:`${s[o].count[0]}-${s[o].count[1]}`} "${s[o].name}" at ${Math.round(100*s[o].chance)}%`}function si(){Bc.innerText=Math.ceil(l.stats.full.health)+"/"+Math.ceil(l.stats.full.max_health)+" hp",Hc.style.width=(l.stats.full.health*100/l.stats.full.max_health).toString()+"%"}function Ki(){Oc.innerText=Math.round(l.stats.full.stamina)+"/"+Math.round(l.stats.full.max_stamina)+" stamina",Nc.style.width=(l.stats.full.stamina*100/l.stats.full.max_stamina).toString()+"%"}function Va(){Object.keys(Fi).forEach(function(n){n==="crit_rate"||n==="crit_multiplier"?Fi[n].innerHTML=`${(l.stats.full[n]*100).toFixed(1)}%`:n==="attack_speed"?Fi[n].innerHTML=`${l.get_attack_speed().toFixed(1)}`:n==="attack_power"?Fi[n].innerHTML=`${l.get_attack_power().toFixed(1)}`:Fi[n].innerHTML=`${l.stats.full[n].toFixed(1)}`,Bs(n)});let e=document.getElementById("attack_stats"),t=Math.round(l.stats.full.attack_points);if(ii.attack_points.innerHTML=`${t}`,l.equipment["off-hand"]!=null&&l.equipment["off-hand"].offhand_type==="shield"){let n=(l.stats.full.block_chance*100).toFixed(1);ii.defensive_action.innerHTML="Block :",ii.defensive_points.innerHTML=`${n}%`,ii.defensive_points.parentNode.children[2].children[0].innerHTML="Chance to block an attack",e.children[3].innerHTML=`Block : ${Math.round(n)}%`}else{let n=Math.round(l.stats.full.evasion_points);ii.defensive_action.innerHTML="EP : ",ii.defensive_points.innerHTML=`${n}`,ii.defensive_points.parentNode.children[2].children[0].innerHTML="Evasion points, a total value of everything that contributes to the evasion chance, except for some situational skills and modifiers",e.children[3].innerHTML=`EP: ${Math.round(n)} `}Bs("defensive_points"),Bs("attack_points"),Uc();let i=l.get_attack_power();i>100?i=Math.round(i):i=Math.round(10*i)/10,e.children[0].innerHTML=`Atk: ${i}`,e.children[1].innerHTML=`Atk spd: ${Math.round(l.get_attack_speed()*100)/100}`,e.children[2].innerHTML=`AP:  ${Math.round(t)}`,e.children[4].innerHTML=`Def: ${Math.round(l.stats.full.defense)} `}function Bs(e){let t;if(Fi[e])t=Fi[e].parentNode.children[2].children[1];else if(ii[e]&&e!=="defensive_action")t=ii[e].parentNode.children[2].children[1];else return;t.innerHTML=bn(e)}function Uc(){Kc(),er(),tr()}function Kc(){xl.innerHTML="Max health: "+Math.round(l.stats.full.max_health)+"<br>",xl.innerHTML+=bn("max_health")}function er(){Ha.innerHTML="Max stamina: "+Math.round(l.stats.full.max_stamina)+"<br>",Ha.innerHTML+=bn("max_stamina"),Ha.innerHTML+="<br>------------------------<br>Stamina efficiency: "+Math.round(100*l.stats.full.stamina_efficiency)/100+"<br>",Ha.innerHTML+=bn("stamina_efficiency")}function tr(){pn.innerHTML="Global xp multiplier: "+Math.round(100*l.xp_bonuses.total_multiplier.all)/100+"<br>",pn.innerHTML+=Hs("all",!1),pn.innerHTML+="<br>------------------------<br>Hero xp multiplier: "+Math.round(100*l.xp_bonuses.total_multiplier.hero)/100+" (with global: "+Math.round(xr()*100)/100+")<br>",pn.innerHTML+=Hs("hero",!1),pn.innerHTML+="<br>------------------------<br>Skill xp multiplier: "+Math.round(100*l.xp_bonuses.total_multiplier.all_skill)/100+" (with global: "+Math.round(kr()*100)/100+")<br>",pn.innerHTML+=Hs("all_skill",!1)}function bn(e){let t="";return e==="attack_power"?t+=`<br>Breakdown:
        <br>Base value (weapon * str/10): ${Math.round(100*l.stats.total_flat.attack_power)/100}`:e==="attack_points"?t+=`<br>Breakdown:
        <br>Base value: ${Math.round(100*l.stats.total_flat.attack_points)/100}`:e==="defensive_points"?(l.equipment["off-hand"]!=null&&l.equipment["off-hand"].offhand_type==="shield"?e="block_chance":e="evasion_points",t+=`<br>Breakdown:
            <br>Base value: ${Math.round(100*l.stats.total_flat[e])/100}`):t+=`<br>Breakdown:
        <br>Base value: ${Math.round(100*l.base_stats[e])/100}`,Object.keys(l.stats.flat).forEach(i=>{if(l.stats.flat[i][e]&&l.stats.flat[i][e]!==0){let n=l.stats.flat[i][e]>=0?"+":"";t+=`<br>${dt(i.replace("_"," "))}: ${n}${Math.round(100*l.stats.flat[i][e])/100}`}}),Object.keys(l.stats.multiplier).forEach(i=>{l.stats.multiplier[i][e]&&l.stats.multiplier[i][e]!==1&&(t+=`<br>${dt(i.replace("_"," "))}: x${Math.round(100*l.stats.multiplier[i][e])/100}`)}),t}function Hs(e,t){let i="",n=1;return t&&e!=="all"&&(e!=="all_skill"&&e!=="hero"?n=wo(e):n*=l.xp_bonuses.total_multiplier.all||1),i+=`<br>Breakdown:
        <br>Base value: ${Math.round(100*n)/100}`,Object.keys(l.xp_bonuses.multiplier).forEach(s=>{l.xp_bonuses.multiplier[s]?.[e]&&l.xp_bonuses.multiplier[s]?.[e]!==1&&(i+=`<br>${dt(s.replace("_"," "))}: x${Math.round(100*l.xp_bonuses.multiplier[s][e])/100}`)}),i}function kn(){let e=Object.keys(he).length;jc.innerText=e,e>0?(Is.innerHTML="",Object.values(zi).forEach(t=>{t.remove()}),zi={},Object.values(he).forEach(t=>{zi[t.name]=Rl({effect_name:t.name,duration:t.duration,add_bonus:!0}),Is.appendChild(zi[t.name])})):Is.innerHTML="No active effects",no()}function no(){Object.keys(zi).forEach(e=>{he[e]?.duration?zi[e].querySelector(".active_effect_duration").innerHTML=yt({time:{minutes:he[e].duration},round:!1}):zi[e].remove()})}function ao(){let e=M.getTimeOfDaySimple();Wc.innerHTML=M.toString()+", <b>"+e+"</b>"}function Qa(){let e=Ta(),t=I.use_uncivilised_temperature_scale?Wn(e):e,i=I.use_uncivilised_temperature_scale?"\xB0F":"\xB0C",n=e<Mn[0]-bi(),s="normal_temperature";n&&(s="cold_temperature"),t=t.toString(),t.includes(".")||(t+=".0"),v.is_under_roof?Kn.innerHTML=e+i:Yn()?e>0?Kn.innerHTML=`<span class="material-icons icon">cloud</span><span class="${s}">`+t+i+"</span>":Kn.innerHTML=`<span class="material-icons icon">ac_unit</span><span class="${s}">`+t+i+"</span>":Kn.innerHTML=`<span class="${s}">`+t+i+"</span>",Kn.appendChild(Jc())}function Jc(){let e=document.createElement("div");return e.id="temperature_tooltip",I.use_uncivilised_temperature_scale?(e.innerHTML=`Lowest tolerable temperature: <strong>${Math.round(10*Wn(Zn-bi()))/10}</strong>`,e.innerHTML+=`<br>(<strong>${Math.round(10*Wn(Zn))/10}</strong> base minus <strong>${Math.round(10*Wn(bi())-320)/10}</strong> cold protection)<br>`,e.innerHTML+=bn("cold_tolerance"),e.innerHTML+="<br>Scale conversion: x1.8"):(e.innerHTML=`Lowest tolerable temperature: <strong>${Math.round(10*(Zn-bi()))/10}</strong>`,e.innerHTML+=`<br>(<strong>${Zn}</strong> base minus <strong>${Math.round(10*bi())/10}</strong> cold protection)<br>`,e.innerHTML+=bn("cold_tolerance")),e}function je(e){let t,i=e>=0?"":"-";return e=Math.abs(e),e>0?(t=e%10!=0?`${e%10}<span class="coin coin_wood">W</span>`:"",e>9&&(t=(Math.floor(e/10)%100!=0?`${Math.floor(e/10)%100}<span class="coin coin_copper">C</span>${t?" ":""}`:"")+t,e>999&&(t=(Math.floor(e/1e3)%100!=0?`${Math.floor(e/1e3)%100}<span class="coin coin_silver">S</span>${t?" ":""}`:"")+t,e>99999&&(t=`${Math.floor(e/1e5)}<span class="coin coin_gold">G</span>${t?" ":""}`+t))),i+t):"nothing"}function ir(e=!1){ql.children[0].children[0].style.width=`${100*l.xp.current_xp/l.xp.xp_to_next_lvl}%`,ql.children[1].innerText=`${Qt(l.xp.current_xp)} / ${Qt(l.xp.xp_to_next_lvl)} xp`,e&&(Pc.innerText=`Level: ${l.xp.current_level}`,si())}function Ua(){tr()}function Ka(){er()}function so(){Ml.reputation.innerHTML="",Object.keys(l.reputation).forEach(e=>{if(l.reputation[e]>0){let t=document.createElement("div"),i=document.createElement("span"),n=document.createElement("span");t.classList.add("data_entry"),i.classList.add("data_entry_name"),n.classList.add("data_entry_value"),i.innerHTML=dt(e)+" reputation",n.innerHTML=l.reputation[e],t.appendChild(i),t.appendChild(n),Ml.reputation.appendChild(t)}})}function Os({dialogue_key:e,textlines:t,origin:i}){let n=$[e];Vi();let s=document.createElement("div");s.innerHTML=dt($[e].name),s.id="dialogue_name_div",U.appendChild(s);let a=document.createElement("div");if(a.id="dialogue_answer_div",U.appendChild(a),t){for(let r=0;r<t.length;r++){let d=t[r];if(n.textlines[d].is_unlocked&&!n.textlines[d].is_finished&&Ai(n.textlines[d].display_conditions,l)){if(n.textlines[d].required_flags){if((n.textlines[d].required_flags.yes&&!Array.isArray(n.textlines[d].required_flags.yes)||n.textlines[d].required_flags.no&&!Array.isArray(n.textlines[d].required_flags.no))&&console.error(`Textline "${d}" in dialogue "${e}" has required flag passed as a single value but it should be an array!`),n.textlines[d].required_flags.yes){for(let _=0;_<n.textlines[d].required_flags.yes.length;_++)if(!Ne[n.textlines[d].required_flags.yes[_]])return}if(n.textlines[d].required_flags.no){for(let _=0;_<n.textlines[d].required_flags.no.length;_++)if(Ne[n.textlines[d].required_flags.no[_]])return}}let c=document.createElement("div");c.innerHTML=`"${Qn.getText(St,n.textlines[d].name)}"`,c.classList.add("dialogue_textline"),c.setAttribute("data-textline",d),c.setAttribute("onclick",`start_textline(this.getAttribute('data-textline'), ${i})`),U.appendChild(c)}}let o=document.createElement("div");o.innerHTML="<i class='material-icons'>arrow_back</i> "+Fc,o.classList.add("backstep_dialogue_button"),o.setAttribute("onclick",`start_dialogue("${e}")`),U.appendChild(o)}else{if(Object.keys(n.textlines).forEach(r=>{if(n.textlines[r].is_unlocked&&!n.textlines[r].is_finished&&!n.textlines[r].is_branch_only&&Ai(n.textlines[r].display_conditions,l)){if(n.textlines[r].required_flags){if((n.textlines[r].required_flags.yes&&!Array.isArray(n.textlines[r].required_flags.yes)||n.textlines[r].required_flags.no&&!Array.isArray(n.textlines[r].required_flags.no))&&console.error(`Textline "${r}" in dialogue "${e}" has required flag passed as a single value but it should be an array!`),n.textlines[r].required_flags.yes){for(let c=0;c<n.textlines[r].required_flags.yes.length;c++)if(!Ne[n.textlines[r].required_flags.yes[c]])return}if(n.textlines[r].required_flags.no){for(let c=0;c<n.textlines[r].required_flags.no.length;c++)if(Ne[n.textlines[r].required_flags.no[c]])return}}let d=document.createElement("div");d.innerHTML=`"${Qn.getText(St,n.textlines[r].name)}"`,d.classList.add("dialogue_textline"),d.setAttribute("data-textline",r),d.setAttribute("onclick","start_textline(this.getAttribute('data-textline'))"),U.appendChild(d)}}),Object.keys(n.actions).forEach(r=>{if(n.actions[r].is_unlocked&&!n.actions[r].is_finished&&n.actions[r].can_be_displayed(l)){let d=document.createElement("div");d.innerHTML=`${Qn.getText(St,n.actions[r].starting_text)}`,d.classList.add("dialogue_textline"),d.setAttribute("data-location_action",r),d.setAttribute("onclick","start_game_action(this.getAttribute('data-location_action'), event)"),U.appendChild(d)}}),n.trader){let r=document.createElement("div");r.innerHTML='<i class="material-icons">storefront</i>  '+j[n.trader].trade_text,r.classList.add("dialogue_trade"),r.setAttribute("data-trader",n.trader),r.setAttribute("onclick","startTrade(this.getAttribute('data-trader'))"),U.appendChild(r)}let o=document.createElement("div");o.innerHTML="<i class='material-icons'>arrow_back</i> "+n.ending_text,o.classList.add("end_dialogue_button"),o.setAttribute("onclick","end_dialogue()"),U.appendChild(o)}}function Ns({text:e,is_description:t}){e=Qn.getText(St,e),t?document.getElementById("dialogue_answer_div").innerHTML="*"+e+"*":document.getElementById("dialogue_answer_div").innerHTML='<i>"'+e+'"</i>'}function ml(){U.style.display="",Al.style.display="none"}function Xc(e){Vi();let t=document.createElement("div");t.innerText=x[e.activity_name].action_text,t.id="action_status_div";let i=document.createElement("div");if(x[e.activity_name].base_skills_names){let a=R(x[e.activity_name].base_skills_names)==p[x[e.activity_name].base_skills_names].max_level?"Max":`${Math.round(1e4*p[x[e.activity_name].base_skills_names].current_xp/p[x[e.activity_name].base_skills_names].xp_to_next_lvl)/100}%`,o=R(x[e.activity_name].base_skills_names)==p[x[e.activity_name].base_skills_names].max_level?"Max":`${Math.floor(p[x[e.activity_name].base_skills_names].current_xp)}`,r=R(x[e.activity_name].base_skills_names)==p[x[e.activity_name].base_skills_names].max_level?"Max":`${Math.ceil(p[x[e.activity_name].base_skills_names].xp_to_next_lvl)}`;if(x[e.activity_name].type!=="GATHERING"?i.innerText=`Getting ${e.skill_xp_per_tick} base xp per in-game minute to `:i.innerText=`Getting ${e.skill_xp_per_tick} base xp per gathering cycle to `,o!=="Max"?i.innerText+=` ${p[x[e.activity_name].base_skills_names].name()} (${a}  [${Qt(o)} / ${Qt(r)}])`:i.innerText+=` ${p[x[e.activity_name].base_skills_names].name()} (Maxxed out!)`,x[e.activity_name].type!=="GATHERING"){let d=Math.ceil((r-o)/(e.skill_xp_per_tick*Lt(p[x[e.activity_name].base_skills_names].skill_id)));isNaN(d)||(i.innerHTML+=`<br>Next level in ${Ti(d)} (${yt({time:{minutes:d/60},long_names:!0})}realtime)`)}else{let d=Math.ceil(e.gathering_time_needed*(r-o)/(e.skill_xp_per_tick*Lt(p[x[e.activity_name].base_skills_names].skill_id)));isNaN(d)||(i.innerHTML+=`<br>Next level in ${Ti(d)} (${yt({time:{minutes:d/60},long_names:!0})}realtime)`)}}else console.warn(`Activity "${e.activity_name}" has no skills assigned!`);i.id="action_xp_div";let n=document.createElement("div");n.setAttribute("onclick","end_activity()"),n.id="action_end_div";let s=document.createElement("div");if(s.innerText=`Finish ${e.activity_name}`,s.id="action_end_text",n.appendChild(s),x[e.activity_name].type==="JOB"){let a=document.createElement("div");a.innerHTML=`(earnings: ${je(0)})`,a.id="action_end_earnings",n.appendChild(a)}if(U.appendChild(t),U.appendChild(i),e.gained_resources){let a=document.createElement("div"),o=document.createElement("div");a.appendChild(o),o.id="gathering_progress_bar",o.style.width=385*e.gathering_time/e.gathering_time_needed+"px",a.id="gathering_progress_bar_max",U.appendChild(a),a.appendChild(Zl(e))}if(U.appendChild(n),x[e.activity_name].type==="JOB"){let a=document.createElement("div");a.id="time_for_earnings_div",ko(e)?a.innerHTML=`Next earnings in: ${Pn(e.working_period-e.working_time)}`:a.innerHTML=`There's not enough time left to earn more, but ${l.name} might still learn something...`,U.insertBefore(a,U.children[2])}Ga()}function oo(e,t){if(t){document.getElementById("action_end_earnings").innerHTML=`(earnings: ${je(e.earnings)})`;let o=document.getElementById("time_for_earnings_div");ko(e)?o.innerHTML=`Next earnings in: ${Pn(e.working_period-e.working_time%e.working_period)}`:o.innerHTML=`There's not enough time left to earn more, but ${l.name} might still learn something...`}let i=document.getElementById("action_xp_div");if(!i){console.warn(`Failed to find htmlElement with id "action_xp_div" for activity "${e.activity_id}"`);return}let n=R(x[e.activity_name].base_skills_names)==p[x[e.activity_name].base_skills_names].max_level?"Max":`${Math.round(1e4*p[x[e.activity_name].base_skills_names].current_xp/p[x[e.activity_name].base_skills_names].xp_to_next_lvl)/100}%`,s=R(x[e.activity_name].base_skills_names)==p[x[e.activity_name].base_skills_names].max_level?"Max":`${Math.floor(p[x[e.activity_name].base_skills_names].current_xp)}`,a=R(x[e.activity_name].base_skills_names)==p[x[e.activity_name].base_skills_names].max_level?"Max":`${Math.ceil(p[x[e.activity_name].base_skills_names].xp_to_next_lvl)}`;if(x[e.activity_name].type!=="GATHERING"?i.innerText=`Getting ${e.skill_xp_per_tick} base xp per in-game minute to `:i.innerText=`Getting ${e.skill_xp_per_tick} base xp per gathering cycle to `,s!=="Max"?i.innerText+=` ${p[x[e.activity_name].base_skills_names].name()} (${n}  [${Qt(s)} / ${Qt(a)}])`:i.innerText+=` ${p[x[e.activity_name].base_skills_names].name()} (Maxxed out!)`,x[e.activity_name].type!=="GATHERING"){let o=Math.ceil((a-s)/(e.skill_xp_per_tick*Lt(p[x[e.activity_name].base_skills_names].skill_id)));isNaN(o)||(i.innerHTML+=`<br>Next level in ${Ti(o)} (${yt({time:{minutes:o/60},long_names:!0})}realtime)`)}else{let o=Math.ceil(e.gathering_time_needed*(a-s)/(e.skill_xp_per_tick*Lt(p[x[e.activity_name].base_skills_names].skill_id)));isNaN(o)||(i.innerHTML+=`<br>Next level in ${Ti(o)} (${yt({time:{minutes:o/60},long_names:!0})}realtime)`)}e.gained_resources&&(document.getElementById("gathering_progress_bar").style.width=385*e.gathering_time/e.gathering_time_needed+"px")}function Zc(e,t){Vi();let i;e?i=$[e].actions[t]:i=v.actions[t];let n=document.createElement("div");n.innerText=i.action_text,n.id="action_status_div",U.appendChild(n);let s=document.createElement("div"),a=document.createElement("div");s.appendChild(a),a.id="action_progress_bar",a.style.width="0px",s.id="action_progress_bar_max",U.appendChild(s);let o=document.createElement("div");o.setAttribute("onclick","end_game_action()"),o.id="action_end_div";let r=document.createElement("div");r.innerText="Give up for now",r.id="action_end_text",o.appendChild(r),U.appendChild(o),Ga()}function lo(e){document.getElementById("action_progress_bar").style.width=385*e+"px"}function nr(e){document.getElementById("action_status_div").innerHTML=e}function ar(){document.getElementById("action_end_div").innerHTML="Finish"}function Ja({content_type:e,data:t}){let i="";if(t.special?.upstack_result_message&&(i=t.special.upstack_result_message),e==="dialogue")Os({dialogue_key:t.dialogue_key}),i||(i=$[t.dialogue_key].getDescription()),Ns({text:i,is_description:!0});else if(e==="dialogue_answer")Os({dialogue_key:t.dialogue_key}),i||(i=t.text),Ns({text:i});else if(e==="dialogue_branch")Os({dialogue_key:t.dialogue_key,textlines:t.textlines}),i||(i=t.text),Ns({text:i});else if(e==="action")Zc(t.dialogue_key,t.action_key);else if(e==="activity")Xc(t.activity);else throw new Error(`Error on filling action box content: no such content type as "${e}"`)}function sr(){Vi();let e=document.createElement("div");e.innerText="Sleeping...",e.id="action_status_div";let t=document.createElement("div");t.setAttribute("onclick","end_sleeping()"),t.id="action_end_div";let i=document.createElement("div");i.innerText="Wake up",i.id="action_end_text",t.appendChild(i),U.appendChild(e),U.appendChild(t),Ga()}function or(e){Vi();let t=document.createElement("div");t.innerText=`Reading the book, ${Ti(u[e].getRemainingTime())} left`,t.id="action_status_div";let i=document.createElement("div");i.setAttribute("onclick","end_reading()"),i.id="action_end_div";let n=document.createElement("div");n.innerText="Stop reading for now",n.id="action_end_text",i.appendChild(n),U.appendChild(t),U.appendChild(i),Ga({book_title:e})}function ro(e){if(!ne[e.category]){ne[e.category]={};let y=document.createElement("div");y.innerHTML=`<i class="material-icons icon skill_dropdown_icon"> keyboard_double_arrow_down </i>${e.category} skills`,y.dataset.skill_category=e.category,y.classList.add("skill_category_div");let b=document.createElement("a");b.className="material-icons icon",b.style.float="right",b.innerHTML="keyboard_arrow_up",b.addEventListener("click",H=>{let W=Se.indexOf(e.category);W>0&&([Se[W],Se[W-1]]=[Se[W-1],Se[W]],Ps(),Tl())});let w=document.createElement("a");w.className="material-icons icon",w.style.float="right",w.innerHTML="keyboard_arrow_down",w.addEventListener("click",H=>{let W=Se.indexOf(e.category);W<Se.length-1&&([Se[W],Se[W+1]]=[Se[W+1],Se[W]],Ps(),Tl())}),y.appendChild(b),y.appendChild(w);let k=document.createElement("div");k.dataset.skill_category_skills=!0,y.appendChild(k),_t.appendChild(y),y.addEventListener("click",H=>{H.target.classList.contains("skill_category_div")?H.target.classList.toggle("skill_category_expanded"):H.target.classList.contains("skill_dropdown_icon")&&H.target.parentNode.classList.toggle("skill_category_expanded")}),Se.indexOf(e.category)==-1&&Se.push(e.category)}if(ne[e.category][e.skill_id]){console.trace(`Tried to create a skillbar for skill "${e.skill_id}", but it already has one!`);return}ne[e.category][e.skill_id]=document.createElement("div");let t=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div"),r=document.createElement("div"),d=document.createElement("div"),c=document.createElement("div"),_=document.createElement("div"),h=document.createElement("div"),f=document.createElement("div");t.classList.add("skill_bar_max"),i.classList.add("skill_bar_current"),n.classList.add("skill_bar_text"),s.classList.add("skill_bar_name"),a.classList.add("skill_bar_xp"),o.classList.add("skill_tooltip"),f.classList.add("skill_tooltip_next_milestone"),n.appendChild(s),n.append(a),d.classList.add("skill_xp_gain"),o.appendChild(r),o.appendChild(d),o.appendChild(c),o.appendChild(_),o.appendChild(h),o.appendChild(f),c.innerHTML=`<span class="skill_id">id: "${e.skill_id}"</span><br><br>${e.description}<br>`,e.flavour_text&&(c.innerHTML+=`<br><span class="skill_flavour_text">"${e.flavour_text}"</span>`),e.get_effect_description()&&(c.innerHTML+="<br><br>"),e.parent_skill&&(c.innerHTML+=`Parent skill: ${e.parent_skill}<br><br>`),t.appendChild(n),t.appendChild(i),t.appendChild(o),ne[e.category][e.skill_id].appendChild(t),ne[e.category][e.skill_id].setAttribute("data-skill",e.skill_id),ne[e.category][e.skill_id].classList.add("skill_div"),_t.querySelector(`[data-skill_category=${e.category}]`).querySelector("[data-skill_category_skills]").appendChild(ne[e.category][e.skill_id]),es({}),Ps(),xn(e)}function Ji(e,t=!0){ne[e.category][e.skill_id]&&(Xa(e),e.current_xp!=="Max"?(ne[e.category][e.skill_id].children[0].classList.remove("skill_bar_capped"),ne[e.category][e.skill_id].children[0].children[0].children[1].innerHTML=`${100*Math.floor(e.current_xp/e.xp_to_next_lvl*1e3)/1e3}%`,ne[e.category][e.skill_id].children[0].children[2].children[0].innerHTML=`${Qt(e.current_xp)} / ${Qt(e.xp_to_next_lvl)}`):(ne[e.category][e.skill_id].children[0].classList.add("skill_bar_capped"),ne[e.category][e.skill_id].children[0].children[0].children[1].innerHTML="Max!",ne[e.category][e.skill_id].children[0].children[2].children[0].innerHTML="Maxed out!"),ne[e.category][e.skill_id].children[0].children[1].style.width=`${100*e.current_xp/e.xp_to_next_lvl}%`,qs(e.skill_id)&&(ne[e.category][e.skill_id].children[0].children[2].children[4].innerHTML=`<br>${qs(e.skill_id)}`),typeof Ms(e.skill_id)<"u"?ne[e.category][e.skill_id].children[0].children[2].children[5].innerHTML=`lvl ${Ms(e.skill_id)}: ???`:ne[e.category][e.skill_id].children[0].children[2].children[5].innerHTML="",typeof e.get_effect_description<"u"&&(ne[e.category][e.skill_id].children[0].children[2].children[3].innerHTML=`${e.get_effect_description()}`),t&&es({sort_by:Jn}))}function Xa(e){if(!ne[e.category]?.[e.skill_id])return;ne[e.category][e.skill_id].children[0].children[0].children[0].innerHTML=`${e.name()} : level ${e.current_level}/${e.max_level}`;let t=l.bonus_skill_levels.full[e.skill_id];t!=0&&(t>0?ne[e.category][e.skill_id].children[0].children[0].children[0].innerHTML+=` <b>[+${t}]</b>`:ne[e.category][e.skill_id].children[0].children[0].children[0].innerHTML+=` <b>[${t}]</b>`)}function lr(e){ne[e.category][e.skill_id]&&(ne[e.category][e.skill_id].children[0].children[2].children[3].innerHTML=`${e.get_effect_description()}`)}function xn(e){if(!ne[e.category]||!ne[e.category][e.skill_id])return;let t=Math.round(100*e.get_parent_xp_multiplier()*Lt(e.skill_id))/100||1;ne[e.category][e.skill_id].children[0].children[2].children[1].innerHTML=`XP gain: x${t}<br><span>XP cost scaling: x${e.xp_scaling}</span>`}function Za(){Object.keys(ne).forEach(e=>{Object.keys(ne[e]).forEach(t=>{xn(p[t])})})}function es({sort_by:e="name",change_direction:t=!1}){t&&(e&&e===Jn?Pi==="asc"?Pi="desc":Pi="asc":e==="level"?Pi="desc":Pi="asc"),Jn=e;let i=Pi=="asc"?1:-1,n=Pi==="asc"?-1:1;for(let s=0;s<_t.children.length;s++)[..._t.children[s].querySelector("[data-skill_category_skills]").children].sort((a,o)=>{let r,d;if(e==="level")Jn=e,r=p[a.getAttribute("data-skill")].current_level,d=p[o.getAttribute("data-skill")].current_level;else if(e==="progress"){if(isNaN(p[a.getAttribute("data-skill")].current_xp))return 1;if(isNaN(p[o.getAttribute("data-skill")].current_xp))return-1;r=-p[a.getAttribute("data-skill")].current_xp/p[a.getAttribute("data-skill")].xp_to_next_lvl,d=-p[o.getAttribute("data-skill")].current_xp/p[o.getAttribute("data-skill")].xp_to_next_lvl}else r=p[a.getAttribute("data-skill")].name(),d=p[o.getAttribute("data-skill")].name(),Jn="name";return r>d?i:n}).forEach(a=>_t.children[s].querySelector("[data-skill_category_skills").appendChild(a))}function Ps(){[..._t.children].sort((e,t)=>{let i=Se.indexOf(e.dataset.skill_category),n=Se.indexOf(t.dataset.skill_category);return i==-1||n==-1?e.dataset.skill_category>t.dataset.skill_category?1:-1:i>n?1:-1}).forEach(e=>_t.appendChild(e))}function Tl(){Se.length=0,[..._t.children].forEach((e,t)=>{Se[t]=e.dataset.skill_category})}function ts(e,t,i){for(;Ni.firstChild;)Ni.removeChild(Ni.lastChild);Object.keys(ot).forEach(n=>{delete ot[n]}),Ni.innerHTML=`<tr class="stance_list_entry stance_list_header">
        <th class="stance_list_header stance_list_header_fav">Fav</th>
        <th class="stance_list_header stance_list_header_select">Select</th>
        <th class="stance_list_header stance_list_header_name">Name</th>
    </tr>`,Object.keys(e).forEach(n=>{if(e[n].is_unlocked){ot[n]=document.createElement("tr"),ot[n].classList.add("stance_list_entry"),ot[n].dataset.stance=n;let s=`<td class="stances_button stances_button_checkbox"><input type="checkbox" id="stances_fav_${n}" name="stance_fav_selection" onclick="fav_stance('${n}')"></td>`,a=`<td class="stances_button stances_button_radio"><input type="radio" id="stances_select_${n}" name="stance_list_selection" onclick="select_stance('${n}')"></td>`,o=`<td class="stances_name"><label for="stances_select_${n}">${e[n].name}</td>`;ot[n].innerHTML=s,ot[n].innerHTML+=a,ot[n].innerHTML+=o;let r=document.createElement("td");r.appendChild(eu(e[n])),ot[n].appendChild(r),Ni.append(ot[n])}}),[...Ni.children].sort((n,s)=>{let a=e[n.getAttribute("data-stance")],o=e[s.getAttribute("data-stance")];if(o){if(!a)return-1}else return 1;return(!a||!o||!a.is_unlocked||!o.is_unlocked)&&console.error(`No such stance as either '${a}' or '${o}', or at least one of them is not yet unlocked!`),a.stamina_cost<o.stamina_cost?-1:a.stamina_cost>o.stamina_cost||a.name>o.name?1:-1}).forEach(n=>Ni.appendChild(n)),co(t),uo(i)}function eu(e){let t=document.createElement("div");t.classList.add("stance_tooltip"),t.innerHTML=`<div>${e.name}</div><br>
    <div>${e.getDescription()}</div><br>
    <div>Stamina cost: ${e.stamina_cost}</div>
    <div class='stance_tooltip_stats'>${rr(e)}</div`;let i=e.target_count;return i>1&&e.related_skill&&(i=i+Math.round(i*R(e.related_skill)/p[e.related_skill].max_level)),i>1&&(t.innerHTML+=`
        <br><div class='stance_tooltip_hitcount'>${e.randomize_target_count?"Randomly hits up to":"Hits up to"} ${i} enemies</div>`),t}function rr(e){let t="",i=e.getStats();return Object.keys(i).forEach(n=>{t+=`<br>x${Math.round(100*i[n])/100} ${We[n]}`}),t}function cr(e){ot[e.id].querySelector(".stance_tooltip_stats").innerHTML=rr(e);let t=e.target_count;t>1&&(e.related_skill&&(t=t+Math.round(t*R(e.related_skill)/p[e.related_skill].max_level)),ot[e.id].querySelector(".stance_tooltip_hitcount").innerHTML=`${e.randomize_target_count?"Randomly hits up to":"Hits up to"} ${t} enemies</div>`)}function co(e){ot[e.id].children[1].children[0].checked=!0,document.getElementById("character_stance_name").children[0].innerHTML=e.name;let t=document.getElementById("character_stance_selection");t.children&&(t.querySelector(`[data-stance='${e.id}']`)?t.querySelector(`[data-stance='${e.id}']`).children[0].checked=!0:!Rt[e.id]&&t.querySelector("[data-stance] :checked")&&(t.querySelector("[data-stance] :checked").checked=!1))}function uo(e){let t=document.getElementById("character_stance_selection");t.innerHTML="",Object.keys(Rt).forEach(n=>{ot[n].children[0].children[0].checked=!0;let s=`<div data-stance="${n}"><input type="radio" id="stances_quick_select_${n}" name="stance_quick_selection" onclick="select_stance('${n}')">
         <label for="stances_quick_select_${n}">${e[n].name}</div>`;t.innerHTML+=s}),[...t.children].sort((n,s)=>{let a=e[n.getAttribute("data-stance")],o=e[s.getAttribute("data-stance")];return(!a||!o)&&console.error(`No such stance as either '${a}' or '${o}'!`),a.stamina_cost<o.stamina_cost?-1:a.stamina_cost>o.stamina_cost||a.name>o.name?1:-1}).forEach(n=>t.appendChild(n));let i=document.getElementById("character_stance_selection");i.children&&i.querySelector(`[data-stance='${mt}']`)&&(i.querySelector(`[data-stance='${mt}']`).children[0].checked=!0)}function _o(e){let t=X[e];Gi[e]=document.createElement("div"),Gi[e].innerHTML=tu(e),Gi[e].setAttribute("data-bestiary_rank",t.rank),Gi[e].classList.add("bestiary_entry_div"),As.appendChild(Gi[e]),[...As.children].sort((i,n)=>parseInt(i.getAttribute("data-bestiary_rank"))-parseInt(n.getAttribute("data-bestiary_rank"))).forEach(i=>As.appendChild(i))}function tu(e){let t=document.createElement("div"),i=document.createElement("div");i.innerHTML=e,i.classList.add("bestiary_entry_name");let n=document.createElement("div");return n.innerHTML=Ot[e],n.classList.add("bestiary_entry_kill_count"),t.appendChild(i),t.appendChild(n),t.appendChild(ur(e)),t.innerHTML}function ur(e){let t=X[e],i=document.createElement("div");i.classList.add("bestiary_entry_tooltip");let n=document.createElement("div");n.innerHTML=`<br>Base xp value: ${t.xp_value} <br><br>`;let s=document.createElement("div");s.innerHTML=t.description;let a=document.createElement("div");Object.keys(t.tags).forEach(h=>{a.innerHTML+=`[${h}] `}),a.innerHTML+="<br><br>";let o=document.createElement("div");o.innerHTML="Stats: <br>";let r=document.createElement("div");r.classList.add("grid_container"),r.append(fn(t,"Health"),fn(t,"Defense"));let d=document.createElement("div");d.classList.add("grid_container"),d.append(fn(t,"Attack power"),fn(t,"Attack speed"));let c=document.createElement("div");c.classList.add("grid_container"),c.append(fn(t,"AP"),fn(t,"EP")),o.appendChild(r),o.appendChild(d),o.appendChild(c);let _=document.createElement("div");t.loot_list.length>0&&_.appendChild(Il());for(let h=0;h<t.loot_list.length;h++)_.appendChild(Il(t,t.loot_list[h]));return i.appendChild(s),i.appendChild(n),i.appendChild(a),i.appendChild(o),i.appendChild(_),i}function dr(e){Gi[e].querySelector(".bestiary_entry_tooltip").replaceWith(ur(e))}function _r(e){Gi[e].children[1].innerHTML=Ot[e]}function Il(e,t){let i=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div");return i.classList.add("loot_slot_div"),n.classList.add("loot_name"),s.classList.add("loot_chance"),a.classList.add("loot_chance_base"),o.classList.add("loot_chance_current"),e?(n.innerHTML=`${t.item_name}`,a.innerHTML=`[${t.chance*100}%]`,o.innerHTML=`${Math.round(1e4*t.chance*e.get_droprate_modifier())/100}%`,s.append(o,a),i.append(n,s)):(n.innerHTML="Item name",a.innerHTML="base %",o.innerHTML="current %",s.append(o,a),i.append(n,s)),i}function fn(e,t){let i=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div");switch(i.classList.add("stat_slot_div"),n.classList.add("stat_name"),s.classList.add("stat_value"),t){case"Health":n.innerHTML="Health:",s.innerHTML=`${e.stats.health}`,i.append(n,s);break;case"Defense":n.innerHTML="Defense:",s.innerHTML=`${e.stats.defense}`,i.append(n,s);break;case"Attack power":n.innerHTML="Attack power:",s.innerHTML=`${e.stats.attack}`,e.stats.attack_count>1&&(s.innerHTML+=`x${e.stats.attack_count}`),i.append(n,s);break;case"Attack speed":n.innerHTML="Attack speed:",s.innerHTML=`${e.stats.attack_speed}`,i.append(n,s);break;case"AP":n.innerHTML="AP:",s.innerHTML=`${Math.round(e.stats.dexterity*Math.sqrt(e.stats.intuition||1))}`,i.append(n,s);break;case"EP":n.innerHTML="EP:",s.innerHTML=`${Math.round(e.stats.agility*Math.sqrt(e.stats.intuition||1))}`,i.append(n,s);break}return i}function iu(e){ni[e]=document.createElement("div");let t=u[e],i=document.createElement("div");i.innerHTML=e,i.classList.add("anthology_entry_name");let n=Qi(t);n.classList.add("anthology_entry_tooltip"),ni[e].appendChild(i),ni[e].appendChild(n),ni[e].setAttribute("data-book",e),ni[e].classList.add("anthology_entry_div"),Cs.appendChild(ni[e]),[...Cs.children].sort((s,a)=>s.getAttribute("data-book")-a.getAttribute("data-book")).forEach(s=>Cs.appendChild(s))}function mo(e,t){ni[e]||iu(e),ni[e].children[1].innerHTML=yn({item:u[e]}),ni[e].style.display=t?"flex":"none"}function ho(e,t){Ge.children[e].querySelector(".enemy_attack_bar").style.width=`${Math.min(t*100,100)}%`}function mr(e){let t="enemy_hit",i=Ge.children[e];i.classList.contains(t)?(i.style.webkitAnimation="none",setTimeout(()=>{i.style.webkitAnimation=""})):Ge.children[e].classList.add(t)}function is(e){Ge.children[e].classList.remove("enemy_hit")}function po(e){Rc.style.width=`${Math.min(e*100,100)}%`}function bl(e){if(Rs[e]){console.warn(`Tried to add quest "${e}" to display, but it's already there!`);return}else if(N[e].is_hidden){console.warn(`Tried to add quest "${e}" to display, but it's a hidden quest!`);return}let t=N[e],i=nu(e);Rs[e]=i,Gs.appendChild(i),t.is_finished&&i.classList.add("quest_finished"),hr()}function Dn(e){if(N[e].is_hidden){console.warn(`Tried to update display of quest "${e}", but it's a hidden quest!`),console.trace();return}else if(!Rs[e]){console.warn(`Tried to update display of quest "${e}", but it's not in display!`);return}let t=N[e],i=document.querySelector(`[data-quest_id="${e}"]`),n=i.querySelector(".quest_name_div");n.innerHTML=t.getQuestName();let s=i.querySelector(".quest_description_div");s.innerHTML=t.getQuestDescription()??"",t.is_finished&&i.classList.add("quest_finished"),au(e),hr()}function hr(){[...Gs.children].sort((e,t)=>{let i=N[e.getAttribute("data-quest_id")],n=N[t.getAttribute("data-quest_id")];return i.is_finished&&!n.is_finished?1:!i.is_finished&&n.is_finished?-1:i.display_priority!==n.display_priority?i.display_priority-n.display_priority:i.getQuestName()>n.getQuestName()?1:-1}).forEach(e=>Gs.appendChild(e))}function nu(e){let t=N[e],i=document.createElement("div");i.dataset.quest_id=e;let n=document.createElement("div"),s=document.createElement("div");return i.classList.add("quest_div"),s.innerHTML=t.getQuestName(),s.classList.add("quest_name_div"),n.innerHTML=t.getQuestDescription(),n.classList.add("quest_description_div"),i.appendChild(s),i.appendChild(n),i.appendChild(pr(e)),i.addEventListener("click",a=>{a.target.classList.contains("quest_name_div")&&i.classList.toggle("quest_div_expanded")}),i}function pr(e){let t=N[e],i=document.createElement("div");i.classList.add("quest_task_list_div");let n=t.quest_tasks.findIndex(s=>!s.is_finished);n=n==-1?t.quest_tasks.length:n;for(let s=0;s<n;s++)t.quest_tasks[s].is_hidden||i.appendChild(Ds(e,s));return n!==t.quest_tasks.length&&(t.quest_tasks[n].is_hidden||i.appendChild(Ds(e,n))),i}function Ds(e,t){let i=N[e].quest_tasks[t],n=document.createElement("div");n.classList.add("quest_task_div");let s=document.createElement("span");s.classList.add("task_status_icon"),i.is_finished?(n.classList.add("task_finished"),s.innerHTML='<i class="material-icons">check_box</i>'):s.innerHTML='<i class="material-icons">check_box_outline_blank</i>';let a=document.createElement("div");a.classList.add("task_description_div"),a.innerHTML=i.task_description;let o=document.createElement("div"),r=0;if(Object.keys(i.task_condition).forEach(d=>{if(Object.keys(i.task_condition[d]).length){let c=document.createElement("div");c.classList.add("task_condition_div"),c.innerHTML+=d+":",Object.keys(i.task_condition[d]).forEach(_=>{let h=document.createElement("div");h.classList.add("task_type_div"),h.innerHTML+=Vo[_]+":",Object.keys(i.task_condition[d][_]).forEach(f=>{let y=document.createElement("div");y.classList.add("task_target_div"),y.innerHTML+=f+": "+i.task_condition[d][_][f].current+"/"+i.task_condition[d][_][f].target,h.appendChild(y),r++}),c.appendChild(h)}),o.appendChild(c)}}),r==1){let d=o.getElementsByClassName("task_condition_div");for(let c=0;c<d.length;c++)d.item(c).innerHTML=d.item(c).innerHTML.replace("any:","").replace("all:","")}return n.appendChild(s),n.appendChild(a),n.appendChild(o),n}function vl(e,t){let i=N[e];if(i.quest_tasks[t].is_hidden||i.is_hidden)return;let s=document.querySelector(`[data-quest_id="${e}"]`).querySelector(".quest_task_list_div");(s.children.item(t)||s.children.item(t-1)).replaceWith(Ds(e,t))}function au(e){let i=document.querySelector(`[data-quest_id="${e}"]`).querySelector(".quest_task_list_div");i.replaceWith(pr(e)),i.remove()}function Xi(){fo("rain")}function Zi(){fo("snow")}function ia(){fo("stars")}function fo(e){ns();let t;switch(e){case"snow":t=Ca,Ye=document.getElementById("foreground_canvas");break;case"rain":t=Ia,Ye=document.getElementById("foreground_canvas");break;case"stars":t=Aa,Ye=document.getElementById("background_canvas");break;default:break}Di=Ye.getContext("2d"),Ye.width=Di.canvas.clientWidth,Ye.height=Di.canvas.clientHeight,Pa=[];for(let i=0;i<Math.ceil(Ye.width*Ye.height/5e3);i++)Pa.push(new t({canvas:Ye}));fr()}function ns(){Ye=Ye||document.getElementById("foreground_canvas"),Di=Di||Ye.getContext("2d"),Di.clearRect(0,0,Ye.width,Ye.height),cancelAnimationFrame(Ol),clearTimeout(Nl)}function fr(){Nl=setTimeout(()=>{Ol=requestAnimationFrame(fr),Di.clearRect(0,0,Ye.width,Ye.height);for(let e=0;e<Pa.length;e++)Pa[e].draw()},1e3/60)}function gr(e,t){if(e>t)Ll.innerHTML="Reward available!";else{let i=t-e;i/=1e3;let n=Math.floor(i%60);i=Math.floor(i/60);let s=Math.floor(i%60);i=Math.floor(i/60);let a=i;Ll.innerHTML=`Reward available in: ${a}:${s}:${n} real time`}}function qn(e){e?(ei.innerText=`Load the backup autosave [${e.replaceAll("_",":")}]`,ei.style["background-image"]="var(--options_gradient);",ei.style["background-color"]="transparent",ei.style.color="white",ei.style.cursor="pointer"):(ei.style["background-image"]="none",ei.style["background-color"]="#181818",ei.style.color="gray",ei.style.cursor="not-allowed")}function na(e,t){t?vt.innerText="Import save from main version":vt.innerText="Import save from dev version",e!==void 0?(vt.style["background-image"]="var(--options_gradient);",vt.style["background-color"]="transparent",vt.style.color="white",vt.style.cursor="pointer",e?vt.innerText+=` [${e.replaceAll("_",":")}]`:vt.innerText+=" [unknown date]"):(vt.style["background-image"]="none",vt.style["background-color"]="#181818",vt.style.color="gray",vt.style.cursor="not-allowed")}function yr(){document.getElementById("loading_screen").style.visibility="hidden"}function as(e){let t=document.getElementById("loading_screen_version_info"),i=Ba();t.innerHTML=`Save game version: ${e||"none"}<br>
 Current game version: ${i}<br>`,e&&(e===i?t.innerHTML+="<div class='top_border'>No changes since the last time you played~</div>":Et(e,i)?t.innerHTML+="<div class='top_border'>Game has been updated since the last time you played, check the changelog for more details</div>":t.innerHTML+="<div class='top_border'>Your save is from a newer version of the game. Continuing is likely to lead to multiple issues!</div>")}function qt(e){Gc.innerHTML=e}function go(){document.getElementById("loading_screen_loading_text").classList.add("fade")}function wr(){let e=document.getElementById("loading_screen_status");e.classList.remove("loading_screen_status_warnings"),e.classList.add("loading_screen_status_errors"),e.innerHTML="An error has occured on loading! Please open the browser console to check for details and then let the developer know!"}function br(){let e=document.getElementById("loading_screen_status");e.classList.add("loading_screen_status_warnings"),e.innerHTML="A potential issue has occured on loading. Please open the browser console to check for details."}function yo(){let e=document.getElementById("loading_screen_play_button");e.classList.remove("none_display"),e.classList.add("fade_in")}function vr(e){let t=document.getElementById("loading_screen_play_button");t.innerText=e}function Na({element:e,siblings_only:t=!1,class_name:i}){let n=t?e.parentNode.querySelectorAll(`.${i}`):document.getElementsByClassName(i),s=e.classList.contains(i);for(let a=0;a<n.length;a++)n[a].classList.remove(i);s||e.classList.add(i)}function Oa(e){let t=document.getElementsByClassName(e);for(;t.length>0;)t.item(0).classList.remove(e)}function Ys(e,t){let i=e.getBoundingClientRect(),n=t.getBoundingClientRect();return i.bottom<=n.top}var su=.75,xo=10,Xn=["axe","pickaxe","sickle","shovel"],Oi=()=>l.name.match(/\b(?<![\w])rat\b/i),qr=10,Mr=60,$r=20,Mn=[14,8,2,-4],Zn=Mn[0],ss=["Cold","Very cold","Freezing","Hypothermia"],qo=class extends _i{constructor(){super(),this.base_stats={max_health:50,health:50,health_regeneration_flat:0,health_regeneration_percent:0,health_loss_flat:0,health_loss_percent:0,max_stamina:50,stamina:50,stamina_regeneration_flat:0,stamina_regeneration_percent:0,stamina_efficiency:1,max_mana:0,mana:0,mana_regeneration_flat:0,mana_regeneration_percent:0,mana_efficiency:1,strength:10,agility:10,dexterity:10,intuition:10,magic:0,attack_speed:1,crit_rate:.05,crit_multiplier:1.3,attack_power:0,defense:0,block_strength:0,block_chance:0,evasion_points:0,attack_points:0,heat_tolerance:0,cold_tolerance:0,unarmed_power:1,armor_penetration:0},this.name="Hero",this.titles={},this.stats={full:{...this.base_stats},total_flat:{},total_multiplier:{},flat:{level:{},skills:{},equipment:{},skill_milestones:{},books:{},light_level:{},environment:{}},multiplier:{skills:{},skill_milestones:{},equipment:{},books:{},stance:{},light_level:{},environment:{}}},this.reputation={village:0,slums:0,town:0},this.bonus_skill_levels={full:{},flat:{equipment:{},active_effects:{},skills:{}}},this.xp_bonuses={total_multiplier:{hero:1,all:1,all_skill:1},multiplier:{levels:{},skills:{},books:{},active_effects:{}}},this.equipment={head:null,torso:null,arms:null,ring:null,weapon:null,"off-hand":null,legs:null,feet:null,amulet:null,artifact:null,cape:null,axe:null,pickaxe:null,sickle:null,shovel:null},this.money=0,this.xp={current_level:0,total_xp:0,current_xp:0,xp_to_next_lvl:xo,total_xp_to_next_lvl:xo,base_xp_cost:xo,xp_scaling:1.6}}add_xp({xp_to_add:t,use_bonus:i=!0}){if(i&&(t*=(l.xp_bonuses.total_multiplier.hero||1)*(l.xp_bonuses.total_multiplier.all||1)),l.xp.total_xp+=t,t+l.xp.current_xp<l.xp.xp_to_next_lvl)l.xp.current_xp+=t;else{let n=0;for(;l.xp.total_xp>=l.xp.total_xp_to_next_lvl;)n+=1,l.xp.total_xp_to_next_lvl=Math.round(l.xp.base_xp_cost*(1-l.xp.xp_scaling**(n+1))/(1-l.xp.xp_scaling));let s=Math.round(l.xp.base_xp_cost*(1-l.xp.xp_scaling**n)/(1-l.xp.xp_scaling)),a=l.get_level_bonus(n);return l.xp.xp_to_next_lvl=l.xp.total_xp_to_next_lvl-s,l.xp.current_level=n,l.xp.current_xp=l.xp.total_xp-s,`${l.name} is getting stronger. Reached level ${l.xp.current_level} ${a}`}}get_level_bonus(t){let i=0,n=0,s=0,a=0,o=0,r=0,d=1.03,c=1;for(let h=l.xp.current_level+1;h<=t;h++)h%2==1?(s+=Math.ceil(h/10),r+=Math.ceil(h/10)):(a+=Math.ceil(h/10),o+=Math.ceil(h/10)),i+=10*Math.ceil(h/10),n+=5,c=c*d;l.stats.flat.level.max_health=(l.stats.flat.level.max_health||0)+i,l.stats.flat.level.health=l.stats.flat.level.max_health,l.stats.flat.level.max_stamina=(l.stats.flat.level.max_stamina||0)+n,l.stats.flat.level.stamina=l.stats.flat.level.max_stamina,l.stats.flat.level.strength=(l.stats.flat.level.strength||0)+s,l.stats.flat.level.intuition=(l.stats.flat.level.intuition||0)+r,l.stats.flat.level.agility=(l.stats.flat.level.agility||0)+a,l.stats.flat.level.dexterity=(l.stats.flat.level.dexterity||0)+o,l.xp_bonuses.multiplier.levels.all_skill=(l.xp_bonuses.multiplier.levels.all_skill||1)*c;let _=`<br>HP increased by ${i}<br>Stamina increased by ${n}`;return s>0&&(_+=`<br>Strength increased by ${s}`),a>0&&(_+=`<br>Agility increased by ${a}`),o>0&&(_+=`<br>Dexterity increased by ${o}`),r>0&&(_+=`<br>Intuition increased by ${r}`),_+=`<br>Skill xp gains increased by ${Math.round((d-1)*100)}%`,_}},l=new qo;l.stats.add_skill_milestone_bonus=function({stats:e={},xp_multipliers:t={}}){Object.keys(e).forEach(i=>{e[i].flat&&(l.stats.flat.skill_milestones[i]=(l.stats.flat.skill_milestones[i]||0)+e[i].flat),e[i].multiplier&&(l.stats.multiplier.skill_milestones[i]=(l.stats.multiplier.skill_milestones[i]||1)*e[i].multiplier)}),t?.hero&&(l.xp_bonuses.multiplier.skills.hero=(l.xp_bonuses.multiplier.skills.hero||1)*t.hero),t?.all&&(l.xp_bonuses.multiplier.skills.all=(l.xp_bonuses.multiplier.skills.all||1)*t.all),t?.all_skill&&(l.xp_bonuses.multiplier.skills.all_skill=(l.xp_bonuses.multiplier.skills.all_skill||1)*t.all_skill),Object.keys(p).forEach(i=>{t[i]&&(l.xp_bonuses.multiplier.skills[i]=(l.xp_bonuses.multiplier.skills[i]||1)*t[i])}),Object.keys(Ci).forEach(i=>{let n="category_"+i;t[n]&&(l.xp_bonuses.multiplier.skills[n]=(l.xp_bonuses.multiplier.skills[n]||1)*t[n])})};l.stats.add_book_bonus=function({multipliers:e={},xp_multipliers:t={}}){Object.keys(l.base_stats).forEach(i=>{e[i]&&(l.stats.multiplier.books[i]=(l.stats.multiplier.books[i]||1)*e[i])}),t?.hero&&(l.xp_bonuses.multiplier.books.hero=(l.xp_bonuses.multiplier.books.hero||1)*t.hero),t?.all&&(l.xp_bonuses.multiplier.books.all=(l.xp_bonuses.multiplier.books.all||1)*t.all),t?.all_skill&&(l.xp_bonuses.multiplier.books.all_skill=(l.xp_bonuses.multiplier.books.all_skill||1)*t.all_skill),Object.keys(p).forEach(i=>{t[i]&&(l.xp_bonuses.multiplier.books[i]=(l.xp_bonuses.multiplier.books[i]||1)*t[i])})};l.stats.add_active_effect_bonus=function(){l.stats.flat.active_effects={},l.stats.multiplier.active_effects={},l.bonus_skill_levels.flat.active_effects={},l.xp_bonuses.multiplier.active_effects={},Object.keys(he).forEach(e=>{let t=1,i=bo(he[e]);for(let[n,s]of Object.entries(i.stats))s.flat&&(l.stats.flat.active_effects[n]=(l.stats.flat.active_effects[n]||0)+s.flat*t),s.multiplier&&(l.stats.multiplier.active_effects[n]=(l.stats.multiplier.active_effects[n]||1)*s.multiplier*t);for(let[n,s]of Object.entries(i.bonus_skill_levels))l.bonus_skill_levels.flat.active_effects[n]=(l.bonus_skill_levels.flat.active_effects[n]||0)+s;for(let[n,s]of Object.entries(i.xp_multipliers))l.xp_bonuses.multiplier.active_effects[n]=(l.xp_bonuses.multiplier.active_effects[n]||1)*s})};l.stats.add_all_equipment_bonus=function(){l.stats.flat.equipment={},l.stats.multiplier.equipment={},l.bonus_skill_levels.flat.equipment={},Object.keys(l.equipment).forEach(e=>{if(!l.equipment[e])return;l.equipment[e].getDefense&&(l.stats.flat.equipment.defense=(l.stats.flat.equipment.defense||0)+l.equipment[e].getDefense());let t=l.equipment[e].getStats(),i=l.equipment[e].getBonusSkillLevels();Object.keys(t).forEach(n=>{t[n].flat&&(l.stats.flat.equipment[n]=(l.stats.flat.equipment[n]||0)+t[n].flat),t[n].multiplier&&(l.stats.multiplier.equipment[n]=(l.stats.multiplier.equipment[n]||1)*t[n].multiplier)}),Object.keys(i).forEach(n=>{i[n]&&(l.bonus_skill_levels.flat.equipment[n]=(l.bonus_skill_levels.flat.equipment[n]||0)+i[n])})}),l.stats.add_weapon_type_bonuses()};l.stats.add_weapon_type_bonuses=function(){l.equipment.weapon==null?(l.stats.multiplier.skills.attack_power=C({skill_id:"Unarmed"}),l.stats.multiplier.skills.attack_speed=C({scaling_type:"multiplicative",skill_id:"Unarmed"})**.3333,l.stats.multiplier.skills.attack_points=C({scaling_type:"multiplicative",skill_id:"Unarmed"})**.3333,l.stats.multiplier.skills.evasion_points=C({scaling_type:"multiplicative",skill_id:"Unarmed"})**.3333):(l.stats.multiplier.skills.attack_speed=1,l.stats.multiplier.skills.attack_power=C({skill_id:Rn[l.equipment.weapon.weapon_type]}),l.stats.multiplier.skills.attack_points=C({skill_id:Rn[l.equipment.weapon.weapon_type]})**.3333,l.stats.multiplier.skills.evasion_points=1)};l.stats.add_all_skill_level_bonus=function(){l.stats.flat.skills.defense=bt("Iron skin"),l.stats.multiplier.skills.stamina_efficiency=C({scaling_type:"multiplicative",skill_id:"Running"}),l.stats.multiplier.skills.strength=C({scaling_type:"multiplicative",skill_id:"Weightlifting"})*C({scaling_type:"multiplicative",skill_id:"Climbing"})*C({scaling_type:"multiplicative",skill_id:"Breathing"}),l.stats.multiplier.skills.block_strength=1+5*bt("Shield blocking"),l.stats.multiplier.skills.agility=C({scaling_type:"multiplicative",skill_id:"Equilibrium"})*C({scaling_type:"multiplicative",skill_id:"Climbing"})*C({scaling_type:"multiplicative",skill_id:"Breathing"})*C({scaling_type:"multiplicative",skill_id:"Swimming"}),l.stats.multiplier.skills.dexterity=C({scaling_type:"multiplicative",skill_id:"Climbing"}),l.stats.multiplier.skills.max_stamina=C({scaling_type:"multiplicative",skill_id:"Breathing"})*C({scaling_type:"multiplicative",skill_id:"Swimming"}),l.stats.multiplier.skills.max_health=C({scaling_type:"multiplicative",skill_id:"Fortitude"}),l.stats.flat.skills.intuition=C({scaling_type:"multiplicative",skill_id:"Meditation"}),l.stats.flat.skills.unarmed_power=p.Unarmed.current_level*.1,l.stats.add_weapon_type_bonuses(),l.stats.flat.skills.cold_tolerance=.5*R("Cold resistance")};l.stats.add_all_stance_bonus=function(){let e=Te.getStats();Object.keys(l.base_stats).forEach(t=>{e[t]?l.stats.multiplier.stance[t]=e[t]||1:l.stats.multiplier.stance[t]=1})};l.stats.add_location_penalties=function(){let e={},t=1;v&&("connected_locations"in v||(e=v.get_total_effect().hero_penalty),v.light_level==="dark"||v.light_level==="normal"&&Si(M)?(t=.5+.5*R("Night vision")/p["Night vision"].max_level,l.stats.multiplier.light_level.evasion_points=t,l.stats.multiplier.light_level.attack_points=t):(l.stats.multiplier.light_level.evasion_points=1,l.stats.multiplier.light_level.attack_points=1)),l.stats.multiplier.environment={},l.stats.flat.environment={},Object.keys(e.multipliers||{}).forEach(i=>{l.stats.multiplier.environment[i]=e.multipliers[i]}),Object.keys(e.flats||{}).forEach(i=>{l.stats.flat.environment[i]=e.flats[i]})};l.get_character_cold_tolerance=function(){return l.stats.full.cold_tolerance};l.get_character_heat_tolerance=function(){return l.stats.full.heat_tolerance};l.update_stats=function(){let e=Math.max(l.stats.full.max_health-l.stats.full.health,0)||0,t=Math.max(l.stats.full.max_stamina-l.stats.full.stamina,0)||0,i=Math.max(l.stats.full.max_mana-l.stats.full.mana,0)||0;l.stats.add_all_skill_level_bonus(),l.stats.add_all_stance_bonus(),Object.keys(l.stats.full).forEach(n=>{let s=0,a=1;n==="block_chance"?s=su+Math.round(bt("Shield blocking")*1e4)/1e4:n==="attack_points"?s=Math.sqrt(l.stats.full.intuition)*l.stats.full.dexterity*C({scaling_type:"multiplicative",skill_id:"Combat"}):n==="evasion_points"?s=l.stats.full.agility*Math.sqrt(l.stats.full.intuition)*C({scaling_type:"multiplicative",skill_id:"Evasion"}):Object.values(l.stats.flat).forEach(o=>{s+=o[n]||0}),Object.values(l.stats.multiplier).forEach(o=>{a*=o[n]||1}),l.stats.full[n]=(l.base_stats[n]+s)*a,l.stats.total_flat[n]=l.base_stats[n]+s,l.stats.total_multiplier[n]=a||1,n==="health"?l.stats.full.health=Math.max(0,l.stats.full.max_health-e):n==="stamina"?l.stats.full.stamina=Math.max(0,l.stats.full.max_stamina-t):n==="mana"&&(l.stats.full.mana=Math.max(0,l.stats.full.max_mana-i))}),l.equipment.weapon!=null?l.stats.full.attack_power=l.stats.full.strength/10*l.equipment.weapon.getAttack()*l.stats.total_multiplier.attack_power:l.stats.full.attack_power=l.stats.full.strength/10*l.stats.total_multiplier.attack_power*l.stats.full.unarmed_power,l.stats.total_flat.attack_power=l.stats.full.attack_power/l.stats.total_multiplier.attack_power,Object.keys(l.xp_bonuses.total_multiplier).forEach(n=>{l.xp_bonuses.total_multiplier[n]=(l.xp_bonuses.multiplier.levels[n]||1)*(l.xp_bonuses.multiplier.skills[n]||1)*(l.xp_bonuses.multiplier.books[n]||1)*(l.xp_bonuses.multiplier.active_effects[n]||1),l.xp_bonuses.total_multiplier[n]!=1&&(n!=="hero"&&(n==="all"||n==="all_skill"||n.includes("category_")?Za():xn(p[n])),(n==="hero"||n==="all")&&Ua())}),Object.keys(l.bonus_skill_levels.full).forEach(n=>{if(n.includes("category_"))return;let s="category_"+p[n].category;l.bonus_skill_levels.full[n]=(l.bonus_skill_levels.flat.equipment[n]||0)+(l.bonus_skill_levels.flat.active_effects[n]||0)+(l.bonus_skill_levels.flat.skills[n]||0)+(l.bonus_skill_levels.flat.equipment[s]||0)+(l.bonus_skill_levels.flat.active_effects[s]||0)+(l.bonus_skill_levels.flat.skills[s]||0),l.bonus_skill_levels.full[n]!=0&&Xa(p[n])})};l.get_stamina_multiplier=function(){return l.stats.full.stamina==0?.5+bt("Persistence"):1};l.get_attack_speed=function(){return l.stats.full.attack_speed*l.get_stamina_multiplier()};l.get_attack_power=function(){return l.stats.full.attack_power*l.get_stamina_multiplier()};l.wears_armor=function(){return l.equipment.head&&l.equipment.head.getDefense()!==0||l.equipment.torso&&l.equipment.torso.getDefense()!==0||l.equipment.arms&&l.equipment.arms.getDefense()!==0||l.equipment.legs&&l.equipment.legs.getDefense()!==0||l.equipment.feet&&l.equipment.feet.getDefense()!==0||l.equipment.cape&&l.equipment.cape.getDefense()!==0};l.take_damage=function({damage_values:e,can_faint:t=!0,give_skill_xp:i=!0}){let n;e=e.map(a=>a<1?Math.max(Math.ceil(10*a)/10,0):Math.ceil(10*Math.max(a-l.stats.full.defense,a*.05,1))/10);let s=e.reduce((a,o)=>a+o);return l.stats.full.health-=s,l.stats.full.health<=0&&t?(n=!0,l.stats.full.health=0):n=!1,{damage_taken:s,fainted:n}};l.get_character_money=function(){return l.money};function ze(e){let t=l.add_to_inventory(e);we({was_anything_new_added:t})}function ct(e){l.remove_from_inventory(e),we();for(let t=0;t<e.length;t++){if(l.inventory[e[t].item_key])continue;let{id:i}=JSON.parse(e[t].item_key);i&&u[i].tags.usable&&Tt[i]&&os(i)}}function oi(e){if(!e){Ui(),we(),l.stats.add_all_equipment_bonus(),Le();return}let t=l.equipment[e.equip_slot];$o(e.equip_slot,!0),l.equipment[e.equip_slot]=e,Ui(),we(),l.stats.add_all_equipment_bonus(),Le(),Mo(e),t&&Mo(t)}function Er(e){e in l.inventory&&(oi(l.inventory[e].item),ct([{item_key:e}]))}function $o(e,t=!1){if(l.equipment[e]!=null){let i=l.equipment[e];ze([{item_key:i.getInventoryKey()}]),l.equipment[e]=null,Ui(),we(),t||(l.stats.add_all_equipment_bonus(),Le(),Mo(i))}}function Mo(e){let t=Object.keys(e.getBonusSkillLevels());if(t.length>0)for(let i=0;i<t.length;i++)t[i].includes("category_")||Xa(p[t[i]])}function bi(){return l.get_character_cold_tolerance()}function Le(){l.stats.add_location_penalties(),l.update_stats(),Va(),si(),Ki(),Ka()}function Lt(e){let t="category_"+p[e].category;return(l.xp_bonuses.total_multiplier.all||1)*wo(e)}function wo(e){let t="category_"+p[e].category;return(l.xp_bonuses.total_multiplier.all_skill||1)*(l.xp_bonuses.total_multiplier.all||1)*(l.xp_bonuses.total_multiplier[t]||1)}function kr(){return(l.xp_bonuses.total_multiplier.all_skill||1)*(l.xp_bonuses.total_multiplier.all||1)}function xr(){return(l.xp_bonuses.total_multiplier.hero||1)*(l.xp_bonuses.total_multiplier.all||1)}function R(e){return p[e].current_level+(l.bonus_skill_levels.full[e]||0)}function bt(e){return p[e].get_level_bonus(R(e))}function C({scaling_type:e,skill_id:t}){return p[t].get_coefficient({scaling_type:e,skill_level:R(t)})}function bo(e){let t=1;Object.keys(Li).forEach(n=>{e.tags[Li[n]]&&(t*=C({scaling_type:"multiplicative",skill_id:n}))});let i={stats:{},bonus_skill_levels:{...e.effects.bonus_skill_levels},xp_multipliers:{...e.effects.xp_multipliers}};for(let[n,s]of Object.entries(e.effects.stats))i.stats[n]={},s.flat?n.includes("_percent")?i.stats[n].flat=s.flat*(t>0?t:1):i.stats[n].flat=s.flat*(t>0?t:1)**2:s.multiplier&&(i.stats[n].multiplier=s.multiplier*(t>1?t:1));return i}var ke={trash:1,common:1,uncommon:1.1,rare:1.3,epic:1.6,legendary:2,mythical:2.5},u={};function sa(e){let t;if(u[e].component_type==="helmet interior")t="head";else if(u[e].component_type==="chestplate interior")t="torso";else if(u[e].component_type==="leg armor interior")t="legs";else if(u[e].component_type==="glove interior")t="arms";else if(u[e].component_type==="shoes interior")t="feet";else return console.error(`Component type "${u[e].component_type}" doesn't correspond to any armor slot!`),null;return t}function Ve(e){let t;return e<50?t="trash":e<=100?t="common":e<130?t="uncommon":e<160?t="rare":e<200?t="epic":e<246?t="legendary":t="mythical",t}function ou({components:e,quality:t=100}){let i=0;return Object.values(e).forEach(n=>{i+=u[n].value}),Oe(1.25*i*(t/100)*ke[Ve(t)])}var tn=class{constructor({name:t,description:i,value:n=0,tags:s={},market_saturation_group:a,saturates_market:o,material_type:r=null,quality:d=null,id:c=null,components:_=null,getName:h=()=>this.name}){if(this.name=t,this.name?.startsWith($e))throw new Error(`Item name of item "${this.name}" starts with a forbidden prefix!`);this.id=c,this.description=i,this.saturates_market=o??!0,this.material_type=r,this.quality=d,this.components=_,this.value=n,this.tags=s,this.tags.item=!0,this.market_saturation_group=a,this.getName||(this.getName=h)}getMarketSaturationGroup(){return this.market_saturation_group||{group_key:this.id,group_tier:0}}getInventoryKey(){return this.inventory_key||(this.inventory_key=this.createInventoryKey()),this.inventory_key}createInventoryKey(){let t={};return this.components?(t.components={},Object.keys(this.components).forEach(i=>{t.components[i]=this.components[i]})):t.id=this.id,this.quality&&(t.quality=this.quality),JSON.stringify(t)}getBaseValue({quality:t}={}){return t=t||this.quality||100,this.components?ou({components:this.components,quality:t}):Oe(this.value*(t/100)*ke[Ve(t)])}getValue({quality:t,region:i}){return t=t||this.quality||100,!this.saturates_market||!i?Oe(this.getBaseValue({quality:t})):this.getValueWithSaturation(i)}getValueWithSaturation(t){let{group_key:i,group_tier:n}=this.getMarketSaturationGroup();return Xo({item:this,base_value:this.getBaseValue(),group_key:i,group_tier:n,region:t})}getValueOfMultiple({additional_traded_count:t=0,count:i,region:n,price_multiplier:s=1,is_selling:a=!0,stop_multiplier_at:o=1/0}){if(this.saturates_market){let{group_key:r,group_tier:d}=this.getMarketSaturationGroup(),c=this.getBaseValue(),_=Jo({value:c,start_count:bs({region:n,group_key:r,group_tier:d})+t,how_many_to_trade:i,region:n,is_group:r.startsWith($e),is_selling:a,stop_multiplier_at:o});return Math.max(i,Math.ceil(Oe(c*s)*Math.round(c*_)/c))}else return Oe(this.getBaseValue())*i}getDescription(){return this.description}},ht=class extends tn{constructor(t){super(t),this.item_type="OTHER"}},B=class extends ht{constructor(t){super(t),this.item_type="MATERIAL",this.tags.material=!0}},aa=class extends tn{constructor(t){super(t),this.item_type="COMPONENT",this.component_tier=t.component_tier||1,this.component_stats=t.component_stats||{},this.tags.component=!0,this.quality=Math.round(t.quality)||100}getRarity(t){return t?Ve(t):(this.rarity||(this.rarity=Ve(this.quality)),this.rarity)}calculateRarity(t){let i;return t<50?i="trash":t<100?i="common":t<130?i="uncommon":t<160?i="rare":t<200?i="epic":t<246?i="legendary":i="mythical",i}getStats(){return this.component_stats}},V=class extends aa{constructor(t){if(super(t),t.component_type!=="axe head"&&t.component_type!=="hammer head"&&t.component_type!=="short blade"&&t.component_type!=="long blade"&&t.component_type!=="short handle"&&t.component_type!=="long handle"&&t.component_type!=="medium handle")throw new Error(`No such weapon component type as ${t.component_type}`);this.component_type=t.component_type,this.attack_value=t.attack_value||0,t.component_type==="short handle"?(this.attack_multiplier=1,this.market_saturation_group={group_key:$e+"handle",group_tier:this.component_tier-1}):t.component_type==="medium handle"?(this.attack_multiplier=1,this.market_saturation_group={group_key:$e+"handle",group_tier:this.component_tier-1}):t.component_type==="long handle"?(this.attack_multiplier=1.5,this.market_saturation_group={group_key:$e+"handle",group_tier:this.component_tier-1}):(this.attack_multiplier=1,this.market_saturation_group={group_key:$e+"weapon",group_tier:this.component_tier-1}),this.name_prefix=t.name_prefix,this.tags["weapon component"]=!0,this.tags.component=!0}},Qe=class extends aa{constructor(t){if(super(t),t.component_type!=="shield base"&&t.component_type!=="shield handle")throw new Error(`No such shield component type as ${t.component_type}`);this.component_type=t.component_type,t.component_type==="shield base"?this.market_saturation_group={group_key:$e+"shield",group_tier:this.component_tier-1}:this.market_saturation_group={group_key:$e+"handle",group_tier:this.component_tier-1},this.shield_strength=t.shield_strength,this.shield_name=t.shield_name||t.name,this.tags["shield component"]=!0,this.tags.component=!0}},ae=class extends aa{constructor(t){if(super(t),t.component_type!=="helmet interior"&&t.component_type!=="helmet exterior"&&t.component_type!=="chestplate interior"&&t.component_type!=="chestplate exterior"&&t.component_type!=="leg armor interior"&&t.component_type!=="leg armor exterior"&&t.component_type!=="glove interior"&&t.component_type!=="glove exterior"&&t.component_type!=="shoes interior"&&t.component_type!=="shoes exterior")throw new Error(`No such armor component type as ${t.component_type}`);this.component_type=t.component_type,this.defense_value=t.defense_value,this.stats=t.stats||{},this.equip_slot=t.equip_slot,this.full_armor_name=t.full_armor_name,this.armor_name=t.armor_name,this.name_prefix=t.name_prefix,this.name_suffix=t.name_suffix,this.tags["armor component"]=!0,this.tags.component=!0,this.market_saturation_group={group_key:$e+"armor",group_tier:this.component_tier-1}}},xe=class extends tn{constructor(t){super(t),this.item_type="USABLE",this.effects=t.effects||{},this.recovery_chances=t.recovery_chances||{},this.saturates_market=!1,this.tags.usable=!0}},li=class extends tn{constructor(t){super(t),this.item_type="EQUIPPABLE",this.bonus_skill_levels=t.bonus_skill_levels||{},this.quality=Math.round(Number(t.quality))||100,this.tags.equippable=!0}getItemTier(){if(this.components){let t=1;return Object.values(this.components).forEach(i=>{u[i].component_tier>t&&(t=u[i].component_tier)}),t}else return this.component_tier?this.component_tier:1}getRarity(t){return t?Ve(t):(this.rarity||(this.rarity=Ve(this.quality)),this.rarity)}getStats(t){return t?this.calculateStats(t):(this.stats||(this.stats=this.calculateStats(this.quality)),this.stats)}calculateStats(t){let i={};if(this.components){let n=Object.values(this.components).map(s=>u[s]).filter(s=>s);for(let s=0;s<n.length;s++)Object.keys(n[s].component_stats).forEach(a=>{i[a]||(i[a]={}),!(a==="defense"||a==="attack_power"||a==="block_strength")&&(n[s].component_stats[a].multiplier&&(i[a].multiplier=(i[a].multiplier||1)*n[s].component_stats[a].multiplier),n[s].component_stats[a].flat&&(i[a].flat=(i[a].flat||0)+n[s].component_stats[a].flat))});Object.keys(i).forEach(s=>{i[s].multiplier&&(i[s].multiplier>=1?i[s].multiplier=Math.round(100*(1+(i[s].multiplier-1)*ke[this.getRarity(t)]))/100:i[s].multiplier=Math.round(100*i[s].multiplier)/100),i[s].flat&&(i[s].flat>0?i[s].flat=Math.round(100*i[s].flat*ke[this.getRarity(t)])/100:i[s].flat=Math.round(100*i[s].flat)/100)})}else{let n=this.component_stats||this.base_stats||{};Object.keys(n).forEach(s=>{i[s]={},n[s].multiplier&&(i[s].multiplier=1,n[s].multiplier>=1?i[s].multiplier=Math.round(100*(1+(n[s].multiplier-1)*ke[this.getRarity(t)]))/100:i[s].multiplier=Math.round(100*n[s].multiplier)/100),n[s].flat&&(i[s].flat=0,n[s].flat>0?i[s].flat=Math.round(100*n[s].flat*ke[this.getRarity(t)])/100:i[s].flat=Math.round(100*n[s].flat)/100)})}return i}getBonusSkillLevels(){return this.bonus_skill_levels}},en=class extends li{constructor(t){super(t),this.equip_slot="artifact",this.stats=t.stats,this.ignore_quality=!0,this.tags.artifact=!0,this.id||(this.id=this.getName())}getStats(){return this.stats}},It=class extends li{constructor(t){super(t),this.equip_slot=t.equip_slot,this.ignore_quality=!0,this.tags.tool=!0,this.tags[this.equip_slot]=!0,this.id||(this.id=this.getName())}getStats(){return{}}},nt=class extends li{constructor(t){if(super(t),this.equip_slot="off-hand",this.offhand_type="shield",!u[t.components.shield_base])throw new Error(`No such shield base component as: ${t.components.shield_base}`);if(this.components.shield_base=t.components.shield_base,t.components.handle&&!u[t.components.handle])throw new Error(`No such shield handle component as: ${t.components.handle}`);this.components.handle=t.components.handle,this.tags.shield=!0,this.id||(this.id=this.getName()),this.market_saturation_group={group_key:$e+"shield",group_tier:this.getItemTier()-1}}getShieldStrength(t){return t?this.calculateShieldStrength(t):(this.shield_strength||(this.shield_strength=this.calculateShieldStrength(this.quality)),this.shield_strength)}calculateShieldStrength(t){return Math.round(10*Math.ceil(u[this.components.shield_base].shield_strength*(u[this.components.handle].component_stats?.block_strength?.multiplier||1)*(t/100)*ke[this.getRarity(t)]))/10}getName(){return u[this.components.shield_base].shield_name}},Q=class extends li{constructor(t){if(super(t),t.components){if(!u[t.components.internal])throw new Error(`No such internal armor element as: ${t.components.internal}`);if(this.components.internal=t.components.internal,this.components.external=t.components.external,u[this.components.internal].component_type==="helmet interior")this.equip_slot="head";else if(u[this.components.internal].component_type==="chestplate interior")this.equip_slot="torso";else if(u[this.components.internal].component_type==="leg armor interior")this.equip_slot="legs";else if(u[this.components.internal].component_type==="glove interior")this.equip_slot="arms";else if(u[this.components.internal].component_type==="shoes interior")this.equip_slot="feet";else throw new Error(`Component type "${u[this.components.internal].component_type}" doesn't correspond to any armor slot!`);if(t.external&&!u[t.external])throw new Error(`No such external armor element as: ${t.components.external}`);this.market_saturation_group={group_key:$e+"armor",group_tier:this.getItemTier()-1}}else{if(this.tags.component=!0,this.tags["armor component"]=!0,this.tags.clothing=!0,this.component_stats=t.component_stats||{},delete this.components,!t.name)throw new Error("Component-less item needs to be provided a name!");if(this.name=t.name,!t.value)throw new Error(`Component-less item "${this.getName()}" needs to be provided a monetary value!`);if(this.component_type=t.component_type,this.value=t.value,this.component_tier=t.component_tier||1,this.base_defense=t.base_defense,this.market_saturation_group={group_key:$e+"clothing",group_tier:this.getItemTier()-1},t.component_type==="helmet interior")this.equip_slot="head";else if(t.component_type==="chestplate interior")this.equip_slot="torso";else if(t.component_type==="leg armor interior")this.equip_slot="legs";else if(t.component_type==="glove interior")this.equip_slot="arms";else if(t.component_type==="shoes interior")this.equip_slot="feet";else throw new Error(`Component type "${t.component_type}" doesn't correspond to any armor slot!`)}this.tags.armor=!0,this.id||(this.id=this.getName())}getDefense(t){return t?this.calculateDefense(t):(this.defense_value||(this.defense_value=this.calculateDefense(this.quality)),this.defense_value)}calculateDefense(t){return this.components?Math.ceil(((u[this.components.internal].defense_value||u[this.components.internal].base_defense||0)+(u[this.components.external]?.defense_value||0))*(t/100||this.quality/100)*ke[this.getRarity(t||this.quality)]):Math.ceil((this.base_defense||0)*(t/100||this.quality/100)*ke[this.getRarity(t||this.quality)])}getName(){return this.name||(this.components.external?u[this.components.external].full_armor_name?this.name=u[this.components.external].full_armor_name:this.name=(u[this.components.external].name_prefix||"")+" "+u[this.components.internal].armor_name.toLowerCase()+" "+(u[this.components.external].name_suffix||""):this.name=u[this.components.internal].armor_name),this.name}},pe=class extends li{constructor(t){if(super(t),this.equip_slot="weapon",!u[t.components.head])throw new Error(`No such weapon head as: ${t.components.head}`);if(this.components.head=t.components.head,!u[t.components.handle])throw new Error(`No such weapon handle as: ${t.components.handle}`);if(this.components.handle=t.components.handle,u[this.components.handle].component_type==="long handle"&&(u[this.components.head].component_type==="short blade"||u[this.components.head].component_type==="long blade"))this.weapon_type="spear";else if(u[this.components.handle].component_type==="medium handle"&&u[this.components.head].component_type==="axe head")this.weapon_type="axe";else if(u[this.components.handle].component_type==="medium handle"&&u[this.components.head].component_type==="hammer head")this.weapon_type="hammer";else if(u[this.components.handle].component_type==="short handle"&&u[this.components.head].component_type==="short blade")this.weapon_type="dagger";else if(u[this.components.handle].component_type==="short handle"&&u[this.components.head].component_type==="long blade")this.weapon_type="sword";else throw new Error(`Combination of elements of types ${u[this.components.handle].component_type} and ${u[this.components.head].component_type} does not exist!`);this.tags.weapon=!0,this.tags[this.weapon_type]=!0,this.id||(this.id=this.getName()),this.market_saturation_group={group_key:$e+"weapon",group_tier:this.getItemTier()-1}}getAttack(t){return t?this.calculateAttackPower(t):(this.attack_power||(this.attack_power=this.calculateAttackPower(this.quality)),this.attack_power)}calculateAttackPower(t){return Math.ceil((u[this.components.head].attack_value+u[this.components.handle].attack_value+(u[this.components.handle].component_stats?.attack_power?.flat||0))*u[this.components.head].attack_multiplier*u[this.components.handle].attack_multiplier*(u[this.components.handle].component_stats?.attack_power?.multiplier||1)*(t/100)*ke[this.getRarity(t)])}getName(){return`${u[this.components.head].name_prefix} ${this.weapon_type==="hammer"?"battle hammer":this.weapon_type}`}},Bt=class extends li{constructor(t){if(super(t),this.components=void 0,this.equip_slot="cape",this.base_stats=t.base_stats,this.item_tier=t.item_tier,this.tags.cape=!0,!t.name)throw new Error("Component-less item needs to be provided a name!");if(this.name=t.name,!t.value)throw new Error(`Component-less item "${this.getName()}" needs to be provided a monetary value!`);this.value=t.value,this.base_defense=t.base_defense,this.id||(this.id=this.getName()),this.market_saturation_group={group_key:$e+"cape",group_tier:this.getItemTier()-1}}getDefense(t){return t?this.calculateDefense(t):(this.defense_value||(this.defense_value=this.calculateDefense(this.quality)),this.defense_value)}calculateDefense(t){return Math.ceil((this.base_defense||0)*(t/100||this.quality/100)*ke[this.getRarity(t||this.quality)])}},ls=class extends li{constructor(t){super(t),this.equip_slot="amulet",this.stats=t.stats,this.ignore_quality=!0,this.tags.amulet=!0,this.id||(this.id=this.getName())}getStats(){return this.stats}},ri=class{constructor({required_time:t=1,required_skills:i={literacy:0},literacy_xp_rate:n=1,finish_reward:s={},bonuses:a={},rewards:o={}}){this.required_time=t,this.accumulated_time=0,this.required_skills=i,this.literacy_xp_rate=n,this.finish_reward=s,this.is_finished=!1,this.bonuses=a,this.rewards=o}},F={},Gt=class extends tn{constructor(t){super(t),this.item_type="BOOK",this.name=t.name,this.tags.book=!0,this.saturates_market=!1}getReadingTime(){let{required_time:t}=F[this.name];return t}getRemainingTime(){return Math.max(F[this.name].required_time-F[this.name].accumulated_time,0)}addProgress(t=1){F[this.name].accumulated_time+=t,F[this.name].accumulated_time>=F[this.name].required_time&&this.setAsFinished()}setAsFinished(){F[this.name].is_finished=!0,F[this.name].accumulated_time=F[this.name].required_time}};function de(e){switch(e.item_type){case"EQUIPPABLE":switch(e.equip_slot){case"weapon":return new pe(e);case"off-hand":return new nt(e);case"artifact":return new en(e);case"axe":case"pickaxe":case"sickle":case"shovel":return new It(e);case"cape":return new Bt(e);case"amulet":return new ls(e);default:return new Q(e)}case"USABLE":return new xe(e);case"BOOK":return new Gt(e);case"OTHER":return new ht(e);case"COMPONENT":if(e.tags["weapon component"])return new V(e);if(e.tags["armor component"])return new ae(e);if(e.tags["shield component"])return new Qe(e);throw new Error(`Item ${e.name} has a wrong component type`);case"MATERIAL":return new B(e);default:throw new Error(`Wrong item type: ${e.item_type}`)}}function ye(e){let{id:t,components:i,quality:n}=JSON.parse(e);if(t&&!n){if(u[t])return de(u[t]);throw new Error(`Inventory item "${e}" couldn't be found!`)}else if(i){let{head:s,handle:a,shield_base:o,internal:r,external:d}=i;if(s)if(u[s]){if(u[a])return de({components:i,quality:n,equip_slot:"weapon",item_type:"EQUIPPABLE"});throw new Error(`Weapon handle component "${a}" couldn't be found!`)}else throw new Error(`Weapon head component "${s}" couldn't be found!`);else if(o)if(u[o]){if(u[a])return de({components:i,quality:n,equip_slot:"off-hand",item_type:"EQUIPPABLE"});throw new Error(`Shield handle component "${a}" couldn't be found!`)}else throw new Error(`Shield base component "${o}" couldn't be found!`);else if(r)if(u[r])if(u[d]){let c=sa(r);return c?de({components:i,quality:n,equip_slot:c,item_type:"EQUIPPABLE"}):void 0}else throw new Error(`External armor component "${d}" couldn't be found!`);else throw new Error(`Internal armor component "${r}" couldn't be found!`);else throw new Error(`Inventory key "${e}" seems to refer to non-existing item type!`)}else{if(n)return de({...u[t],quality:n});throw new Error(`Inventory key "${e}" is incorrect!`)}}F["ABC for kids"]=new ri({required_time:120,literacy_xp_rate:1,bonuses:{xp_multipliers:{all:1.1}}});F["Old combat manual"]=new ri({required_time:320,literacy_xp_rate:1,bonuses:{xp_multipliers:{Combat:1.2}}});F["Twist liek a snek"]=new ri({required_time:320,literacy_xp_rate:1,bonuses:{xp_multipliers:{Evasion:1.2},multipliers:{agility:1.1}}});F["Medicine for dummies"]=new ri({required_time:420,literacy_xp_rate:2,rewards:{recipes:[{category:"alchemy",subcategory:"items",recipe_id:"Weak healing powder"},{category:"alchemy",subcategory:"items",recipe_id:"Healing balm"},{category:"alchemy",subcategory:"items",recipe_id:"Oneberry juice"},{category:"alchemy",subcategory:"items",recipe_id:"Healing powder"},{category:"alchemy",subcategory:"items",recipe_id:"Healing potion"}]},bonuses:{xp_multipliers:{Medicine:1.2}}});F["Butchering and you"]=new ri({required_time:240,literacy_xp_rate:2,rewards:{skills:["Butchering"],recipes:[{category:"cooking",subcategory:"items",recipe_id:"Animal fat"}]}});F["Ode to Whimsy, and other poems"]=new ri({required_time:120,literacy_xp_rate:4,bonuses:{xp_multipliers:{all:1.1}}});F["A Glint On The Sand"]=new ri({required_time:420,literacy_xp_rate:4,rewards:{recipes:[{category:"alchemy",subcategory:"items",recipe_id:"Potash"},{category:"smelting",subcategory:"items",recipe_id:"Raw Glass"},{category:"crafting",subcategory:"items",recipe_id:"Glass phial"},{category:"crafting",subcategory:"items",recipe_id:"Glass bottle"}],activities:[{location:"Village",activity:"sand"}]}});u["ABC for kids"]=new Gt({name:"ABC for kids",description:"The simplest book on the market",value:100}),u["Old combat manual"]=new Gt({name:"Old combat manual",description:"Old book about combat, worn and outdated, but might still contain something useful",value:200}),u["Twist liek a snek"]=new Gt({name:"Twist liek a snek",description:"This book has a terrible grammar, seemingly written by some uneducated bandit, but despite that it quite well details how to properly evade attacks.",value:200}),u["Medicine for dummies"]=new Gt({name:"Medicine for dummies",description:"A simple book about healing, describing how to create some basic medicines.",value:320}),u["Butchering and you"]=new Gt({name:"Butchering and you",description:"An introductory book to animal butchering, that goes into further detail on how to make a use of animal parts, especially hides and bones.",value:240}),u["Ode to Whimsy, and other poems"]=new Gt({name:"Ode to Whimsy, and other poems",description:"A short and wonderful book of poetry that fills one with appreciation for life",value:200}),u["A Glint On The Sand"]=new Gt({id:"A Glint On The Sand",name:"A Glint On The Sand",description:"This books recounts a tale of shipwrecked crew accidentally discovering glassmaking while cooking on a beach. More importantly, it details the processees and materials necessary to manufacture glass.",value:300});(function(){u["Rat fang"]=new ht({name:"Rat fang",description:"Fang of a huge rat, not very sharp, but can still pierce a human skin if enough force is applied",value:8,material_type:"animal tooth"}),u["Wolf fang"]=new ht({name:"Wolf fang",description:"Fang of a wild wolf. Somewhat sharp, still not very useful. Maybe if it had a bit better quality...",value:12,material_type:"animal tooth"}),u["Boar tusk"]=new B({name:"Boar tusk",description:"Tusk of a wild boar. Visibly worn and not very sharp.",value:20}),u["Rat meat chunks"]=new ht({name:"Rat meat chunks",description:"Eww",value:8}),u["Glass phial"]=new ht({name:"Glass phial",description:"Small glass phial, a perfect container for a potion",value:10}),u["Glass bottle"]=new ht({name:"Glass bottle",description:"A glass bottle, perfect for carrying a drink around",value:20}),u["Camping supplies"]=new ht({name:"Camping supplies",description:"Bedroll, tent, small chest, and generally just anything that could be needed to establish a camp",value:2e3}),u["Coil of rope"]=new ht({name:"Coil of rope",description:"A nice, long coil of rope, for whatever use you might find",value:400}),u["Mountain goat horn"]=new ht({name:"Mountain goat horn",description:"A curved and sturdy horn of a mountain goat. While not very useful in itself, it makes for a nice decoration.",value:30})})();(function(){u["Rat tail"]=new B({name:"Rat tail",description:"Tail of a huge rat. Doesn't seem very useful, but maybe some meat could be recovered from it",value:4}),u["Rat pelt"]=new B({name:"Rat pelt",description:"Pelt of a huge rat. Fur has terrible quality, but maybe leather could be used for something if you gather more?",value:10,material_type:"pelt"}),u["High quality wolf fang"]=new B({name:"High quality wolf fang",description:"Fang of a wild wolf. Very sharp, undamaged and surprisingly clean.",value:15,material_type:"miscellaneous"}),u["Wolf pelt"]=new B({name:"Wolf pelt",description:"Pelt of a wild wolf. It's a bit damaged so it won't fetch a great price, but the leather itself could be useful.",value:20,material_type:"pelt"}),u["Boar hide"]=new B({name:"Boar hide",description:"Thick hide of a wild boar. Too stiff for clothing, but might be useful for an armor",value:30,material_type:"pelt"}),u["Boar meat"]=new B({name:"Boar meat",description:"Fatty meat of a wild boar, all it needs is to be cooked.",value:20}),u["High quality boar tusk"]=new B({name:"High quality boar tusk",description:"Tusk of a wild boar. Sharp and long enough to easily kill an adult human",value:25,material_type:"miscellaneous"}),u["Bear hide"]=new B({description:"A strong hide of a wild bear, so strong that even steel struggles against it.",value:50,material_type:"pelt"}),u["Bear claw"]=new B({description:"Large and dangerous claw of a wild bear, but it has seen better days.",value:50}),u["Sharp bear claw"]=new B({description:"Large and dangerous of a wild bear, sharp enough to easily cut through meat",value:80,material_type:"miscellaneous"}),u["Weak monster bone"]=new B({name:"Weak monster bone",description:"Mutated and dark bone of a monster. While on the weaker side, it's still very strong and should be useful for crafting after some processing",value:30,material_type:"bone"}),u["Goat meat"]=new B({name:"Goat meat",description:"Lean meat of a goat, it's pretty tough and needs to be cooked for a long time.",value:25}),u["Mountain goat hide"]=new B({name:"Mountain goat hide",description:"Thick hide of a mountain goat hide. Not as strong as boar hide, but this one can actually be turned into clothes after some processing.",value:30,material_type:"pelt"}),u["Pristine mountain goat horn"]=new B({name:"Pristine mountain goat horn",description:"Curved and sturdy horn of a mountain goat. It's noticeably bigger than average and seems to be even sturdier.",value:70,material_type:"miscellaneous"})})();(function(){u["Low quality iron ore"]=new B({name:"Low quality iron ore",description:"Iron content is rather low and there are a lot of problematic components that can't be fully removed, which will affect created materials.",value:3,material_type:"raw metal"}),u["Iron ore"]=new B({name:"Iron ore",description:"It has a decent iron content and can be smelt into market-quality iron.",value:5,material_type:"raw metal"}),u["Atratan ore"]=new B({name:"Atratan ore",description:"A dark-colored ore that's useless by itself but can be mixed with iron to create steel.",value:6,material_type:"raw metal"}),u.Coal=new B({name:"Coal",description:"A flammable material with extremely high carbon content.",value:7,material_type:"coal"}),u.Charcoal=new B({name:"Charcoal",description:"A flammable material with extremely high carbon content, created by strongly heating wood.",value:5,material_type:"coal"}),u["Piece of rough wood"]=new B({description:"Cheapest form of wood. There's a lot of bark and malformed pieces.",value:2,material_type:"raw wood",getName:()=>Oi()?"Piece of rat wood":"Piece of rough wood"}),u["Piece of wood"]=new B({description:"Average quality wood. There's a lot of bark and malformed pieces.",value:4,material_type:"raw wood"}),u["Piece of ash wood"]=new B({description:"Strong yet elastic, it's best wood you can hope to find around. There's a lot of bark and malformed pieces.",value:7,material_type:"raw wood"}),u["Belmart leaf"]=new B({description:"Small, round, dark-green leaves with with very good disinfectant properties",value:8,material_type:"disinfectant herb"}),u["Golmoon leaf"]=new B({description:"Big green-brown leaves that can be applied to wounds to speed up their healing",value:8,material_type:"healing herb"}),u.Oneberry=new B({description:"Small blue berries capable of stimulating body's natural healing",value:8,material_type:"healing herb"}),u["Silver thistle"]=new B({description:"Rare herb that usually grows high up in mountains, a potent healing ingredient",value:20,material_type:"healing herb"}),u["Cooking herbs"]=new B({name:"Parsley, Sage, Rosemary and Thyme",description:"A collection of various herbs commonly used to enhance the flavour and nutrition of dishes.",value:10,material_type:"culinary herb"}),u.Wool=new B({description:"A handful of wool, raw and unprocessed",value:8,material_type:"raw fabric"}),u["Silica Sand"]=new B({description:"Sand made potent by the remains of countless generations of creatures that lived and died in the body of water it was taken from.",value:1})})();(function(){u.Bonemeal=new B({description:"Powdered bones and teeth, that can be used as an organic fertilizer.",value:100}),u["Low quality iron ingot"]=new B({description:"It has a lot of impurities, resulting in it being noticeably below the market standard",value:10,material_type:"metal"}),u["Iron ingot"]=new B({description:"It doesn't suffer from any excessive impurities and can be used without worries.",value:20,material_type:"metal"}),u["Steel ingot"]=new B({description:"Basic alloy of iron, harder and more resistant.",value:40,material_type:"metal"}),u["Piece of wolf rat leather"]=new B({description:"It's slightly damaged and seems useless for anything that requires precise work.",value:10,material_type:"piece of leather"}),u["Processed rat pelt"]=new B({description:"Processed pelt of a huge rat. It's of a barely acceptable quality, but it's still a miracle with how terrible the basic material was.",value:20,material_type:"processed pelt"}),u["Piece of wolf leather"]=new B({description:"Somewhat strong, should offer some protection when turned into armor",value:20,material_type:"piece of leather"}),u["Processed wolf pelt"]=new B({description:"Processed pelt of a wild wolf. It's a nice, stylish material.",value:40,material_type:"processed pelt"}),u["Piece of boar leather"]=new B({description:"Thick and resistant leather, too stiff for clothes but perfect for armor",value:30,material_type:"piece of leather"}),u["Processed boar hide"]=new B({description:"Processed hide of a wild boar. It's a rough, heavy material, but it's quite strong.",value:60,material_type:"processed pelt"}),u["Piece of goat leather"]=new B({description:"Thick and resistant, just barely elastic enough to be used for clothing",value:40,material_type:"piece of leather"}),u["Processed goat hide"]=new B({description:"Processed hide of a wild goat. It's a rough and resistant material.",value:80,material_type:"processed pelt"}),u["Piece of bear leather"]=new B({description:"Strong and resistant, but too thick for clothing",value:60,material_type:"piece of leather"}),u["Processed bear hide"]=new B({description:"Strong and resistant, but too thick for clothing",value:120,material_type:"piece of leather"}),u["Animal fat"]=new B({description:"White, thick, oily substance, rendered from animal tissue.",value:40,material_type:"fat"}),u["Wool cloth"]=new B({description:"Thick and warm, might possibly absorb some punches",value:8,material_type:"fabric"}),u["Iron chainmail"]=new B({description:"Dozens of tiny iron rings linked together. Nowhere near a wearable form, turning it into armor will still take a lot of effort and focus",value:12,material_type:"chainmail"}),u["Steel chainmail"]=new B({description:"Dozens of tiny steel rings linked together. Nowhere near a wearable form, turning it into armor will still take a lot of effort and focus",value:18,material_type:"chainmail"}),u["Scraps of wolf rat meat"]=new B({description:"Ignoring where they come from and all the attached diseases, they actually look edible. Just remember to cook it first.",value:8,material_type:"meat"}),u["Processed rough wood"]=new B({description:"Cheapest form of wood, ready to be used. Despite being rather weak, it still has a lot of uses.",value:6,material_type:"wood"}),u["Processed wood"]=new B({description:"Average quality wood, ready to be used.",value:11,material_type:"wood"}),u["Processed ash wood"]=new B({description:"High quality wood, just waiting to be turned into a piece of equipment.",value:20,material_type:"wood"}),u["Processed weak monster bone"]=new B({description:"Polished and cleaned bones of a weak monster, just waiting to be turned into a piece of equipment.",value:40,material_type:"bone"}),u.Potash=new B({description:"An alchemical substance derived from plant ash, sought after for production of bleach, soap and glass.",value:25}),u["Raw Glass"]=new B({description:"Molten piece of glass, yet to be shaped into something useful.",value:100})})();(function(){u["Basic spare parts"]=new ht({name:"Basic spare parts",description:"Some cheap and simple spare parts, like bindings and screws, necessary for crafting equipment",value:30,component_tier:1})})();(function(){u["Cheap short iron blade"]=new V({name:"Cheap short iron blade",description:"Crude blade made of iron. Perfect length for a dagger, but could be also used for a spear",component_type:"short blade",value:70,component_tier:1,name_prefix:"Cheap iron",attack_value:5,component_stats:{crit_rate:{flat:.06},attack_speed:{multiplier:1.2},evasion_points:{multiplier:1.05}}}),u["Short iron blade"]=new V({name:"Short iron blade",description:"A good iron blade. Perfect length for a dagger, but could be also used for a spear",component_type:"short blade",value:160,component_tier:2,name_prefix:"Iron",attack_value:8,component_stats:{crit_rate:{flat:.08},attack_speed:{multiplier:1.3},evasion_points:{multiplier:1.13}}}),u["Short steel blade"]=new V({name:"Short steel blade",description:"A good steel blade. Perfect length for a dagger, but could be also used for a spear",component_type:"short blade",value:240,component_tier:3,name_prefix:"Steel",attack_value:11,component_stats:{crit_rate:{flat:.1},attack_speed:{multiplier:1.35},evasion_points:{multiplier:1.2}}}),u["Cheap long iron blade"]=new V({name:"Cheap long iron blade",description:"Crude blade made of iron, with a perfect length for a sword",component_type:"long blade",value:100,name_prefix:"Cheap iron",component_tier:1,attack_value:8,component_stats:{attack_speed:{multiplier:1.1},crit_rate:{flat:.02},attack_points:{multiplier:1.05}}}),u["Long iron blade"]=new V({name:"Long iron blade",description:"Good blade made of iron, with a perfect length for a sword",component_type:"long blade",value:210,name_prefix:"Iron",component_tier:2,attack_value:13,component_stats:{attack_speed:{multiplier:1.15},crit_rate:{flat:.04},attack_points:{multiplier:1.13}}}),u["Long steel blade"]=new V({name:"Long steel blade",description:"Good blade made of steel, with a perfect length for a sword",component_type:"long blade",value:310,name_prefix:"Steel",component_tier:3,attack_value:18,component_stats:{attack_speed:{multiplier:1.2},crit_rate:{flat:.05},attack_points:{multiplier:1.2}}}),u["Cheap iron axe head"]=new V({name:"Cheap iron axe head",description:"A heavy axe head made of low quality iron",component_type:"axe head",value:100,name_prefix:"Cheap iron",component_tier:1,attack_value:10,component_stats:{attack_speed:{multiplier:.9}}}),u["Iron axe head"]=new V({name:"Iron axe head",description:"A heavy axe head made of steel",component_type:"axe head",value:210,name_prefix:"Iron",component_tier:2,attack_value:16,component_stats:{attack_speed:{multiplier:.95}}}),u["Steel axe head"]=new V({name:"Steel axe head",description:"A heavy axe head made of steel",component_type:"axe head",value:310,name_prefix:"Steel",component_tier:3,attack_value:22}),u["Cheap iron hammer head"]=new V({name:"Cheap iron hammer head",description:"A crude ball made of low quality iron, with a small hole for the handle",component_type:"hammer head",value:100,name_prefix:"Cheap iron",component_tier:1,attack_value:12,component_stats:{attack_speed:{multiplier:.8}}}),u["Iron hammer head"]=new V({name:"Iron hammer head",description:"A crude ball made of iron, with a small hole for the handle",component_type:"hammer head",value:210,name_prefix:"Iron",component_tier:2,attack_value:19,component_stats:{attack_speed:{multiplier:.85}}}),u["Steel hammer head"]=new V({name:"Steel hammer head",description:"A blocky piece of steel, with a small hole for the handle",component_type:"hammer head",value:300,name_prefix:"Steel",component_tier:3,attack_value:26,component_stats:{attack_speed:{multiplier:.9}}}),u["Simple short wooden hilt"]=new V({name:"Simple short wooden hilt",description:"A short handle for a sword or maybe a dagger",component_type:"short handle",value:8,component_tier:1}),u["Short wooden hilt"]=new V({name:"Short wooden hilt",description:"A short handle for a sword or maybe a dagger",component_type:"short handle",value:32,component_tier:2,component_stats:{attack_speed:{multiplier:1.05}}}),u["Short ash wood hilt"]=new V({name:"Short ash wood hilt",description:"A short handle for a sword or maybe a dagger",component_type:"short handle",value:48,component_tier:3,component_stats:{attack_speed:{multiplier:1.1}}}),u["Simple medium wooden handle"]=new V({name:"Simple medium wooden handle",description:"A medium handle for an axe or a hammer",component_type:"medium handle",value:16,component_tier:1,component_stats:{attack_speed:{multiplier:.95}}}),u["Medium wooden handle"]=new V({name:"Medium wooden handle",description:"A medium handle for an axe or a hammer",component_type:"medium handle",value:64,component_tier:2}),u["Medium ash wood handle"]=new V({name:"Medium ash wood handle",description:"A medium handle for an axe or a hammer",component_type:"medium handle",value:96,component_tier:3,component_stats:{attack_speed:{multiplier:1.05}}}),u["Simple long wooden shaft"]=new V({name:"Simple long wooden shaft",description:"A long shaft for a spear, somewhat uneven",component_type:"long handle",value:24,component_tier:1,component_stats:{attack_speed:{multiplier:.9}}}),u["Long wooden shaft"]=new V({name:"Long wooden shaft",description:"A long shaft for a spear, somewhat uneven",component_type:"long handle",value:100,component_tier:2,component_stats:{attack_speed:{multiplier:.95}}}),u["Long ash wood shaft"]=new V({name:"Long ash wood shaft",description:"A long shaft for a spear.",component_type:"long handle",value:150,component_tier:3}),u["Cheap short iron hilt"]=new V({name:"Cheap short iron hilt",description:"A short handle for a sword or maybe a dagger, heavy",component_type:"short handle",value:56,component_tier:1,component_stats:{attack_speed:{multiplier:.9},attack_power:{multiplier:1.05}}}),u["Short iron hilt"]=new V({name:"Short iron hilt",description:"A short handle for a sword or maybe a dagger, heavy",component_type:"short handle",value:80,component_tier:2,component_stats:{attack_power:{multiplier:1.05}}}),u["Short steel hilt"]=new V({name:"Short steel hilt",description:"A short handle for a sword or maybe a dagger, heavy",component_type:"short handle",value:120,component_tier:3,component_stats:{attack_power:{multiplier:1.1}}}),u["Cheap medium iron handle"]=new V({name:"Cheap medium iron handle",description:"A medium handle for an axe or a hammer, very heavy",component_type:"medium handle",value:64,component_tier:1,component_stats:{attack_speed:{multiplier:.7},attack_power:{multiplier:1.2}}}),u["Medium iron handle"]=new V({name:"Medium iron handle",description:"A medium handle for an axe or a hammer, very heavy",component_type:"medium handle",value:100,component_tier:2,component_stats:{attack_speed:{multiplier:.8},attack_power:{multiplier:1.2}}}),u["Medium steel handle"]=new V({name:"Medium steel handle",description:"A medium handle for an axe or a hammer, very heavy",component_type:"medium handle",value:150,component_tier:3,component_stats:{attack_speed:{multiplier:.8},attack_power:{multiplier:1.27}}}),u["Cheap long iron shaft"]=new V({name:"Cheap long iron shaft",description:"A long shaft for a spear, extremely heavy",component_type:"long handle",value:92,component_tier:1,component_stats:{attack_speed:{multiplier:.5},attack_power:{multiplier:1.6}}}),u["Long iron shaft"]=new V({name:"Long iron shaft",description:"A long shaft for a spear,  extremely heavy",component_type:"long handle",value:128,component_tier:2,component_stats:{attack_speed:{multiplier:.6},attack_power:{multiplier:1.6}}}),u["Long steel shaft"]=new V({name:"Long steel shaft",description:"A long shaft for a spear, extremely heavy",component_type:"long handle",value:192,component_tier:3,component_stats:{attack_speed:{multiplier:.6},attack_power:{multiplier:1.75}}}),u["Short weak bone hilt"]=new V({name:"Short weak bone hilt",description:"A short handle for a sword or maybe a dagger, made of a weak monster's bone",component_type:"short handle",value:120,component_tier:3,component_stats:{attack_power:{multiplier:1.05},attack_speed:{multiplier:1.05}}}),u["Medium weak bone handle"]=new V({name:"Medium weak bone handle",description:"A medium handle for an axe or a hammer, made of a weak monster's bone",component_type:"medium handle",value:150,component_tier:3,component_stats:{attack_speed:{multiplier:.95},attack_power:{multiplier:1.1}}}),u["Long weak bone shaft"]=new V({name:"Long weak bone shaft",description:"A long shaft for a spear, made of weak monster's bone",component_type:"long handle",value:192,component_tier:3,component_stats:{attack_speed:{multiplier:.8},attack_power:{multiplier:1.5}}})})();(function(){u["Cheap iron spear"]=new pe({components:{head:"Cheap short iron blade",handle:"Simple long wooden shaft"}}),u["Iron spear"]=new pe({components:{head:"Short iron blade",handle:"Simple long wooden shaft"}}),u["Steel spear"]=new pe({components:{head:"Short steel blade",handle:"Long wooden shaft"}}),u["Cheap iron dagger"]=new pe({components:{head:"Cheap short iron blade",handle:"Simple short wooden hilt"}}),u["Iron dagger"]=new pe({components:{head:"Short iron blade",handle:"Simple short wooden hilt"}}),u["Steel dagger"]=new pe({components:{head:"Short steel blade",handle:"Short wooden hilt"}}),u["Cheap iron sword"]=new pe({components:{head:"Cheap long iron blade",handle:"Simple short wooden hilt"}}),u["Iron sword"]=new pe({components:{head:"Long iron blade",handle:"Simple short wooden hilt"}}),u["Steel sword"]=new pe({components:{head:"Long steel blade",handle:"Short wooden hilt"}}),u["Cheap iron axe"]=new pe({components:{head:"Cheap iron axe head",handle:"Simple medium wooden handle"}}),u["Iron axe"]=new pe({components:{head:"Iron axe head",handle:"Simple medium wooden handle"}}),u["Steel axe"]=new pe({components:{head:"Steel axe head",handle:"Medium wooden handle"}}),u["Cheap iron battle hammer"]=new pe({components:{head:"Cheap iron hammer head",handle:"Simple medium wooden handle"}}),u["Iron battle hammer"]=new pe({components:{head:"Iron hammer head",handle:"Simple medium wooden handle"}}),u["Steel battle hammer"]=new pe({components:{head:"Steel hammer head",handle:"Medium wooden handle"}})})();(function(){u["Wolf leather helmet armor"]=new ae({name:"Wolf leather helmet armor",description:"Strenghtened wolf leather, ready to be used as a part of a helmet",component_type:"helmet exterior",value:240,component_tier:2,full_armor_name:"Wolf leather helmet",defense_value:2,component_stats:{agility:{multiplier:.95}}}),u["Boar leather helmet armor"]=new ae({name:"Boar leather helmet armor",description:"Strong boar leather, ready to be used as a part of a helmet",component_type:"helmet exterior",value:400,component_tier:3,full_armor_name:"Boar leather helmet",defense_value:3,component_stats:{agility:{multiplier:.95}}}),u["Bear leather helmet armor"]=new ae({name:"Bear leather helmet armor",description:"Strong bear leather, ready to be used as a part of a helmet",component_type:"helmet exterior",value:600,component_tier:4,full_armor_name:"Bear leather helmet",defense_value:4,component_stats:{agility:{multiplier:.95}}}),u["Wolf leather chestplate armor"]=new ae({id:"Wolf leather chestplate armor",name:"Wolf leather cuirass",description:"Simple cuirass made of solid wolf leather, all it needs now is something softer to wear under it.",component_type:"chestplate exterior",value:480,component_tier:2,full_armor_name:"Wolf leather armor",defense_value:4,component_stats:{agility:{multiplier:.95}}}),u["Boar leather chestplate armor"]=new ae({id:"Boar leather chestplate armor",name:"Boar leather cuirass",description:"Strong cuirass made of boar leather.",component_type:"chestplate exterior",value:800,component_tier:3,full_armor_name:"Boar leather armor",defense_value:6,component_stats:{agility:{multiplier:.95}}}),u["Bear leather chestplate armor"]=new ae({id:"Bear leather chestplate armor",name:"Bear leather cuirass",description:"Strong cuirass made of bear leather.",component_type:"chestplate exterior",value:1e3,component_tier:4,full_armor_name:"Bear leather armor",defense_value:8,component_stats:{agility:{multiplier:.95}}}),u["Wolf leather greaves"]=new ae({name:"Wolf leather greaves",description:"Greaves made of wolf leather. Just attach them onto some pants and you are ready to go.",component_type:"leg armor exterior",value:240,component_tier:2,full_armor_name:"Wolf leather armored pants",defense_value:2,component_stats:{agility:{multiplier:.95}}}),u["Boar leather greaves"]=new ae({name:"Boar leather greaves",description:"Greaves made of thick boar leather. Just attach them onto some pants and you are ready to go.",component_type:"leg armor exterior",value:400,component_tier:3,full_armor_name:"Boar leather armored pants",defense_value:3,component_stats:{agility:{multiplier:.95}}}),u["Bear leather greaves"]=new ae({name:"Bear leather greaves",description:"Greaves made of thick bear leather. Just attach them onto some pants and you are ready to go.",component_type:"leg armor exterior",value:600,component_tier:4,full_armor_name:"Bear leather armored pants",defense_value:4,component_stats:{agility:{multiplier:.95}}}),u["Wolf leather glove armor"]=new ae({name:"Wolf leather glove armor",description:"Pieces of wolf leather shaped for gloves.",component_type:"glove exterior",value:240,component_tier:2,full_armor_name:"Wolf leather gloves",defense_value:2}),u["Boar leather glove armor"]=new ae({name:"Boar leather glove armor",description:"Pieces of boar leather shaped for gloves.",component_type:"glove exterior",value:400,component_tier:3,full_armor_name:"Boar leather gloves",defense_value:3}),u["Bear leather glove armor"]=new ae({name:"Bear leather glove armor",description:"Pieces of bear leather shaped for gloves.",component_type:"glove exterior",value:600,component_tier:4,full_armor_name:"Bear leather gloves",defense_value:4}),u["Wolf leather shoe armor"]=new ae({name:"Wolf leather shoe armor",description:"Pieces of wolf leather shaped for shoes.",component_type:"shoes exterior",value:240,component_tier:2,full_armor_name:"Wolf leather shoes",defense_value:2}),u["Boar leather shoe armor"]=new ae({name:"Boar leather shoe armor",description:"Pieces of boar leather shaped for shoes.",component_type:"shoes exterior",value:400,component_tier:3,full_armor_name:"Boar leather shoes",defense_value:3}),u["Bear leather shoe armor"]=new ae({name:"Bear leather shoe armor",description:"Pieces of bear leather shaped for shoes.",component_type:"shoes exterior",value:600,component_tier:4,full_armor_name:"Bear leather shoes",defense_value:4}),u["Iron chainmail helmet armor"]=new ae({name:"Iron chainmail helmet armor",description:"Best way to keep your head in one piece",component_type:"helmet exterior",value:320,component_tier:2,full_armor_name:"Iron chainmail helmet",defense_value:4,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),u["Steel chainmail helmet armor"]=new ae({name:"Steel chainmail helmet armor",description:"Best way to keep your head in one piece",component_type:"helmet exterior",value:480,component_tier:3,full_armor_name:"Steel chainmail helmet",defense_value:6,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),u["Iron chainmail vest"]=new ae({name:"Iron chainmail vest",description:"Basic iron chainmail. Nowhere near as strong as a plate armor",component_type:"chestplate exterior",value:640,component_tier:2,full_armor_name:"Iron chainmail armor",defense_value:8,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),u["Steel chainmail vest"]=new ae({name:"Steel chainmail vest",description:"Basic steel chainmail. Nowhere near as strong as a plate armor",component_type:"chestplate exterior",value:960,component_tier:3,full_armor_name:"Steel chainmail armor",defense_value:11,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),u["Iron chainmail greaves"]=new ae({name:"Iron chainmail greaves",description:"Greaves made of iron chainmail. Just attach them onto some pants and you are ready to go.",component_type:"leg armor exterior",value:320,component_tier:2,full_armor_name:"Iron chainmail pants",defense_value:4,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),u["Steel chainmail greaves"]=new ae({name:"Steel chainmail greaves",description:"Greaves made of steel chainmail. Just attach them onto some pants and you are ready to go.",component_type:"leg armor exterior",value:480,component_tier:3,full_armor_name:"Steel chainmail pants",defense_value:6,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),u["Iron chainmail glove"]=new ae({name:"Iron chainmail glove",description:"Iron chainmail in a form ready to be applied onto a glove.",component_type:"glove exterior",value:320,component_tier:2,full_armor_name:"Iron chainmail gloves",defense_value:4,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),u["Steel chainmail glove"]=new ae({name:"Steel chainmail glove",description:"Steel chainmail in a form ready to be applied onto a glove.",component_type:"glove exterior",value:480,component_tier:3,full_armor_name:"Steel chainmail gloves",defense_value:6,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),u["Iron chainmail shoes"]=new ae({name:"Iron chainmail shoes",description:"Iron chainmail in a form ready to be applied onto a pair of shoes.",component_type:"shoes exterior",value:320,component_tier:2,full_armor_name:"Iron chainmail boots",defense_value:4,component_stats:{agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),u["Steel chainmail shoes"]=new ae({name:"Steel chainmail shoes",description:"Steel chainmail in a form ready to be applied onto a pair of shoes.",component_type:"shoes exterior",value:480,component_tier:3,full_armor_name:"Steel chainmail boots",defense_value:6,component_stats:{agility:{multiplier:.9},cold_tolerance:{flat:-1}}})})();(function(){u["Cheap leather vest"]=new Q({name:"Cheap leather vest",description:"Vest providing very low protection. Better not to know what's it made from",value:100,component_type:"chestplate interior",base_defense:2,component_tier:1,component_stats:{attack_speed:{multiplier:.99},cold_tolerance:{flat:1}}}),u["Leather vest"]=new Q({name:"Leather vest",description:"Comfortable leather vest, offering a low protection.",value:300,component_type:"chestplate interior",base_defense:2,component_tier:2,component_stats:{cold_tolerance:{flat:1}}}),u["Goat leather vest"]=new Q({name:"Goat leather vest",description:"Comfortable leather vest, offering a mediocre protection.",value:450,component_type:"chestplate interior",base_defense:3,component_tier:3,component_stats:{cold_tolerance:{flat:1}}}),u["Cheap leather pants"]=new Q({name:"Cheap leather pants",description:"Leather pants made from cheapest resources available.",value:100,component_type:"leg armor interior",base_defense:1,component_tier:1,component_stats:{attack_speed:{multiplier:.99},cold_tolerance:{flat:1}}}),u["Leather pants"]=new Q({name:"Leather pants",description:"Solid leather pants.",value:300,component_type:"leg armor interior",base_defense:2,component_tier:2,component_stats:{cold_tolerance:{flat:2}}}),u["Goat leather pants"]=new Q({name:"Goat leather pants",description:"Solid leather pants.",value:450,component_type:"leg armor interior",base_defense:3,component_tier:3,component_stats:{cold_tolerance:{flat:2}}}),u["Cheap leather hat"]=new Q({name:"Cheap leather hat",description:"A cheap leather hat to protect your head.",value:100,component_type:"helmet interior",base_defense:1,component_tier:1,component_stats:{attack_speed:{multiplier:.99},cold_tolerance:{flat:1}}}),u["Leather hat"]=new Q({name:"Leather hat",description:"A nice leather hat to protect your head.",value:300,component_type:"helmet interior",base_defense:2,component_tier:2,component_stats:{cold_tolerance:{flat:1}}}),u["Goat leather hat"]=new Q({name:"Goat leather hat",description:"A solid leather hat to protect your head.",value:450,component_type:"helmet interior",base_defense:3,component_tier:3,component_stats:{cold_tolerance:{flat:1}}}),u["Leather gloves"]=new Q({name:"Leather gloves",description:"Strong leather gloves, perfect for handling rough and sharp objects.",value:300,component_type:"glove interior",base_defense:1,component_tier:2,component_stats:{cold_tolerance:{flat:2}}}),u["Goat leather gloves"]=new Q({name:"Goat leather gloves",description:"Strong leather gloves, perfect for handling rough and sharp objects.",value:450,component_type:"glove interior",base_defense:2,component_tier:3,component_stats:{cold_tolerance:{flat:2}}}),u["Cheap leather shoes"]=new Q({name:"Cheap leather shoes",description:"Shoes made of thin and cheap leather. Even then, they are in every single aspect better than not having any.",value:100,component_type:"shoes interior",base_defense:0,component_tier:1,component_stats:{agility:{multiplier:1.05},cold_tolerance:{flat:2}}}),u["Leather shoes"]=new Q({name:"Leather shoes",description:"Solid shoes made of leather, a must have for any traveler",value:300,component_type:"shoes interior",base_defense:1,component_tier:2,component_stats:{attack_speed:{multiplier:1.02},agility:{multiplier:1.1},cold_tolerance:{flat:2}}}),u["Goat leather shoes"]=new Q({name:"Goat leather shoes",description:"Strong shoes made of leather, a must have for any traveler",value:450,component_type:"shoes interior",base_defense:2,component_tier:3,component_stats:{attack_speed:{multiplier:1.02},agility:{multiplier:1.15},cold_tolerance:{flat:2}}}),u["Wool shirt"]=new Q({name:"Wool shirt",description:"It's not thick enough to provide any physical protection, but on the plus side it's light, it's warm, and it and doesn't block your moves.",value:300,component_type:"chestplate interior",base_defense:0,component_tier:2,component_stats:{attack_speed:{multiplier:1.01},agility:{multiplier:1.02},cold_tolerance:{flat:3}}}),u["Wool pants"]=new Q({name:"Wool pants",description:"Nice woollen pants. Slightly itchy.",value:100,component_type:"leg armor interior",base_defense:0,component_tier:2,component_stats:{cold_tolerance:{flat:3}}}),u["Wool hat"]=new Q({name:"Wool hat",description:"Simple woollen hat to protect your head from cold.",value:300,component_type:"helmet interior",base_defense:0,component_tier:2,component_stats:{attack_speed:{multiplier:1.01},agility:{multiplier:1.01},cold_tolerance:{flat:2}}}),u["Wool gloves"]=new Q({name:"Wool gloves",description:"Warm and comfy, but they don't provide any protection.",value:300,component_type:"glove interior",base_defense:0,component_tier:2,component_stats:{cold_tolerance:{flat:2}}}),u["Rat pelt cape"]=new Bt({name:"Rat pelt cape",item_tier:1,description:"It's a cape... made of wolf rat pelts. Only for poor or insane.",value:100,base_stats:{cold_tolerance:{flat:2}}}),u["Wolf pelt cape"]=new Bt({name:"Wolf pelt cape",description:"An elegant cape made from wolf pelts. Doesn't provide much protection, but is light enough to not hinder your movements.",value:400,item_tier:2,base_defense:2,base_stats:{cold_tolerance:{flat:4}}}),u["Boar hide cape"]=new Bt({name:"Boar hide cape",description:"A rough cape made from boar hides. Offers a nice protection, but is heavy and stiff.",value:700,item_tier:3,base_defense:5,base_stats:{attack_speed:{multiplier:.9},agility:{multiplier:.9},cold_tolerance:{flat:5}}}),u["Goat hide cape"]=new Bt({name:"Goat hide cape",description:"A rough cape made from goat hides",value:700,item_tier:3,base_defense:3,base_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.95},cold_tolerance:{flat:4}}}),u["Bear hide cape"]=new Bt({name:"Bear hide cape",description:"A thick, heavy, and warm furry cape, made from a bear hide",value:1e3,item_tier:4,base_defense:7,base_stats:{attack_speed:{multiplier:.95},agility:{multiplier:.95},cold_tolerance:{flat:7}}})})();(function(){u["Wolf leather armor"]=new Q({components:{internal:"Leather vest",external:"Wolf leather chestplate armor"}}),u["Wolf leather helmet"]=new Q({components:{internal:"Leather hat",external:"Wolf leather helmet armor"}}),u["Wolf leather armored pants"]=new Q({components:{internal:"Leather pants",external:"Wolf leather greaves"}}),u["Iron chainmail armor"]=new Q({components:{internal:"Leather vest",external:"Iron chainmail vest"}}),u["Iron chainmail helmet"]=new Q({components:{internal:"Leather hat",external:"Iron chainmail helmet armor"}}),u["Iron chainmail pants"]=new Q({components:{internal:"Leather pants",external:"Iron chainmail greaves"}}),u["Steel chainmail armor"]=new Q({components:{internal:"Goat leather vest",external:"Steel chainmail vest"}}),u["Steel chainmail helmet"]=new Q({components:{internal:"Goat leather hat",external:"Steel chainmail helmet armor"}}),u["Steel chainmail pants"]=new Q({components:{internal:"Goat leather pants",external:"Steel chainmail greaves"}})})();(function(){u["Cheap wooden shield base"]=new Qe({name:"Cheap wooden shield base",description:"Cheap shield component made of wood, basically just a few planks barely holding together",value:16,shield_strength:1,shield_name:"Cheap wooden shield",component_tier:1,component_type:"shield base",component_stats:{attack_speed:{multiplier:.95}}}),u["Crude wooden shield base"]=new Qe({name:"Crude wooden shield base",description:"A shield base of rather bad quality, but at least it won't fall apart by itself",value:32,shield_strength:3,shield_name:"Crude wooden shield",component_tier:1,component_type:"shield base",component_stats:{attack_speed:{multiplier:.95}}}),u["Wooden shield base"]=new Qe({name:"Wooden shield base",description:"Proper wooden shield base, although it could use some additional reinforcement",value:80,shield_strength:5,shield_name:"Wooden shield",component_tier:2,component_type:"shield base",component_stats:{attack_speed:{multiplier:.95}}}),u["Ash wood shield base"]=new Qe({name:"Ash wood shield base",description:"Solid wooden shield base, although still nowhere near as resistant as metal",value:120,shield_strength:8,shield_name:"Ash wood shield",component_tier:3,component_type:"shield base",component_stats:{attack_speed:{multiplier:.95}}}),u["Crude iron shield base"]=new Qe({name:"Crude iron shield base",description:"Heavy shield base made of low quality iron.",value:128,shield_strength:6,shield_name:"Crude iron shield",component_tier:1,component_type:"shield base",component_stats:{attack_speed:{multiplier:.75}}}),u["Iron shield base"]=new Qe({name:"Iron shield base",description:"Solid and strong shield base, although it's quite heavy",value:210,shield_strength:10,shield_name:"Iron shield",component_tier:2,component_type:"shield base",component_stats:{attack_speed:{multiplier:.8}}}),u["Steel shield base"]=new Qe({name:"Steel shield base",description:"Mighty shield base, although it's quite heavy",value:300,shield_strength:14,shield_name:"Steel shield",component_tier:3,component_type:"shield base",component_stats:{attack_speed:{multiplier:.85}}}),u["Basic shield handle"]=new Qe({id:"Basic shield handle",name:"Crude wooden shield handle",description:"A simple handle for holding the shield",value:10,component_tier:1,component_type:"shield handle"}),u["Wooden shield handle"]=new Qe({name:"Wooden shield handle",description:"A decent wooden handle for holding the shield",value:32,component_tier:2,component_type:"shield handle",component_stats:{block_strength:{multiplier:1.1}}}),u["Ash wood shield handle"]=new Qe({name:"Ash wood shield handle",description:"A solid wooden handle for holding the shield",value:48,component_tier:3,component_type:"shield handle",component_stats:{block_strength:{multiplier:1.2}}})})();(function(){u["Cheap wooden shield"]=new nt({components:{shield_base:"Cheap wooden shield base",handle:"Basic shield handle"}}),u["Crude wooden shield"]=new nt({components:{shield_base:"Crude wooden shield base",handle:"Basic shield handle"}}),u["Wooden shield"]=new nt({components:{shield_base:"Wooden shield base",handle:"Wooden shield handle"}}),u["Ash wood shield"]=new nt({components:{shield_base:"Ash wood shield base",handle:"Ash wood shield handle"}}),u["Crude iron shield"]=new nt({components:{shield_base:"Crude iron shield base",handle:"Basic shield handle"}}),u["Iron shield"]=new nt({components:{shield_base:"Iron shield base",handle:"Wooden shield handle"}}),u["Steel shield"]=new nt({components:{shield_base:"Steel shield base",handle:"Ash wood shield handle"}})})();(function(){u["Wolf trophy"]=new en({name:"Wolf trophy",value:100,stats:{armor_penetration:{flat:50},crit_rate:{flat:.02}}}),u["Boar trophy"]=new en({name:"Boar trophy",value:160,stats:{attack_power:{multiplier:1.1},crit_multiplier:{flat:.2}}}),u["Mountain goat trophy"]=new en({name:"Mountain goat trophy",value:250,stats:{attack_power:{multiplier:1.05},defense:{flat:5,multiplier:1.05}}}),u["Bear trophy"]=new en({name:"Bear trophy",value:400,stats:{attack_power:{multiplier:1.3},attack_speed:{multiplier:.9}}})})();(function(){u["Warrior's necklace"]=new ls({value:1e3,stats:{attack_power:{multiplier:1.1},attack_speed:{multiplier:1.1}}})})();(function(){u["Old pickaxe"]=new It({name:"Old pickaxe",description:"An old pickaxe that has seen better times, but is still usable",value:10,equip_slot:"pickaxe"}),u["Old axe"]=new It({name:"Old axe",description:"An old axe that has seen better times, but is still usable",value:10,equip_slot:"axe"}),u["Old sickle"]=new It({name:"Old sickle",description:"And old herb sickle that has seen better times, but is still usable",value:10,equip_slot:"sickle"}),u["Old shovel"]=new It({name:"Old shovel",description:"And old shovel that has seen better times, but can still be used to dig something up",value:10,equip_slot:"shovel"}),u["Iron pickaxe"]=new It({name:"Iron pickaxe",description:"A decent pickaxe made of iron, strong enough for most ores",value:1e3,equip_slot:"pickaxe",bonus_skill_levels:{Mining:3}}),u["Iron chopping axe"]=new It({name:"Iron chopping axe",description:"A decent axe made of iron, hard and sharp enough for most of trees, even if they will still require an effort",value:1e3,equip_slot:"axe",bonus_skill_levels:{Woodcutting:3}}),u["Iron sickle"]=new It({name:"Iron sickle",description:"A decent sickle made of iron, sharp enough for most of plants",value:1e3,equip_slot:"sickle",bonus_skill_levels:{Herbalism:3}}),u["Iron shovel"]=new It({name:"Iron shovel",description:"A decent shovel made of iron, solid enough for most of your digging needs",value:1e3,equip_slot:"shovel",bonus_skill_levels:{Digging:3}})})();(function(){u["Stale bread"]=new xe({name:"Stale bread",description:"Big piece of an old bread, still edible.",value:20,effects:[{effect:"Basic meal",duration:60}],tags:{food:!0},material_type:"bread"}),u["Fresh bread"]=new xe({name:"Fresh bread",description:"Freshly baked bread, delicious.",value:40,effects:[{effect:"Basic meal",duration:150}],tags:{food:!0},material_type:"bread"}),u["Bread kwas"]=new xe({name:"Bread kwas",description:"Tastes like bread",value:40,effects:[{effect:"Well hydrated",duration:60}],recovery_chances:{"Glass bottle":.6},tags:{drink:!0}}),u.Carrot=new xe({name:"Carrot",description:"A delicious root that can be eaten raw.",value:20,effects:[{effect:"Basic meal",duration:10}],tags:{food:!0}}),u["Cooked carrot"]=new xe({name:"Cooked carrot",description:"A delicious root, cooked.",value:30,effects:[{effect:"Basic meal",duration:150}],tags:{food:!0}}),u.Potato=new xe({name:"Potato",description:"A common tuber with versatile culinary usage. Just remember to cook it first!",value:15,effects:[{effect:"Slight food poisoning",duration:20}],tags:{food:!0}}),u["Cooked potato"]=new xe({name:"Potato",description:"A common tuber with versatile culinary usage, though this one was simply cooked.",value:40,effects:[{effect:"Basic meal",duration:150}],tags:{food:!0}}),u["Weak healing powder"]=new xe({name:"Weak healing powder",description:"Not very potent, but can still make body heal noticeably faster for quite a while",value:40,effects:[{effect:"Weak healing powder",duration:240}],tags:{medicine:!0}}),u["Healing powder"]=new xe({name:"Healing powder",description:"Not exactly powerful in its effects, but still makes the body heal noticeably faster and for a long time",value:100,effects:[{effect:"Healing powder",duration:300}],tags:{medicine:!0}}),u["Oneberry juice"]=new xe({name:"Oneberry juice",description:"Tastes kinda nice and provides a quick burst of healing",value:80,effects:[{effect:"Weak healing potion",duration:10}],recovery_chances:{"Glass phial":.75},tags:{medicine:!0}}),u["Healing potion"]=new xe({name:"Healing potion",description:"Tastes nice at first but has a bitter aftertase. Povides a quick burst of healing",value:200,effects:[{effect:"Healing potion",duration:10}],recovery_chances:{"Glass phial":.75},tags:{medicine:!0}}),u["Healing balm"]=new xe({name:"Healing balm",description:"Simply apply it to your wound and watch it heal",value:120,effects:[{effect:"Weak healing balm",duration:90}],tags:{medicine:!0}}),u["Roasted rat meat"]=new xe({name:"Roasted rat meat",description:"Smell might be fine now, but it still seems like a bad idea to eat it",value:10,effects:[{effect:"Cheap meat meal",duration:45},{effect:"Slight food poisoning",duration:45}],tags:{food:!0}}),u["Roasted purified rat meat"]=new xe({name:"Roasted purified rat meat",description:"Smells alright and should be safe to eat, yet you still have some doubts",value:20,effects:[{effect:"Cheap meat meal",duration:45}],tags:{food:!0}}),u["Fried pork"]=new xe({name:"Fried pork",description:"It's dripping with fat and smells fantastic, all it lacks is some spices and a good side dish.",value:40,effects:[{effect:"Simple meat meal",duration:90}],tags:{food:!0}}),u["Fried goat meat"]=new xe({name:"Fried goat meat",description:"It has a nice aroma, but is a bit too tough. Perhaps a stew would have been a better choice?",value:40,effects:[{effect:"Simple meat meal",duration:90}],tags:{food:!0}}),u["Pork roast"]=new xe({name:"Pork roast",description:"A generous amount of herbs has been rubbed into the meat, resulting in a hearty meal with a mouthwatering aroma.",value:100,effects:[{effect:"Decent meat meal",duration:120}],tags:{food:!0}}),u["Goat stew"]=new xe({name:"Goat stew",description:"Goat meat boiled to tenderness in a herbal broth. Perfect to warm yourself up for the road.",value:100,effects:[{effect:"Decent meat meal",duration:120},{effect:"Hot meal",duration:60}],tags:{food:!0}})})();Object.keys(u).forEach(e=>{u[e].id=e,u[e].getName()||(u[e].name=e)});var ie={},ci=class{constructor({name:t,id:i,related_skill:n,target_count:s=1,randomize_target_count:a=!1,is_unlocked:o=!1,stat_multipliers:r={},stamina_cost:d=1,description:c=""}){Nn(this,"getDescription",function(){if(this.description)return this.description;if(this.related_skill)return p[this.related_skill].description});Nn(this,"getStats",function(){if(this.related_skill){let t={};return Object.keys(this.stat_multipliers).forEach(i=>{this.stat_multipliers[i]<1?t[i]=this.stat_multipliers[i]+(1-this.stat_multipliers[i])*R(this.related_skill)/(2*p[this.related_skill].max_level):t[i]=this.stat_multipliers[i]+(this.stat_multipliers[i]-1)*R(this.related_skill)/p[this.related_skill].max_level}),t}else return this.stat_multipliers});if(n&&!p[n])throw`Tried to attach skill "${n}" to stance "${t}", but such a skill doesnt exist!`;if(this.name=t,this.id=i,this.related_skill=n,this.description=c,this.target_count<1)throw"Combat stance cannot target less than 1 enemy!";this.target_count=s,this.randomize_target_count=a,this.is_unlocked=o,this.stat_multipliers=r,this.stamina_cost=d}};ie.normal=new ci({name:"Normal Stance",id:"normal",is_unlocked:!0,description:"A normal and basic stance. It doesn't excell in anything, but also doesn't suffer any major flaws and is energy efficient.",stat_multipliers:{}});ie.quick=new ci({name:"Quick Steps",id:"quick",related_skill:"Quick steps",description:"A swift and precise technique that abandons strength in favor of greater speed",stat_multipliers:{attack_power:.8,attack_speed:1.2},stamina_cost:2});ie.heavy=new ci({name:"Crushing Force",id:"heavy",related_skill:"Heavy strike",stat_multipliers:{attack_power:1.2,attack_speed:.8},stamina_cost:2});ie.defensive=new ci({name:"Defensive Measures",id:"defensive",related_skill:"Defensive measures",stat_multipliers:{attack_power:.8,attack_speed:.8,evasion_points:1.2,block_strength:1.1},target_count:1,stamina_cost:2});ie.wide=new ci({name:"Broad Arc",id:"wide",related_skill:"Wide swing",stat_multipliers:{attack_power:.4},target_count:4,stamina_cost:4});ie.berserk=new ci({name:"Berserker's Stride",id:"berserk",related_skill:"Berserker's stride",stat_multipliers:{attack_power:1.2,hit_chance:1.2,agility:.4,block_strength:.4},target_count:3,randomize_target_count:!0,stamina_cost:4});ie["flowing water"]=new ci({name:"Flowing Water",id:"flowing water",related_skill:"Flowing water",stat_multipliers:{attack_power:1.2,agility:1.2,attack_speed:1.2},target_count:2,stamina_cost:4});var le=1e6;function Sr(){let e=[0,0],t=performance.now(),i=performance.now(),n=[0,0];console.log("Began verifying game objects."),console.log("Began verifying items.");for(let[f,y]of Object.entries(u)){let b=!1;if(f!==y.id&&(console.error(`Id mismatch: "${f}" - "${y.id}"`),b=!0),y.tags.usable)for(let w=0;w<y.effects.length;w++)Z[y.effects[w].effect]||(console.error(`Effect "${y.effects[w].effect}" of item "${f}" is not defined in effect templates`),b=!0);y.stats&&Object.keys(y.stats).forEach(w=>{l.base_stats[w]===void 0?(console.error(`Item "${f}" has a non-existent stat "${w}"`),b=!0):Object.keys(y.stats[w]).forEach(k=>{k!=="multiplier"&&k!=="flat"&&(console.error(`Item "${f}" has a non-existent stat type "${k}" (should be 'multiplier' or 'flat')`),b=!0)})}),n[0]++,n[1]+=b,e[0]++,e[1]+=b}let s=performance.now();n[1]>0?console.log(`Finished verifying items in: ${Math.round(le*(s-i))/le}s
Found issue in ${n[1]} out of ${n[0]}`):console.log(`Finished verifying ${n[0]} items in: ${Math.round(le*(s-i))/le}s
No issues were found.`),i=performance.now();let a=[0,0];console.log("Began verifying skills.");for(let[f,y]of Object.entries(p)){let b=!1;f!==y.skill_id&&(console.error(`Id mismatch: "${f}" - "${y.skill_id}"`),b=!0),y.milestones&&Object.values(y.milestones).forEach(w=>{Object.keys(w).forEach(k=>{k!=="unlocks"&&k!=="stats"&&k!=="xp_multipliers"?(console.error(`Skill "${f}" has a milestone reward to a non-existent category of "${k}"`),b=!0):k==="unlocks"?Object.keys(w[k]).forEach(H=>{H!=="skills"&&H!=="recipes"&&H!=="quests"&&(console.error(`Skill "${f}" has a milestone reward in form of unlocking "${H}" which is not supported`),b=!0)}):k==="stats"?Object.keys(w[k]).forEach(H=>{l.base_stats[H]===void 0&&(console.error(`Skill "${f}" has a milestone reward for a non-existent stat "${H}"`),b=!0),Object.keys(w[k][H]).forEach(W=>{W!=="flat"&&W!=="multiplier"&&(console.error(`Skill "${f}" has a milestone reward to stats of wrong type "${W}". Should be "flat" or "multiplier"`),b=!0)})}):Object.keys(w[k]).forEach(H=>{H!=="all"&&H!=="all_skill"&&H!=="hero"&&!p[H]&&(H.includes("category_")?Ci[H.replace("category_","")]||(b=!0,console.error(`Skill "${f}" has a milestone reward for a non-existent skill "${H}"`)):(b=!0,console.error(`Skill "${f}" has a milestone reward for a non-existent skill "${H}"`)))})})}),a[0]++,a[1]+=b,e[0]++,e[1]+=b}s=performance.now(),a[1]>0?console.log(`Finished verifying skills in: ${Math.round(le*(s-i))/le}s
Found issue in ${a[1]} out of ${a[0]}`):console.log(`Finished verifying ${a[0]} skills in: ${Math.round(le*(s-i))/le}s
No issues were found.`),i=performance.now();let o=[0,0];console.log("Began verifying locations.");for(let[f,y]of Object.entries(m)){let b=!1;if(f!==y.id&&(console.error(`Id mismatch: "${f}" - "${y.id}"`),b=!0),y.tags.safe_zone){for(let w=0;w<y.dialogues.length;w++)$[y.dialogues[w]]||(console.error(`Location "${f}" refers to a non-existent dialogue "${$[y.dialogues[w]]}"`),b=!0);if(y.traders?.length>0){y.market_region?Ae[y.market_region]||(console.error(`Location "${f}" has market region "${y.market_region}" assigned, but no such region is present in region mapping!`),b=!0):(console.error(`Location "${f}" has at least one trader but no trade region assigned!`),b=!0);for(let w=0;w<y.traders.length;w++)j[y.traders[w]]||(console.error(`Location "${f}" refers to a non-existent trader "${y.traders[w]}"`),b=!0)}for(let w=0;w<y.connected_locations.length;w++)y.connected_locations[w].location||(console.error(`Location "${f}" is connected to a non-existent location.`),b=!0);Object.keys(y.activities).forEach(w=>{x[y.activities[w].activity_name]||(console.error(`Location "${f}" refers to a non-existent activity "${y.activities[w].activity_name}"`),b=!0);for(let k=0;k<y.activities[w].gained_resources?.length;k++)u[y.activities[w].gained_resources.resources[k].name]||(console.error(`Activity "${w}" in location "${f}" refers to a non-existent item "${y.activities[w].gained_resources.resources[k].name}"`),b=!0)})}else if(y.tags["Combat zone"]){for(let w=0;w<y.enemies_list?.length;w++)X[y.enemies_list[w]]||(console.error(`Location "${f}" refers to a non-existent enemy "${y.enemies_list[w]}"`),b=!0);for(let w=0;w<y.enemy_groups_list?.length;w++)for(let k=0;k<y.enemy_groups_list[w].enemies.length;k++)X[y.enemy_groups_list[w].enemies[k]]||(console.error(`Location "${f}" refers to a non-existent enemy "${y.enemy_groups_list[w].enemies[k]}"`),b=!0);if(y.first_reward&&rs(y.first_reward,"location",f),y.repeatable_reward&&(rs(y.repeatable_reward,"location",f)||(b=!0)),y.rewards_with_clear_requirement)for(let w=0;w<y.rewards_with_clear_requirement.length;w++)rs(y.rewards_with_clear_requirement[w],"location",f)||(b=!0)}o[0]++,o[1]+=b,e[0]++,e[1]+=b}s=performance.now(),o[1]>0?console.log(`Finished verifying locations in: ${Math.round(le*(s-i))/le}s
Found issue in ${o[1]} out of ${o[0]}`):console.log(`Finished verifying ${o[0]} locations in: ${Math.round(le*(s-i))/le}s
No issues were found.`),i=performance.now();let r=[0,0];console.log("Began verifying enemies.");for(let[f,y]of Object.entries(X)){let b=!1;f!==y.id&&(console.error(`Id mismatch: "${f}" - "${y.id}"`),b=!0);for(let w=0;w<y.loot_list.length;w++)u[y.loot_list[w].item_name]||(console.error(`Enemy "${f}" refers to a non-existent item "${y.loot_list[w].item_name}"`),b=!0);r[0]++,r[1]+=b,e[0]++,e[1]+=b}s=performance.now(),r[1]>0?console.log(`Finished verifying enemies in: ${Math.round(le*(s-i))/le}s
Found issue in ${r[1]} out of ${r[0]}`):console.log(`Finished verifying ${r[0]} in: ${Math.round(le*(s-i))/le}s
No issues were found.`),i=performance.now();let d=[0,0];console.log("Began verifying market regions.");for(let[f]of Object.entries(Ae)){let y=!1,b=!1;Object.values(m).forEach(w=>{w.market_region===f&&(b=!0)}),b||(y=!0,console.error(`Market region "${f}" is not used for any location despite being defined in region connections!`)),d[0]++,d[1]+=y,e[0]++,e[1]+=y}s=performance.now(),d[1]>0?console.log(`Finished verifying market regions in: ${Math.round(le*(s-i))/le}s
Found issue in ${d[1]} out of ${d[0]}`):console.log(`Finished verifying ${d[0]} market regions in: ${Math.round(le*(s-i))/le}s
No issues were found.`),i=performance.now();let c=[0,0];console.log("Began verifying dialogues.");for(let[f,y]of Object.entries($)){let b=!1;for(let[w,k]of Object.entries(y.textlines))Zt.english[k.name]||(b=!0,console.error(`Textline "${w}" in "${f}" has no translation provided for starting text`)),Zt.english[k.getText()]||(b=!0,console.error(`Textline "${w}" in "${f}" has no translation provided for answer text`)),k.rewards&&(rs(k.rewards,"textline",f,w)||(b=!0));for(let[w,k]of Object.entries(y.actions))Zt.english[k.starting_text]||(b=!0,console.error(`Action "${w}" in "${f}" has no translation provided for starting text`)),Zt.english[k.success_text]||(b=!0,console.error(`Textline "${w}" in "${f}" has no translation provided for success text`));c[0]++,c[1]+=b,e[0]++,e[1]+=b}s=performance.now(),c[1]>0?console.log(`Finished verifying dialogues in: ${Math.round(le*(s-i))/le}s
Found issue in ${c[1]} out of ${c[0]}`):console.log(`Finished verifying ${c[0]} dialogues in: ${Math.round(le*(s-i))/le}s
No issues were found.`);let _=performance.now(),h;return e[1]>0?h=`Finished verifying game objects in: ${Math.round(le*(_-t))/le}s
Found issue in ${e[1]} out of ${e[0]}`:h=`Finished verifying ${e[0]} game objects in: ${Math.round(le*(_-t))/le}s
No issues were found.`,console.log(h),e[1]==0}function rs(e,t,i,n){let s=!0;return Object.keys(e).forEach(a=>{if(a==="xp"&&typeof e[a]!="number")console.error(ui(t,i,n)+"wrong kind of reward of 'xp' type, should be Number but found '"+typeof e[a]+"'"),s=!1;else if(a==="skill_xp")Object.keys(e[a]).forEach(o=>{p[o]||(console.error(ui(t,i,n)+"wrong skill id for 'skill_xp', no such skill as '"+o+"'"),s=!1),typeof e[a][o]!="number"&&(console.error(ui(t,i,n)+"wrong kind of reward of 'skill xp' type for '"+o+"', should be Number but found '"+typeof e[a][o]+"'"),s=!1)});else if(a==="locations")for(let o=0;o<e[a].length;o++)m[e[a][o].location]||(console.error(ui(t,i,n)+`non-existent location '${e[a][o].location}' listed for unlocks`),s=!1);else if(a==="textlines")for(let o=0;o<e[a].length;o++){$[e[a][o].dialogue]||(console.error(ui(t,i,n)+`non-existent dialogue '${e[a][o].dialogue}' listed for textline unlocks`),s=!1);for(let r=0;r<e[a][o].lines.length;r++)$[e[a][o].dialogue].textlines[e[a][o].lines[r]]||(console.error(ui(t,i,n)+`non-existent textline '${e[a][o].lines[r]}' listed for unlocks in dialogue '${e[a][o].dialogue}'`),s=!1)}else if(a==="move_to")m[e[a].location]||(console.error(ui(t,i,n)+`non-existent location '${e[a].location}' listed for moving to`),s=!1);else if(a==="quest_progress")for(let o=0;o<e[a].length;o++)N[e[a][o].quest_id]||(console.error(ui(t,i,n)+`non-existent quest '${e[a][o].quest_id}' listed for progressing`),s=!1),N[e[a][o].quest_id].quest_tasks.length<e[a][o].task_index&&(console.error(ui(t,i,n)+`too high task index for progressing quest '${e[a][o].quest_id}'`),s=!1)}),s}function ui(e,t,i){if(e==="location")return`Location "${t}" has a `;if(e==="textline")return`Textline "${i}" in dialogue "${t}" has a `}var Lr={add_reputation:({reputation:e,region:t})=>{if(Number.isInteger(e))if(t in l.reputation)l.reputation[t]+=e;else throw new Error(`Tried to add reputation to "${t}", which is not a valid reputation region!`);else throw new Error(`Tried to add "${e}", which is not a valid integer!`)}};var nn={},Tr="Running",Ir=60,Cr=4,Eo=class{constructor(){this.queue=[]}add_to_queue(t){this.queue.push(t),this.queue.sort((i,n)=>i[0]-n[0])}shift_from_queue(){return this.is_queue_empty()?"Queue is empty":this.queue.shift()}is_queue_empty(){return this.queue.length==0}},Sn=class{constructor(){this.adjacent={},this.vertice_count=0}add_connection(t,i,n){this.adjacent[t]||(this.adjacent[t]=[]),this.adjacent[t].push([i,n])}update_time_skill_modifiers(){Object.keys(nn).forEach(t=>{nn[t]=1/Cr**(p[t].current_level/p[t].max_level)})}update_time_skill_modifier(t){nn[t]=1/Cr**(p[t].current_level/p[t].max_level)}get_total_skills_modifier(t){let i=1;for(let n=0;n<t.length;n++)t[n]in nn||this.update_time_skill_modifier(t[n]),i*=nn[t[n]];return i**t.length}fill_connections(t){Object.values(t).forEach(i=>{if(i.is_unlocked&&!i.is_finished){if(i.parent_location){let n=i.parent_location.connected_locations.find(o=>o.location===i).travel_time??Ir,s=i.parent_location.connected_locations.find(o=>o.location===i).travel_time_skills||[Tr],a=this.get_total_skills_modifier(s);this.add_connection(i.id,i.parent_location.id,n*a)}else for(let n=0;n<i.connected_locations.length;n++)if(i.connected_locations[n].location.is_unlocked&&!i.connected_locations[n].location.is_finished){let s=i.connected_locations[n].travel_time_skills||[Tr],a=this.get_total_skills_modifier(s);this.add_connection(i.id,i.connected_locations[n].location.id,(i.connected_locations[n].travel_time??Ir)*a)}}})}find_shortest_paths(t){let i=new Eo,n={};for(i.add_to_queue([0,t]),n[t]=0;!i.is_queue_empty();){let[,s]=i.shift_from_queue();if(this.adjacent[s])for(let[a,o]of this.adjacent[s])n[s]==null&&(n[s]=1/0),n[a]==null&&(n[a]=1/0),n[a]>n[s]+o&&(n[a]=n[s]+o,i.add_to_queue([n[a],a]))}return Object.keys(n).forEach(s=>{n[s]=Math.round(n[s])}),n}};var pt="save data",ft="dev save data",ma="backup save",ha="dev backup save",Ne={is_gathering_unlocked:!1,is_crafting_unlocked:!1,is_strength_proved:!1,is_mofu_mofu_enabled:!0},Ar={is_gathering_unlocked:"You have gained the ability to gather new materials! Remember to equip your tools first <br>[Note: equipped tools do not appear in inventory as you will be swapping them very rarely]",is_crafting_unlocked:"You have gained the ability to craft items and equipment!"},Ao=document.getElementById("loading_screen_play_button"),An={english:"english",mofu_english:"mofu_english"},St=An.mofu_english,Or=!1,Bo=0,Ho=0,ca=0,ua=0,Oo=0,No=0,Po=0,jo=0,Wo=0,ms=0,hs={},lu=5,ru=1/360,cu=.2,ln=0,Io=1e3*60*60*20,So=20,an=0,sn=[0,0,0,0],oa=!1,uu=!1,P=null,pa={},qi,di=[],on=[],In=[],Nr,ki=0,Tn=0,la=[],Mt=10,v,q,ps,Bn,xt={},Ft,$n={},du=!0,$i=!1,vi=null,kt=null,et=null,_u=60,ds=0,mu=3600,Lo=0,Ln=0,cs=0,ra,Br,Ze,he={},mt=ie.normal,Te=ie.normal,Rt={},Tt={},re=1,hu=1,I={uniform_text_size_in_action:!1,auto_return_to_bed:!0,remember_message_log_filters:!1,remember_sorting_options:!1,combat_disable_autoswitch:!1,log_every_gathering_period:!0,log_total_gathering_gain:!0,auto_use_when_longest_runs_out:!0,use_uncivilised_temperature_scale:!1,do_background_animations:!1,skip_play_button:!1,mofu_mofu_mode:!0,do_enemy_onhit_animations:!0},xi={unlocks:!0,events:!0,combat:!0,loot:!0,crafting:!0,background:!0},pu=.1,fu=2,zt=[],Mi={TOP:"top",ALL:"all"},da=document.getElementById("character_name_field");da.value=l.name;da.addEventListener("change",()=>l.name=da.value.toString().trim().length>0?da.value:"Hero");var Pr=document.getElementById("time_div");Pr.innerHTML=M.toString();(function(){Object.keys(p).forEach(t=>{l.xp_bonuses.total_multiplier[t]=1,l.bonus_skill_levels.full[t]=0}),Object.keys(Ci).forEach(t=>{l.xp_bonuses.total_multiplier["category_"+t]=1})})();function jr(e){let t=document.getElementById("options_textsize");t.checked||e?(I.uniform_text_size_in_action=!0,document.documentElement.style.setProperty("--options_action_textsize","20px")):(I.uniform_text_size_in_action=!1,document.documentElement.style.setProperty("--options_action_textsize","16px")),e!==void 0&&(t.checked=e)}function Wr(e){let t=document.getElementById("options_bed_return");t.checked||e?I.auto_return_to_bed=!0:I.auto_return_to_bed=!1,e!==void 0&&(t.checked=e)}function Rr(e){let t=document.getElementById("options_save_messagelog_settings");t.checked||e?I.remember_message_log_filters=!0:I.remember_message_log_filters=!1,e!==void 0&&(t.checked=e,xi.unlocks?document.documentElement.style.setProperty("--message_unlocks_display","inline-block"):(document.documentElement.style.setProperty("--message_unlocks_display","none"),document.getElementById("message_show_unlocks").classList.remove("active_selection_button")),xi.combat?document.documentElement.style.setProperty("--message_combat_display","inline-block"):(document.documentElement.style.setProperty("--message_combat_display","none"),document.getElementById("message_show_combat").classList.remove("active_selection_button")),xi.events?document.documentElement.style.setProperty("--message_events_display","inline-block"):(document.documentElement.style.setProperty("--message_events_display","none"),document.getElementById("message_show_events").classList.remove("active_selection_button")),xi.loot?document.documentElement.style.setProperty("--message_loot_display","inline-block"):(document.documentElement.style.setProperty("--message_loot_display","none"),document.getElementById("message_show_loot").classList.remove("active_selection_button")),xi.crafting?document.documentElement.style.setProperty("--message_crafting_display","inline-block"):(document.documentElement.style.setProperty("--message_crafting_display","none"),document.getElementById("message_show_crafting").classList.remove("active_selection_button")),xi.background?document.documentElement.style.setProperty("--message_background_display","inline-block"):(document.documentElement.style.setProperty("--message_background_display","none"),document.getElementById("message_show_background").classList.remove("active_selection_button")))}function Gr(e){let t=document.getElementById("options_dont_autoswitch_to_combat");t.checked||e?I.disable_combat_autoswitch=!0:I.disable_combat_autoswitch=!1,e!==void 0&&(t.checked=e)}function Fr(e){let t=document.getElementById("options_log_all_gathering");t.checked||e?I.log_every_gathering_period=!0:I.log_every_gathering_period=!1,e!==void 0&&(t.checked=e)}function zr(e){let t=document.getElementById("options_log_gathering_result");t.checked||e?I.log_total_gathering_gain=!0:I.log_total_gathering_gain=!1,e!==void 0&&(t.checked=e)}function Dr(e){let t=document.getElementById("options_use_uncivilised_temperature_scale");t.checked||e?I.use_uncivilised_temperature_scale=!0:I.use_uncivilised_temperature_scale=!1,e!==void 0&&(t.checked=e),Qa()}function Yr(e){let t=document.getElementById("options_do_background_animations");t.checked||e?I.do_background_animations=!0:(I.do_background_animations=!1,ns(),window.removeEventListener("resize",Zi),window.removeEventListener("resize",Xi),window.removeEventListener("resize",ia)),e!==void 0&&(t.checked=e)}function Vr(e){let t=document.getElementById("options_skip_play_button");t.checked||e?I.skip_play_button=!0:I.skip_play_button=!1,e!==void 0&&(t.checked=e)}function Qr(e){let t=document.getElementById("options_mofu_mofu_mode");e!==void 0&&(t.checked=e),t.checked?(I.mofu_mofu_mode=!0,Ne.is_mofu_mofu_enabled=!0,St=An.mofu_english):(I.mofu_mofu_mode=!1,Ne.is_mofu_mofu_enabled=!1,St=An.english)}function Ur(e){let t=document.getElementById("options_do_enemy_onhit_animations");t.checked||e?I.do_enemy_onhit_animations=!0:I.do_enemy_onhit_animations=!1,e!==void 0&&(t.checked=e)}function $t({location_id:e,event:t,skip_travel_time:i=!1,do_quest_events:n=!0,skip_combat:s=!1}){if(t?.target.classList.contains("fast_travel_removal_button"))return;let a=v,o=m[e]||v;if(!(e!==v?.name&&o.is_finished)){if(Co(),gs(),ju(),!o)throw`No such location as "${e}"`;n&&fa({quest_event_type:"enter_location",quest_event_target:o.id,quest_event_count:1}),typeof v<"u"&&v.id!==o.id&&S(`[ Entering ${o.name} ]`,"message_travel"),o.crafting&&Zs(),v=o,Ft||(Ft=new Sn,Ft.fill_connections(m)),xt[v.id]||(xt[v.id]=Ft.find_shortest_paths(v.id)),a&&!i&&Xu({value:xt[a.id][v.id],source:"travel"}),Qa(),Le(),"connected_locations"in v?za(v):(Fl(v),s||ac(),v.is_challenge||(kt=v.id)),De({rewards:v.entrance_rewards})}}function gu(){v.housing&&v.housing.is_unlocked||(at[v.id]?rc({location_id:v.id,update_choices:!1}):Pu({location_id:v.id}))}function Kr(e){if(q=Object.assign({},v.activities[e]),q.id=e,!x[q.activity_name])throw`No such activity as ${q.activity_name} could be found`;if(x[q.activity_name].type==="JOB"){if(!En(q)){q=null;return}q.earnings=0,q.working_time=0}else if(x[q.activity_name].type==="TRAINING"){if(!En(q)){q=null;return}}else if(x[q.activity_name].type==="GATHERING"){if(!(!x[q.activity_name].required_tool_type||l.equipment[x[q.activity_name].required_tool_type])){S("You need to equip a proper tool to do that!"),q=null;return}q.gathered_materials={}}else throw`"${x[q.activity_name].type}" is not a valid activity type!`;q.gathering_time=0,q.gained_resources&&(q.gathering_time_needed=q.getActivityEfficiency().gathering_time_needed),Yo({content_type:"activity",data:{activity:q}})}function Ro(){if(S(`${l.name} finished ${q.activity_name}`,"activity_finished"),q.earnings&&(S(`${l.name} earned ${je(q.earnings)}`,"activity_money"),Jr(q.earnings)),q.gathered_materials&&I.log_total_gathering_gain){let e=[];Object.keys(q.gathered_materials).forEach(t=>{e.push({item_key:t,count:q.gathered_materials[t]})}),Ra({loot_list:e,is_a_summary:!0})}ai(),q=null,ga(Mi.TOP)}function yu(e,t){Bn=e;let i;Ze?i=$[Ze].actions[e]:i=v.actions[e];let n;if(Yo({content_type:"action",data:{dialogue_key:Ze,action_key:e}}),!i.can_be_started(l)){us({action_key:e,conditions_status:-1,dialogue_key:Ze});return}if(!i.check_conditions_on_finish&&(n=i.get_conditions_status(l),n==0)){us({action_key:e,conditions_status:0,dialogue_key:Ze});return}if(t&&i.floating_click_effects){let s=i.floating_click_effects[Math.floor(Math.random()*i.floating_click_effects.length)];Wl(s,{x:t.pageX,y:t.pageY})}if(i.attempt_duration>0){let s=0,a=i.attempt_duration/.1;ps=setInterval(()=>{s>=a-1&&(clearInterval(ps),us({action_key:e,conditions_status:n,dialogue_key:Ze})),s++,lo(s/a)},1e3*.1/re)}else lo(1),us({action_key:e,conditions_status:n,dialogue_key:Ze})}function us({action_key:e,conditions_status:t,dialogue_key:i}){ai(!0);let n;i?n=$[i].actions[e]:n=v.actions[e],typeof t>"u"&&(i?t=$[i].actions[e].get_conditions_status(l):t=v.actions[e].get_conditions_status(l));let s="If you see this, Miktaew screwed something up. Whoops!";if(t==-1)s=n.failure_texts.unable_to_begin[Math.floor(n.failure_texts.unable_to_begin.length*Math.random())];else if(t==0)s=n.failure_texts.conditional_loss[Math.floor(n.failure_texts.conditional_loss.length*Math.random())];else{let a=bu({action_key:e,conditions_status:t,dialogue_key:i}),o=!1;a>Math.random()?(s=n.success_text,n.repeatable||(n.is_finished=!0),De({rewards:n.rewards,source_type:"action"}),o=!0):s=n.failure_texts.random_loss[Math.floor(n.failure_texts.random_loss.length*Math.random())],Object.keys(n.conditions[0]?.items_by_id||{}).forEach(r=>{n.conditions[0].items_by_id[r].remove&&ct([{item_key:u[r].getInventoryKey(),item_count:n.conditions[0].items_by_id[r].count}])}),Object.keys(n.required.items_by_id||{}).forEach(r=>{(n.required.items_by_id[r].remove_on_success&&o||n.required.items_by_id[r].remove_on_fail&&!o)&&ct([{item_key:u[r].getInventoryKey(),item_count:n.required.items_by_id[r].count}])})}ar(),i?(Wu({data:{upstack_result_message:s}}),n.attempt_duration==0&&ga(Mi.TOP)):nr(s)}function wu(){ai(),clearInterval(ps),Bn=null,ga(Mi.TOP)}function bu({action_key:e,conditions_status:t,dialogue_key:i}){let n;return i?n=$[i].actions[e]:n=v.actions[e],n.success_chances.length==1?n.success_chances[0]:t==1&&n.success_chances[1]?n.success_chances[1]:n.success_chances[0]+(n.success_chances[1]-n.success_chances[0])*t}function vu({activity_id:e}){if(!x[e].is_unlocked){x[e].is_unlocked=!0;let t="";x[e].unlock_text&&(t=x[e].unlock_text+":<br>"),S(t+`Gained the ability of "${x[e].name}"`,"activity_unlocked")}}function ku(e){if(!e.activity.is_unlocked){e.activity.is_unlocked=!0;let t="";m[e.location].activities[e.activity.activity_id].unlock_text&&(t=m[e.location].activities[e.activity.activity_id].unlock_text+":<br>"),(x[e.activity.activity_name].type!=="GATHERING"||Ne.is_gathering_unlocked)&&S(t+`Unlocked activity "${e.activity.activity_name}" in location "${e.location}"`,"activity_unlocked")}}function Hr(e){if(!e.action.is_unlocked){e.action.is_unlocked=!0;let t="";e.location?m[e.location].actions[e.action.action_id].unlock_text&&(t=m[e.location].actions[e.action.action_id].unlock_text+":<br>",S(t+`Unlocked action "${e.action.action_name}" in location "${e.location}"`,"activity_unlocked")):e.dialogue&&$[e.dialogue].actions[e.action.action_id].unlock_text&&(t=$[e.dialogue].actions[e.action.action_id].unlock_text+":<br>",S(t+`Unlocked action "${e.action.action_name}" wit "${e.dialogue}"`,"activity_unlocked"))}}function Jr(e){l.money+=e,mn()}function Go({ammount_to_restore:e=0,ammount_to_loose:t=0,add_xp:i=!0}={}){if(!e&&!t)return;let n=Math.min(l.stats.full.max_health-l.stats.full.health,e-t),s=Math.min(l.stats.full.max_health-l.stats.full.health+t,e);n&&(l.stats.full.health+=n,si()),s&&i&&s>0&&z({skill:p.Regeneration,xp_to_add:s}),l.stats.full.health<=0&&(l.stats.full.health=0,oc({is_combat:"parent_location"in v}))}function xu(){if(l.stats.full.health<l.stats.full.max_health){let e=Math.round(Math.max(l.stats.full.max_health*.01,2)*(1+3*R("Regeneration")/p.Regeneration.max_level));Go({ammount_to_restore:e})}if(l.stats.full.stamina<l.stats.full.max_stamina){let e=Math.round(Math.max(l.stats.full.max_stamina/120,2));l.stats.full.stamina+=e,l.stats.full.stamina>l.stats.full.max_stamina&&(l.stats.full.stamina=l.stats.full.max_stamina),Ki()}}function qu(){if(l.stats.full.health<l.stats.full.max_health){let e=Math.round(Math.max(l.stats.full.max_health*.04,5)*(1+R("Sleeping")/p.Sleeping.max_level)*(1+3*R("Regeneration")/p.Regeneration.max_level));Go({ammount_to_restore:e})}if(l.stats.full.stamina<l.stats.full.max_stamina){let e=Math.round(Math.max(l.stats.full.max_stamina/30,5)*(1+R("Sleeping")/p.Sleeping.max_level));l.stats.full.stamina+=e,l.stats.full.stamina>l.stats.full.max_stamina&&(l.stats.full.stamina=l.stats.full.max_stamina),Ki()}}function Fo(){sr(),$i=!0,vi=v.id}function Xr(){$i=!1,$t({location_id:v.id,skip_travel_time:!0}),ai()}function Zr(e){let t=_s(e)?JSON.parse(e).id:e;if(!v?.parent_location){if(et===t){fs();return}else et&&fs();F[t].is_finished||($i&&Xr(),q&&Ro(),et=t,or(t),Fa(et))}}function fs(){$t({location_id:v.id,skip_travel_time:!0}),ai();let e=et;et=null,Fa(e)}function Mu(){u[et].addProgress(),Fa(et),z({skill:p.Literacy,xp_to_add:F.literacy_xp_rate});let e=F[et];F[et].is_finished&&(S(`Finished the book "${et}"`),mo(et,!0),fs(),l.stats.add_book_bonus(e.bonuses),Le(),De({rewards:e.rewards}))}function vo(){return et}function En(e){if(!e.infinite){if(e.availability_time){if(e.availability_time.end>e.availability_time.start){if(M.hour*60+M.minute>e.availability_time.end*60||M.hour*60+M.minute<e.availability_time.start*60||!e.availability_seasons?.includes(M.getSeason()))return!1}else if(!e.availability_seasons?.includes(M.getSeason(1))||M.hour*60+M.minute>e.availability_time.start*60||M.hour*60+M.minute<e.availability_time.end*60)return!1}else if(!e.availability_seasons?.includes(M.getSeason()))return!1}return!0}function ko(e){if(!e.infinite){if(e.availability_time.end>e.availability_time.start){if(M.hour*60+M.minute+e.working_period-e.working_time%e.working_period>e.availability_time.end*60||M.hour*60+M.minute<e.availability_time.start*60)return!1}else if(!e.availability_time.includes(M.getSeason(1))||M.hour*60+M.minute>e.availability_time.start*60&&M.hour*60+M.minute+e.working_period-e.working_time%e.working_period>e.availability_time.end*60+24*60||M.hour*60+M.minute<e.availability_time.start*60&&M.hour*60+M.minute+e.working_period-e.working_time%e.working_period>e.availability_time.end*60)return!1}return!0}function $u(e){Yo({content_type:"dialogue",data:{dialogue_key:e}})}function Eu(){Ze=null,ga(Mi.TOP)}function Su(){za(v)}function Lu(e){let i=$[Ze].textlines[e];De({rewards:i.rewards,source_type:"textline",inform_textline:!1}),i.otherUnlocks&&i.otherUnlocks();let n=Tu(i);if(Oi()&&Math.random()<=.01){let s=n.split(" "),a=Math.floor(s.length*Math.random());s[a]="rat",n=s.join(" ")}i.branches_into?.length?Ja({content_type:"dialogue_branch",data:{text:n,textlines:i.branches_into}}):Ja({content_type:"dialogue_answer",data:{text:n,dialogue_key:Ze}})}function Tu(e){return e.getText({season:M.getSeason()})}function Iu(e){if(!ie[e]){console.warn(`Tried to unlock stance "${e}", but no such stance exists!`);return}ie[e].is_unlocked||S(`You have learned a new stance: "${ie[e].name}"`,"location_unlocked"),ie[e].is_unlocked=!0,ts(ie,Te,Rt)}function Hn(e,t=!1){if(t){if(!ie[e])throw new Error(`No such stance as "${e}"`);if(!ie[e].is_unlocked)throw new Error(`Stance "${e}" is not yet unlocked!`)}else mt=ie[e],co(mt);Te=ie[e],Le(),zo()}function ec(e){Rt[e]?delete Rt[e]:ie[e].is_unlocked?Rt[e]=!0:console.warn(`Tried to fav a stance '${e}' despite it not being unlocked!`),uo(ie)}function tc({enemies:e}={}){if(!v.get_next_enemies){Co(),gs();return}for(let n=0;n<P?.length;n++)is(n);P=e||v.get_next_enemies(),Co();let t=1/l.stats.full.attack_speed;qi=[...P.map(n=>1/n.stats.attack_speed)];let i=[t,...qi].sort((n,s)=>n-s)[0];if(i<1){let n=1/i;t*=n;for(let s=0;s<P.length;s++)qi[s]*=n,di[s]=0,on[s]=0,In[s]=[Date.now(),Date.now()]}else for(let n=0;n<P.length;n++)di[n]=0,on[n]=0,In[n]=[Date.now(),Date.now()];ki=0,Tn=0,la=[Date.now(),Date.now()];for(let n=0;n<P.length;n++)is(n),ic(n,0,!0);Do({base_cooldown:t}),Us(),Ks()}function zo(){if(!P)return;let e=1/l.stats.full.attack_speed;qi=[...P.map(i=>1/i.stats.attack_speed)];let t=[e,...qi].sort((i,n)=>i-n)[0];if(t<1){let i=1/t;e*=i;for(let n=0;n<P.length;n++)qi[n]*=i}Do({base_cooldown:e})}function ic(e,t,i=!1){t=t||0,ho(e,t/60),i&&(di[e]=0,on[e]=0),clearTimeout(pa[e]),pa[e]=setTimeout(()=>{In[e][0]=Date.now(),di[e]+=In[e][0]-In[e][1]-qi[e]*1e3/(60*re),In[e][1]=Date.now(),ho(e,t/60),t++,t>=60&&(t=0,sc(e)),ic(e,t),di[e]<=Mt/re&&di[e]>=-Mt/re?on[e]=di[e]:di[e]>Mt/re?on[e]=Mt/re:di[e]<-Mt/re&&(on[e]=-Mt/re)},qi[e]*1e3/(60*re)-on[e])}function Cu(e){clearTimeout(pa[e])}function Do({base_cooldown:e}){if(gs(),!P)return;if(l.stats.full.stamina>=mt.stamina_cost/l.stats.full.stamina_efficiency){if(mt.id!==Te.id){Hn(mt.id);return}}else if(Te.id!=="normal"){Hn("normal",!0);return}let t=Te.target_count;t>1&&Te.related_skill&&(t=t+Math.round(t*R(Te.related_skill)/p[Te.related_skill].max_level)),Te.randomize_target_count&&(t=Math.floor(Math.random()*t)||1);let i=[],n=P.filter(o=>o.is_alive).slice(-t);for(;n.length>0;)i.push(n.pop());Hu(Te.stamina_cost);let s=e/l.get_stamina_multiplier(),a=l.get_attack_power();nc({base_cooldown:e,actual_cooldown:s,attack_power:a,targets:i,target_count:t})}function nc({base_cooldown:e,actual_cooldown:t,attack_power:i,targets:n,count:s=0,is_new:a=!0,target_count:o=1,do_quest_events:r=!0}){po(s/60),a&&(ki=0,Tn=0),gs(),Nr=setTimeout(()=>{if(la[0]=Date.now(),ki+=la[0]-la[1]-t*1e3/(60*re),la[1]=Date.now(),po(s/60),s++,s>=60){s=0;let d=!1;for(let c=0;c<n.length;c++)Au({target:n[c],attack_power:i,target_count:n.length});Te.related_skill&&(d=z({skill:p[Te.related_skill],xp_to_add:n.reduce((c,_)=>c+_.xp_value,0)/n.length}),d&&(cr(Te),Le())),P.filter(c=>c.is_alive).length!=0?Do({base_cooldown:e}):(v.enemy_groups_killed+=1,v.enemy_groups_killed>0&&v.enemy_groups_killed%v.enemy_count==0&&(Ou(v),r&&fa({quest_event_type:"clear",quest_event_target:v.id,quest_event_count:1})),document.getElementById("enemy_count_div").children[0].children[1].innerHTML=v.enemy_count-v.enemy_groups_killed%v.enemy_count,tc())}else nc({base_cooldown:e,actual_cooldown:t,attack_power:i,targets:n,target_count:o,count:s,is_new:!1});ki<=Mt/re&&ki>=-Mt/re?Tn=ki:ki>Mt/re?Tn=Mt/re:ki<-Mt/re&&(Tn=-Mt/re)},t*1e3/(60*re)-Tn)}function gs(){clearTimeout(Nr)}function Co(){Object.keys(pa).forEach(e=>{clearTimeout(pa[e])})}function ac(){P==null&&tc()}function sc(e){if(!P)return;let t=P.filter(h=>h.is_alive).length**(2/3),i=P[e],n=P.filter(h=>h.is_alive).length**(-1/3);i.size==="small"?z({skill:p["Pest killer"],xp_to_add:i.xp_value/t}):i.size==="large"&&(z({skill:p["Giant slayer"],xp_to_add:i.xp_value/t}),n*=C({scaling_type:"multiplicative",skill_id:"Giant slayer"}));let s=i.stats.attack,a=[],o=!1,r=!1;for(let h=0;h<i.stats.attack_count;h++)a.push(s*(1.2-Math.random()*.4));if(a=a.sort((h,f)=>f-h),l.equipment["off-hand"]?.offhand_type==="shield")if(l.stats.full.block_chance>Math.random()){z({skill:p["Shield blocking"],xp_to_add:i.xp_value/t});let h=l.stats.total_multiplier.block_strength*l.equipment["off-hand"].getShieldStrength();if(h>a[0]){S(l.name+" blocked an attack","hero_blocked");return}else a=a.map(f=>Math.max(0,f-h)),r=!0}else z({skill:p["Shield blocking"],xp_to_add:i.xp_value/(2*t)});else if(rn(i.stats.dexterity*Math.sqrt(i.stats.intuition??1),l.stats.full.evasion_points*n)<Math.random()){let f=l.wears_armor()?i.xp_value:i.xp_value*1.5;z({skill:p.Evasion,xp_to_add:f/t}),S(l.name+" evaded an attack","enemy_missed");return}else z({skill:p.Evasion,xp_to_add:i.xp_value/(2*t)});Wo++,pu>Math.random()&&(a=a.map(h=>h*fu),o=!0,Po++),l.wears_armor()||z({skill:p["Iron skin"],xp_to_add:i.xp_value/t});let{damage_taken:d,fainted:c}=l.take_damage({damage_values:a});z({skill:p.Fortitude,xp_to_add:d**.6/t});let _=a.length>1?` x${a.length}`:"";if(o?r?S(l.name+" partially blocked, was critically hit"+_+" for "+Math.ceil(10*d)/10+" dmg","hero_attacked_critically"):S(l.name+" was critically hit"+_+" for "+Math.ceil(10*d)/10+" dmg","hero_attacked_critically"):r?S(l.name+" partially blocked, was hit"+_+" for "+Math.ceil(10*d)/10+" dmg","hero_attacked"):S(l.name+" was hit"+_+" for "+Math.ceil(10*d)/10+" dmg","hero_attacked"),c){oc();return}si()}function Au({target:e,attack_power:t,target_count:i}){let n=t,s,a=!1,o=P.filter(d=>d.is_alive).length**(-1/4);if(z({skill:p.Combat,xp_to_add:e.xp_value/i}),e.size==="small"?(z({skill:p["Pest killer"],xp_to_add:e.xp_value/i}),o*=C({scaling_type:"multiplicative",skill_id:"Pest killer"})):e.size==="large"&&z({skill:p["Giant slayer"],xp_to_add:e.xp_value/i}),rn(l.stats.full.attack_points*o,e.stats.agility*Math.sqrt(e.stats.intuition??1))>Math.random()){jo++,l.equipment.weapon!=null?(s=Math.round(10*n*(1.2-Math.random()*.4))/10,z({skill:p[Rn[l.equipment.weapon.weapon_type]],xp_to_add:e.xp_value/i})):(s=Math.round(10*n*(1.2-Math.random()*.4))/10,z({skill:p.Unarmed,xp_to_add:e.xp_value/i}));let d=P.findIndex(c=>c===e);if(I.do_enemy_onhit_animations&&mr(d),l.stats.full.crit_rate>Math.random()?(s=Math.round(10*s*l.stats.full.crit_multiplier)/10,a=!0,No++):a=!1,s=Math.ceil(10*Math.max(s-Math.min(0,e.stats.defense-l.stats.full.armor_penetration),s*.1,1))/10,e.stats.health-=s,s>ms&&(ms=s),a?S(e.name+" was critically hit for "+s+" dmg","enemy_attacked_critically"):S(e.name+" was hit for "+s+" dmg","enemy_attacked"),e.stats.health<=0){Oo++,e.stats.health=0,S(e.name+" was defeated","enemy_defeated");let c=e.xp_value*P.length**.3334;ys(c/i,!0);let _=e.get_loot({drop_chance_modifier:1/P.length**.6667});_.length>0&&(Ra({loot_list:_,is_combat:!0}),_=_.map(h=>({item_key:u[h.item_id].getInventoryKey(),count:h.count})),ze(_)),Bu(e)}Ks()}else S(l.name+" has missed","hero_missed")}function Bu(e,t=!0){e.is_alive=!1,e.add_to_bestiary&&(Ot[e.name]?(Ot[e.name]+=1,_r(e.name)):(Ot[e.name]=1,_o(e.name)));let i=P.findIndex(n=>n===e);Cu(i),t&&(fa({quest_event_type:"kill",quest_event_target:e.id,quest_event_count:1}),Object.keys(e.tags||{}).forEach(n=>{fa({quest_event_type:"kill_any",quest_event_target:n,quest_event_count:1})}))}function oc({is_combat:e=!0}={}){e&&(Ho++,S(l.name+" has lost consciousness","hero_defeat"),si(),I.auto_return_to_bed&&vi?($t({location_id:vi}),Fo()):$t({location_id:v.parent_location.id})),_a("Recovering",5)}function Hu(e=1,t=!0){if(l.stats.full.stamina-=e/(t*l.stats.full.stamina_efficiency||1),l.stats.full.stamina<0&&(l.stats.full.stamina=0),l.stats.full.stamina<1){l.stats.full.health/l.stats.full.max_health<.2&&(e*=2);for(let i=0;i<ss.length;i++)he[ss[i]]&&(e*=1.19**i);z({skill:p.Persistence,xp_to_add:e}),Va()}Ki()}function z({skill:e,xp_to_add:t=1,should_info:i=!0,use_bonus:n=!0,add_to_parent:s=!0,cap_gained_xp:a=!0,is_from_loading:o=!1,do_quest_events:r=!0}){let d=!1;if(t==0)return d;if(t<0)return console.error(`Tried to add negative xp to skill ${e.skill_id}`),d;if(isNaN(t))return console.error(`Tried to add NaN xp to skill ${e.skill_id}`),d;n&&(t=t*hu*Lt(e.skill_id),e.parent_skill&&(t*=e.get_parent_xp_multiplier())),a&&typeof xp_to_next_lvl===Number&&(t=Math.min(t,e.xp_to_next_lvl*ks));let c=e.name(),_=e.visibility_treshold>e.total_xp,{message:h,gains:f,unlocks:y}=e.add_xp({xp_to_add:t,cap_gained_xp:a}),b=e.name();if(e.parent_skill&&s&&e.total_xp>p[e.parent_skill].total_xp){let k=Math.min(e.total_xp-p[e.parent_skill].total_xp,t);z({skill:p[e.parent_skill],xp_to_add:k,should_info:i,use_bonus:!1,add_to_parent:s,cap_gained_xp:!1,is_from_loading:o})}let w=e.visibility_treshold<=e.total_xp;if(_&&w&&(ro(e),Ji(e,!1),(typeof i>"u"||i)&&S(`Unlocked new skill: ${e.name()}`,"skill_raised")),f&&(l.stats.add_skill_milestone_bonus(f),e.skill_id==="Unarmed"&&l.stats.add_all_equipment_bonus()),w){if(c!==b&&rt[e.skill_id])for(let k=0;k<rt[e.skill_id].length;k++)Ji(p[rt[e.skill_id][k]],!1);typeof h<"u"?(d=!0,h=h.replace("%HeroName%",l.name),Ji(e,!0),(typeof i>"u"||i)&&Le(),typeof e.get_effect_description<"u"&&lr(e),e.is_parent?Za():xn(e),Ka(),De({source_name:e.skill_id,source_type:"skill",rewards:y,inform_overall:i}),(typeof i>"u"||i)&&S(h,"skill_raised"),c!==b&&(!_&&(typeof i>"u"||i)&&S(`Skill ${c} upgraded to ${b}`,"skill_raised"),v?.connected_locations&&!q&&Object.keys(v.activities).forEach(k=>{x[v.activities[k].activity_name].base_skills_names.includes(e.skill_id)&&Ya(x[k])}),Object.keys(l.inventory).forEach(k=>{let H=ye(k);if(H.tags.usable){let W=H.effects;for(let ce=0;ce<W.length;ce++)if(Z[W[ce].effect].effects?.bonus_skill_levels?.[e.skill_id]){we({item_key:k});return}}else H.tags.equippable&&H.getBonusSkillLevels()[e.skill_id]&&we({item_key:k})}),Object.keys(l.equipment).forEach(k=>{if(!l.equipment[k])return;l.equipment[k].getBonusSkillLevels()[e.skill_id]&&(Ui(),we({equip_slot:k}))}),kn()),nn[e.skill_id]&&!o&&(Ft=new Sn,Ft.fill_connections(m),xt={},xt[v.id]=Ft.find_shortest_paths(v.id)),Ea[e.skill_id]&&Object.keys(Ot).forEach(k=>{X[k].tags[Ea[e.skill_id]]&&dr(k)}),r&&fa({quest_event_type:"reach_skill",quest_event_target:e.skill_id,quest_event_count:e.current_level})):Ji(e,!1)}return d}function ys(e,t=!0,i){let n=l.add_xp({xp_to_add:e,use_bonus:i});n&&(t&&S(n,"level_up"),l.stats.full.health=l.stats.full.max_health,Le()),ir(n)}function Ou(e){let t=!1;if(e.enemy_groups_killed==e.enemy_count||e.is_challenge?(e.is_challenge&&lc({location:e,challenge_self_lock:!0}),t=!0,e.first_reward&&De({rewards:e.first_reward,source_type:"location",source_name:e.name,is_first_clear:!0,source_id:e.id})):e.repeatable_reward.xp&&typeof e.repeatable_reward.xp=="number"&&De({rewards:{xp:e.repeatable_reward.xp},source_type:"location",source_name:e.name,is_first_clear:!1,source_id:e.id}),e.rewards_with_clear_requirement)for(let i=0;i<e.rewards_with_clear_requirement.length;i++)e.enemy_groups_killed==e.enemy_count*e.rewards_with_clear_requirement[i].required_clear_count&&De({rewards:e.rewards_with_clear_requirement[i],source_type:"location",source_name:e.name,is_first_clear:!1,source_id:e.id});De({rewards:{...e.repeatable_reward,xp:null},source_type:"location",source_name:e.name,is_first_clear:!1,source_id:e.id}),e.otherUnlocks(),t&&v?.parent_location&&$t({location_id:v.parent_location.id})}function De({rewards:e={},source_type:t,source_name:i,is_first_clear:n,inform_overall:s=!0,inform_textline:a=!0,only_unlocks:o=!1,is_from_loading:r=!1}){let d=!1;if(e.messages&&!r)for(let c=0;c<e.messages.length;c++)S(e.messages[c]);if(e.money&&typeof e.money=="number"&&!o&&(s&&S(`${l.name} earned ${je(e.money)}`),Jr(e.money)),e.xp&&typeof e.xp=="number"&&!o&&(t==="location"?s&&(n?S(`Obtained ${e.xp}xp for clearing ${i} for the first time`,"location_reward"):S(`Obtained additional ${e.xp}xp for clearing ${i}`,"location_reward")):S(`Gained ${e.xp}xp`,"location_reward"),ys(e.xp)),e.skill_xp&&!o&&Object.keys(e.skill_xp).forEach(c=>{typeof e.skill_xp[c]=="number"&&(s&&S(`${l.name} gained ${e.skill_xp[c]}xp to ${p[c].name()}`),z({skill:p[c],xp_to_add:e.skill_xp[c],cap_gained_xp:!1}))}),e.locations)for(let c=0;c<e.locations.length;c++)d=Nu({location:m[e.locations[c].location],skip_message:s&&e.locations[c].skip_message})||d;if(e.flags)for(let c=0;c<e.flags.length;c++){let _=Ne[e.flags[c]];Ne[e.flags[c]]=!0,!_&&Ar[e.flags[c]]&&s&&S(`${Ar[e.flags[c]]}`,"activity_unlocked")}if(e.textlines)for(let c=0;c<e.textlines.length;c++){let _=!1;for(let h=0;h<e.textlines[c].lines.length;h++)$[e.textlines[c].dialogue].textlines[e.textlines[c].lines[h]].is_unlocked==!1&&(_=!0,$[e.textlines[c].dialogue].textlines[e.textlines[c].lines[h]].is_unlocked=!0);_&&a&&s&&!e.textlines[c].skip_message&&S(`You should talk to ${e.textlines[c].dialogue}`,"dialogue_unlocked")}if(e.dialogues)for(let c=0;c<e.dialogues?.length;c++){let _=$[e.dialogues[c]];_.is_unlocked||(_.is_unlocked=!0,S(`You can now talk with ${_.name}`,"activity_unlocked"))}if(e.traders)for(let c=0;c<e.traders.length;c++){let _=j[e.traders[c].trader];_.is_unlocked||(_.is_unlocked=!0,e.traders[c].skip_message||S(`You can now trade with ${_.name}`,"activity_unlocked"))}if(e.housing&&Object.keys(e.housing).forEach(c=>{m[c].housing.is_unlocked=!0}),e.global_activities)for(let c=0;c<e.global_activities?.length;c++)vu({activity_id:e.global_activities[c]});if(e.activities)for(let c=0;c<e.activities?.length;c++)(!m[e.activities[c].location].activities[e.activities[c].activity].tags?.gathering||Ne.is_gathering_unlocked)&&ku({location:m[e.activities[c].location].name,activity:m[e.activities[c].location].activities[e.activities[c].activity]});if(e.actions)for(let c=0;c<e.actions?.length;c++)e.actions[c].dialogue?Hr({dialogue:$[e.actions[c].dialogue]?.name,action:$[e.actions[c].dialogue].actions[e.actions[c].action]}):e.actions[c].location&&Hr({location:m[e.actions[c].location]?.name,action:m[e.actions[c].location].actions[e.actions[c].action]});if(e.stances)for(let c=0;c<e.stances.length;c++)Iu(e.stances[c]);if(e.skills){for(let c=0;c<e.skills.length;c++)if(!p[e.skills[c]].is_unlocked){p[e.skills[c]].is_unlocked=!0,ro(p[e.skills[c]]),Ji(p[e.skills[c]],!1),s&&S(`Unlocked new skill: ${p[e.skills[c]].name()}`),t==="skill"&&(rt[e.skills[c]]||(rt[e.skills[c]]=[]),p[i]?rt[e.skills[c]].push(i):console.error(`Tried to register skill "${i}" as related to "${e.skills[c]}", but the former does not exist!`));for(let _=0;_<rt[e.skills[c]]?.length;_++)Ji(p[rt[e.skills[c]][_]],!1)}}if(e.recipes)for(let c=0;c<e.recipes.length;c++)G[e.recipes[c].category][e.recipes[c].subcategory][e.recipes[c].recipe_id].is_unlocked||(G[e.recipes[c].category][e.recipes[c].subcategory][e.recipes[c].recipe_id].is_unlocked=!0,s&&S(`Unlocked new recipe: ${G[e.recipes[c].category][e.recipes[c].subcategory][e.recipes[c].recipe_id].name}`));if(e.quests)for(let c=0;c<e.quests.length;c++)me.isQuestActive(e.quests[c])||me.startQuest({quest_id:e.quests[c]});if(e.quest_progress)for(let c=0;c<e.quest_progress.length;c++){let _=e.quest_progress[c].quest_id,h=e.quest_progress[c].task_index;h==N[_].getCompletedTaskCount()&&(N[_]?.quest_tasks[h]?me.finishQuestTask({quest_id:_,task_index:h,skip_warning:!0}):console.warn(`Tried to complete ${h}'th task for quest '${_}', but either quest or index does not exist!`))}if(e.locks){if(e.locks.textlines&&Object.keys(e.locks.textlines).forEach(c=>{for(let _=0;_<e.locks.textlines[c].length;_++)$[c].textlines[e.locks.textlines[c][_]].is_finished=!0}),e.locks.locations)for(let c=0;c<e.locks.locations.length;c++)d=lc({location:m[e.locks.locations[c]]})||d;if(e.locks.traders)for(let c=0;c<e.locks.traders.length;c++)j[e.locks.traders[c]].is_finished=!0;if(e.locks.quests)for(let c=0;c<e.locks.quests.length;c++)me.finishQuest({quest_id:e.locks.quests[c],skip_rewards:!0})}if(e.items&&!o)for(let c=0;c<e.items.length;c++){let _=u[e.items[c]];S(`${l.name} obtained "${_.getName()} x1"`),ze([{item_key:_.getInventoryKey(),count:1}])}e.reputation&&!o&&(Object.keys(e.reputation).forEach(c=>{Lr.add_reputation({region:c,reputation:e.reputation[c]})}),so()),d&&!r&&(Ft=new Sn,Ft.fill_connections(m),xt={},xt[v.id]=Ft.find_shortest_paths(v.id)),e.move_to&&!o&&(t!=="action"?$t({location_id:e.move_to.location}):v=m[e.move_to.location])}function Nu({location:e,skip_message:t}){let i=!1;if(!e.is_unlocked){if(e.is_unlocked=!0,i=!0,!t){let n=e.unlock_text||`Unlocked location ${e.name}`;S(n,"location_unlocked")}v&&!Ze&&!Bn&&$t({location_id:v.id,skip_travel_time:!0})}return e.housing?.is_unlocked&&($n[e.id]=!0),i}function lc({location:e,challenge_self_lock:t=!1}){let i=!1;return at[e.id]&&(delete at[e.id],t||Da({location_id:e.id})),e.is_finished||(i=!0,e.is_finished=!0),kt===e.id&&(kt=null),i}function Pu({location_id:e}){if(at[e]){console.warn(`Tried to favourite location "${m[e].name}" despite it already being in favourites`);return}at[e]=!0,ta()}function rc({location_id:e,update_choices:t=!0}){if(!at[e]){console.warn(`Tried to unfavourite location "${m[e].name}" despite it not being in favourites`);return}delete at[e],ta(),t&&Da({location_id:e})}function ju(){P=null;for(let e=0;e<7;e++)is(e)}function cc(e,t=1){let i=e.parentNode.parentNode.dataset.crafting_category,n=e.parentNode.parentNode.dataset.crafting_subcategory,s=e.parentNode.dataset.recipe_id,a=v.crafting.tiers[i];if(!i||!n||!s)throw new Error(`Tried to use a recipe but either category, subcategory, or recipe id was not passed: ${i} - ${n} - ${s}`);if(G[i][n][s]){let o=G[i][n][s],r=document.querySelector(`[data-crafting_category="${i}"][data-crafting_subcategory="${n}"] [data-recipe_id="${s}"]`),d=!1,c,_;if(n==="items"){let{available_ammount:h,materials:f}=o.get_availability(),y=Math.min(t,h),b=y,w;if(y>0){let k=o.get_success_chance(a);c=o.getResult();let{result_id:H,count:W}=c,ce=p[o.recipe_skill],qe=ce.total_xp_to_next_lvl-ce.total_xp,He=Math.min(ce.xp_to_next_lvl*xs,wt({category:i,subcategory:n,recipe_id:s})*Lt(ce.skill_id)),Ie=He*k,Ce=Math.ceil(qe/Ie);b=Math.min(Ce,y),w=Math.floor(b*k);let Dt=Math.random()<b*k-w?1:0;w+=Dt;let Yt=(w+(b-w)/4)*He,tt=0,gt=0;if(b<y&&Yt<qe){for(let D=0;D<2&&b+tt+gt<y&&(Math.random()<k?tt++:gt++,!(Yt+He*(tt+gt/4)>=qe));D++);b+=tt+gt,w+=tt}_=Yt+He*(tt+gt/4),ca+=b,ua+=w;for(let D=0;D<o.materials.length;D++)if(o.materials[D].material_id){let Me=u[o.materials[D].material_id].getInventoryKey();ct([{item_key:Me,item_count:o.materials[D].count*b}])}for(let D=0;D<f.length;D++){let Me=u[f[D]].material_type,it=o.materials.find(se=>se.material_type===Me);ct([{item_key:u[f[D]].getInventoryKey(),item_count:it.count*b}])}if(w>0){ze([{item_key:u[H].getInventoryKey(),count:W*w}]);let D=`Created ${u[H].getName()}`;b>1?D+=` [${W*w} out of ${W*b}]`:D+=` x${W*w}`,S(D,"crafting")}else{let D=`Failed to create ${u[H].getName()}`;b>1?D+=` [0 out of ${W*b}]`:D+=` x${W*b}`,S(D,"crafting")}d=z({skill:ce,xp_to_add:_,cap_gained_xp:!1,use_bonus:!1}),Object.keys(u[H].tags).forEach(D=>{let Me=Qo[D];Me&&z({skill:p[Me],xp_to_add:_/2,cap_gained_xp:!0,use_bonus:!1})&&(l.stats.add_active_effect_bonus(),Le(),Object.keys(l.inventory).forEach(se=>{l.inventory[se].item.tags.medicine&&we({item_key:se})}))}),b<y?cc(e,y-b):(io(),Xl())}else console.warn("Tried to use a recipe without having enough materials!")}else if(n==="components"||o.recipe_type==="component"||o.recipe_type==="componentless"){let h=r.children[1].querySelector(".selected_material");if(h){let f=h.dataset.item_key,{id:y}=JSON.parse(f),b=o.materials.filter(w=>w.material_id===y)[0];if(b.count<=l.inventory[f]?.count){let w=p[o.recipe_skill],k=Math.min(t,Math.floor(l.inventory[f].count/b.count)),H=w.total_xp_to_next_lvl-w.total_xp,W=0,ce={},qe=0,He={},Ie=o.getResult(l.inventory[f].item,a),Ce;for(let D=0;D<k;D++){let Me=Ie.component_tier??Ie.item_tier;if(Ce=o.get_quality(a-Me),ce[Ce]=ce[Ce]+1||1,He[Ce]=He[Ce]+1||1,qe++,W+=Math.min(w.xp_to_next_lvl*xs,wt({category:i,subcategory:n,recipe_id:s,material_count:b.count,result_tier:Me,rarity_multiplier:ke[Ve(Ce)]})*Lt(w.skill_id)),W>=H){let se=Object.keys(ce).map(At=>Number(At)).sort((At,Vt)=>Vt-At)[0];qe>1?S(`Created ${Ie.getName()} x${qe} [highest quality: ${se}% x${ce[se]}] (+${Math.floor(W)} xp)`,"crafting"):S(`Created ${Ie.getName()} [${se}% quality] x1 (+${Math.floor(W)} xp)`,"crafting"),z({skill:w,xp_to_add:W,cap_gained_xp:!1,use_bonus:!1}),ce={},qe=0,W=0,H=w.total_xp_to_next_lvl-w.total_xp}}if(ca+=k,ua+=k,qe>0){let Me=Object.keys(ce).map(it=>Number(it)).sort((it,se)=>se-it)[0];qe>1?S(`Created ${Ie.getName()} x${qe} [highest quality: ${Me}% x${ce[Me]}] (+${Math.floor(W)} xp)`,"crafting"):S(`Created ${Ie.getName()} [${Me}% quality] x1 (+${Math.floor(W)} xp)`,"crafting"),z({skill:w,xp_to_add:W,cap_gained_xp:!1,use_bonus:!1})}let Dt=Ie.getInventoryKey(),Yt=JSON.parse(Dt),tt=Object.keys(He).map(D=>Number(D)),gt=[];for(let D=0;D<tt.length;D++){let Me=JSON.stringify({...Yt,quality:tt[D]});gt.push({item_key:Me,count:He[tt[D]]})}ze(gt),ct([{item_key:f,item_count:b.count*k}]),h.classList.remove("selected_material"),l.inventory[f]?b.count>l.inventory[f].count&&h.classList.add("recipe_unavailable"):h.remove(),to({category:i,subcategory:n,recipe_id:s,refreshing:!0})}else console.log("Tried to create an item without having necessary materials")}else return}else if(n==="equipment"){let h=r.children[1].children[0].children[1].querySelector(".selected_component")?.dataset.item_key,f=r.children[1].children[1].children[1].querySelector(".selected_component")?.dataset.item_key;if(!h||!f)return;if(!l.inventory[h]||!l.inventory[f])throw new Error("Tried to create item with components that are not present in the inventory!");if(l.inventory[h].count&&l.inventory[f].count){let y=p[o.recipe_skill],b=Math.min(t,l.inventory[h].count,l.inventory[f].count),w=y.total_xp_to_next_lvl-y.total_xp,k=0,H={},W=0,ce=l.inventory[h].item,qe=l.inventory[f].item,He={},Ie=o.getResult(ce,qe,a),Ce,Dt=o.get_component_quality_weighted(ce,qe),Yt=Math.max(ce.component_tier,qe.component_tier);for(let se=0;se<b;se++)if(Ce=o.get_quality(Dt,a-Math.max(Yt)||0),H[Ce]=H[Ce]+1||1,He[Ce]=He[Ce]+1||1,W++,k+=Math.min(y.xp_to_next_lvl,wt({category:i,subcategory:n,recipe_id:s,selected_components:[ce,qe],rarity_multiplier:ke[Ve(Ce)]})*Lt(y.skill_id)),k>=w){let Vt=Object.keys(H).map(On=>Number(On)).sort((On,wc)=>wc-On)[0];W>1?S(`Created ${Ie.getName()} x${W} [highest quality: ${Vt}% x${H[Vt]}] (+${Math.floor(k)} xp)`,"crafting"):S(`Created ${Ie.getName()} [${Vt}% quality] x1 (+${Math.floor(k)} xp)`,"crafting"),z({skill:y,xp_to_add:k,use_bonus:!1,cap_gained_xp:!1}),H={},W=0,k=0,w=y.total_xp_to_next_lvl-y.total_xp}if(ca+=b,ua+=b,W>0){let At=Object.keys(H).map(Vt=>Number(Vt)).sort((Vt,On)=>On-Vt)[0];W>1?S(`Created ${Ie.getName()} x${W} [highest quality: ${At}% x${H[At]}] (+${Math.floor(k)} xp)`,"crafting"):S(`Created ${Ie.getName()} [${At}% quality] x1 (+${Math.floor(k)} xp)`,"crafting"),z({skill:y,xp_to_add:k,use_bonus:!1,cap_gained_xp:!1})}let tt=Ie.getInventoryKey(),gt=JSON.parse(tt),D=Object.keys(He).map(se=>Number(se)),Me=[];for(let se=0;se<D.length;se++){let At=JSON.stringify({...gt,quality:D[se]});Me.push({item_key:At,count:He[D[se]]})}ze(Me),ct([{item_key:h,item_count:b},{item_key:f,item_count:b}]);let it={};it[h]=!0,it[f]=!0,eo({category:i,recipe_id:s,component_keys:it})}}}else throw new Error(`Tried to use a recipe that doesn't exist: ${i} -> ${n} -> ${s}`)}function Yo({content_type:e,data:t,what_to_remove:i=Mi.TOP}){zt.push({content_type:e,data:t,what_to_remove:i}),uc()}function ga(){let t=zt.pop().what_to_remove||Mi.TOP;if(t!==Mi.TOP)if(t===Mi.ALL)for(;zt[0];)zt.pop();else throw new Error(`No such content stack removal option as "${t}"`);uc()}function Wu({data:e}){zt.length>1&&(zt[zt.length-2].data.special=e)}function uc(){if(Ze?Ze=null:q?(q=null,ai()):Bn&&(Bn=null,ai(),clearInterval(ps)),zt.length){let{content_type:e,data:t}=zt[zt.length-1];if(e.startsWith("dialogue")&&(Ze=t.dialogue_key),e!=="dialogue"){if(e!=="dialogue_answer"){if(e!=="dialogue_branch")if(e==="action")Ze=t.dialogue_key,Bn=t.action_key;else if(e==="activity")q=t.activity;else throw new Error(`Error on switching action box content: no such content type as "${e}"`)}}e&&Ja({content_type:e,data:t})}else $t({location_id:v.id,skip_travel_time:!0})}function Ru(e){Er(e),P?zo():v.tags.safe_zone&&Object.keys(v.activities).forEach(t=>{v.activities[t].gained_resources&&Ya(v.activities[t])})}function Gu(e){$o(e),P&&zo()}function dc(e){let{id:t}=JSON.parse(e),i=u[t].effects,n=!1;for(let s=0;s<i.length;s++){let a=u[t].effects[s].duration;(!he[i[s].effect]||he[i[s].effect].duration<a)&&(he[i[s].effect]=new _e({...Z[i[s].effect],duration:a}),n=!0)}if(n){kn(),l.stats.add_active_effect_bonus(),Le();let s=[];Object.keys(u[t].recovery_chances).forEach(a=>{u[t].recovery_chances[a]>Math.random()&&s.push({item_id:a})}),ze(s),Object.keys(Li).forEach(a=>{u[t].tags[Li[a]]&&z({skill:p[a],xp_to_add:(u[t].value/10)**.6667})&&(l.stats.add_active_effect_bonus(),Le(),Object.keys(l.inventory).forEach(r=>{l.inventory[r].item.tags[Li[a]]&&we({item_key:r})}))}),ct([{item_key:e}])}}function Fu(e){if(u[e]){if(!u[e].tags.usable)throw new Error(`Tried to add "${e}" to auto consume, but it's not a consumable.`)}else throw new Error(`Tried to add "${e}" to auto consume, but no such item exists.`);Tt[e]=!0}function os(e){if(!Tt[e])throw new Error(`Tried to remove "${e}" from auto consume, but it's not there.`);delete Tt[e],l.inventory[u[e].getInventoryKey()]}function zu(e){if(u[e]){if(!u[e].tags.usable)throw new Error(`Tried to change "${e}" auto consume status, but it's not a consumable.`)}else throw new Error(`Tried to change "${e}" auto consum status, but no such item exists.`);Tt[e]?os(e):Fu(e),l.inventory[u[e].getInventoryKey()]}function _a(e,t){let i=!1;Object.keys(he).forEach(n=>{i||Object.keys(Z[n].group_tags).forEach(s=>{i||s in Z[e].group_tags&&(Z[n].group_tags[s]>Z[e].group_tags[s]?i=!0:delete he[n])})}),!i&&(he[e]=new _e({...Z[e],duration:t}),l.stats.add_active_effect_bonus(),kn(),Le())}function fa({quest_event_type:e,quest_event_target:t,quest_event_count:i}){me.catchQuestEvent({quest_event_type:e,quest_event_target:t,quest_event_count:i,additional_quest_tags:{location:v?.id||"",season:M.getSeason()||""}})}function Du(){_a("Spark of Inspiration",1800),S("Gained a Spark of Inspiration!","export_reward")}function _c(){let e=new Date,t=e.getFullYear(),i=e.getMonth()+1,n=i>9?i.toString():"0"+i.toString(),s=e.getDate()>9?e.getDate().toString():"0"+e.getDate().toString(),a=e.getHours()>9?e.getHours().toString():"0"+e.getHours().toString(),o=e.getMinutes()>9?e.getMinutes().toString():"0"+e.getMinutes().toString(),r=e.getSeconds()>9?e.getSeconds().toString():"0"+e.getSeconds().toString();return`${t}-${n}-${s} ${a}_${o}_${r}`}function Ct(){return window.location.href.endsWith("-dev/")}function _s(e){try{return JSON.parse(e)&&!!e}catch{return!1}}function mc(){try{let e={};e["game version"]=Ls,e["current time"]=M,e.language=St,e.saved_at=_c(),e.total_playtime=Bo,e.total_deaths=Ho,e.total_crafting_attempts=ca,e.total_crafting_successes=ua,e.total_kills=Oo,e.total_crits_done=No,e.total_crits_taken=Po,e.total_hits_done=jo,e.total_hits_taken=Wo,e.strongest_hit=ms,e.gathered_materials=hs,e.global_flags=Ne,e.last_rewarded_export=ln||0,e.character={name:l.name,titles:l.titles,inventory:{},equipment:l.equipment,money:l.money,xp:{total_xp:l.xp.total_xp},hp_to_full:l.stats.full.max_health-l.stats.full.health,stamina_to_full:l.stats.full.max_stamina-l.stats.full.stamina,reputation:l.reputation},e.player_storage={inventory:{}},e.rain_counter=an,e.cold_status_counters=sn,Object.keys(l.inventory).forEach(t=>{e.character.inventory[t]={count:l.inventory[t].count}}),Object.keys(st.inventory).forEach(t=>{e.player_storage.inventory[t]={count:st.inventory[t].count}}),e.favourite_consumables=Tt,e.recipes={},Object.keys(G).forEach(t=>{e.recipes[t]={},Object.keys(G[t]).forEach(i=>{e.recipes[t][i]={},Object.keys(G[t][i]).forEach(n=>{e.recipes[t][i][n]={},e.recipes[t][i][n].is_unlocked=G[t][i][n].is_unlocked,e.recipes[t][i][n].is_finished=G[t][i][n].is_finished})})}),e.skill_category_order=Se,e.skills={},Object.keys(p).forEach(function(t){p[t].is_parent||(e.skills[p[t].skill_id]={total_xp:p[t].total_xp})}),e["current location"]=v.id,e.locations={},Object.keys(m).forEach(function(t){e.locations[t]={},m[t].is_unlocked&&(e.locations[t].is_unlocked=!0),m[t].is_finished&&(e.locations[t].is_finished=!0),"parent_location"in m[t]&&(e.locations[t].enemy_groups_killed=m[t].enemy_groups_killed),m[t].activities&&(e.locations[t].unlocked_activities=[],Object.keys(m[t].activities).forEach(i=>{m[t].activities[i].is_unlocked&&e.locations[t].unlocked_activities.push(i)})),m[t].actions&&(e.locations[t].actions={},Object.keys(m[t].actions).forEach(i=>{(m[t].actions[i].is_unlocked||m[t].actions[i].is_finished)&&(e.locations[t].actions[i]={},m[t].actions[i].is_unlocked&&(e.locations[t].actions[i].is_unlocked=!0),m[t].actions[i].is_finished&&(e.locations[t].actions[i].is_finished=!0))})),m[t].housing?.is_unlocked&&(e.locations[t].housing_unlocked=!0)}),e.favourite_locations=at,e.activities={},Object.keys(x).forEach(function(t){x[t].is_unlocked&&(e.activities[t]={is_unlocked:!0})}),q&&(e.current_activity={activity_id:q.id,working_time:q.working_time,earnings:q.earnings,gathering_time:q.gathering_time,gathered_materials:q.gathered_materials}),e.dialogues={},Object.keys($).forEach(function(t){e.dialogues[t]={is_unlocked:$[t].is_unlocked,is_finished:$[t].is_finished,textlines:{},actions:{}},$[t].textlines&&Object.keys($[t].textlines).forEach(i=>{e.dialogues[t].textlines[i]={is_unlocked:$[t].textlines[i].is_unlocked,is_finished:$[t].textlines[i].is_finished}}),$[t].actions&&Object.keys($[t].actions).forEach(i=>{e.dialogues[t].actions[i]={is_unlocked:$[t].actions[i].is_unlocked,is_finished:$[t].actions[i].is_finished}})}),e.traders={},Object.keys(j).forEach(function(t){if(j[t].is_finished)e.traders[t]={is_unlocked:j[t].is_unlocked,is_finished:j[t].is_finished};else if(j[t].is_unlocked)if(j[t].last_refresh==-1||j[t].can_refresh())e.traders[t]={last_refresh:-1,is_unlocked:j[t].is_unlocked};else{let i={};Object.keys(j[t].inventory).forEach(n=>{i[n]={count:j[t].inventory[n].count}}),e.traders[t]={inventory:i,last_refresh:j[t].last_refresh,is_unlocked:j[t].is_unlocked,is_finished:j[t].is_finished}}}),e.books={},Object.keys(F).forEach(t=>{(F[t].accumulated_time>0||F[t].is_finished)&&(e.books[t]={accumulated_time:F[t].accumulated_time,is_finished:F[t].is_finished})}),e.quests={},Object.keys(N).forEach(t=>{e.quests[t]={is_active:t in Je,is_finished:N[t].is_finished,task_status:[]};for(let i=0;i<N[t].quest_tasks.length;i++)if(N[t].quest_tasks[i].is_finished)e.quests[t].task_status[i]={is_finished:!0};else if(t in Je){e.quests[t].task_status[i]={progress:Je[t].quest_tasks[i].task_condition};return}}),e.is_reading=et,e.is_sleeping=$i,e.active_effects=he,e.enemy_killcount=Ot,e.loot_sold_count=Y,e.last_combat_location=kt,e.last_location_with_bed=vi,e.options=I,e.stances={},Object.keys(ie).forEach(t=>{ie[t].is_unlocked&&(e.stances[t]=!0)}),e.current_stance=Te,e.selected_stance=mt,e.faved_stances=Rt,e.message_filters={unlocks:document.documentElement.style.getPropertyValue("--message_unlocks_display")!=="none",events:document.documentElement.style.getPropertyValue("--message_events_display")!=="none",combat:document.documentElement.style.getPropertyValue("--message_combat_display")!=="none",loot:document.documentElement.style.getPropertyValue("--message_loot_display")!=="none",background:document.documentElement.style.getPropertyValue("--message_background_display")!=="none",crafting:document.documentElement.style.getPropertyValue("--message_crafting_display")!=="none"},e.skill_list_state={};for(let t=0;t<_t.childElementCount;t++)e.skill_list_state[t]=_t.children[t].classList.contains("skill_category_expanded");return JSON.stringify(e)}catch(e){console.error("Something went wrong on saving the game!"),console.error(e),S("FAILED TO CREATE A SAVE FILE, PLEASE CHECK CONSOLE FOR ERRORS AND REPORT IT","message_critical")}}function Yu(){return Date.now()-ln>Io&&(ln=Date.now(),Du()),hc(),btoa(mc())}function Cn({key:e,is_manual:t}){let i=mc();return i&&(localStorage.setItem(e,i),t&&(S("Saved the game manually"),ds=0)),JSON.parse(i).saved_at}function hc(){Ct()?Cn({key:ft,is_manual:!0}):Cn({key:pt,is_manual:!0})}function To(e){try{let t=!1;M.loadTime(e["current time"]),Pr.innerHTML=M.toString(),Object.keys(e.global_flags||{}).forEach(a=>{a==="is_deep_forest_beaten"?Ne.is_strength_proved=e.global_flags[a]:Ne[a]=e.global_flags[a]}),e.language&&(An[e.language]?St=e.language:(console.warn(`Language ${e.language} could not be found.`),I.mofu_mofu_mode?St=An.mofu_english:St=An.english)),ln=e.last_rewarded_export||ln,Bo=e.total_playtime||0,Ho=e.total_deaths||0,ca=e.total_crafting_attempts||0,ua=e.total_crafting_successes||0,Oo=e.total_kills||0,No=e.total_crits_done||0,Po=e.total_crits_taken||0,jo=e.total_hits_done||0,Wo=e.total_hits_taken||0,ms=e.strongest_hit||0,hs=e.gathered_materials||{},da.value=e.character.name,l.name=e.character.name,vi=e.last_location_with_bed,kt=e.last_combat_location,I.uniform_text_size_in_action=e.options?.uniform_text_size_in_action,jr(I.uniform_text_size_in_action),I.auto_return_to_bed=e.options?.auto_return_to_bed,Wr(I.auto_return_to_bed),I.disable_combat_autoswitch=e.options?.disable_combat_autoswitch,Gr(I.disable_combat_autoswitch),I.remember_message_log_filters=e.options?.remember_message_log_filters,e.message_filters&&Object.keys(xi).forEach(a=>{xi[a]=e.message_filters[a]??!0}),Rr(I.remember_message_log_filters),I.log_every_gathering_period=e.options?.log_every_gathering_period,Fr(I.log_every_gathering_period),I.log_total_gathering_gain=e.options?.log_total_gathering_gain,zr(I.log_total_gathering_gain),I.do_background_animations=e.options?.do_background_animations,Yr(I.do_background_animations),I.skip_play_button=e.options?.skip_play_button,Vr(I.skip_play_button),I.mofu_mofu_mode=e.options?.mofu_mofu_mode,Qr(I.mofu_mofu_mode),I.do_enemy_onhit_animations=e.options?.do_enemy_onhit_animations,Ur(I.do_enemy_onhit_animations);let i=jn("v0.3.5",e["game version"])==1;l.money=(e.character.money||0)*((i==1)*10||1),mn(),ys(e.character.xp.total_xp,!1),an=e.rain_counter||0;for(let a=0;a<e.cold_status_counters?.length;a++)sn[a]=e.cold_status_counters[a]||0;if(Object.keys(e.favourite_consumables||{}).forEach(a=>{Tt[a]=!0}),Object.keys(e.character.reputation||{}).forEach(a=>{a in l.reputation?l.reputation[a]=e.character.reputation[a]:(console.warn(`Skipped reputation, no such region as "${a}"`),t=!0)}),so(),qt("Checking out your books"),e.skill_category_order&&e.skill_category_order.forEach((a,o)=>{Se[o]=a}),e.books){let a=0,o=e.skills.Literacy.total_xp;Object.keys(e.books).forEach(r=>{u[r]||(console.warn(`Book ${r} couldn't be found and was skipped!`),t=!0),e.books[r].accumulated_time>0&&(e.books[r].is_finished?(u[r].setAsFinished(),l.stats.add_book_bonus(F[r].bonuses),De({rewards:F[r].rewards,only_unlocks:!0,inform_overall:!1,is_from_loading:!0}),a+=F[r].required_time*F[r].literacy_xp_rate):(u[r].addProgress(e.books[r].accumulated_time),a+=F[r].accumulated_time*F[r].literacy_xp_rate)),mo(r,e.books[r].is_finished)}),a>o?(z({skill:p.Literacy,should_info:!1,xp_to_add:a,use_bonus:!1,cap_gained_xp:!1,is_from_loading:!0}),console.warn(`Saved XP for "Literacy skill" was less than it should be based on progress with books (${o} vs ${a}), so it was adjusted to match it!`),t=!0):z({skill:p.Literacy,should_info:!1,xp_to_add:o,use_bonus:!1,cap_gained_xp:!1,is_from_loading:!0})}Object.keys(e.skills).forEach(a=>{a!=="Literacy"&&(p[a]&&!p[a].is_parent?e.skills[a].total_xp>0&&z({skill:p[a],xp_to_add:e.skills[a].total_xp,should_info:!1,add_to_parent:!0,use_bonus:!1,cap_gained_xp:!1,is_from_loading:!0}):e.skills[a].total_xp>0&&(console.warn(`Skill "${a}" couldn't be found!`),t=!0))}),e.stances&&Object.keys(e.stances).forEach(a=>{e.stances&&(ie[a].is_unlocked=!0)}),ts(ie,Te,Rt),e.faved_stances&&Object.keys(e.faved_stances).forEach(a=>{ie[a]&&ie[a].is_unlocked&&ec(a)}),e.current_stance&&(Te=ie[e.current_stance.id]||ie[e.current_stance],mt=ie[e.selected_stance.id]||ie[e.selected_stance],Hn(mt.id)),Object.keys(e.character.equipment).forEach(function(a){if(e.character.equipment[a]!=null){let o=jn("v0.4.4",e["game version"])==1?100:1;if(a==="weapon"){let{quality:r,equip_slot:d}=e.character.equipment[a],c;if(e.character.equipment[a].components)c=e.character.equipment[a].components;else{let{head:_,handle:h}=e.character.equipment[a];c={head:_,handle:h}}if(!u[c.head])console.warn(`Skipped item: weapon head component "${c.head}" couldn't be found!`),t=!0;else if(!u[c.handle])console.warn(`Skipped item: weapon handle component "${c.handle}" couldn't be found!`),t=!0;else{let _=de({components:c,quality:r*o,equip_slot:d,item_type:"EQUIPPABLE"});oi(_)}}else if(a==="off-hand"){let{quality:r,equip_slot:d}=e.character.equipment[a],c;if(e.character.equipment[a].components)c=e.character.equipment[a].components;else{let{shield_base:_,handle:h}=e.character.equipment[a];c={shield_base:_,handle:h}}if(!u[c.shield_base])console.warn(`Skipped item: shield base component "${c.shield_base}" couldn't be found!`),t=!0;else if(!u[c.handle])console.warn(`Skipped item: shield handle "${c.handle}" couldn't be found!`),t=!0;else{let _=de({components:c,quality:r*o,equip_slot:d,item_type:"EQUIPPABLE"});oi(_)}}else if(e.character.equipment[a].equip_slot==="arti'fact"||e.character.equipment[a].tags?.tool)oi(de(e.character.equipment[a]));else{let{quality:r,equip_slot:d}=e.character.equipment[a];if(e.character.equipment[a].components&&e.character.equipment[a].components.internal.includes(" [component]")){let c=de({...u[e.character.equipment[a].components.internal.replace(" [component]","")],quality:r*o});oi(c)}else if(e.character.equipment[a].components){let c=e.character.equipment[a].components;if(!u[c.internal])console.warn(`Skipped item: internal armor component "${c.internal}" couldn't be found!`),t=!0;else if(c.external&&!u[c.external])console.warn(`Skipped item: external armor component "${c.external}" couldn't be found!`),t=!0;else{let _=de({components:c,quality:r*o,equip_slot:d,item_type:"EQUIPPABLE"});oi(_)}}else{let c=de({...u[e.character.equipment[a].name],quality:r*o});oi(c)}}}}),l.equipment.weapon===null&&oi(null);let n=[];Object.keys(e.character.inventory).forEach(a=>{if(_s(a)){let{id:o,components:r,quality:d}=JSON.parse(a);if(o&&!d)if(u[o])o==="Coal"&&Et(e["game version"],"v0.4.6.12")?n.push({item_key:u.Charcoal.getInventoryKey(),count:e.character.inventory[a].count,quality:d}):n.push({item_key:a,count:e.character.inventory[a].count,quality:d});else{console.warn(`Inventory item "${a}" from save on version "${e["game version"]} couldn't be found!`),t=!0;return}else if(r){let{head:c,handle:_,shield_base:h,internal:f,external:y}=r;if(c)if(u[c])if(u[_])n.push({item_key:a,count:e.character.inventory[a].count,quality:d});else{console.warn(`Skipped item: weapon handle component "${_}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: weapon head component "${c}" couldn't be found!`),t=!0;return}else if(h)if(u[h])if(u[_])n.push({item_key:a,count:e.character.inventory[a].count,quality:d});else{console.warn(`Skipped item: shield handle component "${_}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: shield base component "${h}" couldn't be found!`),t=!0;return}else if(f)if(u[f])if(u[y]){if(!sa(f))return;n.push({item_key:a,count:e.character.inventory[a].count,quality:d})}else{console.warn(`Skipped item: external armor component "${y}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: internal armor component "${f}" couldn't be found!`),t=!0;return}else console.error(`Intentory key "${a}" from save on version "${e["game version"]} seems to refer to non-existing item type!`)}else d?n.push({item_key:a,count:e.character.inventory[a].count,quality:d}):console.error(`Intentory key "${a}" from save on version "${e["game version"]} is incorrect!`)}else if(Array.isArray(e.character.inventory[a]))for(let o=0;o<e.character.inventory[a].length;o++)if(e.character.inventory[a][o].item_type==="EQUIPPABLE")if(e.character.inventory[a][o].equip_slot==="weapon"){let{quality:r}=e.character.inventory[a][o],d;if(e.character.inventory[a][o].components)d=e.character.inventory[a][o].components;else{let{head:c,handle:_}=e.character.inventory[a][o];d={head:c,handle:_}}if(!u[d.head])console.warn(`Skipped item: weapon head component "${d.head}" couldn't be found!`),t=!0;else if(!u[d.handle])console.warn(`Skipped item: weapon handle component "${d.handle}" couldn't be found!`),t=!0;else{let c=de({item_type:"EQUIPPABLE",equip_slot:"weapon",components:d});n.push({item_key:c.getInventoryKey(),count:1,quality:r*100})}}else if(e.character.inventory[a][o].equip_slot==="off-hand"){let{quality:r}=e.character.inventory[a][o],d;if(e.character.inventory[a][o].components)d=e.character.inventory[a][o].components;else{let{shield_base:c,handle:_}=e.character.inventory[a][o];d={shield_base:c,handle:_}}if(!u[d.shield_base])console.warn(`Skipped item: shield base component "${d.shield_base}" couldn't be found!`),t=!0;else if(!u[d.handle])console.warn(`Skipped item: shield handle "${d.handle}" couldn't be found!`),t=!0;else{let c=de({item_type:"EQUIPPABLE",equip_slot:"off-hand",components:d});n.push({item_key:c.getInventoryKey(),count:1,quality:r*100})}}else if(e.character.inventory[a][o].equip_slot==="artifact"||e.character.inventory[a][o].equip_slot==="amulet")n.push({item_key:a,count:1});else if(e.character.inventory[a][o].components&&e.character.inventory[a][o].components.internal.includes(" [component]"))n.push({item_key:a,count:1});else if(e.character.inventory[a][o].components){let r=e.character.inventory[a][o].components;if(!u[r.internal])console.warn(`Skipped item: internal armor component "${r.internal}" couldn't be found!`),t=!0;else if(r.external&&!u[r.external])console.warn(`Skipped item: external armor component "${r.external}" couldn't be found!`),t=!0;else{let d=de({item_type:"EQUIPPABLE",components:r});n.push({item_key:d.getInventoryKey(),count:1,quality:e.character.inventory[a][o].quality*100})}}else n.push({item_id:a,count:1});else n.push({item_id:a,count:1,quality:e.character.inventory[a][o].quality*100});else if(u[a])n.push({item_id:a,count:e.character.inventory[a].count});else{console.warn(`Inventory item "${a}" from save on version "${e["game version"]}" couldn't be found!`),t=!0;return}}),ze(n);let s=[];if(e.player_storage&&(Object.keys(e.player_storage.inventory).forEach(function(a){if(_s(a)){let{id:o,components:r,quality:d}=JSON.parse(a);if(o&&!d)if(u[o])s.push({item_key:a,count:e.player_storage.inventory[a].count,quality:d});else{console.warn(`Inventory item "${a}" from save on version "${e["game version"]} couldn't be found!`),t=!0;return}else if(r){let{head:c,handle:_,shield_base:h,internal:f,external:y}=r;if(c)if(u[c])if(u[_])s.push({item_key:a,count:e.player_storage.inventory[a].count,quality:d});else{console.warn(`Skipped item: weapon handle component "${_}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: weapon head component "${c}" couldn't be found!`),t=!0;return}else if(h)if(u[h])if(u[_])s.push({item_key:a,count:e.player_storage.inventory[a].count,quality:d});else{console.warn(`Skipped item: shield handle component "${_}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: shield base component "${h}" couldn't be found!`),t=!0;return}else if(f)if(u[f])if(u[y]){if(!sa(f))return;s.push({item_key:a,count:e.player_storage.inventory[a].count,quality:d})}else{console.warn(`Skipped item: external armor component "${y}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: internal armor component "${f}" couldn't be found!`),t=!0;return}else console.error(`Intentory key "${a}" from save on version "${e["game version"]} seems to refer to non-existing item type!`)}else d?s.push({item_key:a,count:e.player_storage.inventory[a].count,quality:d}):console.error(`Intentory key "${a}" from save on version "${e["game version"]} is incorrect!`)}}),st.add_to_inventory(s)),qt("Meowing at your cat"),Object.keys(e.dialogues).forEach(function(a){if($[a])$[a].is_unlocked=e.dialogues[a].is_unlocked,$[a].is_finished=e.dialogues[a].is_finished;else{if(a==="cute little rat"&&Et(e["game version"],"v0.5.0"))return;console.warn(`Dialogue "${a}" couldn't be found!`),t=!0;return}e.dialogues[a].textlines&&Object.keys(e.dialogues[a].textlines).forEach(o=>{if($[a].textlines[o])$[a].textlines[o].is_unlocked=e.dialogues[a].textlines[o].is_unlocked,$[a].textlines[o].is_finished=e.dialogues[a].textlines[o].is_finished;else{console.warn(`Textline "${o}" in dialogue "${a}" couldn't be found!`),t=!0;return}}),e.dialogues[a].actions&&Object.keys(e.dialogues[a].actions).forEach(o=>{if($[a].actions[o])$[a].actions[o].is_unlocked=e.dialogues[a].actions[o].is_unlocked,$[a].actions[o].is_finished=e.dialogues[a].actions[o].is_finished;else{console.warn(`Textline "${o}" in dialogue "${a}" couldn't be found!`),t=!0;return}})}),Object.keys(e.traders).forEach(function(a){let o=[];if(j[a]){if(j[a].is_unlocked=e.traders[a].is_unlocked,e.traders[a].is_finished){j[a].is_finished=!0;return}e.traders[a].inventory&&Object.keys(e.traders[a].inventory).forEach(function(r){if(_s(r)){let{id:d,components:c,quality:_}=JSON.parse(r);if(d&&!_)if(u[d])o.push({item_key:r,count:e.traders[a].inventory[r].count});else{console.warn(`Inventory item "${r}" from save on version "${e["game version"]} couldn't be found!`),t=!0;return}else if(c){let{head:h,handle:f,shield_base:y,internal:b,external:w}=c;if(h)if(u[h])if(u[f])o.push({item_key:r,count:1,quality:_});else{console.warn(`Skipped item: weapon handle component "${f}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: weapon head component "${h}" couldn't be found!`),t=!0;return}else if(y)if(u[y])if(u[f])o.push({item_key:r,count:1,quality:_});else{console.warn(`Skipped item: shield handle component "${f}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: shield base component "${y}" couldn't be found!`),t=!0;return}else if(b)if(u[b])if(u[w]){if(!sa(b))return;o.push({item_key:r,count:1,quality:_})}else{console.warn(`Skipped item: external armor component "${w}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: internal armor component "${b}" couldn't be found!`),t=!0;return}else console.error(`Intentory key "${r}" from save on version "${e["game version"]} seems to refer to non-existing item type!`)}else _?o.push({item_key:r,count:1,quality:_}):console.error(`Intentory key "${r}" from save on version "${e["game version"]} is incorrect!`)}else if(Array.isArray(e.traders[a].inventory[r]))for(let d=0;d<e.traders[a].inventory[r].length;d++)if(e.traders[a].inventory[r][d].item_type==="EQUIPPABLE")if(e.traders[a].inventory[r][d].equip_slot==="weapon"){let{quality:c}=e.traders[a].inventory[r][d],_;if(e.traders[a].inventory[r][d].components)_=e.traders[a].inventory[r][d].components;else{let{head:h,handle:f}=e.traders[a].inventory[r][d];_={head:h,handle:f}}if(!u[_.head])console.warn(`Skipped item: weapon head component "${_.head}" couldn't be found!`),t=!0;else if(!u[_.handle])console.warn(`Skipped item: weapon handle component "${_.handle}" couldn't be found!`),t=!0;else{let h=de({components:_,item_type:"EQUIPPABLE",equip_slot:"weapon"});o.push({item_key:h.getInventoryKey(),count:1,quality:c*100})}}else if(e.traders[a].inventory[r][d].equip_slot==="off-hand"){let{quality:c}=e.traders[a].inventory[r][d],_;if(e.traders[a].inventory[r][d].components)_=e.traders[a].inventory[r][d].components;else{let{shield_base:h,handle:f}=e.traders[a].inventory[r][d];_={shield_base:h,handle:f}}if(!u[_.shield_base])console.warn(`Skipped item: shield base component "${_.shield_base}" couldn't be found!`),t=!0;else if(!u[_.handle])console.warn(`Skipped item: shield handle "${_.handle}" couldn't be found!`),t=!0;else{let h=de({components:_,item_type:"EQUIPPABLE",equip_slot:"off-hand"});o.push({item_key:h.getInventoryKey(),count:1,quality:c*100})}}else{let{quality:c}=e.traders[a].inventory[r][d];if(e.traders[a].inventory[r][d].components&&e.traders[a].inventory[r][d].components.internal.includes(" [component]")){let _=de({...u[r]});o.push({item_key:_.getInventoryKey(),count:1,quality:c*100})}else if(e.traders[a].inventory[r][d].components){let _=e.traders[a].inventory[r][d].components;if(!u[_.internal])console.warn(`Skipped item: internal armor component "${_.internal}" couldn't be found!`),t=!0;else if(_.external&&!u[_.external])console.warn(`Skipped item: external armor component "${_.external}" couldn't be found!`),t=!0;else{let h=de({components:_,item_type:"EQUIPPABLE",equip_slot:"armor"});o.push({item_key:h.getInventoryKey(),count:1,quality:c*100})}}else o.push({item_id:r,count:1,quality:c*100})}else console.warn('Skipped item, no such item type as "0" could be found'),t=!0;else e.traders[a].inventory[r].item.value=u[r].value,u[r].item_type==="EQUIPPABLE"?e.traders[a].inventory[r].item.equip_effect=u[r].equip_effect:u[r].item_type==="USABLE"&&(e.traders[a].inventory[r].item.use_effect=u[r].use_effect),o.push({item_id:r,count:e.traders[a].inventory[r].count})}),j[a].refresh(),j[a].inventory={},Es(a,o),j[a].last_refresh=e.traders[a].last_refresh}else{console.warn(`Trader "${a} couldn't be found!`),t=!0;return}}),qt("Hiding rats in your walls"),Object.keys(e.locations).forEach(function(a){if(m[a]){if(e.locations[a].is_unlocked&&(m[a].is_unlocked=!0),e.locations[a].is_finished&&(m[a].is_finished=!0),"parent_location"in m[a]){if(m[a].enemy_groups_killed=e.locations[a].enemy_groups_killed||0,Et(e["game version"],"v0.4.6")){if(m[a].enemy_groups_killed/m[a].enemy_count>=1){let{rep_rew:o}=m[a].first_reward;o&&De({reputation:o,is_from_loading:!0})}if(m[a].rewards_with_clear_requirement)for(let o=0;o<m[a].rewards_with_clear_requirement.length;o++)m[a].enemy_groups_killed==m[a].enemy_count*m[a].rewards_with_clear_requirement[o].required_clear_count&&De({rewards:m[a].rewards_with_clear_requirement[o],source_type:"location",source_name:m[a].name,is_first_clear:!1,source_id:m[a].id,is_from_loading:!0})}else if(m[a].rewards_with_clear_requirement)for(let o=0;o<m[a].rewards_with_clear_requirement.length;o++)m[a].enemy_groups_killed==m[a].enemy_count*m[a].rewards_with_clear_requirement[o].required_clear_count&&De({rewards:m[a].rewards_with_clear_requirement[o],source_type:"location",source_name:m[a].name,is_first_clear:!1,source_id:m[a].id,only_unlocks:!0,is_from_loading:!0})}if(e.locations[a].unlocked_activities)for(let o=0;o<e.locations[a].unlocked_activities.length;o++)m[a].activities[e.locations[a].unlocked_activities[o]]&&(e.locations[a].unlocked_activities[o]==="plowing the fields"?m[a].activities.fieldwork.is_unlocked=!0:m[a].activities[e.locations[a].unlocked_activities[o]].is_unlocked=!0);e.locations[a].actions&&Object.keys(e.locations[a].actions).forEach(o=>{e.locations[a].actions[o].is_unlocked&&(m[a].actions[o].is_unlocked=!0),e.locations[a].actions[o].is_finished&&(m[a].actions[o].is_finished=!0)}),e.locations[a].housing_unlocked?Object.keys(m[a].housing).length?(m[a].housing.is_unlocked=!0,e.locations[a].is_unlocked&&($n[a]=!0)):(console.warn(`Location "${m[a].name}" was saved as having a bed unlocked, but it no longer has this mechanic and was skipped!`),t=!0):m[a].housing?.is_unlocked&&($n[a]=!0)}else{console.warn(`Location "${a}" couldn't be found!`),t=!0;return}}),Et(e["game version"],"v0.5")&&m["Nearby cave"].activities.climbing.is_unlocked&&(x.climbing.is_unlocked=!0),Et(e["game version"],"v0.4.6.7")&&(m["Town square"].is_unlocked=!1,e["current location"]==="Town square"&&(e["current location"]="Village")),Object.keys(e.activities).forEach(function(a){x[a]?x[a].is_unlocked=e.activities[a].is_unlocked||!1:a==="plowing the fields"?x.fieldwork.is_unlocked=e.activities[a].is_unlocked||!1:(console.warn(`Activity "${a}" couldn't be found!`),t=!0)}),Et(e["game version"],"v0.5")){let a={},o=Object.keys(Ae).length;Object.keys(e.loot_sold_count).forEach(r=>{let d=e.loot_sold_count[r];Object.keys(Ae).forEach(c=>{a[c]||(a[c]={}),a[c][r]=[{sold:0,recovered:0}],a[c][r][0].sold=Math.floor(d.sold/o),a[c][r][0].recovered=Math.floor(d.recovered/o)})}),wa(a),$["old craftsman"].textlines.learn.is_finished&&ze([{item_id:"Old shovel"}])}else wa(e.loot_sold_count||{});if(jn(e["game version"],"v0.4.4")>=0&&(Object.keys(e.active_effects).forEach(function(a){he[a]=new _e({...Z[a],duration:e.active_effects[a].duration})}),l.stats.add_active_effect_bonus()),qt("Hiding from the vet"),e.character.hp_to_full==null||e.character.hp_to_full>=l.stats.full.max_health?l.stats.full.health=1:l.stats.full.health=l.stats.full.max_health-e.character.hp_to_full,e.character.stamina_to_full==null||e.character.stamina_to_full>=l.stats.full.max_stamina?l.stats.full.stamina=0:l.stats.full.stamina=l.stats.full.max_stamina-e.character.stamina_to_full,qt("Hiding rats in your walls (again!)"),e.enemy_killcount&&Object.keys(e.enemy_killcount).forEach(a=>{Ot[a]=e.enemy_killcount[a],_o(a)}),qt("Looking for things that can be done tomorrow instead"),e.quests&&Object.keys(e.quests).forEach(a=>{if(e.quests[a].is_finished){for(let o=0;o<N[a].quest_tasks.length;o++)N[a].quest_tasks[o].is_finished=!0;me.startQuest({quest_id:a,should_inform:!1}),me.finishQuest({quest_id:a,should_inform:!1,only_unlocks:!0,is_from_loading:!0})}else if(e.quests[a].is_active){me.startQuest({quest_id:a,should_inform:!1});for(let d=0;d<e.quests[a].task_status.length-1;d++)N[a].quest_tasks[d].is_finished=!0;let o=e.quests[a].task_status.length-1,r=e.quests[a].task_status[o].progress;Object.keys(r||{}).forEach(d=>{if(!N[a].quest_tasks[o].task_condition[d]){console.warn(`Skipped loading progress for quest "${a}", no such task group as "${d}" was present.`),t=!0;return}Object.keys(r[d]).forEach(c=>{if(!N[a].quest_tasks[o].task_condition[d][c]){console.warn(`Skipped loading progress for quest "${a}", no such task type as "${c}" was present.`),t=!0;return}Object.keys(r[d][c]).forEach(_=>{if(!N[a].quest_tasks[o].task_condition[d][c][_]){console.warn(`Skipped loading progress for quest "${a}", no such task target as "${_}" was present.`),t=!0;return}N[a].quest_tasks[o].task_condition[d][c][_].current=r[d][c][_].current})})}),N[a].is_hidden||Dn(a)}}),Et(e["game version"],"v0.5.0")&&(me.startQuest({quest_id:"Lost memory",should_inform:!1}),$["village elder"].textlines["what happened"].is_finished&&(me.finishQuestTask({quest_id:"Lost memory",task_index:0,skip_message:!0}),$["village elder"].textlines["need to"].is_finished&&(me.finishQuestTask({quest_id:"Lost memory",task_index:1,skip_message:!0}),$["village elder"].textlines["cleared cave"].is_finished&&(me.finishQuestTask({quest_id:"Lost memory",task_index:2,skip_message:!0}),$["suspicious man"].textlines.defeated.is_finished&&me.finishQuestTask({quest_id:"Lost memory",task_index:3,skip_message:!0})))),m["Suspicious wall"].is_finished&&(me.startQuest({quest_id:"The Infinite Rat Saga",should_inform:!1}),m["Mysterious gate"].enemy_groups_killed>=m["Mysterious gate"].enemy_count&&(me.finishQuestTask({quest_id:"The Infinite Rat Saga",task_index:0,skip_message:!0}),m["Nearby cave"].actions["open the gate"].is_finished&&(me.finishQuestTask({quest_id:"The Infinite Rat Saga",task_index:1,skip_message:!0}),m["Writhing tunnel"].enemy_groups_killed>=m["Writhing tunnel"].enemy_count&&me.finishQuestTask({quest_id:"The Infinite Rat Saga",task_index:2,skip_message:!0})))),$["suspicious man"].textlines.gang.is_finished&&(me.startQuest({quest_id:"Light in the darkness",should_inform:!1}),me.finishQuestTask({quest_id:"Light in the darkness",task_index:0,skip_message:!0}),m["Gang hideout"].is_finished&&me.finishQuestTask({quest_id:"Light in the darkness",task_index:1,skip_message:!0})),$["farm supervisor"].textlines.fight0.is_finished&&(me.startQuest({quest_id:"Ploughs to swords",should_inform:!1}),$["farm supervisor"].textlines.fight.is_finished&&(me.finishQuestTask({quest_id:"Ploughs to swords",task_index:0,skip_message:!0}),$["farm supervisor"].textlines["defeated boars"].is_finished&&me.finishQuestTask({quest_id:"Ploughs to swords",task_index:1,skip_message:!0})))),qt("Mixing catnip with more catnip"),e.recipes&&Object.keys(e.recipes).forEach(a=>{Object.keys(e.recipes[a]).forEach(o=>{Object.keys(e.recipes[a][o]).forEach(r=>{if(!G[a][o][r]){if(Et(e["game version"],"v0.5.0")&&(a==="crafting"&&o==="items"&&(G.butchering.items[r]||G.woodworking.items[r])||r==="Shield base"||r==="Shield handle"))return;console.warn(`Could not find recipe "${a}"->"${o}"->"${r}". It might have been removed.`),t=!0;return}e.recipes[a][o][r].is_unlocked&&(G[a][o][r].is_unlocked=!0),e.recipes[a][o][r].is_finished&&(G[a][o][r].is_finished=!0)})})}),qt("Doing some finishing pats"),e.favourite_locations&&Object.keys(e.favourite_locations).forEach(a=>{m[a]?at[a]=!0:(console.warn(`Saved favourite locations included "${a}", which is not a valid location id`),t=!0)}),e.skill_list_state&&Object.keys(e.skill_list_state).forEach(a=>{_t.childElementCount>0&&e.skill_list_state[a]&&_t.children[a].classList.add("skill_category_expanded")}),Le(),we(),si(),kn(),Xs(),$t({location_id:e["current location"],skip_travel_time:!0,do_quest_events:!1,skip_combat:!0}),I.use_uncivilised_temperature_scale=e.options?.use_uncivilised_temperature_scale,Dr(I.use_uncivilised_temperature_scale),e.current_activity){let a=e.current_activity.activity_id;typeof a<"u"&&v.activities[a]&&x[v.activities[a].activity_name]?(Kr(a),x[v.activities[a].activity_name].type==="JOB"?(q.working_time=e.current_activity.working_time,q.earnings=e.current_activity.earnings*((i==1)*10||1),document.getElementById("action_end_earnings").innerHTML=`(earnings: ${je(q.earnings)})`):x[v.activities[a].activity_name].type==="GATHERING"&&(q.gathered_materials=e.current_activity.gathered_materials||{}),q.gathering_time=e.current_activity.gathering_time):(console.warn(`Couldn't find saved activity "${a}"! It might have been removed`),t=!0)}e.is_sleeping&&Fo(),e.is_reading&&Zr(e.is_reading),t&&br(),ao(),as(e["game version"])}catch(t){throw as(e["game version"]),t}}function Vu(e){try{Ct()?localStorage.setItem(ft,atob(e)):localStorage.setItem(pt,atob(e)),window.location.reload(!1)}catch(t){console.error("Something went wrong on preparing to load from file!"),console.error(t)}}function Qu(){try{Ct()?localStorage.getItem(ft)?(To(JSON.parse(localStorage.getItem(ft))),S("Loaded dev save. If you want to use save from live version, import it through options panel or manually")):(To(JSON.parse(localStorage.getItem(pt))),S("Dev save was not found. Loaded live version save.")):To(JSON.parse(localStorage.getItem(pt)))}catch(e){Or=!0,qt("Something went wrong \u{1F62D}"),wr(),console.error("Something went wrong on loading from localStorage!"),console.error(e)}}function Uu(){try{Ct()?localStorage.getItem(ha)?(localStorage.setItem(ft,localStorage.getItem(ha)),window.location.reload(!1)):(console.log("Can't load backup as there is none yet."),S("Can't load backup as there is none yet.")):localStorage.getItem(ma)?(localStorage.setItem(pt,localStorage.getItem(ma)),window.location.reload(!1)):(console.log("Can't load backup as there is none yet."),S("Can't load backup as there is none yet."))}catch(e){console.error("Something went wrong on loading from localStorage!"),console.error(e)}}function Ku(){try{Ct()?localStorage.getItem(pt)?(localStorage.setItem(ft,localStorage.getItem(pt)),window.location.reload(!1)):(console.log("There are no saves on the other release."),S("There are no saves on the other release.")):localStorage.getItem(ft)?(localStorage.setItem(pt,localStorage.getItem(ft)),window.location.reload(!1)):(console.log("There are no saves on the other release."),S("There are no saves on the other release."))}catch(e){console.error("Something went wrong on loading from localStorage!"),console.error(e)}}function Ju(){let e=prompt('This will erase all your progress and you will have to start from the very beginning. If you are sure this is what you want, type "reset" below');if(e==="reset"||e==='"reset"')return Ct()?localStorage.removeItem(ft):localStorage.removeItem(pt),window.location.reload(),!1;console.log("Hard reset was cancelled.")}function pc(e){let t=Si(M);M.goUp(e||($i?6:1)),t!==Si(M)&&Le(),ao()}function Xu({value:e=0,source:t}){pc(e),fc({time_in_minutes:e,is_sleep:$i,is_travel:t==="travel"})}function fc({time_in_minutes:e=1,is_travel:t}){let i=!1;return Object.keys(he).forEach(n=>{(!t||t&&he[n].affected_by_travel)&&(he[n].duration-=e,he[n].duration<=0&&(delete he[n],l.stats.add_active_effect_bonus(),Le(),i=!0))}),i}function gc(){setTimeout(()=>{Br=Date.now(),Ln+=Br-ra-1e3/re,ra=Date.now();let e=!1,t=M.day;pc(),ra-ln>Io?document.getElementById("save_to_file_button").classList.add("export_button_with_reward"):document.getElementById("save_to_file_button").classList.remove("export_button_with_reward"),gr(ra-ln,Io),M.day>t&&(Uo(lu,ru),Ko(cu),$s()&&(we({is_trade:!0}),Ht())),e=e||fc({time_in_minutes:1}),no(),kn();let n=Ta();Yn()&&!v.is_under_roof?(an>=qr?_a("Wet",30):n<0?an+=.25:an++,!oa&&I.do_background_animations&&(n>=0?(window.addEventListener("resize",Xi),window.removeEventListener("resize",Zi),window.removeEventListener("resize",ia),Xi()):(window.addEventListener("resize",Zi),window.removeEventListener("resize",Xi),window.removeEventListener("resize",ia),Zi())),oa=I.do_background_animations):(oa&&(ns(),window.removeEventListener("resize",Zi),window.removeEventListener("resize",Xi)),an>0&&an--,oa=!1),I.do_background_animations&&!Yn()&&!v.is_under_roof&&Si()&&(oa||!uu)&&(window.addEventListener("resize",ia),window.removeEventListener("resize",Zi),window.removeEventListener("resize",Xi)),So!==n&&(e||Le()),Qa(),So=n;let s=!1;for(let r=Mn.length-1;r>=0;r--)if(So+bi()<=Mn[r]){if(he.Wet&&sn[r]>=$r||sn[r]>=Mr){if(s)continue;_a(ss[r],60)}else sn[r]++;z({skill:p["Cold resistance"],xp_to_add:.2})}else sn[r]>0&&sn[r]--;if("parent_location"in v)Object.keys(Tt).forEach(r=>{let d=u[r].getInventoryKey();if(!l.inventory[d]){os(r);return}let c=u[r].effects.sort((_,h)=>I.auto_use_when_longest_runs_out?h.duration-_.duration:_.duration-h.duration);if(!he[c[0].effect]){dc(d);return}}),z({skill:p.Breathing,xp_to_add:.1});else{if($i?(qu(),z({skill:p.Sleeping,xp_to_add:v.housing?.sleeping_xp_per_tick})):(du&&xu(),et&&Mu()),mt.id!==Te.id&&Hn(mt.id),q){if(q.applied_effects)for(let d=0;d<q.applied_effects.length;d++)_a(q.applied_effects[d].effect,q.applied_effects[d].duration);if(x[q.activity_name].type!=="GATHERING")for(let d=0;d<x[q.activity_name].base_skills_names?.length;d++)z({skill:p[x[q.activity_name].base_skills_names[d]],xp_to_add:q.skill_xp_per_tick});if(x[q.activity_name].type==="TRAINING"?(z({skill:p.Breathing,xp_to_add:.5}),oo(q,!1)):z({skill:p.Breathing,xp_to_add:.1}),q.gathering_time+=1,q.gained_resources&&q.gathering_time>=q.gathering_time_needed){let{gathering_time_needed:d,gained_resources:c}=q.getActivityEfficiency();q.gathering_time_needed=d;let _=[];for(let f=0;f<c.length;f++)if(Math.random()>1-c[f].chance){let y=Math.floor(Math.random()*(c[f].count[1]-c[f].count[0]+1))+c[f].count[0];_.push({item_key:u[c[f].name].getInventoryKey(),count:y}),hs[c[f].name]=(hs[c[f].name]||0)+y}if(_.length>0){I.log_every_gathering_period&&Ra({loot_list:_});for(let f=0;f<_.length;f++)q.gathered_materials[_[f].item_key]=q.gathered_materials[_[f].item_key]+_[f].count||_[f].count;ze(_)}let h=!1;if(x[q.activity_name].type==="GATHERING"){for(let f=0;f<x[q.activity_name].base_skills_names?.length;f++)h=z({skill:p[x[q.activity_name].base_skills_names[f]],xp_to_add:q.skill_xp_per_tick})||h;Ya(q)}q.gathering_time=0}x[q.activity_name].type==="JOB"&&(q.working_time+=1,q.working_time%q.working_period==0&&(q.earnings+=q.get_payment())),oo(q,!1),En(q)||Ro()}else{z({skill:p.Breathing,xp_to_add:.1});let d=document.getElementsByClassName("activity_div");for(let c=0;c<d.length;c++){let _=v.activities[d[c].getAttribute("data-activity")];(x[_.activity_name].type==="JOB"||x[_.activity_name].type==="TRAINING")&&(En(_)?(d[c].classList.remove("activity_unavailable"),d[c].classList.add("start_activity")):(d[c].classList.remove("start_activity"),d[c].classList.add("activity_unavailable")))}}let r=v.getBackgroundNoises();r.length>0&&Math.random()<1/600&&S(`"${r[Math.floor(Math.random()*r.length)]}"`,"background"),q&&Math.random()<1/100&&(r=x[q.activity_name].getBackgroundNoises(),r.length>0&&S(`"${r[Math.floor(Math.random()*r.length)]}"`,"background"))}let a=0,o=0;if(l.stats.full.health_regeneration_flat&&(a+=l.stats.full.health_regeneration_flat),l.stats.full.health_regeneration_percent&&(a+=l.stats.full.max_health*l.stats.full.health_regeneration_percent/100),l.stats.full.health_loss_flat&&(o-=l.stats.full.health_loss_flat),l.stats.full.health_loss_percent&&(o+=l.stats.full.max_health*l.stats.full.health_loss_percent/100),Go({ammount_to_restore:a,ammount_to_loose:o}),l.stats.full.stamina_regeneration_flat&&(l.stats.full.stamina+=l.stats.full.stamina_regeneration_flat),l.stats.full.stamina_regeneration_percent&&(l.stats.full.stamina+=l.stats.full.max_stamina*l.stats.full.stamina_regeneration_percent/100),l.stats.full.mana_regeneration_flat&&(l.stats.full.mana+=l.stats.full.mana_regeneration_flat),l.stats.full.mana_regeneration_percent&&(l.stats.full.mana+=l.stats.full.max_mana*l.stats.full.mana_regeneration_percent/100),l.stats.full.stamina>l.stats.full.max_stamina&&(l.stats.full.stamina=l.stats.full.max_stamina),(l.stats.full.stamina_regeneration_flat||l.stats.full.stamina_regeneration_percent)&&Ki(),ds+=1,ds>=_u*re&&(ds=0,Ct()?Cn({key:ft}):Cn({key:pt}),console.log("Auto-saved the game!")),Lo+=1,Lo>=mu*re){Lo=0;let r;Ct()?r=Cn({key:ha}):r=Cn({key:ma}),r&&qn(r),console.log("Created an automatic backup!")}if(!$i&&v&&v.light_level==="normal"&&Si()&&z({skill:p["Night vision"],xp_to_add:1}),v){let r=v.gained_skills,d=!1;for(let c=0;c<r?.length;c++)d=z({skill:v.gained_skills[c].skill,xp_to_add:v.gained_skills[c].xp})||d;d&&Dl(v)}Ln<=100/re&&Ln>=-100/re?cs=Ln:Ln>100/re?cs=100/re:Ln<-100/re&&(cs=-100/re),Bo+=1/re,gc()},1e3/re-cs)}function yc(){typeof v>"u"&&$t({location_id:"Village",skip_travel_time:!0}),v.parent_location&&ac(),si(),ra=Date.now(),gc()}window.equip_item=Ru;window.unequip_item=Gu;window.change_location=$t;window.reload_normal_location=Su;window.handleLocationIconClick=gu;window.remove_location_from_favourites=rc;window.start_dialogue=$u;window.end_dialogue=Eu;window.start_textline=Lu;window.remove_fast_travel_choice=Da;window.start_activity=Kr;window.end_activity=Ro;window.start_game_action=yu;window.end_game_action=wu;window.start_sleeping=Fo;window.end_sleeping=Xr;window.start_reading=Zr;window.end_reading=fs;window.start_trade=al;window.exit_trade=ll;window.add_to_buying_list=rl;window.remove_from_buying_list=cl;window.add_to_selling_list=ul;window.remove_from_selling_list=dl;window.cancel_trade=sl;window.accept_trade=ol;window.is_in_trade=$s;window.update_displayed_total_price=Gl;window.open_storage=hl;window.exit_storage=pl;window.move_item_to_storage=fl;window.remove_item_from_storage=gl;window.is_storage_open=yl;window.format_money=je;window.get_character_money=l.get_character_money;window.use_item=dc;window.change_consumable_favourite_status=zu;window.do_enemy_combat_action=sc;window.sort_displayed_inventory=vn;window.update_displayed_character_inventory=we;window.update_displayed_trader_inventory=Ht;window.update_displayed_storage_inventory=Qs;window.sort_displayed_skills=es;window.change_stance=Hn;window.fav_stance=ec;window.openCraftingWindow=Yl;window.closeCraftingWindow=Vl;window.switchCraftingRecipesPage=Js;window.switchCraftingRecipesSubpage=Ql;window.useRecipe=cc;window.updateDisplayedComponentChoice=eo;window.updateDisplayedMaterialChoice=to;window.updateRecipeTooltip=Yi;window.remove_from_content_stack=ga;window.option_uniform_textsize=jr;window.option_bed_return=Wr;window.option_combat_autoswitch=Gr;window.option_remember_filters=Rr;window.option_log_all_gathering=Fr;window.option_log_gathering_result=zr;window.option_use_uncivilised_temperature_scale=Dr;window.option_do_background_animations=Yr;window.option_skip_play_button=Vr;window.option_mofu_mofu_mode=Qr;window.option_do_enemy_onhit_animations=Ur;window.getDate=_c;window.isOnDev=Ct;window.saveProgress=hc;window.save_to_file=Yu;window.load_progress=Vu;window.loadBackup=Uu;window.importOtherReleaseSave=Ku;window.hardReset=Ju;window.get_game_version=Ba;window.run=yc;window.Verify_Game_Objects=Sr;qt("Waking up from a nyap...");Ao.addEventListener("click",yc);Ao.addEventListener("click",yr);pt in localStorage||Ct()&&ft in localStorage?(Qu(),Le(),Ua()):(as(),ze([{item_id:"Cheap iron sword",quality:40},{item_id:"Cheap leather pants",quality:40},{item_id:"Stale bread",count:5}]),ys(0),l.money=102,mn(),Le(),ts(ie,Te,Rt),Hn("normal"),Xs(),$t({location_id:"Village",skip_travel_time:!0}),me.startQuest({quest_id:"Lost memory"}));Or?(go(),vr("Play...?"),yo()):(qt("Waiting for you to click 'PLAY'"),go(),yo());Ui();vn({sort_by:"name",target:"character"});I.skip_play_button&&Ao.click();Ct()?(S("It looks like you are playing on the dev release. It is recommended to keep the developer console open (in Chrome/Firefox/Edge it's at F12 => 'Console' tab) in case of any errors/warnings appearing in there.","notification"),localStorage[ha]?qn(JSON.parse(localStorage[ha]).saved_at):qn(),localStorage[pt]?na(JSON.parse(localStorage[pt]).saved_at||"",!0):na(null,!0)):(localStorage[ma]?qn(JSON.parse(localStorage[ma]).saved_at):qn(),localStorage[ft]?na(JSON.parse(localStorage[ft]).saved_at||""):na());})();
//# sourceMappingURL=bundle.js.map
