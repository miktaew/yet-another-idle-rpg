"use strict";(()=>{var Mc=Object.defineProperty;var $c=(e,t,i)=>t in e?Mc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Wn=(e,t,i)=>$c(e,typeof t!="symbol"?t+"":t,i);function ka(e){this.year=e.year,this.month=e.month,this.day=e.day,this.hour=e.hour,this.minute=e.minute,this.day_count=e.day_count??1,this.goUp=function(t){if(this.minute+=t??1,this.minute>=60){let i=this.minute%60,n=Math.floor(this.minute/60);this.minute=i,this.hour+=n}if(this.hour>=24){let i=this.hour%24,n=Math.floor(this.hour/24);this.hour=i,this.day+=n,this.day_count+=n}if(this.day>30){let i=this.day%30,n=Math.floor(this.day/30);this.day=i,this.month+=n}if(this.month>12){let i=this.month%12,n=Math.floor(this.month/12);this.month=i,this.year+=n}},this.goUp(0),this.loadTime=function(t){this.year=t.year,this.month=t.month,this.day=t.day,this.hour=t.hour,this.minute=t.minute,this.day_count=t.day_count},this.getSeason=function(t){let i;return t?i=this.month+Math.floor((this.day+t)/30):i=this.month,i>9?Ai[3]:i>6?Ai[2]:i>3?Ai[1]:Ai[0]},this.getTimeOfDay=function(){return this.hour>=21||this.hour<4?"Night":this.hour>=4&&this.hour<8?"Dawn":this.hour>=8&&this.hour<18?"Day":"Dusk"},this.getTimeOfDaySimple=function(){return this.hour>=21||this.hour<4?"Night":"Day"},this.getDayOfTheWeek=function(){switch(this.day_count%7){case 0:return"Sun";case 1:return"Mon";case 2:return"Tue";case 3:return"Wed";case 4:return"Thu";case 5:return"Fri";case 6:return"Sat"}}}ka.prototype.toString=function(){let e=(this.day>9?this.day:`0${this.day}`)+"/";return e+=(this.month>9?this.month:`0${this.month}`)+"/",e+=this.year+" ",e+=(this.hour>9?this.hour:`0${this.hour}`)+":",e+=(this.minute>9?this.minute:`0${this.minute}`)+", ",e+=this.getSeason()+", "+this.getDayOfTheWeek(),e};function bt({time:e,long_names:t,round:i=!0}){if(!e)throw"No time passed in arguments!";e.minutes=Math.ceil(e.minutes),i&&(e.minutes>=60&&(e.hours=e.hours+Math.floor(e.minutes/60)||Math.floor(e.minutes/60),e.minutes=e.minutes%60),e.hours>=24&&(e.days=e.days+Math.floor(e.hours/24)||Math.floor(e.hours/24),e.hours=e.hours%24),e.days>30&&(e.months=e.months+Math.floor(e.days/30)||Math.floor(e.days/30),e.days=e.days%30),e.months>12&&(e.years=e.years+Math.floor(e.months/12)||Math.floor(e.months/12),e.months=e.months%12));let n="";if(e.years>0){let s=e.years==1?"year":"years";n+=t?`${e.year} ${s} `:`${e.year}Y`}if(e.months>0){let s=e.months==1?"month":"months";n+=t?`${e.months} ${s} `:`${e.months}M`}if(e.days>0){let s=e.days==1?"day":"days";n+=t?`${e.days} ${s} `:`${e.days}D`}if(e.hours>0){let s=e.hours==1?"hour":"hours";n+=t?`${e.hours} ${s} `:`${e.hours}h`}if(e.minutes>0){let s=e.minutes==1?"minute":"minutes";n+=t?`${e.minutes} ${s} `:`${e.minutes}m`}return n}function pi(e){return e=e||M,e.hour>=20||e.hour<4}var Ai=["Spring","Summer","Autumn","Winter"],M=new ka({year:999,month:4,day:1,hour:8,minute:0,day_count:1});var We={strength:"str",health:"hp",max_health:"hp",health_regeneration_flat:"hp regen",health_regeneration_percent:"hp % regen",health_loss_flat:"hp loss",health_loss_percent:"hp % loss",stamina_regeneration_flat:"stam regen",stamina_regeneration_percent:"stam % regen",max_stamina:"stamina",agility:"agl",dexterity:"dex",magic:"magic",attack_speed:"attack speed",attack_power:"attack power",crit_rate:"crit rate",crit_multiplier:"crit dmg",stamina_efficiency:"stamina efficiency",intuition:"int",block_strength:"shield strength",hit_chance:"hit chance",evasion:"EP",evasion_points:"EP",attack_points:"AP",heat_tolerance:"heat resistance",cold_tolerance:"cold resistance",unarmed_power:"unarmed base dmg",armor_penetration:"armor pen",defense:"defense"},Ko={kill:"kill",kill_any:"kill",clear:"clear"},Hi={Medicine:"medicine",Gluttony:"food"},Jo={medicine:"Medicine"};function Xt(e,t=3){let i=1e6;return e==0?0:e>=i||e<.01?Number.parseFloat(e).toExponential(t).replace(/[+-]/g,""):e>10?Math.round(e).toLocaleString():e>1?(Math.round(e*10)/10).toLocaleString():(Math.round(e*100)/100).toLocaleString()}function $e(e){return e>19999?Math.ceil(e/1e3)*1e3:e>1999?Math.ceil(e/100)*100:e>199?Math.ceil(e/10)*10:Math.ceil(e)}function Bi(e){return e>=120?`${Math.floor(e/60)} hours`:e>=60?"1 hour":`${Math.round(e)} minutes`}function Rn(e){let t="",i=Math.floor(e/60),n=e%60;return i>0&&(i>1?t+=i+" hours":t+=i+" hour"),n>0&&(i>0&&(t+=" "),n>1?t+=n+" minutes":t+=n+" minute"),t}function _n(e,t){let i=e/(e+t);return i>=.8?i=.971+(i-.8)**1.4:i>=.7?i=.846+(i-.7)**.9:i>=.6?i=.688+(i-.6)**.8:i>=.5?i=.53+(i-.5)**.8:i>=.4?i=.331+(i-.4)**.7:i>=.3?i=.173+(i-.3)**.8:i>=.2?i=.073+(i-.2):i>=.1?i=.01+(i-.1)**1.2:i=0,i}function Gn(e,t){let i=e.replace("v","").split("."),n=t.replace("v","").split(".");i.length>n.length?n.push(...Array(i.length-n.length).fill("0")):n.length>i.length&&i.push(...Array(n.length-i.length).fill("0"));for(let s=0;s<i.length;s++){let a;if(Number.parseInt(i[s])&&Number.parseInt(n[s])?a=[Number.parseInt(i[s]),Number.parseInt(n[s])]:a=[i[s]||0,n[s]||0],a[0]!==a[1])return a[0]>a[1]?1:-1}return 0}function Xe(e,t){return Gn(e,t)<0}function Fn(e){return 32+Math.round(10*e*9/5)/10}var R={},Ee="type_",ks={},Be={Village:["Slums"]},Lt=500,Ec=Lt-1,Sc=Math.round(Lt/9),mn=200,Lc=mn-1,Ic=Math.round(mn/9);Object.keys(Be).forEach(e=>{R[e]={};for(let t=0;t<Be[e].length;t++)Be[Be[e][t]]?Be[Be[e][t]].includes(e)||Be[Be[e][t]].push(e):Be[Be[e][t]]=[e]});function Xo(){Object.keys(ks).forEach(e=>{R[e]={}})}function zn(e){Object.keys(e).forEach(t=>{R[t]={},Object.keys(e[t]).forEach(i=>{R[t][i]=[];for(let n=0;n<e[t][i].length;n++)if(e[t][i][n].sold<1e13)e[t][i][n].recovered==null&&(e[t][i][n].recovered=0),R[t][i].push({...e[t][i][n]});else{let a=Math.min(1e3,Math.round(1e3*(e[t][i][n].recovered/e[t][i][n].sold)))??0;R[t][i].push({sold:1e3,recovered:a}),console.warn(`Encountered a suspiciously large sold count of a trade group "${i}" at tier ${n} (${e[t][i][n].sold}). It has been reduced to a 1000, and it's recovered_count was lowered in proportion to it.`)}})})}function Zo(e=1,t=0){Object.keys(R).forEach(i=>{Object.keys(R[i]).forEach(n=>{for(let s=0;s<R[i][n].length;s++)R[i][n][s].recovered+=Math.max(t*(R[i][n][s].sold-R[i][n][s].recovered),e),R[i][n][s].recovered>R[i][n][s].sold&&(R[i][n][s].recovered=R[i][n][s].sold)})})}function el(e){let t={};Object.keys(Be).forEach(i=>{let n=Be[i].length;for(let s=0;s<n;s++){let a=Be[i][s];t[a]=t[a]||{},t[i]=t[i]||{},Object.keys(R[i]||{}).forEach(o=>{t[a][o]=t[a][o]||[],t[i][o]=t[i][o]||[];for(let l=0;l<R[i][o].length;l++){let u=R[i][o][l].sold-R[i][o][l].recovered,c=Math.floor(u*e);R[i][o][l].sold-=c;let _=Math.floor(c/n);t[i][o][l]?t[i][o][l].sold-=c:t[i][o][l]={...R[i][o][l]},t[a][o][l]||(R[a]?.[o]?.[l]?t[a][o][l]={...R[a][o][l]}:t[a][o][l]={sold:0,recovered:0}),t[a][o][l].sold+=_}})}}),zn(t)}function vs({is_group:e,value:t,how_many_sold:i}){let n=1,s,a;return e?(s=Lc,a=Ic):(s=Ec,a=Sc),i>=s?n=.1:i>0&&(n=n*a/(a+i)),Math.round(t*n)/t}function xs({region:e,group_key:t,group_tier:i}){if(!R[e][t])return 0;let n=[];for(let a=0;a<R[e][t]?.length;a++)n[a]=Math.max(0,R[e][t][a].sold-R[e][t][a].recovered);let s=t.startsWith(Ee)?mn:Lt;return hn({sold_by_tier:n,target_tier:i,cap:s})}function hn({sold_by_tier:e,target_tier:t,cap:i}){if(!e)return 0;let n=0;for(let s=t-1;s>=0;s--)n+=Math.max(e[s]??0)*.1**(t-s);n=Math.min(i/8,n),n+=e[t]??0;for(let s=t+1;s<e.length;s++)n+=Math.max(e[s]??0);return n}function tl({value:e,start_count:t,how_many_to_trade:i,is_group:n,is_selling:s=!0,stop_multiplier_at:a}){let o=0;if(s)for(let l=0;l<i;l++)o+=$e(e*vs({value:e,how_many_sold:Math.min(t+a,l+t),is_group:n}));else for(let l=0;l>-i;l--)o+=$e(e*vs({value:e,how_many_sold:Math.min(t+a,Math.max(l+t,0)),is_group:n}));return o}function il({value:e,group_key:t,group_tier:i,region:n}){let s=xs({region:n,group_key:t,group_tier:i});return Math.max(1,$e(e*vs({value:e,how_many_sold:s,is_group:t.startsWith(Ee)})))}function nl({group_key:e,group_tier:t,count:i,region:n}){R[n][e]||(R[n][e]=new Array(t+1).fill().map(s=>({sold:0,recovered:0}))),R[n][e][t]||R[n][e].push(...new Array(t+1-R[n][e].length).fill().map(s=>({sold:0,recovered:0}))),R[n][e][t].sold+=i||1}function al({group_key:e,group_tier:t,count:i,region:n}){!R[n][e]||!R[n][e][t]||(R[n][e][t].sold=Math.max(R[n][e][t].sold-(i||1),0),R[n][e][t].recovered=Math.min(R[n][e][t].recovered,R[n][e][t].sold))}var fi=class{constructor(){this.inventory={}}add_to_inventory(t){let i=!1;for(let n=0;n<t.length;n++){let s;if(t[n].item_key)s=t[n].item_key;else{let a;t[n].quality?a=_e({...d[t[n].item_id],quality:t[n].quality}):a=_e({...d[t[n].item_id]}),s=a.getInventoryKey()}if(s in this.inventory)if(t[n].count===void 0)this.inventory[s].count+=1;else if(typeof t[n].count=="number"&&!isNaN(t[n].count))this.inventory[s].count+=t[n].count;else throw new TypeError(`Tried to add "${t[n].count}" items, which is not a valid number!`);else{t[n].count||(t[n].count=1);let a=Oe(s);this.inventory[s]={item:a,count:t[n].count},i=!0}}return i}remove_from_inventory(t){for(let i=0;i<t.length;i++)if(t[i].item_key in this.inventory){if(typeof t[i].item_count=="number"&&Number.isInteger(t[i].item_count)&&t[i].item_count>=1?this.inventory[t[i].item_key].count-=t[i].item_count:this.inventory[t[i].item_key].count-=1,this.inventory[t[i].item_key].count==0)delete this.inventory[t[i].item_key];else if(this.inventory[t[i].item_key].count<0||isNaN(this.inventory[t[i].item_key].count))throw new Error(`Item count for key "${t[i].item_key}" reached an illegal value of "${this.inventory[t[i].item_key].count}"`)}else throw new Error("Tried to remove item that was not present in inventory")}};var K={items:{},components:{},equipment:{}},Zt={items:{}},pn={items:{}},Ge={items:{},components:{}},Oi={items:{}},Re={items:{}},ei={items:{},components:{}};function gi(e){return{components:Math.min(Math.round(100+2*G(e)),200),equipment:Math.min(Math.round(100+2.8*G(e)),250)}}var xa=class{constructor({name:t,id:i,is_unlocked:n=!0,recipe_type:s,result:a,getResult:o,recipe_level:l=[1,1],recipe_skill:u}){this.name=t,this.id=i||t,this.is_unlocked=n,this.recipe_type=s,this.result=a,this.getResult=o||function(){return this.result},this.recipe_level=l,this.recipe_skill=u}},N=class extends xa{constructor({name:t,id:i,materials:n=[],is_unlocked:s=!0,recipe_type:a,result:o,getResult:l,recipe_level:u,recipe_skill:c,success_chance:_=[1,1]}){super({name:t,id:i,is_unlocked:s,recipe_type:a,result:o,getResult:l,recipe_level:u,recipe_skill:c}),this.materials=n,this.success_chance=_,this.success_chance[0]==0&&(this.success_chance[0]=.1)}get_success_chance(t=1){let i=Math.min(this.recipe_level[1]-this.recipe_level[0]+1,Math.max(0,G(this.recipe_skill)-this.recipe_level[0]+1)),n=Math.min(1,(i+(t-1))/(this.recipe_level[1]-this.recipe_level[0]+1));return this.success_chance[0]*(this.success_chance[1]/this.success_chance[0])**n}get_availability(){let t=1/0,i=[];for(let n=0;n<this.materials.length;n++)if(this.materials[n].material_id){let s=d[this.materials[n].material_id].getInventoryKey();if(!r.inventory[s])return 0;t=Math.floor(Math.min(r.inventory[s].count/this.materials[n].count,t))}else if(this.materials[n].material_type){let s=[];if(Object.keys(r.inventory).forEach(a=>{r.inventory[a].item.material_type===this.materials[n].material_type&&r.inventory[a].count>=this.materials[n].count&&s.push(r.inventory[a])}),s.length==0)return 0;s=s.sort((a,o)=>a.item.getBaseValue()-o.item.getBaseValue()),t=Math.floor(Math.min(s[0].count/this.materials[n].count,t)),i.push(s[0].item.id)}return{available_ammount:t,materials:i}}},J=class extends N{constructor({name:t,id:i,materials:n=[],is_unlocked:s=!0,result:a,component_type:o,recipe_skill:l,item_type:u}){super({name:t,id:i,materials:n,is_unlocked:s,recipe_type:"component",result:a,recipe_level:[1,1],recipe_skill:l,getResult:null,success_rate:[1,1]}),this.component_type=o,this.item_type=u,this.getResult=function(c,_=1){let h=d[this.materials.filter(y=>y.material_id===c.id)[0].result_id],f=this.get_quality(_-h.component_tier||0);if(h.tags.clothing)return new Q({...d[h.id],quality:f});if(h.tags["armor component"])return new ae({...d[h.id],quality:f});if(h.tags["weapon component"])return new V({...d[h.id],quality:f});if(h.tags["shield component"])return new Fe({...d[h.id],quality:f});throw new Error(`Component recipe ${this.name} does not produce a valid result!`)}}get_quality_range(t=0){let i=p[this.recipe_skill],n=(130+(3*G(this.recipe_skill)-i.max_level)+15*t)/100;return[Math.max(10,Math.min(this.get_quality_cap(),Math.round(25*(n-.15))*4)),Math.max(10,Math.min(this.get_quality_cap(),Math.round(25*(n+.1))*4))]}get_quality_cap(){return this.item_type==="Armor"?gi(this.recipe_skill).equipment:gi(this.recipe_skill).components}get_is_quality_capped(){return this.get_quality_range()[0]>=this.get_quality_cap()}get_quality(t=0){let i=this.get_quality_range(t);return Math.round(((i[1]-i[0])*Math.random()+i[0])/4)*4}},qs=class extends N{constructor({name:t,id:i,materials:n=[],is_unlocked:s=!0,result:a,recipe_skill:o,item_type:l}){super({name:t,id:i,materials:n,is_unlocked:s,recipe_type:"componentless",result:a,recipe_level:[1,1],recipe_skill:o,getResult:null,success_rate:[1,1]}),this.item_type=l,this.getResult=function(u,c=1){let _=d[this.materials.filter(f=>f.material_id===u.id)[0].result_id],h=this.get_quality(c-_.item_tier||0);return new Nt({...d[_.id],quality:h})}}get_quality_range(t=0){let i=p[this.recipe_skill],n=(130+(3*G(this.recipe_skill)-i.max_level)+15*t)/100;return[Math.max(10,Math.min(this.get_quality_cap(),Math.round(25*(n-.15))*4)),Math.max(10,Math.min(this.get_quality_cap(),Math.round(25*(n+.1))*4))]}get_quality_cap(){return gi(this.recipe_skill).equipment}get_is_quality_capped(){return this.get_quality_range()[0]>=this.get_quality_cap()}get_quality(t=0){let i=this.get_quality_range(t);return Math.round(((i[1]-i[0])*Math.random()+i[0])/4)*4}},ct=class extends xa{constructor({name:t,id:i,components:n=[],is_unlocked:s=!0,result:a=null,recipe_skill:o="Crafting",item_type:l}){super({name:t,id:i,is_unlocked:s,recipe_type:"equipment",result:a,getResult:null,recipe_level:[1,1],recipe_skill:o,success_rate:[1,1]}),this.components=n,this.item_type=l,this.getResult=function(u,c,_=1){let h=this.get_component_quality_weighted(u,c),f=this.get_quality(h,_-Math.max(u.component_tier,c.component_tier)||0);if(this.item_type==="Weapon")return new fe({components:{head:u.id,handle:c.id},quality:f});if(this.item_type==="Armor")return new Q({components:{internal:u.id,external:c.id},quality:f});if(this.item_type==="Shield")return new Ze({components:{shield_base:u.id,handle:c.id},quality:f});throw new Error(`Recipe "${this.name}" has an incorrect item_type provided ("${this.item_type}")`)}}get_quality_range(t,i=0){let n=p[this.recipe_skill],s=50+t+(3*G(this.recipe_skill)-n.max_level)+10*i;return[Math.max(10,Math.min(this.get_quality_cap(),Math.round(s-15))),Math.max(10,Math.min(this.get_quality_cap(),Math.round(s+15)))]}get_quality_cap(){return gi(this.recipe_skill).equipment}get_quality(t,i=0){let n=this.get_quality_range(t,i);return Math.round(((n[1]-n[0])*Math.random()+n[0])/2)*2}get_component_quality_weighted(t,i){return(t.quality*t.component_tier+i.quality*i.component_tier)/(t.component_tier+i.component_tier)}};function vt({category:e,subcategory:t,recipe_id:i,material_count:n,result_tier:s,selected_components:a,rarity_multiplier:o}){if(!e||!t||!i)throw new Error(`Tried to use a recipe but either category, subcategory, or recipe id was not passed: ${e} - ${t} - ${i}`);let l=4,u=F[e][t][i],c=p[u.recipe_skill].current_level;if(!u)throw new Error(`Tried to use a recipe that doesn't exist: ${e} -> ${t} -> ${i}`);if(t==="items")l=Math.max(l,1.5*u.recipe_level[1])**1.1,u.recipe_level[1]<c&&(l=Math.max(1,l*Math.max(0,Math.min(5,u.recipe_level[1]+6-c)/5)));else if(t==="components"||u.recipe_type==="component"||u.recipe_type==="componentless"){let _=8*s;l=Math.max(l**1.2,(s*4)**1.1*n),_>c*o**.5?l=Math.max(.5*n,l*o):l=Math.max(.5*n,l*o*Math.max(0,Math.min(5,_*o**.5+5-c))/5)}else{let _=8*Math.max(a[0].component_tier,a[1].component_tier);l=Math.max(l,(a[0].component_tier+a[1].component_tier)*4)**1.1,_>c*o**.5?l=Math.max(1,l*o):l=Math.max(1,l*o*Math.max(0,Math.min(5,_*o**.5+5-c))/5)}return Math.round(10*l)/10}Ge.components["Short blade"]=new J({name:"Short blade",materials:[{material_id:"Low quality iron ingot",count:2,result_id:"Cheap short iron blade"},{material_id:"Iron ingot",count:2,result_id:"Short iron blade"},{material_id:"Steel ingot",count:2,result_id:"Short steel blade"}],item_type:"Component",recipe_skill:"Forging"}),Ge.components["Long blade"]=new J({name:"Long blade",materials:[{material_id:"Low quality iron ingot",count:3,result_id:"Cheap long iron blade"},{material_id:"Iron ingot",count:3,result_id:"Long iron blade"},{material_id:"Steel ingot",count:3,result_id:"Long steel blade"}],item_type:"Component",recipe_skill:"Forging"}),Ge.components["Axe head"]=new J({name:"Axe head",materials:[{material_id:"Low quality iron ingot",count:4,result_id:"Cheap iron axe head"},{material_id:"Iron ingot",count:4,result_id:"Iron axe head"},{material_id:"Steel ingot",count:4,result_id:"Steel axe head"}],item_type:"Component",recipe_skill:"Forging"}),Ge.components["Hammer head"]=new J({name:"Hammer head",materials:[{material_id:"Low quality iron ingot",count:4,result_id:"Cheap iron hammer head"},{material_id:"Iron ingot",count:4,result_id:"Iron hammer head"},{material_id:"Steel ingot",count:4,result_id:"Steel hammer head"}],item_type:"Component",recipe_skill:"Forging"}),Ge.components["Short hilt"]=new J({name:"Short hilt",materials:[{material_id:"Low quality iron ingot",count:1,result_id:"Cheap short iron hilt"},{material_id:"Iron ingot",count:1,result_id:"Short iron hilt"},{material_id:"Steel ingot",count:1,result_id:"Short steel hilt"}],item_type:"Component",recipe_skill:"Forging"}),Ge.components["Medium handle"]=new J({name:"Medium handle",materials:[{material_id:"Low quality iron ingot",count:2,result_id:"Cheap medium iron handle"},{material_id:"Iron ingot",count:2,result_id:"Medium iron handle"},{material_id:"Steel ingot",count:2,result_id:"Medium steel handle"}],item_type:"Component",recipe_skill:"Forging"}),Ge.components["Long shaft"]=new J({name:"Long shaft",materials:[{material_id:"Low quality iron ingot",count:4,result_id:"Cheap long iron shaft"},{material_id:"Iron ingot",count:4,result_id:"Long iron shaft"},{material_id:"Steel ingot",count:4,result_id:"Long steel shaft"}],item_type:"Component",recipe_skill:"Forging"}),K.components["Short hilt"]=new J({name:"Short hilt",materials:[{material_id:"Processed weak monster bone",count:1,result_id:"Short weak bone hilt"}],item_type:"Component",recipe_skill:"Crafting"}),K.components["Medium handle"]=new J({name:"Medium handle",materials:[{material_id:"Processed weak monster bone",count:2,result_id:"Medium weak bone handle"}],item_type:"Component",recipe_skill:"Crafting"}),K.components["Long shaft"]=new J({name:"Long shaft",materials:[{material_id:"Processed weak monster bone",count:4,result_id:"Long weak bone shaft"}],item_type:"Component",recipe_skill:"Crafting"}),ei.components["Short hilt"]=new J({name:"Short hilt",materials:[{material_id:"Processed rough wood",count:1,result_id:"Simple short wooden hilt"},{material_id:"Processed wood",count:1,result_id:"Short wooden hilt"},{material_id:"Processed ash wood",count:1,result_id:"Short ash wood hilt"}],item_type:"Component",recipe_skill:"Woodworking"}),ei.components["Medium handle"]=new J({name:"Medium handle",materials:[{material_id:"Processed rough wood",count:2,result_id:"Simple medium wooden handle"},{material_id:"Processed wood",count:2,result_id:"Medium wooden handle"},{material_id:"Processed ash wood",count:2,result_id:"Medium ash wood handle"}],item_type:"Component",recipe_skill:"Woodworking"}),ei.components["Long shaft"]=new J({name:"Long shaft",materials:[{material_id:"Processed rough wood",count:4,result_id:"Simple long wooden shaft"},{material_id:"Processed wood",count:4,result_id:"Long wooden shaft"},{material_id:"Processed ash wood",count:4,result_id:"Long ash wood shaft"}],item_type:"Component",recipe_skill:"Woodworking"});ei.components["Shield base"]=new J({name:"Shield base",materials:[{material_id:"Processed rough wood",count:6,result_id:"Crude wooden shield base"},{material_id:"Processed wood",count:6,result_id:"Wooden shield base"},{material_id:"Processed ash wood",count:6,result_id:"Ash wood shield base"}],item_type:"Component",recipe_skill:"Woodworking",component_type:"shield base"}),ei.components["Shield handle"]=new J({name:"Shield handle",materials:[{material_id:"Processed rough wood",count:4,result_id:"Basic shield handle"},{material_id:"Processed wood",count:4,result_id:"Wooden shield handle"},{material_id:"Processed ash wood",count:4,result_id:"Ash wood shield handle"}],item_type:"Component",recipe_skill:"Woodworking",component_type:"shield handle"}),Ge.components["Shield base"]=new J({name:"Shield base",materials:[{material_id:"Low quality iron ingot",count:5,result_id:"Crude iron shield base"},{material_id:"Iron ingot",count:5,result_id:"Iron shield base"},{material_id:"Steel ingot",count:5,result_id:"Steel shield base"}],item_type:"Component",recipe_skill:"Forging",component_type:"shield base"});K.components["Helmet exterior"]=new J({name:"Helmet exterior",materials:[{material_id:"Piece of wolf leather",count:3,result_id:"Wolf leather helmet armor"},{material_id:"Piece of boar leather",count:3,result_id:"Boar leather helmet armor"},{material_id:"Piece of bear leather",count:3,result_id:"Bear leather helmet armor"}],item_type:"Component",recipe_skill:"Crafting",component_type:"helmet exterior"}),Ge.components["Helmet exterior"]=new J({name:"Helmet exterior",materials:[{material_id:"Iron chainmail",count:3,result_id:"Iron chainmail helmet armor"},{material_id:"Steel chainmail",count:3,result_id:"Steel chainmail helmet armor"}],item_type:"Component",recipe_skill:"Forging",component_type:"helmet exterior"}),K.components["Chestplate exterior"]=new J({name:"Chestplate exterior",materials:[{material_id:"Piece of wolf leather",count:5,result_id:"Wolf leather chestplate armor"},{material_id:"Piece of boar leather",count:5,result_id:"Boar leather chestplate armor"},{material_id:"Piece of bear leather",count:5,result_id:"Bear leather chestplate armor"}],item_type:"Component",recipe_skill:"Crafting",component_type:"chestplate exterior"}),Ge.components["Chestplate exterior"]=new J({name:"Chestplate exterior",materials:[{material_id:"Iron chainmail",count:5,result_id:"Iron chainmail vest"},{material_id:"Steel chainmail",count:5,result_id:"Steel chainmail vest"}],item_type:"Component",recipe_skill:"Forging",component_type:"chestplate exterior"}),K.components["Leg armor exterior"]=new J({name:"Leg armor exterior",materials:[{material_id:"Piece of wolf leather",count:4,result_id:"Wolf leather greaves"},{material_id:"Piece of boar leather",count:4,result_id:"Boar leather greaves"},{material_id:"Piece of bear leather",count:4,result_id:"Bear leather greaves"}],item_type:"Component",recipe_skill:"Crafting",component_type:"leg armor exterior"}),Ge.components["Leg armor exterior"]=new J({name:"Leg armor exterior",materials:[{material_id:"Iron chainmail",count:4,result_id:"Iron chainmail greaves"},{material_id:"Steel chainmail",count:4,result_id:"Steel chainmail greaves"}],item_type:"Component",recipe_skill:"Forging",component_type:"leg armor exterior"}),K.components["Glove exterior"]=new J({name:"Glove exterior",materials:[{material_id:"Piece of wolf leather",count:3,result_id:"Wolf leather glove armor"},{material_id:"Piece of boar leather",count:3,result_id:"Boar leather glove armor"},{material_id:"Piece of bear leather",count:3,result_id:"Bear leather glove armor"}],item_type:"Component",recipe_skill:"Crafting",component_type:"glove exterior"}),Ge.components["Glove exterior"]=new J({name:"Glove exterior",materials:[{material_id:"Iron chainmail",count:3,result_id:"Iron chainmail glove"},{material_id:"Steel chainmail",count:3,result_id:"Steel chainmail glove"}],item_type:"Component",recipe_skill:"Forging",component_type:"Glove exterior"}),K.components["Shoes exterior"]=new J({name:"Shoes exterior",materials:[{material_id:"Piece of wolf leather",count:3,result_id:"Wolf leather shoe armor"},{material_id:"Piece of boar leather",count:3,result_id:"Boar leather shoe armor"},{material_id:"Piece of bear leather",count:3,result_id:"Bear leather shoe armor"}],item_type:"Component",recipe_skill:"Crafting",component_type:"shoes exterior"}),Ge.components["Shoes exterior"]=new J({name:"Shoes exterior",materials:[{material_id:"Iron chainmail",count:3,result_id:"Iron chainmail shoes"},{material_id:"Steel chainmail",count:3,result_id:"Steel chainmail shoes"}],item_type:"Component",recipe_skill:"Forging",component_type:"shoes exterior"});K.equipment.Axe=new ct({name:"Axe",components:["axe head","medium handle"],item_type:"Weapon"}),K.equipment.Dagger=new ct({name:"Dagger",components:["short blade","short handle"],item_type:"Weapon"}),K.equipment.Hammer=new ct({name:"Hammer",components:["hammer head","medium handle"],item_type:"Weapon"}),K.equipment.Spear=new ct({name:"Spear",components:["short blade","long handle"],item_type:"Weapon"}),K.equipment.Sword=new ct({name:"Sword",components:["long blade","short handle"],item_type:"Weapon"}),K.equipment.Shield=new ct({name:"Shield",components:["shield base","shield handle"],item_type:"Shield"}),K.equipment.Helmet=new ct({name:"Helmet",components:["helmet interior","helmet exterior"],item_type:"Armor"}),K.equipment.Chestplate=new ct({name:"Chestplate",components:["chestplate interior","chestplate exterior"],item_type:"Armor"}),K.equipment["Leg armor"]=new ct({name:"Leg armor",components:["leg armor interior","leg armor exterior"],item_type:"Armor"}),K.equipment.Gauntlets=new ct({name:"Gauntlets",components:["glove interior","glove exterior"],item_type:"Armor"}),K.equipment["Armored shoes"]=new ct({name:"Armored shoes",components:["shoes interior","shoes exterior"],item_type:"Armor"});K.equipment.Hat=new J({name:"Hat",materials:[{material_id:"Piece of wolf leather",count:3,result_id:"Leather hat"},{material_id:"Wool cloth",count:3,result_id:"Wool hat"},{material_id:"Piece of goat leather",count:3,result_id:"Goat leather hat"}],item_type:"Armor",component_type:"helmet interior",recipe_skill:"Crafting"}),K.equipment.Shirt=new J({name:"Shirt",materials:[{material_id:"Piece of wolf rat leather",count:5,result_id:"Cheap leather vest"},{material_id:"Piece of wolf leather",count:5,result_id:"Leather vest"},{material_id:"Wool cloth",count:5,result_id:"Wool shirt"},{material_id:"Piece of goat leather",count:5,result_id:"Goat leather vest"}],item_type:"Armor",component_type:"chestplate interior",recipe_skill:"Crafting"}),K.equipment.Pants=new J({name:"Pants",materials:[{material_id:"Piece of wolf rat leather",count:3,result_id:"Cheap leather pants"},{material_id:"Piece of wolf leather",count:3,result_id:"Leather pants"},{material_id:"Wool cloth",count:3,result_id:"Wool pants"},{material_id:"Piece of goat leather",count:3,result_id:"Goat leather pants"}],item_type:"Armor",component_type:"leg armor interior",recipe_skill:"Crafting"}),K.equipment.Gloves=new J({name:"Gloves",materials:[{material_id:"Piece of wolf leather",count:2,result_id:"Leather gloves"},{material_id:"Wool cloth",count:2,result_id:"Wool gloves"},{material_id:"Piece of goat leather",count:2,result_id:"Goat leather gloves"}],item_type:"Armor",component_type:"glove interior",recipe_skill:"Crafting"}),K.equipment.Shoes=new J({name:"Shoes",materials:[{material_id:"Piece of wolf rat leather",count:2,result_id:"Cheap leather shoes"},{material_id:"Piece of wolf leather",count:2,result_id:"Leather shoes"},{material_id:"Piece of goat leather",count:2,result_id:"Goat leather shoes"}],item_type:"Armor",component_type:"shoes interior",recipe_skill:"Crafting"});K.equipment.Cape=new qs({name:"Cape",materials:[{material_id:"Processed rat pelt",count:12,result_id:"Rat pelt cape"},{material_id:"Processed wolf pelt",count:8,result_id:"Wolf pelt cape"},{material_id:"Processed boar hide",count:8,result_id:"Boar hide cape"},{material_id:"Processed goat hide",count:8,result_id:"Goat hide cape"},{material_id:"Processed bear hide",count:8,result_id:"Bear hide cape"}],item_type:"Cape",recipe_skill:"Crafting"});(function(){Re.items["Piece of wolf rat leather"]=new N({name:"Piece of wolf rat leather",recipe_type:"material",materials:[{material_id:"Rat pelt",count:6}],result:{result_id:"Piece of wolf rat leather",count:1},success_chance:[.4,1],recipe_level:[1,5],recipe_skill:"Butchering"}),Re.items["Piece of wolf leather"]=new N({name:"Piece of wolf leather",recipe_type:"material",materials:[{material_id:"Wolf pelt",count:6}],result:{result_id:"Piece of wolf leather",count:1},success_chance:[.2,1],recipe_skill:"Butchering",recipe_level:[1,10]}),Re.items["Piece of boar leather"]=new N({name:"Piece of boar leather",recipe_type:"material",materials:[{material_id:"Boar hide",count:6}],result:{result_id:"Piece of boar leather",count:1},success_chance:[.2,1],recipe_skill:"Butchering",recipe_level:[5,15]}),Re.items["Piece of goat leather"]=new N({name:"Piece of goat leather",recipe_type:"material",materials:[{material_id:"Mountain goat hide",count:6}],result:{result_id:"Piece of goat leather",count:1},success_chance:[.2,1],recipe_skill:"Butchering",recipe_level:[5,15]}),Re.items["Piece of bear leather"]=new N({name:"Piece of bear leather",recipe_type:"material",materials:[{material_id:"Bear hide",count:6}],result:{result_id:"Piece of bear leather",count:1},success_chance:[.2,1],recipe_skill:"Butchering",recipe_level:[12,25]}),Re.items["Processed rat pelt"]=new N({name:"Processed rat pelt",recipe_type:"material",materials:[{material_id:"Rat pelt",count:6}],result:{result_id:"Processed rat pelt",count:1},success_chance:[.4,1],recipe_level:[1,5],recipe_skill:"Butchering"}),Re.items["Processed wolf pelt"]=new N({name:"Processed wolf pelt",recipe_type:"material",materials:[{material_id:"Wolf pelt",count:6}],result:{result_id:"Processed wolf pelt",count:1},success_chance:[.2,1],recipe_level:[1,10],recipe_skill:"Butchering"}),Re.items["Processed boar hide"]=new N({name:"Processed boar hide",recipe_type:"material",materials:[{material_id:"Boar hide",count:6}],result:{result_id:"Processed boar hide",count:1},success_chance:[.2,1],recipe_level:[5,15],recipe_skill:"Butchering"}),Re.items["Processed goat hide"]=new N({name:"Processed goat hide",recipe_type:"material",materials:[{material_id:"Mountain goat hide",count:6}],result:{result_id:"Processed goat hide",count:1},success_chance:[.2,1],recipe_level:[5,15],recipe_skill:"Butchering"}),Re.items["Processed bear hide"]=new N({name:"Processed bear hide",recipe_type:"material",materials:[{material_id:"Bear hide",count:6}],result:{result_id:"Processed bear hide",count:1},success_chance:[.2,1],recipe_level:[12,25],recipe_skill:"Butchering"}),K.items["Wool cloth"]=new N({name:"Wool cloth",recipe_type:"material",materials:[{material_id:"Wool",count:5}],result:{result_id:"Wool cloth",count:1},success_chance:[.1,1],recipe_skill:"Crafting",recipe_level:[5,15]}),K.items["Glass phial"]=new N({name:"Glass phial",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Raw Glass",count:1}],result:{result_id:"Glass phial",count:1},success_chance:[.1,1],recipe_level:[15,25],recipe_skill:"Crafting"}),K.items["Glass bottle"]=new N({name:"Glass bottle",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Raw Glass",count:3}],result:{result_id:"Glass bottle",count:1},success_chance:[.1,1],recipe_level:[15,25],recipe_skill:"Crafting"}),Ge.items["Iron chainmail"]=new N({name:"Iron chainmail",recipe_type:"material",materials:[{material_id:"Iron ingot",count:5}],result:{result_id:"Iron chainmail",count:1},success_chance:[.1,1],recipe_skill:"Forging",recipe_level:[5,15]}),Ge.items["Steel chainmail"]=new N({name:"Steel chainmail",recipe_type:"material",materials:[{material_id:"Steel ingot",count:5}],result:{result_id:"Steel chainmail",count:1},success_chance:[.1,1],recipe_skill:"Forging",recipe_level:[10,20]}),Re.items["Rat meat chunks"]=new N({name:"Rat meat chunks",recipe_type:"material",materials:[{material_id:"Rat tail",count:3}],result:{result_id:"Rat meat chunks",count:1},success_chance:[.4,1],recipe_level:[1,5],recipe_skill:"Butchering"}),pn.items["Low quality iron ingot"]=new N({name:"Low quality iron ingot",recipe_type:"material",materials:[{material_id:"Low quality iron ore",count:5},{material_type:"coal",count:1}],result:{result_id:"Low quality iron ingot",count:1},success_chance:[.6,1],recipe_level:[1,5],recipe_skill:"Smelting"}),pn.items["Iron ingot"]=new N({name:"Iron ingot",recipe_type:"material",materials:[{material_id:"Iron ore",count:5},{material_type:"coal",count:1}],result:{result_id:"Iron ingot",count:1},success_chance:[.4,1],recipe_level:[5,15],recipe_skill:"Smelting"}),pn.items["Steel ingot (inefficient)"]=new N({name:"Steel ingot (inefficient)",recipe_type:"material",materials:[{material_id:"Iron ore",count:5},{material_id:"Atratan ore",count:4},{material_type:"coal",count:2}],result:{result_id:"Steel ingot",count:1},success_chance:[.3,1],recipe_level:[10,20],recipe_skill:"Smelting",is_unlocked:!1}),pn.items["Raw Glass"]=new N({name:"Raw Glass",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Silica Sand",count:2},{material_id:"Potash",count:1}],result:{result_id:"Raw Glass",count:1},success_chance:[.2,1],recipe_level:[10,20],recipe_skill:"Smelting"}),ei.items["Processed rough wood"]=new N({name:"Processed rough wood",recipe_type:"material",materials:[{material_id:"Piece of rough wood",count:5}],result:{result_id:"Processed rough wood",count:1},success_chance:[.6,1],recipe_level:[1,5],recipe_skill:"Woodworking"}),ei.items["Processed wood"]=new N({name:"Processed wood",recipe_type:"material",materials:[{material_id:"Piece of wood",count:5}],result:{result_id:"Processed wood",count:1},success_chance:[.4,1],recipe_level:[5,15],recipe_skill:"Woodworking"}),ei.items["Processed ash wood"]=new N({name:"Processed ash wood",recipe_type:"material",materials:[{material_id:"Piece of ash wood",count:5}],result:{result_id:"Processed ash wood",count:1},success_chance:[.4,1],recipe_level:[10,20],recipe_skill:"Woodworking"}),Re.items["Processed weak monster bone"]=new N({name:"Processed weak monster bone",recipe_type:"material",materials:[{material_id:"Weak monster bone",count:5}],result:{result_id:"Processed weak monster bone",count:1},success_chance:[.1,1],recipe_level:[10,20],recipe_skill:"Butchering"}),pn.items.Charcoal=new N({name:"Charcoal",recipe_type:"material",materials:[{material_type:"raw wood",count:5}],result:{result_id:"Charcoal",count:1},success_chance:[.4,1],recipe_level:[1,10],recipe_skill:"Smelting"}),Zt.items["Animal fat"]=new N({name:"Animal fat",is_unlocked:!1,recipe_type:"usable",materials:[{material_id:"Boar meat",count:3}],result:{result_id:"Animal fat",count:1},success_chance:[.1,1],recipe_level:[7,20],recipe_skill:"Cooking"}),Re.items["High quality wolf fang"]=new N({name:"High quality wolf fang",recipe_type:"material",materials:[{material_id:"Wolf fang",count:50}],result:{result_id:"High quality wolf fang",count:1},success_chance:[.5,1],recipe_level:[1,7],recipe_skill:"Butchering"}),Re.items["High quality boar tusk"]=new N({name:"High quality boar tusk",recipe_type:"material",materials:[{material_id:"Boar tusk",count:50}],result:{result_id:"High quality boar tusk",count:1},success_chance:[.5,1],recipe_level:[5,12],recipe_skill:"Butchering"}),Re.items["Pristine mountain goat horn"]=new N({name:"Pristine mountain goat horn",recipe_type:"material",materials:[{material_id:"Mountain goat horn",count:50}],result:{result_id:"Pristine mountain goat horn",count:1},success_chance:[.5,1],recipe_level:[10,17],recipe_skill:"Butchering"}),Re.items["Sharp bear claw"]=new N({name:"Sharp bear claw",recipe_type:"material",materials:[{material_id:"Bear claw",count:50}],result:{result_id:"Sharp bear claw",count:1},success_chance:[.5,1],recipe_level:[13,20],recipe_skill:"Butchering"}),Oi.items.Potash=new N({name:"Potash",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Charcoal",count:10}],result:{result_id:"Potash",count:1},success_chance:[.5,1],recipe_level:[10,20],recipe_skill:"Alchemy"})})();(function(){K.items.Bonemeal=new N({name:"Bonemeal",is_unlocked:!0,recipe_type:"material",materials:[{material_type:"animal tooth",count:20}],result:{result_id:"Bonemeal",count:1},success_chance:[.1,1],recipe_level:[1,12],recipe_skill:"Crafting"})})();(function(){Zt.items["Roasted rat meat"]=new N({name:"Roasted rat meat",recipe_type:"usable",materials:[{material_id:"Rat meat chunks",count:2}],result:{result_id:"Roasted rat meat",count:1},success_chance:[.7,1],recipe_level:[1,5],recipe_skill:"Cooking"}),Zt.items["Roasted purified rat meat"]=new N({name:"Roasted purified rat meat",recipe_type:"usable",materials:[{material_id:"Rat meat chunks",count:2},{material_id:"Belmart leaf",count:1}],result:{result_id:"Roasted purified rat meat",count:1},success_chance:[.4,1],recipe_level:[1,10],recipe_skill:"Cooking"}),Zt.items["Fried pork"]=new N({name:"Fried pork",recipe_type:"usable",materials:[{material_id:"Boar meat",count:2}],result:{result_id:"Fried pork",count:1},success_chance:[.5,1],recipe_level:[7,15],recipe_skill:"Cooking"}),Zt.items["Fried goat meat"]=new N({name:"Fried goat meat",recipe_type:"usable",materials:[{material_id:"Goat meat",count:2}],result:{result_id:"Fried goat meat",count:1},success_chance:[.4,1],recipe_level:[10,15],recipe_skill:"Cooking"}),Zt.items["Pork roast"]=new N({name:"Pork roast",recipe_type:"usable",materials:[{material_id:"Boar meat",count:2},{material_id:"Cooking herbs",count:3}],result:{result_id:"Pork roast",count:1},success_chance:[.5,1],recipe_level:[10,20],recipe_skill:"Cooking"}),Zt.items["Goat stew"]=new N({name:"Goat stew",recipe_type:"usable",materials:[{material_id:"Goat meat",count:2},{material_id:"Cooking herbs",count:2}],result:{result_id:"Goat stew",count:1},success_chance:[.4,1],recipe_level:[15,25],recipe_skill:"Cooking"}),Zt.items["Bread kwas"]=new N({name:"Bread kwas",recipe_type:"usable",materials:[{material_type:"bread",count:2},{material_id:"Glass bottle",count:1}],result:{result_id:"Bread kwas",count:1},success_chance:[.3,1],recipe_level:[10,15],recipe_skill:"Cooking"}),Oi.items["Weak healing powder"]=new N({name:"Weak healing powder",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Golmoon leaf",count:5}],result:{result_id:"Weak healing powder",count:1},success_chance:[.4,1],recipe_level:[1,10],recipe_skill:"Alchemy"}),Oi.items["Healing powder"]=new N({name:"Healing powder",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Golmoon leaf",count:3},{material_id:"Silver thistle",count:3}],result:{result_id:"Healing powder",count:1},success_chance:[.1,1],recipe_level:[5,15],recipe_skill:"Alchemy"}),Oi.items["Oneberry juice"]=new N({name:"Oneberry juice",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Oneberry",count:10},{material_id:"Glass phial",count:1}],result:{result_id:"Oneberry juice",count:1},success_chance:[.5,1],recipe_level:[2,12],recipe_skill:"Alchemy"}),Oi.items["Healing potion"]=new N({name:"Healing potion",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Oneberry",count:8},{material_id:"Silver thistle",count:4},{material_id:"Glass phial",count:1}],result:{result_id:"Healing potion",count:1},success_chance:[.1,1],recipe_level:[7,17],recipe_skill:"Alchemy"}),Oi.items["Healing balm"]=new N({name:"Healing balm",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Oneberry",count:10},{material_id:"Golmoon leaf",count:5},{material_id:"Animal fat",count:1}],result:{result_id:"Healing balm",count:1},success_chance:[.1,1],recipe_level:[7,15],recipe_skill:"Alchemy"})})();(function(){K.items["Wolf trophy"]=new N({name:"Wolf trophy",recipe_type:"equipment",materials:[{material_id:"High quality wolf fang",count:4}],result:{result_id:"Wolf trophy",count:1},success_chance:[.5,1],recipe_level:[1,10],recipe_skill:"Crafting"}),K.items["Boar trophy"]=new N({name:"Boar trophy",recipe_type:"equipment",materials:[{material_id:"High quality boar tusk",count:4}],result:{result_id:"Boar trophy",count:1},success_chance:[.5,1],recipe_level:[5,15],recipe_skill:"Crafting"}),K.items["Mountain goat trophy"]=new N({name:"Mountain goat trophy",recipe_type:"equipment",materials:[{material_id:"Pristine mountain goat horn",count:4}],result:{result_id:"Mountain goat trophy",count:1},success_chance:[.5,1],recipe_level:[10,20],recipe_skill:"Crafting"}),K.items["Bear trophy"]=new N({name:"Bear trophy",recipe_type:"equipment",materials:[{material_id:"Sharp bear claw",count:4}],result:{result_id:"Bear trophy",count:1},success_chance:[.3,1],recipe_level:[15,25],recipe_skill:"Crafting"})})();var F={crafting:K,cooking:Zt,smelting:pn,forging:Ge,alchemy:Oi,butchering:Re,woodworking:ei};var p={},Ni={},Dn={axe:"Axes",dagger:"Daggers",hammer:"Hammers",sword:"Swords",spear:"Spears",staff:"Staffs",wand:"Wands"},yi="Crafting",Ms=.1,$s=.25,sl="?????",ut={},T=class{constructor({skill_id:t,names:i,description:n,flavour_text:s,max_level:a=60,max_level_coefficient:o=1,max_level_bonus:l=0,base_xp_cost:u=40,visibility_treshold:c=10,get_effect_description:_=()=>"",parent_skill:h=null,milestones:f={},xp_scaling:y=1.8,is_unlocked:b=!0,category:w}){if(t==="all"||t==="hero"||t==="all_skill")throw new Error(`Id "${t}" is not allowed for skills`);if(this.skill_id=t,this.names=i,this.description=n,this.flavour_text=s,this.current_level=0,this.max_level=a,this.max_level_coefficient=o,this.max_level_bonus=l,this.current_xp=0,this.total_xp=0,this.base_xp_cost=u,u<1/Ms&&console.warn(`Skill "${this.skill_id}" has base xp cost lower than what would be needed due to skill xp gains cap!`),this.visibility_treshold=c<u?c:u,this.is_unlocked=b,this.xp_to_next_lvl=u,this.total_xp_to_next_lvl=u,this.get_effect_description=_,this.is_parent=!1,w?this.category=w:(console.warn(`Skill "${this.skill_id}" has no category defined and was defaulted to miscellaneous`),this.category="Miscellaneous"),Ni[this.category]=!0,h)if(p[h])this.parent_skill=h,p[h].is_parent=!0;else throw new Error(`Skill "${h}" doesn't exist, so it can't be set as a parent skill`);this.milestones=f,this.xp_scaling=y>1?y:1.6}name(){if(this.visibility_treshold>this.total_xp||!this.is_unlocked)return sl;let t=Object.keys(this.names);if(t.length==1)return this.names[t[0]];{let n;for(var i=0;i<=t.length&&this.current_level>=parseInt(t[i]);i++)n=this.names[t[i]];return n}}add_xp({xp_to_add:t=0}){if(t==0||!this.is_unlocked)return{};t=Math.round(t*100)/100;let i=this.name();if(this.total_xp=Math.round(100*(this.total_xp+t))/100,this.current_level<this.max_level)if(Math.round(100*(t+this.current_xp))/100<this.xp_to_next_lvl)this.current_xp=Math.round(100*(this.current_xp+t))/100;else{let n=0,s={skills:[],recipes:[],quests:[]};for(;this.total_xp>=this.total_xp_to_next_lvl;)n+=1,this.total_xp_to_next_lvl=Math.round(100*this.base_xp_cost*(1-this.xp_scaling**(n+1))/(1-this.xp_scaling))/100,this.milestones[n]?.unlocks?.skills&&s.skills.push(...this.milestones[n].unlocks.skills),this.milestones[n]?.unlocks?.recipes&&s.recipes.push(...this.milestones[n].unlocks.recipes),this.milestones[n]?.unlocks?.quests&&s.quests.push(...this.milestones[n].unlocks.quests);let a=Math.round(100*this.base_xp_cost*(1-this.xp_scaling**n)/(1-this.xp_scaling))/100;n==0&&console.warn(`Something went wrong, calculated level of skill "${this.skill_id}" after a levelup was 0.
xp_added: ${t};
previous level: ${this.current_level};
total xp: ${this.total_xp};
total xp for that level: ${a};
total xp for next level: ${this.total_xp_to_next_lvl}`);let o;n<this.max_level?(o=this.get_bonus_stats(n),this.xp_to_next_lvl=Math.round(100*(this.total_xp_to_next_lvl-a))/100,this.current_level=n,this.current_xp=Math.round(100*(this.total_xp-a))/100):(o=this.get_bonus_stats(this.max_level),this.current_level=this.max_level,this.total_xp_to_next_lvl="Already reached max lvl",this.current_xp="Max",this.xp_to_next_lvl="Max"),i=i===sl?this.name():i;let l=`${i} has reached level ${this.current_level}`;return(Object.keys(o.stats).length>0||Object.keys(o.xp_multipliers).length>0)&&(l+=`<br><br> Thanks to ${i} reaching new milestone, %HeroName% gained: `,o.stats&&Object.keys(o.stats).forEach(u=>{o.stats[u].flat&&(l+=`<br> +${o.stats[u].flat} ${We[u].replace("_"," ")}`),o.stats[u].multiplier&&(l+=`<br> x${Math.round(100*o.stats[u].multiplier)/100} ${We[u].replace("_"," ")}`)}),o.xp_multipliers&&Object.keys(o.xp_multipliers).forEach(u=>{let c;u!=="all"&&u!=="hero"&&u!=="all_skill"&&!u.includes("category_")?(c=p[u].name(),p[u]||console.warn(`Skill ${this.skill_id} tried to reward an xp multiplier for something that doesn't exist: ${u}. I could be a misspelled skill name`)):c=u.replace("_"," "),u.includes("category_")?l+=`<br> x${Math.round(100*o.xp_multipliers[u])/100} ${c.replace("category_","")} skills xp gain`:l+=`<br> x${Math.round(100*o.xp_multipliers[u])/100} ${c} xp gain`})),{message:l,gains:o,unlocks:s}}return{}}get_bonus_stats(t){let i={stats:{},xp_multipliers:{}},n,s;for(let a=this.current_level+1;a<=t;a++)this.milestones[a]&&(n=this.milestones[a].stats,s=this.milestones[a].xp_multipliers,n&&Object.keys(n).forEach(o=>{i.stats[o]||(i.stats[o]={}),n[o].flat&&(i.stats[o].flat=(i.stats[o].flat||0)+n[o].flat),n[o].multiplier&&(i.stats[o].multiplier=(i.stats[o].multiplier||1)*n[o].multiplier)}),s&&Object.keys(s).forEach(o=>{i.xp_multipliers[o]=(i.xp_multipliers[o]||1)*s[o],ut[o]?ut[o].includes(this.skill_id)||ut[o].push(this.skill_id):ut[o]=[this.skill_id]}));return Object.keys(i.stats).forEach(a=>{i.stats[a].multiplier&&(i.stats[a].multiplier=Math.round(100*i.stats[a].multiplier)/100)}),i}get_coefficient({scaling_type:t,skill_level:i}){switch(t){case"flat":return 1+Math.round((this.max_level_coefficient-1)*(i||this.current_level)/this.max_level*1e3)/1e3;case"multiplicative":return Math.round(Math.pow(this.max_level_coefficient,(i||this.current_level)/this.max_level)*1e3)/1e3;default:return Math.round(Math.pow(this.max_level_coefficient,(i||this.current_level)/this.max_level)*1e3)/1e3}}get_level_bonus(t){return this.max_level_bonus*(t||this.current_level)/this.max_level}get_parent_xp_multiplier(){return this.parent_skill?1.1**Math.max(0,p[this.parent_skill].current_level-this.current_level):1}};function Es(e){let t="",i=p[e],n=Object.keys(i.milestones).filter(s=>s<=i.current_level);if(n.length>0){t=`lvl ${n[0]}: ${ol(i.milestones[n[0]])}`;for(let s=1;s<n.length;s++)t+=`<br>

lvl ${n[s]}: ${ol(i.milestones[n[s]])}`}else return"";return t}function Ss(e){return Object.keys(p[e].milestones).find(t=>t>p[e].current_level)}function ol(e){let t="";if(e.stats){let i="";Object.keys(e.stats).forEach(n=>{e.stats[n].flat&&(t?t+=`, +${e.stats[n].flat} ${We[n]}`:t=`+${e.stats[n].flat} ${We[n]}`),e.stats[n].multiplier&&(i?i+=`, x${e.stats[n].multiplier} ${We[n]}`:i=`x${e.stats[n].multiplier} ${We[n]}`)}),t?i&&(t+=", "+i):t=i}if(e.xp_multipliers){let i=Object.keys(e.xp_multipliers),n;i[0]!=="all"&&i[0]!=="hero"&&i[0]!=="all_skill"?i[0].includes("category_")?n=i[0].replace("category_","")+" skills":n=p[i[0]].name():n=i[0].replace("_"," "),t?t+=`, x${e.xp_multipliers[i[0]]} ${n} xp gain`:t=`x${e.xp_multipliers[i[0]]} ${n} xp gain`;for(let s=1;s<i.length;s++){let a;i[s]!=="all"&&i[s]!=="hero"&&i[s]!=="all_skill"?i[s].includes("category_")?a=i[s].replace("category_","")+" skills":a=p[i[s]].name():a=i[s].replace("_"," "),t+=`, x${e.xp_multipliers[i[s]]} ${a} xp gain`}}if(e.unlocks){if(e.unlocks.skills){let i=e.unlocks.skills;t?t+=`, <br> Unlocked skill "${e.unlocks.skills[0]}"`:t=`Unlocked skill "${e.unlocks.skills[0]}"`;for(let n=1;n<i.length;n++)t+=`, "${e.unlocks.skills[n]}"`}if(e.unlocks.recipes){let i=e.unlocks.recipes.length>1?"new recipes":"a new recipe";t?t+=`, <br> Unlocked ${i}`:t=`Unlocked ${i}`}}return t}(function(){p.Combat=new T({names:{0:"Combat"},category:"Combat",description:"Overall combat ability",max_level_coefficient:2,base_xp_cost:60,get_effect_description:()=>`Multiplies AP by ${Math.round(A({skill_id:"Combat",scaling_type:"multiplicative"})*1e3)/1e3}`}),p["Pest killer"]=new T({names:{0:"Pest killer",15:"Pest slayer"},description:"Small enemies might not seem very dangerous, but it's not that easy to hit them!",max_level_coefficient:2,category:"Combat",base_xp_cost:100,get_effect_description:()=>`Multiplies AP against small-type enemies by ${Math.round(A({skill_id:"Pest killer",scaling_type:"multiplicative"})*1e3)/1e3}`,milestones:{1:{xp_multipliers:{Combat:1.05}},2:{xp_multipliers:{category_Combat:1.05}},3:{stats:{dexterity:{flat:1}}},5:{stats:{dexterity:{multiplier:1.05}},xp_multipliers:{Evasion:1.05,"Shield blocking":1.05}},7:{stats:{dexterity:{flat:1}},xp_multipliers:{Combat:1.05}},10:{stats:{dexterity:{multiplier:1.05}},xp_multipliers:{category_Combat:1.05}},12:{stats:{dexterity:{flat:2}},xp_multipliers:{Combat:1.05}}}}),p["Giant slayer"]=new T({names:{0:"Giant killer",15:"Giant slayer"},description:"Large opponents might seem scary, but just don't get hit and you should be fine!",max_level_coefficient:2,category:"Combat",get_effect_description:()=>`Multiplies EP against large-type enemies by ${Math.round(A({skill_id:"Giant slayer",scaling_type:"multiplicative"})*1e3)/1e3}`}),p.Evasion=new T({names:{0:"Evasion"},description:"Ability to evade attacks. You cannot do it while using a shield",max_level_coefficient:2,base_xp_cost:20,category:"Combat",get_effect_description:()=>`Multiplies EP by ${Math.round(A({skill_id:"Evasion",scaling_type:"multiplicative"})*1e3)/1e3}`,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{agility:{flat:1}},xp_multipliers:{Equilibrium:1.05}},5:{stats:{agility:{flat:1,multiplier:1.05}}},7:{stats:{agility:{flat:2}},xp_multipliers:{Equilibrium:1.05}},10:{stats:{agility:{flat:1,multiplier:1.05}}},12:{stats:{agility:{flat:2}},xp_multipliers:{Equilibrium:1.05}}}}),p["Shield blocking"]=new T({names:{0:"Shield blocking"},description:"Ability to block attacks with shield. You cannot evade while using one",max_level:30,max_level_bonus:.2,category:"Combat",get_effect_description:()=>`Increases block chance by flat ${Math.round(kt("Shield blocking")*1e3)/10}%. Increases blocked damage by ${Math.round(kt("Shield blocking")*5e3)/10}%`}),p.Unarmed=new T({names:{0:"Unarmed",10:"Brawling",20:"Martial arts"},description:"It's definitely, unquestionably, undoubtedly better to just use a weapon instead of doing this. But sure, why not?",category:"Combat",get_effect_description:()=>`Multiplies damage dealt in unarmed combat by ${Math.round(A({skill_id:"Unarmed",scaling_type:"multiplicative"})*1e3)/1e3}. 
Multiplies attack speed, EP and AP in unarmed combat by ${Math.round(A({skill_id:"Unarmed",scaling_type:"multiplicative"})**.3333*1e3)/1e3}.
Adds ${p.Unarmed.current_level/10} base damage to unarmed attacks`,max_level_coefficient:64,milestones:{2:{stats:{strength:{flat:1}},xp_multipliers:{Weightlifting:1.05}},4:{stats:{strength:{flat:1},dexterity:{flat:1}}},6:{stats:{strength:{flat:1},dexterity:{flat:1},agility:{flat:1}},xp_multipliers:{Weightlifting:1.1}},8:{stats:{strength:{flat:1},dexterity:{flat:1},agility:{flat:1}}},10:{stats:{strength:{flat:2},dexterity:{flat:1},agility:{flat:1}},xp_multipliers:{Running:1.2}},12:{stats:{strength:{flat:2},dexterity:{flat:2},agility:{flat:2}}}}})})();(function(){p["Stance mastery"]=new T({names:{0:"Stance proficiency",10:"Stance mastery"},description:"Knowledge on how to apply different stances in combat",base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Increases xp gains of all combat stance skills of level lower than this, x1.1 per level of difference"}),p["Quick steps"]=new T({names:{0:"Quick steps"},parent_skill:"Stance mastery",description:"A swift and precise technique that abandons strength in favor of greater speed",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Improves efficiency of the 'Quick Steps' stance"}),p["Heavy strike"]=new T({names:{0:"Crushing force"},parent_skill:"Stance mastery",description:"A powerful and dangerous technique that abandons speed in favor of overwhelmingly strong attacks",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>'Improves efficiency of the "Crushing force" stance'}),p["Wide swing"]=new T({names:{0:"Broad arc"},parent_skill:"Stance mastery",description:"A special technique that allows striking multiple enemies at once, although at a cost of lower damage",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>'Improves efficiency of the "Broad arc" stance'}),p["Defensive measures"]=new T({names:{0:"Defensive measures"},parent_skill:"Stance mastery",description:"A careful technique focused much more on defense than on attacking",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Improves efficiency of the 'Defensive Measures' stance"}),p["Berserker's stride"]=new T({names:{0:"Berserker's stride"},parent_skill:"Stance mastery",description:"A wild and dangerous technique that focuses on dealing as much damage as possible, while completely ignoring own defense",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Improves efficiency of the 'Berserker's Stride' stance"}),p["Flowing water"]=new T({names:{0:"Flowing water"},parent_skill:"Stance mastery",description:"A wild and dangerous technique that focuses on dealing as much damage as possible, while completely ignoring own defense",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Improves efficiency of the 'Flowing Water' stance"})})();(function(){p["Spatial awareness"]=new T({names:{0:"Spatial awareness"},description:"Understanding where you are in relation to other creatures and objects",get_effect_description:()=>"Reduces environmental penalty in open areas",category:"Environmental",milestones:{1:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1}},3:{xp_multipliers:{Combat:1.1}},5:{xp_multipliers:{category_Combat:1.1},stats:{intuition:{flat:1}}},8:{xp_multipliers:{all_skill:1.1}},10:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1,Combat:1.1},stats:{intuition:{flat:1}}}}}),p["Tight maneuvers"]=new T({names:{0:"Tight maneuvers"},description:"Learn how to fight in narrow environment, where there's not much space for dodging attacks",category:"Environmental",get_effect_description:()=>"Reduces environmental penalty in narrow areas",milestones:{3:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1}},5:{xp_multipliers:{Combat:1.1}},7:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1}},10:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1,Combat:1.1}}}}),p["Night vision"]=new T({names:{0:"Night vision"},description:"Ability to see in darkness",base_xp_cost:600,xp_scaling:1.9,max_level:10,category:"Environmental",get_effect_description:()=>"Reduces environmental penalty in dark areas (except for 'pure darkness')",milestones:{2:{stats:{intuition:{flat:1}}},3:{xp_multipliers:{Evasion:1.05,"Shield blocking":1.05}},5:{stats:{intuition:{flat:1}},xp_multipliers:{"Presence sensing":1.05}},7:{xp_multipliers:{Combat:1.1},stats:{intuition:{multiplier:1.05}}},8:{xp_multipliers:{"Presence sensing":1.1}},10:{xp_multipliers:{"Presence sensing":1.2,Evasion:1.05,"Shield blocking":1.05},stats:{intuition:{multiplier:1.05}}}}}),p["Presence sensing"]=new T({names:{0:"Presence sensing"},description:"Ability to sense a presence without using your eyes",base_xp_cost:60,xp_scaling:2,max_level:20,category:"Environmental",get_effect_description:()=>"Reduces environmental penalty in extremly dark areas",milestones:{1:{stats:{intuition:{flat:1}},xp_multipliers:{"Night vision":1.2}},2:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.2}},4:{stats:{intuition:{flat:1}},xp_multipliers:{Combat:1.1}},5:{xp_multipliers:{all_skill:1.05,"Night vision":1.2},stats:{intuition:{multiplier:1.1}}},7:{stats:{intuition:{flat:1}},xp_multipliers:{hero:1.05,"Night vision":1.2}},10:{xp_multipliers:{all_skill:1.05,"Night vision":1.2}},12:{xp_multipliers:{all:1.05},stats:{intuition:{multiplier:1.1}}}}}),p["Strength of mind"]=new T({names:{0:"Strength of mind"},description:"Resist and reject the unnatural influence. Turn your psyche into an iron fortress",category:"Environmental",base_xp_cost:400,max_level:40,xp_scaling:1.7,get_effect_description:()=>"Reduces eldritch effects",milestones:{1:{xp_multipliers:{all_skill:1.05}},2:{stats:{intuition:{flat:1}},xp_multipliers:{Literacy:1.05,Persistence:1.05,Fortitude:1.05}},3:{xp_multipliers:{hero:1.05}},5:{xp_multipliers:{all_skill:1.05}},7:{stats:{intuition:{flat:1}},xp_multipliers:{Literacy:1.05,Persistence:1.05,Fortitude:1.05}},8:{xp_multipliers:{hero:1.05}},10:{xp_multipliers:{all:1.05}},12:{stats:{intuition:{multiplier:1.2}},xp_multipliers:{Literacy:1.05,Persistence:1.05,Fortitude:1.05}}}}),p["Heat resistance"]=new T({names:{0:"Heat resistance"},description:"Ability to survive and function in high temperatures",base_xp_cost:100,max_level:40,category:"Environmental"}),p["Cold resistance"]=new T({names:{0:"Cold resistance"},description:"Ability to survive and function in low temperatures",base_xp_cost:200,xp_scaling:1.8,max_level:40,category:"Environmental",get_effect_description:()=>`Increases cold tolerance by ${p["Cold resistance"].current_level*.5}`}),p["Dazzle resistance"]=new T({names:{0:"Dazzle resistance"},description:"Don't look at the sun, it's bad for your eyes",base_xp_cost:60,max_level:30,category:"Environmental",get_effect_description:()=>"Reduces hit and evasion penalty in super bright areas",max_level_bonus:.5})})();(function(){p["Weapon mastery"]=new T({names:{0:"Weapon proficiency",15:"Weapon mastery"},description:"Knowledge of all weapons",category:"Weapon",get_effect_description:()=>"Increases xp gains of all weapon skills of level lower than this, x1.1 per level of difference"}),p.Swords=new T({parent_skill:"Weapon mastery",names:{0:"Swordsmanship"},category:"Weapon",description:"The noble art of swordsmanship",get_effect_description:()=>`Multiplies damage dealt with swords by ${Math.round(A({skill_id:"Swords",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with swords by ${Math.round(A({skill_id:"Swords",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{dexterity:{flat:1}}},3:{stats:{agility:{flat:1}}},5:{stats:{strength:{flat:1},crit_rate:{flat:.01}}},7:{stats:{dexterity:{flat:1}}},10:{stats:{agility:{flat:1},crit_multiplier:{flat:.1}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),p.Axes=new T({parent_skill:"Weapon mastery",names:{0:"Axe combat"},category:"Weapon",description:"Ability to fight with axes",get_effect_description:()=>`Multiplies damage dealt with axes by ${Math.round(A({skill_id:"Axes",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with axes by ${Math.round(A({skill_id:"Axes",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{dexterity:{flat:1}}},3:{stats:{strength:{flat:1}}},5:{stats:{dexterity:{flat:1},strength:{flat:1}}},7:{stats:{dexterity:{flat:1}}},10:{stats:{strength:{multiplier:1.05}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),p.Spears=new T({parent_skill:"Weapon mastery",names:{0:"Spearmanship"},category:"Weapon",description:"The ability to fight with the most deadly weapon in history",get_effect_description:()=>`Multiplies damage dealt with spears by ${Math.round(A({skill_id:"Spears",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with spears by ${Math.round(A({skill_id:"Spears",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{dexterity:{flat:1}}},3:{stats:{dexterity:{flat:1}}},5:{stats:{strength:{flat:1},crit_rate:{flat:.01}}},7:{stats:{dexterity:{flat:1}}},10:{stats:{strength:{flat:1},crit_multiplier:{flat:.1}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),p.Hammers=new T({parent_skill:"Weapon mastery",names:{0:"Hammer combat"},category:"Weapon",description:"Ability to fight with battle hammers. Why bother trying to cut someone, when you can just crack all their bones?",get_effect_description:()=>`Multiplies damage dealt with battle hammers by ${Math.round(A({skill_id:"Hammers",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with hammers by ${Math.round(A({skill_id:"Hammers",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{strength:{flat:1}}},3:{stats:{strength:{flat:1}}},5:{stats:{strength:{flat:1},dexterity:{flat:1}}},7:{stats:{strength:{flat:1}}},10:{stats:{strength:{flat:1},dexterity:{flat:1}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),p.Daggers=new T({parent_skill:"Weapon mastery",names:{0:"Dagger combat"},category:"Weapon",description:"The disdained art of fighting (and stabbing) with daggers",get_effect_description:()=>`Multiplies damage dealt with daggers by ${Math.round(A({skill_id:"Daggers",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with daggers by ${Math.round(A({skill_id:"Daggers",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{dexterity:{flat:1}}},3:{stats:{agility:{flat:1}}},5:{stats:{crit_multiplier:{flat:.1},crit_rate:{flat:.01}}},7:{stats:{dexterity:{flat:1}}},10:{stats:{crit_rate:{flat:.02},crit_multiplier:{flat:.1}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),p.Wands=new T({parent_skill:"Weapon mastery",names:{0:"Wand casting"},category:"Weapon",description:"Ability to cast spells with magic wands, increases damage dealt",get_effect_description:()=>`Multiplies damage dealt with wands by ${Math.round(A({skill_id:"Wands",scaling_type:"multiplicative"})*1e3)/1e3}`,max_level_coefficient:8}),p.Staffs=new T({parent_skill:"Weapon mastery",names:{0:"Staff casting"},category:"Weapon",description:"Ability to cast spells with magic staffs, increases damage dealt",get_effect_description:()=>`Multiplies damage dealth with staffs by ${Math.round(A({skill_id:"Staffs",scaling_type:"multiplicative"})*1e3)/1e3}`,max_level_coefficient:8})})();(function(){p.Farming=new T({names:{0:"Farming"},description:"Even a simple action of plowing some fields, can be performed better with skills and experience",base_xp_cost:40,category:"Activity",max_level:10,xp_scaling:1.6,max_level_coefficient:2,milestones:{1:{stats:{max_stamina:{flat:2}}},2:{stats:{strength:{flat:1}}},3:{stats:{dexterity:{flat:1},max_stamina:{flat:2}}},4:{stats:{strength:{flat:1},max_stamina:{flat:2}}},5:{stats:{strength:{flat:1},max_stamina:{flat:2}},xp_multipliers:{Herbalism:1.05}},6:{stats:{strength:{flat:1}},xp_multipliers:{Weightlifting:1.1}},7:{stats:{dexterity:{flat:1},max_stamina:{flat:2}},xp_multipliers:{Unarmed:1.05}},8:{stats:{strength:{flat:1},max_stamina:{flat:2}}},9:{stats:{strength:{flat:1},dexterity:{flat:1}}},10:{stats:{max_stamina:{flat:4},strength:{multiplier:1.05},dexterity:{multiplier:1.05}},xp_multipliers:{Unarmed:1.1,Herbalism:1.1}}}})})();(function(){p.Sleeping=new T({names:{0:"Sleeping"},description:"Good, regular sleep is the basis of getting stronger and helps your body heal",get_effect_description:()=>`Multiplies health restored when sleeping by ${Math.round(100*(1+G("Sleeping")/p.Sleeping.max_level))/100}`,base_xp_cost:1e3,flavour_text:"One rat, two rats, three rats...",visibility_treshold:300,xp_scaling:2,category:"Activity",max_level:10,max_level_coefficient:2.5,milestones:{2:{stats:{max_health:{flat:10,multiplier:1.04}},xp_multipliers:{all:1.05}},4:{stats:{max_health:{flat:20,multiplier:1.04}},xp_multipliers:{all:1.05}},5:{unlocks:{skills:["Meditation"]}},6:{stats:{max_health:{flat:30,multiplier:1.04}},xp_multipliers:{all:1.05,Meditation:1.1}},8:{stats:{max_health:{flat:30,multiplier:1.04}},xp_multipliers:{all:1.05}},10:{stats:{max_health:{flat:40,multiplier:1.1}},xp_multipliers:{all:1.1,Meditation:1.1}}}}),p.Meditation=new T({names:{0:"Meditation"},description:"Focus your mind",base_xp_cost:200,category:"Activity",max_level:30,max_level_coefficient:2,is_unlocked:!1,visibility_treshold:0,milestones:{2:{stats:{intuition:{flat:1}},xp_multipliers:{all:1.05,"Presence sensing":1.05}},4:{stats:{intuition:{flat:1,multiplier:1.05}},xp_multipliers:{all:1.05,"Strength of mind":1.05}},5:{xp_multipliers:{Sleeping:1.1,Breathing:1.1,"Presence sensing":1.05}},6:{stats:{intuition:{flat:2}},xp_multipliers:{"Strength of mind":1.05}},8:{stats:{intuition:{multiplier:1.05}},xp_multipliers:{all:1.05,Sleeping:1.1,Breathing:1.1,"Presence sensing":1.05}},10:{stats:{intuition:{flat:2,multiplier:1.05}},xp_multipliers:{all:1.1,Sleeping:1.1,Breathing:1.1,"Presence sensing":1.1,"Strength of mind":1.1}},12:{stats:{intuition:{flat:2}},xp_multipliers:{all:1.05,"Presence sensing":1.1}}},get_effect_description:()=>{let e=A({skill_id:"Meditation",scaling_type:"multiplicative"});return`Multiplies intuition ${Math.round(e*100)/100}`}}),p.Running=new T({description:"Great way to improve the efficiency of the body",names:{0:"Running"},max_level:50,category:"Activity",max_level_coefficient:2,base_xp_cost:50,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{agility:{flat:1}},xp_multipliers:{Breathing:1.1}},5:{stats:{agility:{flat:1},max_stamina:{multiplier:1.05}}},7:{stats:{agility:{flat:1,multiplier:1.05}},xp_multipliers:{Breathing:1.05}},10:{stats:{agility:{flat:1,multiplier:1.05},max_stamina:{multiplier:1.05}},xp_multipliers:{Breathing:1.1}},12:{stats:{agility:{flat:2},max_stamina:{flat:5}},xp_multipliers:{Breathing:1.05},unlocks:{quests:["Swimming/climbing unlock","Swimming alternative unlock"]}}},get_effect_description:()=>{let e=A({skill_id:"Running",scaling_type:"multiplicative"});return`Multiplies stamina efficiency by ${Math.round(e*100)/100}`}}),p.Weightlifting=new T({description:"No better way to get stronger than by lifting heavy things",names:{0:"Weightlifting"},max_level:50,category:"Activity",max_level_coefficient:4,base_xp_cost:50,milestones:{1:{stats:{strength:{flat:1}}},3:{stats:{strength:{flat:1}},xp_multipliers:{Unarmed:1.05}},5:{stats:{strength:{flat:1,multiplier:1.05},max_stamina:{multiplier:1.05}}},7:{stats:{strength:{flat:1}},xp_multipliers:{Unarmed:1.1}},10:{stats:{strength:{flat:1,multiplier:1.05},max_stamina:{multiplier:1.05}}},12:{stats:{strength:{flat:2},max_stamina:{flat:5}},unlocks:{quests:["Swimming/climbing unlock","Swimming alternative unlock"]}}},get_effect_description:()=>{let e=A({skill_id:"Weightlifting",scaling_type:"multiplicative"});return`Multiplies strength by ${Math.round(e*100)/100}`}}),p.Swimming=new T({description:"A nice, gentle, and relaxing exercise. Just remember to be careful",names:{0:"Swimming"},max_level:50,category:"Activity",max_level_coefficient:2,base_xp_cost:50,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{strength:{flat:1}},xp_multipliers:{Breathing:1.05}},5:{stats:{agility:{multiplier:1.05},max_stamina:{multiplier:1.05}}},7:{stats:{agility:{flat:1}},xp_multipliers:{Breathing:1.1}},10:{stats:{agility:{multiplier:1.05},max_stamina:{multiplier:1.05}}},12:{stats:{agility:{flat:2},max_stamina:{flat:10}}}},get_effect_description:()=>{let e=A({skill_id:"Swimming",scaling_type:"multiplicative"});return`Multiplies agility and stamina by ${Math.round(e*100)/100}`}}),p.Equilibrium=new T({description:"Nothing will throw you off your balance (at least the physical one)",names:{0:"Equilibrium"},category:"Activity",max_level:50,max_level_coefficient:4,base_xp_cost:50,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{intuition:{flat:1}}},5:{stats:{agility:{flat:1,multiplier:1.05},strength:{flat:1},max_stamina:{multiplier:1.05}},xp_multipliers:{Unarmed:1.1}},7:{stats:{intuition:{flat:1}}},9:{stats:{strength:{flat:1}}},10:{stats:{agility:{flat:1},intuition:{multiplier:1.05},max_stamina:{multiplier:1.05}}},12:{stats:{agility:{flat:1},strength:{flat:1}}}},get_effect_description:()=>{let e=A({skill_id:"Equilibrium",scaling_type:"multiplicative"});return`Multiplies agility by ${Math.round(e*100)/100}`}}),p.Climbing=new T({description:"Intense and slightly dangerous form of training that involves majority of your muscles",names:{0:"Climbing"},max_level:50,category:"Activity",max_level_coefficient:2,base_xp_cost:50,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{strength:{flat:1}}},5:{stats:{agility:{multiplier:1.05},max_stamina:{multiplier:1.03}}},7:{stats:{strength:{flat:1}}},10:{stats:{strength:{multiplier:1.05},max_stamina:{multiplier:1.03}}},12:{stats:{strength:{flat:2},agility:{flat:2}}}},get_effect_description:()=>{let e=A({skill_id:"Climbing",scaling_type:"multiplicative"});return`Multiplies strength, dexterity and agility by ${Math.round(e*100)/100}`}})})();(function(){p.Woodcutting=new T({names:{0:"Woodcutting"},description:"Get better with chopping the wood",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6}),p.Mining=new T({names:{0:"Mining"},description:"Get better with mining the ores",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6}),p.Digging=new T({names:{0:"Digging"},description:"Get better with swinging the shovel",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6}),p.Herbalism=new T({names:{0:"Herbalism"},description:"Knowledge of useful plants and mushrooms",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6}),p["Animal handling"]=new T({names:{0:"Animal handling"},description:"Knowledge and skills required to deal with a wide variety of animals",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6})})();(function(){p["Crafting mastery"]=new T({skill_id:"Crafting mastery",names:{0:"Crafting mastery"},description:"A mastery of the minor crafting branches like tinkering, woodworking, or butchering",category:yi,base_xp_cost:40,xp_scaling:1.5,max_level:60,milestones:{5:{stats:{dexterity:{multiplier:1.05}}},10:{stats:{dexterity:{multiplier:1.05}}},15:{stats:{dexterity:{multiplier:1.05}}},20:{stats:{dexterity:{multiplier:1.05}}},25:{stats:{dexterity:{multiplier:1.05}}},30:{stats:{dexterity:{multiplier:1.05}}}}}),p.Crafting=new T({names:{0:"Tinkering"},description:"Turn smaller pieces into one bigger thing",category:yi,parent_skill:"Crafting mastery",base_xp_cost:40,xp_scaling:1.5,max_level:60,get_effect_description:()=>`Quality cap: ${gi("Crafting").components}% for comps, ${gi("Crafting").equipment}% for eq`}),p.Smelting=new T({names:{0:"Smelting"},description:"Turning raw ore into raw metal",category:yi,base_xp_cost:40,xp_scaling:1.5,max_level:60}),p.Forging=new T({names:{0:"Forging"},description:"Turning raw metal into something useful",category:yi,base_xp_cost:40,xp_scaling:1.5,max_level:60,get_effect_description:()=>`Quality cap: ${gi("Forging").components}% for components`,milestones:{10:{unlocks:{recipes:[{category:"smelting",subcategory:"items",recipe_id:"Steel ingot (inefficient)"}]}}}}),p.Cooking=new T({names:{0:"Cooking"},description:"Making the inedible edible",category:yi,base_xp_cost:40,xp_scaling:1.5,max_level:60}),p.Alchemy=new T({names:{0:"Alchemy"},description:"Extracting and enhancing useful properties of the ingredients",category:yi,base_xp_cost:40,xp_scaling:1.5,max_level:60}),p.Butchering=new T({skill_id:"Butchering",names:{0:"Butchering"},description:"Making the most of what you kill",category:yi,parent_skill:"Crafting mastery",base_xp_cost:40,xp_scaling:1.5,max_level_coefficient:2,max_level:60,is_unlocked:!1,visibility_treshold:0,get_effect_description:()=>{let e=A({skill_id:"Butchering",scaling_type:"multiplicative"});return`Multiplies drop chances from Beasts by ${Math.round(e*100)/100}`}}),p.Woodworking=new T({skill_id:"Woodworking",names:{0:"Woodworking"},description:"Turning wood logs into something useful",category:yi,parent_skill:"Crafting mastery",base_xp_cost:40,xp_scaling:1.5,max_level:60})})();(function(){p["Iron skin"]=new T({category:"Combat",names:{0:"Tough skin",10:"Wooden skin",20:"Stone skin",30:"Iron skin"},description:"As it gets damaged, your skin regenerates to be tougher and tougher",base_xp_cost:400,xp_scaling:1.9,max_level:30,max_level_bonus:30,get_effect_description:()=>`Increases base defense by ${Math.round(kt("Iron skin"))}`,milestones:{3:{stats:{max_health:{multiplier:1.01}}},5:{stats:{max_health:{multiplier:1.01},unarmed_power:{flat:.4}}},7:{stats:{max_health:{multiplier:1.02}},xp_multipliers:{Fortitude:1.05}},10:{stats:{max_health:{multiplier:1.02},unarmed_power:{flat:.6}}},12:{stats:{max_health:{multiplier:1.02}},xp_multipliers:{Fortitude:1.05}}}}),p.Fortitude=new T({category:"Combat",names:{0:"Fortitude"},description:"Pretend the wounds are not there",base_xp_cost:200,xp_scaling:1.6,max_level:60,max_level_coefficient:4,get_effect_description:()=>`Multiplies max health by ${Math.round(100*A({scaling_type:"multiplicative",skill_id:"Fortitude"}))/100}`,milestones:{3:{stats:{max_health:{multiplier:1.01}}},5:{stats:{defense:{flat:1}},xp_multipliers:{"Iron skin":1.05}},7:{stats:{max_health:{multiplier:1.02}}},10:{stats:{defense:{flat:1}},xp_multipliers:{"Iron skin":1.05}},12:{stats:{max_health:{multiplier:1.02}}}}})})();(function(){p.Persistence=new T({names:{0:"Persistence"},description:"Do not give up, no matter what",flavour_text:"Believe in me that believes in you!",base_xp_cost:60,category:"Character",max_level:30,get_effect_description:()=>`Increases low stamina stat multiplier to x${(50+Math.round(kt("Persistence")*1e5)/1e3)/100} (originally x0.5)`,milestones:{2:{stats:{max_stamina:{flat:5}},xp_multipliers:{all_skill:1.05}},4:{stats:{max_stamina:{flat:5}},xp_multipliers:{hero:1.05}},6:{stats:{max_stamina:{flat:10},heat_tolerance:{flat:1},cold_tolerance:{flat:1}},xp_multipliers:{all:1.05,"Strength of mind":1.05}},8:{stats:{max_stamina:{flat:10}},xp_multipliers:{all:1.05}},10:{stats:{max_stamina:{multiplier:1.1}},xp_multipliers:{hero:1.05,"Strength of mind":1.05}},12:{stats:{max_stamina:{flat:10},heat_tolerance:{flat:1},cold_tolerance:{flat:1}},xp_multipliers:{hero:1.05}},14:{stats:{stamina_efficiency:{multiplier:1.1}},xp_multipliers:{all_skill:1.05,"Strength of mind":1.05}}},max_level_bonus:.3}),p.Perception=new T({names:{0:"Perception"},description:"Better grasp on your senses allows you to notice small and hidden things, as well as to discern the true nature of what you obsere",category:"Character",max_level_coefficient:2,get_effect_description:()=>"",milestones:{}}),p.Literacy=new T({names:{0:"Literacy"},description:"Ability to read and understand written text",category:"Character",base_xp_cost:120,max_level:10,xp_scaling:2,milestones:{1:{xp_multipliers:{hero:1.05,"Strength of mind":1.05}},2:{xp_multipliers:{all_skill:1.05}},3:{xp_multipliers:{all:1.05}},5:{xp_multipliers:{hero:1.05,"Strength of mind":1.05}}}}),p.Medicine=new T({names:{0:"Medicine"},description:"Create better medicaments and improve your skill at treating wounds",category:"Character",max_level:30,visibility_treshold:5,max_level_coefficient:2,get_effect_description:()=>{let e=A({skill_id:"Medicine",scaling_type:"multiplicative"});return`Multiplies additive effects of medicines by ${Math.round(e**2*100)/100} and multiplicative effects by ${Math.round(e*100)/100}`}}),p.Gluttony=new T({names:{0:"Gluttony"},description:"The more you eat the better you will be at digesting, right?",category:"Character",max_level:30,visibility_treshold:5,max_level_coefficient:2,get_effect_description:()=>{let e=A({skill_id:"Gluttony",scaling_type:"multiplicative"});return`Multiplies additive effects of foods by ${Math.round(e**2*100)/100} and multiplicative effects by ${Math.round(e*100)/100}`},milestones:{3:{xp_multipliers:{hero:1.05}},5:{stats:{max_health:{flat:20}},xp_multipliers:{Regeneration:1.1}},7:{stats:{health_regeneration_flat:{flat:.1}}},10:{stats:{stamina_regeneration_flat:{flat:.1},cold_tolerance:{flat:1}},xp_multipliers:{hero:1.05}},12:{stats:{health_regeneration_flat:{flat:.2}},xp_multipliers:{Regeneration:1.1}}}}),p.Breathing=new T({names:{0:"Breathing"},description:"Oxygen is the most important resource for improving the performance of your body. Learn how to take it in more efficiently",flavour_text:"You are now breathing manually",base_xp_cost:400,visibility_treshold:390,xp_scaling:1.6,category:"Character",max_level_coefficient:2,max_level:40,milestones:{3:{xp_multipliers:{Running:1.1,Meditation:1.1},stats:{attack_speed:{multiplier:1.02}}},5:{stats:{agility:{multiplier:1.05},stamina_efficiency:{multiplier:1.05}}},7:{xp_multipliers:{Running:1.1,Meditation:1.1},stats:{stamina_regeneration_flat:{flat:.1}}},10:{stats:{strength:{multiplier:1.05},max_stamina:{multiplier:1.05},attack_speed:{multiplier:1.02}}},12:{stats:{strength:{flat:2},agility:{flat:2},stamina_regeneration_flat:{flat:.1}},xp_multipliers:{Running:1.1,Meditation:1.1}},14:{xp_multipliers:{Running:1.1,Meditation:1.1},stats:{attack_speed:{multiplier:1.03},stamina_efficiency:{multiplier:1.05}}}},get_effect_description:()=>{let e=A({skill_id:"Breathing",scaling_type:"multiplicative"});return`Multiplies strength, agility and stamina by ${Math.round(e*100)/100}. Reduces thin air effects`}}),p.Regeneration=new T({names:{0:"Regeneration"},description:"As your body regenerates more and more, it slowly becomes more proficient in this task",get_effect_description:()=>`Multiplies health restored when resting or sleeping by ${Math.round(100*(1+3*G("Regeneration")/p.Regeneration.max_level))/100}`,base_xp_cost:1e3,visibility_treshold:500,xp_scaling:1.5,category:"Character",max_level:40,max_level_coefficient:2.5,milestones:{1:{stats:{max_health:{flat:10}}},3:{stats:{max_health:{flat:10}}},5:{stats:{health_regeneration_flat:{flat:.1}}},7:{stats:{max_health:{flat:20}}},10:{stats:{max_health:{flat:20},health_regeneration_flat:{flat:.2}}},12:{stats:{max_health:{flat:20}}},15:{stats:{health_regeneration_flat:{flat:.4}}}}})})();(function(){p.Haggling=new T({names:{0:"Haggling"},description:"The art of the deal",category:"Character",base_xp_cost:100,max_level:25,get_effect_description:()=>`Lowers trader cost multiplier to ${Math.round((1-kt("Haggling"))*100)}% of original value`,max_level_bonus:.5,milestones:{2:{stats:{intuition:{flat:1}}},3:{xp_multipliers:{Literacy:1.05}},5:{stats:{intuition:{flat:2}},xp_multipliers:{Literacy:1.05,Persistence:1.05}},7:{stats:{intuition:{flat:2}}},10:{stats:{intuition:{flat:2}},xp_multipliers:{Literacy:1.05,Persistence:1.05}}}})})();Object.keys(p).forEach(e=>{p[e].skill_id=e});var P={},qa={},Yn=class extends fi{constructor({name:t,display_name:i,trade_text:n,unlock_message:s=null,location_name:a,refresh_time:o=4,refresh_shift:l=0,inventory_template:u,profit_margin:c=3,is_unlocked:_=!0}){super(),this.name=t,this.display_name=i||t,this.trade_text=n||`Trade with ${this.display_name}`,this.unlock_message=s,this.location_name=a,this.last_refresh=-1,this.refresh_time=o,this.refresh_shift=l,this.inventory_template=u,this.profit_margin=c,this.is_unlocked=_,this.is_finished=!1}refresh(){return this.can_refresh()?(this.inventory=this.get_inventory_from_template(),this.last_refresh=M.day_count+1-M.day_count%this.refresh_time,!0):!1}can_refresh(){return this.last_refresh<0||M.day_count-(this.last_refresh+this.refresh_shift)>=this.refresh_time}get_inventory_from_template(){let t={},i=qa[this.inventory_template];for(let n=0;n<i.length;n++)if(i[n].chance>=Math.random()){let s=i[n].count.length==1?i[n].count[0]:Math.round(Math.random()*(i[n].count[1]-i[n].count[0])+i[n].count[0]);if(i[n].quality){let a=Math.round(Math.random()*(i[n].quality[1]-i[n].quality[0])+i[n].quality[0]),o=_e({...d[i[n].item_name],quality:a});t[o.getInventoryKey()]={item:o,count:s}}else t[d[i[n].item_name].getInventoryKey()]={item:_e(d[i[n].item_name]),count:s}}return t}getProfitMargin(){return 1+(this.profit_margin-1)*(1-kt("Haggling"))}getItemPrice(t){let i=Math.ceil(t*this.getProfitMargin());return i>=100?Math.round(i/10)*10:i>=1e3?Math.round(i/100)*100:i}},g=class{constructor({item_name:t,chance:i=1,count:n=[1],quality:s=null}){this.item_name=t,this.chance=i,this.count=n,this.quality=s}};(function(){P["village trader"]=new Yn({name:"village trader",inventory_template:"Basic",is_unlocked:!1,location_name:"Village",trade_text:"Trade on the village market",unlock_message:"You can now visit the village market"}),P["suspicious trader"]=new Yn({name:"suspicious trader",inventory_template:"Basic plus",is_unlocked:!0,location_name:"Slums",profit_margin:5}),P["suspicious trader 2"]=new Yn({name:"suspicious trader 2",display_name:"suspicious trader",inventory_template:"Intermediate",is_unlocked:!1,location_name:"Slums",profit_margin:4})})();(function(){qa.Basic=[new g({item_name:"Cheap iron spear",count:[1],quality:[40,90],chance:.8}),new g({item_name:"Cheap iron dagger",count:[1],quality:[40,90],chance:.8}),new g({item_name:"Cheap iron sword",count:[1],quality:[40,90],chance:.8}),new g({item_name:"Cheap iron axe",count:[1],quality:[40,90],chance:.8}),new g({item_name:"Cheap iron battle hammer",count:[1],quality:[40,90],chance:.8}),new g({item_name:"Cheap iron spear",count:[1],quality:[91,120],chance:.4}),new g({item_name:"Cheap iron dagger",count:[1],quality:[91,120],chance:.4}),new g({item_name:"Cheap iron sword",count:[1],quality:[91,120],chance:.4}),new g({item_name:"Cheap iron axe",count:[1],quality:[91,120],chance:.4}),new g({item_name:"Cheap iron battle hammer",count:[1],quality:[91,120],chance:.4}),new g({item_name:"Iron spear",count:[1],quality:[70,90],chance:.4}),new g({item_name:"Iron dagger",count:[1],quality:[70,90],chance:.4}),new g({item_name:"Iron sword",count:[1],quality:[70,90],chance:.4}),new g({item_name:"Iron axe",count:[1],quality:[70,90],chance:.4}),new g({item_name:"Iron battle hammer",count:[1],quality:[70,90],chance:.4}),new g({item_name:"Wooden training shield",count:[1],quality:[100,100]}),new g({item_name:"Cheap wooden shield",count:[1],quality:[40,90]}),new g({item_name:"Cheap wooden shield",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Crude wooden shield",count:[1],chance:.7,quality:[40,90]}),new g({item_name:"Crude wooden shield",count:[1],chance:.4,quality:[91,120]}),new g({item_name:"Cheap leather vest",count:[1],quality:[40,90]}),new g({item_name:"Cheap leather vest",count:[1],chance:.5,quality:[91,120]}),new g({item_name:"Cheap leather pants",count:[1],quality:[40,90]}),new g({item_name:"Cheap leather pants",count:[1],chance:.5,quality:[91,120]}),new g({item_name:"Cheap leather hat",count:[1],quality:[40,90]}),new g({item_name:"Cheap leather hat",count:[1],chance:.5,quality:[91,120]}),new g({item_name:"Cheap leather shoes",count:[1],chance:.5,quality:[91,120]}),new g({item_name:"Leather shoes",count:[1],chance:.4,quality:[91,120]}),new g({item_name:"Leather vest",count:[1],chance:.7,quality:[70,120]}),new g({item_name:"Leather pants",count:[1],chance:.7,quality:[70,120]}),new g({item_name:"Leather hat",count:[1],chance:.7,quality:[70,120]}),new g({item_name:"Leather gloves",count:[1],chance:.7,quality:[70,120]}),new g({item_name:"Work shoes",count:[1,2],chance:.6,quality:[100,100]}),new g({item_name:"Wolf leather armor",count:[1],chance:.3,quality:[60,120]}),new g({item_name:"Wolf leather armored pants",count:[1],chance:.3,quality:[60,120]}),new g({item_name:"Wolf leather helmet",count:[1],chance:.3,quality:[60,120]}),new g({item_name:"Rat pelt cape",count:[1,3],chance:1,quality:[70,120]}),new g({item_name:"Stale bread",count:[7,14]}),new g({item_name:"Bread kwas",count:[3,5],chance:.6}),new g({item_name:"Fresh bread",count:[4,7]}),new g({item_name:"Weak healing powder",count:[2,5]}),new g({item_name:"Cooking herbs",count:[2,4],chance:.5}),new g({item_name:"Coal",count:[5,20]}),new g({item_name:"ABC for kids",count:[1],chance:1}),new g({item_name:"Old combat manual",count:[1],chance:.5}),new g({item_name:"Butchering and you",count:[1],chance:.2}),new g({item_name:"Medicine for dummies",count:[1],chance:.2}),new g({item_name:"Ode to Whimsy, and other poems",count:[1],chance:.2}),new g({item_name:"A Glint On The Sand",count:[1],chance:.2}),new g({item_name:"Glass phial",count:[5,10],chance:1}),new g({item_name:"Glass bottle",count:[4,8],chance:1}),new g({item_name:"Camping supplies",count:[1,3],chance:1}),new g({item_name:"Coil of rope",count:[1,3],chance:1})],qa["Basic plus"]=[new g({item_name:"Iron spear",count:[1],quality:[70,90],chance:.8}),new g({item_name:"Iron dagger",count:[1],quality:[70,90],chance:.8}),new g({item_name:"Iron sword",count:[1],quality:[70,90],chance:.8}),new g({item_name:"Iron axe",count:[1],quality:[70,90],chance:.8}),new g({item_name:"Iron battle hammer",count:[1],quality:[40,80],chance:.8}),new g({item_name:"Iron spear",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Iron dagger",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Iron sword",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Iron axe",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Iron battle hammer",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Steel spear",count:[1],quality:[70,100],chance:.5}),new g({item_name:"Steel dagger",count:[1],quality:[70,100],chance:.5}),new g({item_name:"Steel sword",count:[1],quality:[70,100],chance:.5}),new g({item_name:"Steel axe",count:[1],quality:[70,100],chance:.5}),new g({item_name:"Steel battle hammer",count:[1],quality:[70,100],chance:.5}),new g({item_name:"Steel spear",count:[1],quality:[81,120],chance:.4}),new g({item_name:"Steel dagger",count:[1],quality:[81,120],chance:.4}),new g({item_name:"Steel sword",count:[1],quality:[81,120],chance:.4}),new g({item_name:"Steel axe",count:[1],quality:[81,120],chance:.4}),new g({item_name:"Steel battle hammer",count:[1],quality:[81,120],chance:.4}),new g({item_name:"Wooden shield",count:[1],quality:[40,80]}),new g({item_name:"Wooden shield",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Crude iron shield",count:[1],quality:[40,80]}),new g({item_name:"Crude iron shield",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Iron shield",count:[1],chance:.6,quality:[40,80]}),new g({item_name:"Iron shield",count:[1],chance:.4,quality:[81,120]}),new g({item_name:"Steel shield",count:[1],chance:.3,quality:[81,100]}),new g({item_name:"Ash wood shield",count:[1],chance:.3,quality:[81,100]}),new g({item_name:"Leather vest",count:[1],chance:.9,quality:[81,120]}),new g({item_name:"Leather pants",count:[1],chance:.9,quality:[81,120]}),new g({item_name:"Leather hat",count:[1],chance:.9,quality:[81,120]}),new g({item_name:"Leather shoes",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Leather gloves",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Work shoes",count:[2,3],chance:.6,quality:[100,100]}),new g({item_name:"Wolf leather armor",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Wolf leather armored pants",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Wolf leather helmet",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Rat pelt cape",count:[1,2],chance:.6,quality:[70,120]}),new g({item_name:"Wolf pelt cape",count:[1],chance:.9,quality:[70,120]}),new g({item_name:"Iron chainmail armor",count:[1],chance:.8,quality:[40,80]}),new g({item_name:"Iron chainmail armor",count:[1],chance:.6,quality:[81,120]}),new g({item_name:"Iron chainmail pants",count:[1],chance:.8,quality:[40,80]}),new g({item_name:"Iron chainmail pants",count:[1],chance:.6,quality:[81,120]}),new g({item_name:"Iron chainmail helmet",count:[1],chance:.8,quality:[40,80]}),new g({item_name:"Iron chainmail helmet",count:[1],chance:.6,quality:[81,120]}),new g({item_name:"Stale bread",count:[4,10]}),new g({item_name:"Fresh bread",count:[2,5]}),new g({item_name:"Bread kwas",count:[1,3]}),new g({item_name:"Weak healing powder",count:[2,5]}),new g({item_name:"Oneberry juice",count:[2,5]}),new g({item_name:"Cooking herbs",count:[1,4],chance:.6}),new g({item_name:"Coal",count:[20,50]}),new g({item_name:"Twist liek a snek",count:[1],chance:.8}),new g({item_name:"Butchering and you",count:[1],chance:.6}),new g({item_name:"Medicine for dummies",count:[1],chance:.6}),new g({item_name:"Ode to Whimsy, and other poems",count:[1],chance:.4}),new g({item_name:"A Glint On The Sand",count:[1],chance:.4}),new g({item_name:"Glass phial",count:[5,10],chance:1}),new g({item_name:"Glass bottle",count:[4,8],chance:1}),new g({item_name:"Camping supplies",count:[1],chance:1}),new g({item_name:"Coil of rope",count:[1],chance:1}),new g({item_name:"Iron sickle",count:[1],chance:.8}),new g({item_name:"Iron pickaxe",count:[1],chance:.8}),new g({item_name:"Iron chopping axe",count:[1],chance:.8}),new g({item_name:"Iron shovel",count:[1],chance:.8})],qa.Intermediate=[new g({item_name:"Iron spear",count:[1],quality:[100,120],chance:.8}),new g({item_name:"Iron dagger",count:[1],quality:[100,120],chance:.8}),new g({item_name:"Iron sword",count:[1],quality:[100,120],chance:.8}),new g({item_name:"Iron axe",count:[1],quality:[100,120],chance:.8}),new g({item_name:"Iron battle hammer",count:[1],quality:[100,120],chance:.8}),new g({item_name:"Steel spear",count:[1],quality:[80,100],chance:.8}),new g({item_name:"Steel dagger",count:[1],quality:[80,100],chance:.8}),new g({item_name:"Steel sword",count:[1],quality:[80,100],chance:.8}),new g({item_name:"Steel axe",count:[1],quality:[80,100],chance:.8}),new g({item_name:"Steel battle hammer",count:[1],quality:[80,100],chance:.8}),new g({item_name:"Steel spear",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Steel dagger",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Steel sword",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Steel axe",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Steel battle hammer",count:[1],quality:[81,120],chance:.8}),new g({item_name:"Wooden shield",count:[1],quality:[40,80]}),new g({item_name:"Wooden shield",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Crude iron shield",count:[1],quality:[40,80]}),new g({item_name:"Crude iron shield",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Iron shield",count:[1],chance:.6,quality:[40,80]}),new g({item_name:"Iron shield",count:[1],chance:.4,quality:[81,120]}),new g({item_name:"Steel shield",count:[1],chance:.4,quality:[81,120]}),new g({item_name:"Ash wood shield",count:[1],chance:.4,quality:[81,120]}),new g({item_name:"Leather vest",count:[1],chance:.9,quality:[81,120]}),new g({item_name:"Leather pants",count:[1],chance:.9,quality:[81,120]}),new g({item_name:"Leather hat",count:[1],chance:.9,quality:[81,120]}),new g({item_name:"Leather shoes",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Leather gloves",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Work shoes",count:[2,3],chance:.6,quality:[100,100]}),new g({item_name:"Goat leather vest",count:[1],chance:.5,quality:[81,120]}),new g({item_name:"Goat leather pants",count:[1],chance:.5,quality:[81,120]}),new g({item_name:"Goat leather hat",count:[1],chance:.5,quality:[81,120]}),new g({item_name:"Goat leather shoes",count:[1],chance:.5,quality:[81,120]}),new g({item_name:"Goat leather gloves",count:[1],chance:.5,quality:[81,120]}),new g({item_name:"Wolf leather armor",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Wolf leather armored pants",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Wolf leather helmet",count:[1],chance:.8,quality:[91,120]}),new g({item_name:"Iron chainmail armor",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Iron chainmail pants",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Iron chainmail helmet",count:[1],chance:.8,quality:[81,120]}),new g({item_name:"Steel chainmail armor",count:[1],chance:.6,quality:[81,120]}),new g({item_name:"Steel chainmail pants",count:[1],chance:.6,quality:[81,120]}),new g({item_name:"Steel chainmail helmet",count:[1],chance:.6,quality:[81,120]}),new g({item_name:"Wolf pelt cape",count:[1],chance:.9,quality:[70,120]}),new g({item_name:"Boar hide cape",count:[1],chance:.9,quality:[70,120]}),new g({item_name:"Goat hide cape",count:[1],chance:.9,quality:[70,120]}),new g({item_name:"Bear hide cape",count:[1],chance:.5,quality:[70,120]}),new g({item_name:"Fresh bread",count:[4,10]}),new g({item_name:"Bread kwas",count:[2,5]}),new g({item_name:"Weak healing powder",count:[2,5]}),new g({item_name:"Oneberry juice",count:[2,5]}),new g({item_name:"Healing powder",count:[2,5]}),new g({item_name:"Healing potion",count:[2,5]}),new g({item_name:"Cooking herbs",count:[2,5],chance:.8}),new g({item_name:"Coal",count:[20,50]}),new g({item_name:"Twist liek a snek",count:[1],chance:1}),new g({item_name:"Butchering and you",count:[1],chance:1}),new g({item_name:"Medicine for dummies",count:[1],chance:1}),new g({item_name:"Ode to Whimsy, and other poems",count:[1],chance:.4}),new g({item_name:"A Glint On The Sand",count:[1],chance:.4}),new g({item_name:"Glass phial",count:[10,16],chance:1}),new g({item_name:"Glass bottle",count:[6,12],chance:1}),new g({item_name:"Camping supplies",count:[1],chance:1}),new g({item_name:"Coil of rope",count:[1],chance:1}),new g({item_name:"Iron sickle",count:[1],chance:1}),new g({item_name:"Iron pickaxe",count:[1],chance:1}),new g({item_name:"Iron chopping axe",count:[1],chance:1}),new g({item_name:"Iron shovel",count:[1],chance:1})]})();var Ne=null,I={value:0,items:[],groups:{}},L={value:0,items:[],groups:{}},Ma=class{constructor(t){this.count=new Array(t+1).fill(0),this.needs_resort=!1,this.unsorted=[],this.sorted=[],this.group_value=0}};function rl(e){P[e].refresh(),Ne=e,fl(),ve({is_trade:!0})}function cl(){L.items=[],L.groups={},L.value=0,I.items=[],I.groups={},I.value=0,ve({is_trade:!0}),jt()}function ul(){let e;if(I.items.length==0&&L.items.length==0?e=r.money:e=r.money+I.value-L.value,e<0)throw new Error("Trying to make a trade that can't be afforded");{r.money=e;let t=[],i=[];for(;L.items.length>0;){let n=L.items.pop();n.item_count=n.count,i.push(n),t.push({item_key:n.item_key,count:n.count});let s=Oe(n.item_key),{group_key:a,group_tier:o}=s.getMarketSaturationGroup();s.saturates_market&&al({group_key:a,group_tier:o,count:n.count,region:v.market_region})}if(i.length>0){ze(t),Tc(Ne,i);for(let n=0;n<t.length;n++)ve({item_key:t[n].item_key})}for(t=[],i=[];I.items.length>0;){let n=I.items.pop();n.item_count=n.count,i.push(n),t.push({item_key:n.item_key,count:n.count});let s=Oe(n.item_key),{group_key:a,group_tier:o}=s.getMarketSaturationGroup();s.saturates_market&&nl({group_key:a,group_tier:o,count:n.count,region:v.market_region})}if(i.length>0){Is(Ne,t),dt(i);for(let n=0;n<t.length;n++)jt({item_key:t[n].item_key})}}z({skill:p.Haggling,xp_to_add:(I.value+L.value)/10,cap_gained_xp:!1}),L.value=0,L.groups={},I.value=0,I.groups={},ve({is_trade:!0}),jt(),fn()}function dl(){Ne=null,L.items=[],L.groups={},L.value=0,I.items=[],I.groups={},I.value=0,gl(),ve()}function _l(e){let t=Oe(e.item_key),{group_key:i,group_tier:n}=t.getMarketSaturationGroup(),s=L.items.find(l=>l.item_key===e.item_key),a=e.count,o=P[Ne].inventory[e.item_key].count;return s?(o-s.count<e.count?(a=o-s.count,s.count=o):s.count+=a,L.groups[i].count[n]+=a,L.groups[i].unsorted.find(l=>e.item_key===l.item_key).count+=a):(o<e.count&&(e.count=o),L.groups[i]?L.groups[i].count.length<n+1&&L.groups[i].count.push(...new Array(n+1-L.groups[i].count.length).fill(0)):L.groups[i]=new Ma(n),L.items.push(e),L.groups[i].unsorted.push({...e}),L.groups[i].count[n]+=e.count,L.groups[i].needs_resort=!0),$a()}function ml(e){let t=Oe(e.item_key),{group_key:i,group_tier:n}=t.getMarketSaturationGroup(),s=e.count,a=L.items.find(o=>o.item_key===e.item_key);if(a?.count<s&&(s=a.count),!L.groups[i]||L.groups[i].count.length<n+1)throw new Error(`Tried to remove an item of trade group '${i}:${n}' from the buying list, but nothing of such group was present in it!`);if(L.groups[i].count[n]<s)throw new Error(`Tried to remove an item of trade group '${i}:${n}' from the buying list, but provided count of '${s}' would lead to a negative number!`);return a?.count>e.count?(a.count-=s,L.groups[i].unsorted.find(o=>e.item_key===o.item_key).count-=s):(s=a.count,a.count=0,L.items.splice(L.items.indexOf(a),1),L.groups[i].unsorted=L.groups[i].unsorted.filter(o=>e.item_key!==o.item_key),L.groups[i].sorted=L.groups[i].sorted.filter(o=>e.item_key!==o.item_key)),L.groups[i].count[n]-=s,$a()}function Ls(){return!!Ne}function hl(e){let t=Oe(e.item_key),{group_key:i,group_tier:n}=t.getMarketSaturationGroup(),s=I.items.find(o=>o.item_key===e.item_key),a=r.inventory[e.item_key].count;return s?(a-s.count<e.count?(e.count=a-s.count,s.count=a):s.count+=e.count,I.groups[i].count[n]+=e.count,I.groups[i].unsorted.find(o=>e.item_key===o.item_key).count+=e.count):(a<e.count&&(e.count=a),I.groups[i]?I.groups[i].count.length<n+1&&I.groups[i].count.push(...new Array(n+1-I.groups[i].count.length).fill(0)):I.groups[i]=new Ma(n),I.items.push(e),I.groups[i].unsorted.push({...e}),I.groups[i].count[n]+=e.count,I.groups[i].needs_resort=!0),$a()}function pl(e){let t=Oe(e.item_key),{group_key:i,group_tier:n}=t.getMarketSaturationGroup(),s=e.count,a=I.items.find(o=>o.item_key===e.item_key);if(a?.count<s&&(s=a.count),!I.groups[i]||I.groups[i].count.length<n+1)throw new Error(`Tried to remove an item of trade group '${i}:${n}' from the selling list, but nothing of such group was present in it!`);if(I.groups[i].count[n]<s)throw new Error(`Tried to remove an item of trade group '${i}:${n}' from the selling list, but provided count of '${s}' would lead to a negative number!`);return a?.count>e.count?(a.count-=s,I.groups[i].unsorted.find(o=>e.item_key===o.item_key).count-=s):(s=a.count,a.count=0,I.items.splice(I.items.indexOf(a),1),I.groups[i].unsorted=I.groups[i].unsorted.filter(o=>e.item_key!==o.item_key),I.groups[i].sorted=I.groups[i].sorted.filter(o=>e.item_key!==o.item_key)),I.groups[i].count[n]-=s,$a()}function Is(e,t){P[e].add_to_inventory(t),Ne===e&&jt()}function Tc(e,t){P[e].remove_from_inventory(t),Ne===e&&jt()}function $a(){let e={buying_precalculated:{},selling:{},buying:{}};return L.value=0,I.value=0,Object.keys(L.groups).forEach(t=>{e.buying_precalculated[t]||(e.buying_precalculated[t]=[]);for(let i=0;i<L.groups[t].sorted.length;i++){let n=Oe(L.groups[t].sorted[i].item_key),{group_tier:s}=n.getMarketSaturationGroup();e.buying_precalculated[t].length<s+1&&e.buying_precalculated[t].push(...new Array(s+1-e.buying_precalculated[t].length).fill(0)),e.buying_precalculated[t][s]+=L.groups[t].sorted[i].count}}),Object.keys(I.groups).forEach(t=>{I.groups[t].group_value=0,e.selling[t]=[],I.groups[t].needs_resort&&(I.groups[t].sorted=I.groups[t].unsorted.sort((i,n)=>ll(i,n)),I.groups[t].needs_resort=!1);for(let i=0;i<I.groups[t].sorted.length;i++){let n=Oe(I.groups[t].sorted[i].item_key),{group_tier:s,group_key:a}=n.getMarketSaturationGroup(),o;a.startsWith(Ee)?o=mn:o=Lt;let l=hn({sold_by_tier:e.selling[t],target_tier:s,cap:o}),u=hn({sold_by_tier:e.buying_precalculated[t],target_tier:s,cap:o});I.groups[t].group_value+=n.getValueOfMultiple({additional_traded_count:l,stop_multiplier_at:Math.max(0,l-u+I.groups[t].sorted[i].count),count:I.groups[t].sorted[i].count,region:v.market_region}),e.selling[t].length<s+1&&e.selling[t].push(...new Array(s+1-e.selling[t].length).fill(0)),e.selling[t][s]+=I.groups[t].sorted[i].count}I.value+=I.groups[t].group_value}),Object.keys(L.groups).forEach(t=>{L.groups[t].group_value=0,e.buying[t]=[],L.groups[t].needs_resort&&(L.groups[t].sorted=L.groups[t].unsorted.sort((i,n)=>ll(i,n)),L.groups[t].needs_resort=!1);for(let i=0;i<L.groups[t].sorted.length;i++){let n=Oe(L.groups[t].sorted[i].item_key),{group_tier:s,group_key:a}=n.getMarketSaturationGroup(),o;a.startsWith(Ee)?o=mn:o=Lt;let l=hn({sold_by_tier:e.selling[t],target_tier:s,cap:o}),u=hn({sold_by_tier:e.buying[t],target_tier:s,cap:o});L.groups[a].group_value+=n.getValueOfMultiple({additional_traded_count:-u,stop_multiplier_at:Math.max(0,l-u-L.groups[t].sorted[i].count),count:L.groups[t].sorted[i].count,region:v.market_region,price_multiplier:P[Ne].getProfitMargin(),is_selling:!1}),e.buying[t].length<s+1&&e.buying[t].push(...new Array(s+1-e.buying[t].length).fill(0)),e.buying[t][s]+=L.groups[t].sorted[i].count}L.value+=L.groups[t].group_value}),I.value-L.value}function ll(e,t){let i=Oe(e.item_key),n=Oe(t.item_key),s=i.getMarketSaturationGroup().group_tier,a=n.getMarketSaturationGroup().group_tier;return s!=a?a-s:n.getBaseValue()-i.getBaseValue()}var ji=(e,t)=>{let i=1;if(e.length==0)return 1;if(e[0].money&&t.money<e[0].money)return i=0,i;if(e[1]?.money&&e[1].money>e[0].money&&t.money<e[1].money&&(i*=(t.money-e[0].money)/(e[1].money-e[0].money)),!i||(e[0].skills&&Object.keys(e[0].skills).forEach(n=>{G(n)<e[0].skills[n]?i=0:e[1]?.skills&&e[1].skills[n]>e[0].skills[n]&&G(n)<e[1].skills[n]&&(i*=(G(n)-e[0].skills[n])/(e[1].skills[n]-e[0].skills[n]))}),!i)||(e[0].items_by_id&&Object.keys(e[0].items_by_id).forEach(n=>{let s=!1;Object.keys(t.inventory).forEach(a=>{if(s)return;let{id:o}=JSON.parse(a);o===n&&t.inventory[a].count>=e[0].items_by_id[n].count&&(s=!0)}),s||(i=0)}),!i))return i;if(e[0].stats&&Object.keys(e[0].stats).forEach(n=>{t.stats.full[n]<e[0].stats[n]?i=0:e[1]?.stats&&e[1].stats[n]>e[0].stats[n]&&t.stats.full[n]<e[1].stats[n]&&(i*=(t.stats.full[n]-e[0].stats[n])/(e[1].stats[n]-e[0].stats[n]))}),e[0].season&&(e[0].season.yes?M.getSeason()!==e[0].season.yes&&(i=0):e[0].season.not&&M.getSeason()===e[0].season.not&&(i=0)),e[0].tools_by_slot){for(let n=0;n<e[0].tools_by_slot.length;n++)if(!t.equipment[e[0].tools_by_slot[n]]){i=0;break}}if(e[0].reputation&&Object.keys(e[0].reputation).forEach(n=>{if(t.reputation[n]<e[0].reputation[n])return i=0,i;e[1]?.reputation&&e[1].reputation[n]>e[0].reputation[n]&&t.reputation[n]<e[1].reputation[n]&&(i*=(t.reputation[n]-e[0].reputation[n])/(e[1].reputation[n]-e[0].reputation[n]))}),e[0].flags){for(let n=0;n<e[0].flags.length;n++)if(!Se[e[0].flags[n]]){i=0;break}}return i};var ge=class{constructor({starting_text:t,action_id:i,action_name:n,description:s,action_text:a,success_text:o,failure_texts:l={},required:u={},display_conditions:c={},conditions:_=[],rewards:h={},attempt_duration:f=0,success_chances:y=[1,1],is_unlocked:b=!1,repeatable:w=!1,check_conditions_on_finish:k=!0,unlock_text:H}){if(this.starting_text=t,this.action_name=n||t,this.action_id=i,this.description=s,this.action_text=a,this.failure_texts=l,this.failure_texts.conditional_loss||(this.failure_texts.conditional_loss=[]),this.failure_texts.random_loss||(this.failure_texts.random_loss=[]),this.failure_texts.unable_to_begin||(this.failure_texts.unable_to_begin=[]),this.success_text=o,this.required=u,_.length>2)throw new Error("LocationAction cannot have more than 2 sets of conditions!");this.conditions=_,this.display_conditions=c,this.check_conditions_on_finish=k,this.rewards=h,this.attempt_duration=f,this.success_chances=y,this.is_unlocked=b,this.is_finished=!1,this.repeatable=w,this.unlock_text=H}get_conditions_status(t){return ji(this.conditions,t)}can_be_started(t){return ji([this.required],t)}can_be_displayed(t){return ji([this.display_conditions],t)}};var q={},Pt=class{constructor({name:t,id:i,starting_text:n=`Talk to the ${t}`,ending_text:s="Go back",is_unlocked:a=!0,is_finished:o=!1,textlines:l={},actions:u={},description:c="",getDescription:_=()=>this.description,location_name:h}){this.name=t,this.id=i||this.name,this.starting_text=n,this.ending_text=s,this.is_unlocked=a,this.is_finished=o,this.textlines=l,this.actions=u,this.description=c,this.getDescription=_,this.location_name=h,Object.keys(this.textlines).forEach(f=>{let y=this.textlines[f];y.locks_lines&&(y.rewards.locks.textlines[this.id]||(y.rewards.locks.textlines[this.id]=[]),y.rewards.locks.textlines[this.id].push(...y.locks_lines))})}},E=class{constructor({name:t,text:i,getText:n,is_unlocked:s=!0,is_finished:a=!1,is_branch_only:o=!1,rewards:l={textlines:[],locations:[],dialogues:[],traders:[],stances:[],flags:[],items:[],locks:{textlines:{}}},branches_into:u=[],locks_lines:c=[],otherUnlocks:_,required_flags:h,display_conditions:f=[]}){this.name=t,this.text=i,this.getText=n||function(){return this.text},this.otherUnlocks=_||function(){},this.is_unlocked=s,this.is_finished=a,this.is_branch_only=o,this.rewards=l||{},this.branches_into=u,this.rewards.textlines=l.textlines||[],this.rewards.locations=l.locations||[],this.rewards.dialogues=l.dialogues||[],this.rewards.traders=l.traders||[],this.rewards.stances=l.stances||[],this.rewards.flags=l.flags||[],this.rewards.items=l.items||[],this.display_conditions=[f],this.required_flags=h,this.locks_lines=c,this.rewards.locks=l.locks||{},this.rewards.locks.textlines||(this.rewards.locks.textlines={})}},Vn=class extends ge{constructor(t){super(t),this.giveup_text=t.giveup_text,this.floating_click_effects=t.floating_click_effects}};(function(){q["village elder"]=new Pt({name:"village elder",textlines:{hello:new E({name:"elder hello",text:"elder hello answ",rewards:{textlines:[{dialogue:"village elder",lines:["what happened","where am i","dont remember","about"]}]},locks_lines:["hello"]}),"what happened":new E({name:"elder head hurts",text:"elder head hurts answ",is_unlocked:!1,locks_lines:["what happened","where am i","dont remember"],rewards:{textlines:[{dialogue:"village elder",lines:["ask to leave 1"]}],quest_progress:[{quest_id:"Lost memory",task_index:0}]}}),"where am i":new E({name:"elder where",text:"elder where answ",is_unlocked:!1,locks_lines:["what happened","where am i","dont remember"],rewards:{textlines:[{dialogue:"village elder",lines:["ask to leave 1"]}],quest_progress:[{quest_id:"Lost memory",task_index:0}]}}),"dont remember":new E({name:"elder remember",text:"elder remember answ",is_unlocked:!1,locks_lines:["what happened","where am i","dont remember"],rewards:{textlines:[{dialogue:"village elder",lines:["ask to leave 1"]}],quest_progress:[{quest_id:"Lost memory",task_index:0}]}}),about:new E({name:"elder who",text:"elder who answ",is_unlocked:!1,locks_lines:["about"]}),"ask to leave 1":new E({name:"elder leave 1",text:"elder leave 1 answ",is_unlocked:!1,rewards:{textlines:[{dialogue:"village elder",lines:["need to"]}]},locks_lines:["ask to leave 1"]}),"need to":new E({name:"elder need to",text:"elder need to answ",is_unlocked:!1,rewards:{textlines:[{dialogue:"village elder",lines:["rats","ask to leave 2","equipment"]}],locations:[{location:"Infested field"}],activities:[{location:"Village",activity:"weightlifting"},{location:"Village",activity:"running"}],quest_progress:[{quest_id:"Lost memory",task_index:1}]},locks_lines:["need to"]}),equipment:new E({name:"elder eq",text:"elder eq answ",is_unlocked:!1,locks_lines:["equipment"],rewards:{textlines:[{dialogue:"village elder",lines:["money"]}],traders:[{trader:"village trader"}]}}),money:new E({name:"elder money",text:"elder money answ",is_unlocked:!1,locks_lines:["money"],rewards:{activities:[{location:"Village",activity:"fieldwork"}]}}),"ask to leave 2":new E({name:"elder leave 2",text:"elder leave 2 answ",is_unlocked:!1,rewards:{}}),rats:new E({name:"elder rats",text:"elder rats answ",is_unlocked:!1}),"cleared field":new E({name:"elder cleared 1",text:"elder cleared 1 answ",is_unlocked:!1,rewards:{locations:[{location:"Nearby cave"},{location:"Infested field"},{location:"Shack"}],textlines:[{dialogue:"village elder",lines:["ask to leave 3"]}],dialogues:["old craftsman"]},locks_lines:["ask to leave 2","cleared field"]}),"ask to leave 3":new E({name:"elder leave 3",text:"elder leave 3 answ",rewards:{locations:[{location:"Nearby cave"},{location:"Infested field"}],dialogues:["old craftsman"]},is_unlocked:!1}),"cleared room":new E({name:"elder room clear",text:"elder room clear answ",is_unlocked:!1,rewards:{locations:[{location:"Eastern mill"}],quests:["It won't mill itself"]},locks_lines:["cleared room"]}),"cleared cave":new E({name:"elder cave clear",text:"elder cave clear answ",is_unlocked:!1,rewards:{textlines:[{dialogue:"village elder",lines:["ask to leave 4"]}],locations:[{location:"Forest road"},{location:"Infested field"},{location:"Nearby cave"}],dialogues:["village guard"],quest_progress:[{quest_id:"Lost memory",task_index:2}]},locks_lines:["ask to leave 3","rats","cleared cave"]}),"ask to leave 4":new E({name:"elder leave 4",text:"elder leave 4 answ",is_unlocked:!1,rewards:{locations:[{location:"Forest road"},{location:"Infested field"},{location:"Nearby cave"}],dialogues:["village guard","old craftsman"]}}),"new tunnel":new E({name:"elder tunnel",text:"elder tunnel answ",is_unlocked:!1,locks_lines:["new tunnel"]}),"more training":new E({name:"elder training",getText:e=>e?.season==="Winter"?"elder training answ 2":"elder training answ 1",is_unlocked:!1,locks_lines:["more training"],rewards:{global_activities:["swimming","climbing"],actions:[{location:"Nearby cave",action:"climb the mountain"}],locks:{quests:["Swimming alternative unlock"]}}})},description:"elder description"}),q["old craftsman"]=new Pt({name:"old craftsman",is_unlocked:!1,textlines:{hello:new E({name:"craftsman hello",text:"craftsman hello answ",rewards:{textlines:[{dialogue:"old craftsman",lines:["learn","leave"]}]},locks_lines:["hello"]}),learn:new E({name:"craftsman learn",text:"craftsman learn answ",rewards:{textlines:[{dialogue:"old craftsman",lines:["remind1","remind2","remind3","remind4"]}],items:["Old pickaxe","Old axe","Old sickle","Old shovel"],flags:["is_gathering_unlocked","is_crafting_unlocked"]},locks_lines:["learn","leave"],is_unlocked:!1}),leave:new E({name:"craftsman leave",text:"craftsman leave answ",is_unlocked:!1}),remind1:new E({name:"craftsman remind 1",text:"craftsman remind 1 answ",is_unlocked:!1,rewards:{textlines:[{dialogue:"old craftsman",lines:["remind4"]}]}}),remind2:new E({name:"craftsman remind 2",text:"craftsman remind 2 answ",is_unlocked:!1,rewards:{textlines:[{dialogue:"old craftsman",lines:["remind4"]}]}}),remind3:new E({name:"craftsman remind 3",text:"craftsman remind 3 answ",is_unlocked:!1,rewards:{textlines:[{dialogue:"old craftsman",lines:["remind4"]}]}}),remind4:new E({name:"craftsman remind 4",text:"craftsman remind 4 answ",is_unlocked:!1})},description:"craftsman description"}),q["village guard"]=new Pt({name:"village guard",is_unlocked:!1,textlines:{hello:new E({name:"guard hello",text:"guard hello answ",rewards:{textlines:[{dialogue:"village guard",lines:["tips","job"]}]},locks_lines:["hello"]}),job:new E({name:"guard job",is_unlocked:!1,text:"guard job answ",rewards:{activities:[{location:"Village",activity:"patrolling"}]},locks_lines:["job"]}),tips:new E({name:"guard tips",is_unlocked:!1,text:"guard tips answ",rewards:{textlines:[{dialogue:"village guard",lines:["teach"]}]}}),hi:new E({name:"guard hi",is_unlocked:!1,text:"guard hi answ",display_conditions:{reputation:{village:250}}}),teach:new E({name:"guard teach",is_unlocked:!1,text:"guard teach answ",rewards:{locations:[{location:"Sparring with the village guard (quick)"},{location:"Sparring with the village guard (heavy)"}]},locks_lines:["teach"]}),quick:new E({name:"guard quick",is_unlocked:!1,text:"guard quick answ",otherUnlocks:()=>{q["village guard"].textlines.heavy.is_finished&&(q["village guard"].textlines.wide.is_unlocked=!0)},locks_lines:["quick"],rewards:{stances:["quick"]}}),heavy:new E({name:"guard heavy",is_unlocked:!1,text:"guard heavy answ",otherUnlocks:()=>{q["village guard"].textlines.quick.is_finished&&(q["village guard"].textlines.wide.is_unlocked=!0)},locks_lines:["heavy"],rewards:{stances:["heavy"]}}),wide:new E({name:"guard wide",is_unlocked:!1,text:"guard wide answ",locks_lines:["wide"],rewards:{stances:["wide"],textlines:[{dialogue:"village guard",lines:["serious","hi"]}]}}),serious:new E({name:"guard serious",is_unlocked:!1,text:"guard serious answ",locks_lines:["serious"]})},description:"guard description"}),q["village millers"]=new Pt({name:"village millers",textlines:{hello:new E({name:"millers hello",text:"millers hello answ",rewards:{textlines:[{dialogue:"village millers",lines:["how","young"]}]},locks_lines:["hello"]}),how:new E({is_unlocked:!1,name:"millers how",text:"millers how answ",rewards:{textlines:[{dialogue:"village millers",lines:["sure"]}]},locks_lines:["how"]}),sure:new E({is_unlocked:!1,name:"millers sure",text:"millers sure answ",rewards:{quest_progress:[{quest_id:"It won't mill itself",task_index:0}],locations:[{location:"Eastern storehouse"}]},locks_lines:["sure"]}),young:new E({is_unlocked:!1,name:"millers young",text:"millers young answ",locks_lines:["young"]}),"cleared storage":new E({is_unlocked:!1,name:"millers cleared",text:"millers cleared answ",locks_lines:["cleared storage"],rewards:{quest_progress:[{quest_id:"It won't mill itself",task_index:1}],actions:[{location:"Village",action:"search for delivery"}]}}),delivered:new E({is_unlocked:!1,name:"millers delivered",text:"millers delivered answ",locks_lines:["delivered"],rewards:{textlines:[{dialogue:"village millers",lines:["kiss"]}],quest_progress:[{quest_id:"It won't mill itself",task_index:2}],actions:[{location:"Village",action:"search for delivery"}]}}),kiss:new E({is_unlocked:!1,name:"millers kiss",text:"millers kiss answ",branches_into:["kiss both","kiss cat","kiss mouse","reject nice","reject mean"]}),"kiss both":new E({is_branch_only:!0,name:"millers kiss both",text:"millers kiss both answ",locks_lines:["kiss"],rewards:{textlines:[{dialogue:"village millers",lines:["kiss more","how2"]}]}}),"kiss cat":new E({is_branch_only:!0,name:"millers kiss cat",text:"millers kiss cat answ",locks_lines:["kiss"],rewards:{textlines:[{dialogue:"village millers",lines:["kiss more","how2"]}]}}),"kiss mouse":new E({is_branch_only:!0,name:"millers kiss mouse",text:"millers kiss mouse answ",locks_lines:["kiss"],rewards:{textlines:[{dialogue:"village millers",lines:["kiss more","how2"]}]}}),"reject nice":new E({is_branch_only:!0,name:"millers reject nice",text:"millers reject nice answ",locks_lines:["kiss"],rewards:{textlines:[{dialogue:"village millers",lines:["how2"]}]}}),"reject mean":new E({is_branch_only:!0,name:"millers reject mean",text:"millers reject mean answ",locks_lines:["kiss"],rewards:{textlines:[{dialogue:"village millers",lines:["how2"]}]}}),"kiss more":new E({is_unlocked:!1,name:"millers kiss more",text:"millers kiss more answ",locks_lines:["kiss more"]}),how2:new E({is_unlocked:!1,name:"millers how2",text:"millers how2 answ"})},description:"millers description"}),q["gate guard"]=new Pt({name:"gate guard",textlines:{enter:new E({name:"g guard hello",text:"g guard hello answ"})},description:"g guard description"}),q["suspicious man"]=new Pt({name:"suspicious man",textlines:{hello:new E({name:"sus hello",text:"sus hello answ",rewards:{locations:[{location:"Fight off the assailant"}]},locks_lines:["hello"]}),defeated:new E({name:"sus defeated",is_unlocked:!1,text:"sus defeated answ",locks_lines:["defeated"],rewards:{textlines:[{dialogue:"suspicious man",lines:["behave","situation"]}],quest_progress:[{quest_id:"Lost memory",task_index:3}]}}),behave:new E({name:"sus behave",is_unlocked:!1,text:"sus behave answ",locks_lines:["defeated"],rewards:{textlines:[{dialogue:"suspicious man",lines:["situation","boss"]}]}}),boss:new E({name:"sus boss",is_unlocked:!1,text:"sus boss answ",locks_lines:["boss"]}),situation:new E({name:"sus situation",is_unlocked:!1,text:"sus situation answ",locks_lines:["situation"],rewards:{textlines:[{dialogue:"suspicious man",lines:["gang","boss"]}]}}),gang:new E({name:"sus gang",is_unlocked:!1,text:"sus gang answ",locks_lines:["gang","behave"],rewards:{textlines:[{dialogue:"suspicious man",lines:["gang","behave 2"]}],locations:[{location:"Gang hideout"}],quest_progress:[{quest_id:"Light in the darkness",task_index:0}]}}),"defeated gang":new E({name:"sus gang defeated",is_unlocked:!1,text:"sus gang defeated answ",locks_lines:["defeated gang"],rewards:{textlines:[{dialogue:"suspicious man",lines:["tricks","behave 3"]}],dialogues:["old woman of the slums"]}}),"behave 2":new E({name:"sus behave 2",is_unlocked:!1,text:"sus behave 2 answ"}),"behave 3":new E({name:"sus behave 3",is_unlocked:!1,text:"sus behave 3 answ",rewards:{textlines:[{dialogue:"suspicious man",lines:["tricks"]}],dialogues:["old woman of the slums"],actions:[{dialogue:"suspicious man",action:"headpat"}]}}),tricks:new E({name:"sus tricks",is_unlocked:!1,text:"sus tricks answ",rewards:{stances:["defensive"]},locks_lines:["tricks"]})},getDescription:()=>q["suspicious man"].textlines["defeated gang"].is_finished?"sus description 2":"sus description 1",actions:{headpat:new Vn({action_id:"headpat",is_unlocked:!1,repeatable:!0,starting_text:"sus headpat",floating_click_effects:["(* ^ \u03C9 ^)	","<(\uFFE3\uFE36\uFFE3)>	","(*\u2267\u03C9\u2266*)	","(\u15D2\u2A4A\u15D5)","(= \u2A4A =)"],description:"",action_text:"",success_text:"sus headpat answ",display_conditions:{flags:["is_mofu_mofu_enabled"]},attempt_duration:0,success_chances:[1]})}}),q["old woman of the slums"]=new Pt({name:"old woman of the slums",is_unlocked:!1,textlines:{hello:new E({name:"old hello",text:"old hello answ",locks_lines:["hello"],rewards:{textlines:[{dialogue:"old woman of the slums",lines:["dinner"]}]}}),dinner:new E({name:"old dinner",is_unlocked:!1,text:"old dinner answ",locks_lines:["dinner"],rewards:{textlines:[{dialogue:"old woman of the slums",lines:["ingredients"]}]}}),ingredients:new E({name:"old ingredients",is_unlocked:!1,text:"old ingredients answ",locks_lines:["ingredients"],rewards:{activities:[{location:"Town outskirts",activity:"herbalism"}]}})},getDescription:()=>q["old woman of the slums"].textlines.hello.is_finished?"old description 2":"old description 1"}),q["farm supervisor"]=new Pt({name:"farm supervisor",textlines:{hello:new E({name:"sup hello",text:"sup hello answ",rewards:{textlines:[{dialogue:"farm supervisor",lines:["things","work","animals","fight","fight0","anything"]}]},locks_lines:["hello"]}),work:new E({name:"sup work",is_unlocked:!1,text:"sup work answ",rewards:{activities:[{location:"Town farms",activity:"fieldwork"}]},locks_lines:["work"]}),anything:new E({name:"sup anything",is_unlocked:!1,text:"sup anything answ",rewards:{actions:[{dialogue:"farm supervisor",action:"bonemeal1"}],quests:["Bonemeal delivery"]},locks_lines:["anything"]}),"more bonemeal":new E({name:"sup bonemeal",is_unlocked:!1,text:"sup bonemeal answ",rewards:{actions:[{dialogue:"farm supervisor",action:"bonemeal2"}]},locks_lines:["more bonemeal"]}),animals:new E({name:"sup animals",is_unlocked:!1,text:"sup animals answ",required_flags:{yes:["is_gathering_unlocked"]},rewards:{activities:[{location:"Town farms",activity:"animal care"}]},locks_lines:["animals"]}),fight0:new E({name:"sup fight0",is_unlocked:!1,text:"sup fight0 answ",required_flags:{no:["is_strength_proved"]},rewards:{quests:["Ploughs to swords"]}}),fight:new E({name:"sup fight",is_unlocked:!1,text:"sup fight answ",required_flags:{yes:["is_strength_proved"]},rewards:{actions:[{location:"Forest road",action:"search for boars"}],quests:["Ploughs to swords"],quest_progress:[{quest_id:"Ploughs to swords",task_index:0}]},locks_lines:["fight"]}),things:new E({is_unlocked:!1,name:"sup things",text:"sup things answ",rewards:{textlines:[{dialogue:"farm supervisor",lines:["animals","fight","fight0","anything"]}]}}),"defeated boars":new E({is_unlocked:!1,name:"sup defeated boars",text:"sup defeated boars answ",locks_lines:["defeated boars"],rewards:{money:4e3,quest_progress:[{quest_id:"Ploughs to swords",task_index:1}],textlines:[{dialogue:"farm supervisor",lines:["troubled"]}]}}),troubled:new E({is_unlocked:!1,name:"sup troubled",text:"sup troubled answ",locks_lines:["troubled"],display_conditions:{season:{not:"Winter"}},rewards:{quest_progress:[{quest_id:"Ploughs to swords",task_index:2}],actions:[{location:"Town farms",action:"dig for ants 1"}]}}),"eliminated ants":new E({is_unlocked:!1,name:"sup eliminated",text:"sup eliminated answ",locks_lines:["eliminated ants"],rewards:{quest_progress:[{quest_id:"Ploughs to swords",task_index:3}]}})},actions:{bonemeal1:new Vn({action_id:"bonemeal1",starting_text:"sup deliver",description:"",action_text:"",success_text:"sup deliver answ",failure_texts:{unable_to_begin:["sup deliver not"]},required:{items_by_id:{Bonemeal:{count:50,remove_on_success:!0}}},attempt_duration:0,success_chances:[1],rewards:{quest_progress:[{quest_id:"Bonemeal delivery",task_index:0}],textlines:[{dialogue:"farm supervisor",lines:["more bonemeal"]}]}}),bonemeal2:new Vn({action_id:"bonemeal2",starting_text:"sup deliver 2",description:"",action_text:"",success_text:"sup deliver 2 answ",repeatable:!0,failure_texts:{unable_to_begin:["sup deliver 2 not"]},required:{items_by_id:{Bonemeal:{count:50,remove_on_success:!0}}},attempt_duration:0,success_chances:[1],rewards:{money:2e3}})},description:"sup description"})})();var x={},Ea=class{constructor({name:t,description:i,action_text:n,base_skills_names:s,is_unlocked:a=!1,getBackgroundNoises:o}){this.name=t,this.description=i,this.action_text=n,this.base_skills_names=s,this.tags=[],this.is_unlocked=a,this.getBackgroundNoises=o||function(){return[]}}},Sa=class extends Ea{constructor(t){super(t),this.type="JOB",this.payment_type=t.payment_type}},ti=class extends Ea{constructor(t){super(t),this.type="TRAINING"}},Pi=class extends ti{constructor({name:t,description:i,action_text:n,base_skills_names:s,is_unlocked:a=!1,required_tool_type:o,getBackgroundNoises:l=null}){super({name:t,description:i,action_text:n,base_skills_names:s,is_unlocked:a,getBackgroundNoises:l}),this.type="GATHERING",this.tags.gathering=!0,this.required_tool_type=o}};(function(){x.fieldwork=new Sa({name:"fieldwork",action_text:"Working on the fields",description:"It's tiring and doesn't pay much, but it's better than doing nothing",base_skills_names:["Farming"],is_unlocked:!0}),x.patrolling=new Sa({name:"patrolling",action_text:"Patrolling",description:"Nothing ever happens",base_skills_names:["Spatial awareness"],is_unlocked:!0})})();(function(){x.running=new ti({name:"running",action_text:"Just running around",description:"One of the most basic exercises",base_skills_names:["Running"],is_unlocked:!0}),x.weightlifting=new ti({name:"weightlifting",action_text:"Carrying heavy things",description:"One of the most basic exercises",base_skills_names:["Weightlifting"],is_unlocked:!0}),x.balancing=new ti({name:"balancing",action_text:"Trying to keep your balance",description:"One of the most basic exercises",base_skills_names:["Equilibrium"],is_unlocked:!0}),x.swimming=new ti({name:"swimming",action_text:"Splish, splash, splosh",description:"A rather basic, although somewhat risky exercise",base_skills_names:["Swimming"],is_unlocked:!1}),x.meditating=new ti({name:"meditating",action_text:"Focusing your mind",description:"A somewhat basic exercise",base_skills_names:["Meditation"],is_unlocked:!0}),x.climbing=new ti({name:"climbing",action_text:"Looking for next grip to hold to",description:"An advanced exercise that uses majority of muscles in the body",base_skills_names:["Climbing"],is_unlocked:!1})})();(function(){x.mining=new Pi({name:"mining",action_text:"Swinging the pickaxe",description:"Swing you pickaxe against the hard rock",base_skills_names:["Mining"],is_unlocked:!0,required_tool_type:"pickaxe",getBackgroundNoises:()=>["clang clang","clink clink","tink tink","crunch","*Your pickaxe strikes the heart of the rock*"]}),x.digging=new Pi({name:"digging",action_text:"Swinging the shovel",description:"Dig up useful materials with a shovel",base_skills_names:["Digging"],is_unlocked:!0,required_tool_type:"shovel",getBackgroundNoises:()=>["plap plap","plop plop","crunch","thwack","scrape","squelch"]}),x.woodcutting=new Pi({name:"woodcutting",action_text:"Gathering wood",description:"Chop chop",base_skills_names:["Woodcutting"],is_unlocked:!0,required_tool_type:"axe",getBackgroundNoises:()=>["chop","CHOP chop","chop CHOP","chop chop","creeeak","Sap oozes from the gash","*Splinters burst from under your axe*","*A pinecone falls on you*","*A squirrel is upset with you*"]}),x.herbalism=new Pi({name:"herbalism",action_text:"Searching for herbs",description:"Look for any useful plants and mushrooms",base_skills_names:["Herbalism"],is_unlocked:!0,required_tool_type:"sickle",getBackgroundNoises:()=>["*rustle*","A frog is watching you work","You find a particularly impressive snail under a leaf"]}),x["animal care"]=new Pi({name:"animal care",action_text:"Tending to animals",description:"Take care of animals",base_skills_names:["Animal handling"],is_unlocked:!0})})();var X={},Wt={},ye={SMALL:"small",MEDIUM:"medium",LARGE:"large"},La={beast:"Butchering"},Ia={};Object.keys(La).forEach(e=>{Ia[La[e]]=e});var de=class{constructor({name:t,id:i,description:n,xp_value:s=1,stats:a,rank:o,loot_list:l=[],size:u="small",add_to_bestiary:c=!0,tags:_=[]}){this.name=t,this.id=i||t,this.rank=o,this.description=n,this.xp_value=s,this.stats=a,this.stats.max_health=a.health,this.loot_list=l,this.tags={};for(let h=0;h<_.length;h++)this.tags[_[h]]=!0;if(this.tags[u]=!0,this.add_to_bestiary=c,u!==ye.SMALL&&u!==ye.MEDIUM&&u!==ye.LARGE)throw new Error(`No such enemy size option as "${u}"!`);this.size=u}get_loot({drop_chance_modifier:t=1}={}){let i=[],n;for(let s=0;s<this.loot_list.length;s++)if(n=this.loot_list[s],n.chance*this.get_droprate_modifier(t)>=Math.random()){let a=1;"count"in n&&(a=Math.round(Math.random()*(n.count.max-n.count.min)+n.count.min)),i.push({item_id:n.item_name,count:a})}return i}get_droprate_modifier(t=1){let i=1*t;return Object.keys(this.tags).forEach(n=>{La[n]&&(i*=A({skill_id:La[n],scaling_type:"multiplicative"}))}),i}};(function(){X["Starving wolf rat"]=new de({name:"Starving wolf rat",description:"Rat with size of a dog, starved and weakened",xp_value:1,rank:1,size:"small",tags:["living","beast","wolf rat"],stats:{health:20,attack:4,agility:5,dexterity:4,magic:0,intuition:5,attack_speed:.8,defense:1},loot_list:[{item_name:"Rat tail",chance:.04},{item_name:"Rat fang",chance:.04},{item_name:"Rat pelt",chance:.01}]}),X["Wolf rat"]=new de({name:"Wolf rat",description:"Rat with size of a dog",xp_value:1,rank:1,size:"small",tags:["living","beast","wolf rat"],stats:{health:30,attack:6,agility:6,dexterity:5,intuition:6,magic:0,attack_speed:1,defense:2},loot_list:[{item_name:"Rat tail",chance:.04},{item_name:"Rat fang",chance:.04},{item_name:"Rat pelt",chance:.01}]}),X["Elite wolf rat"]=new de({name:"Elite wolf rat",description:"Rat with size of a dog, much more ferocious than its relatives",xp_value:4,rank:1,size:ye.SMALL,tags:["living","beast","wolf rat"],stats:{health:80,attack:32,agility:30,dexterity:24,intuition:24,magic:0,attack_speed:1.5,defense:8},loot_list:[{item_name:"Rat tail",chance:.04},{item_name:"Rat fang",chance:.04},{item_name:"Rat pelt",chance:.02}]}),X["Elite wolf rat guardian"]=new de({name:"Elite wolf rat guardian",description:"It's no longer dog-sized, but rather around the size of an average wolf, with thicker skin, longer claws and pure insanity in the eyes",xp_value:15,rank:4,size:ye.MEDIUM,tags:["living","beast","wolf rat","monster"],stats:{health:600,attack:60,agility:50,dexterity:50,intuition:50,magic:0,attack_speed:1.2,defense:30},loot_list:[{item_name:"Rat tail",chance:.04},{item_name:"Rat fang",chance:.04},{item_name:"Rat pelt",chance:.02},{item_name:"Weak monster bone",chance:.005}]}),X["Wall rat"]=new de({name:"Wall rat",description:"They don't live in the walls, they ARE the walls. Insane writhing masses of teeth, fangs, and tails, that make no logical sense. An abomination that cannot exist, and yet it does",xp_value:50,rank:8,size:ye.LARGE,tags:["living","beast","wolf rat","monster","eldritch"],stats:{health:4e3,attack:100,agility:2,dexterity:120,intuition:200,magic:0,attack_speed:2,attack_count:4,defense:20},loot_list:[{item_name:"Rat tail",chance:.08},{item_name:"Rat fang",chance:.08}]}),X["Starving wolf"]=new de({name:"Starving wolf",description:"A big, wild and hungry canine",xp_value:3,rank:2,tags:["living","beast"],stats:{health:200,attack:22,agility:34,dexterity:34,intuition:32,magic:0,attack_speed:1,defense:12},loot_list:[{item_name:"Wolf fang",chance:.03},{item_name:"Wolf pelt",chance:.01}],size:ye.MEDIUM}),X["Young wolf"]=new de({name:"Young wolf",description:"A small, wild canine",xp_value:3,rank:2,tags:["living","beast"],stats:{health:150,attack:25,agility:34,dexterity:30,intuition:24,magic:0,attack_speed:1.4,defense:6},loot_list:[{item_name:"Wolf fang",chance:.03},{item_name:"Wolf pelt",chance:.01}],size:ye.SMALL}),X.Wolf=new de({name:"Wolf",description:"A large, wild canine",xp_value:6,rank:3,tags:["living","beast"],stats:{health:250,attack:40,agility:50,dexterity:50,intuition:40,magic:0,attack_speed:1.3,defense:20},loot_list:[{item_name:"Wolf fang",chance:.04},{item_name:"Wolf pelt",chance:.02},{item_name:"High quality wolf fang",chance:5e-4}],size:ye.MEDIUM}),X.Direwolf=new de({name:"Direwolf",description:"A powerful wild wolf variant of unmatched ferocity",xp_value:20,rank:7,tags:["living","beast"],stats:{health:1e3,attack:160,agility:160,dexterity:70,intuition:70,magic:0,attack_speed:1.4,defense:30},loot_list:[{item_name:"Wolf fang",chance:.08},{item_name:"Wolf pelt",chance:.04},{item_name:"High quality wolf fang",chance:.001},{item_name:"Weak monster bone",chance:.02}],size:ye.MEDIUM}),X["Direwolf hunter"]=new de({name:"Direwolf hunter",description:"A powerful wild wolf variant of unmatched ferocity, the strongest and heaviest out of all direwolves",xp_value:30,rank:8,tags:["living","beast"],stats:{health:2e3,attack:240,agility:130,dexterity:80,intuition:90,magic:0,attack_speed:1.1,defense:40},loot_list:[{item_name:"Wolf fang",chance:.12},{item_name:"Wolf pelt",chance:.06},{item_name:"Weak monster bone",chance:.02},{item_name:"High quality wolf fang",chance:.0015}],size:ye.MEDIUM}),X.Boar=new de({name:"Boar",description:"A big wild creature, with thick skin and large tusks",xp_value:10,rank:4,tags:["living","beast"],stats:{health:600,attack:50,agility:30,dexterity:50,intuition:60,magic:0,attack_speed:1,defense:35},loot_list:[{item_name:"Boar hide",chance:.04},{item_name:"Boar meat",chance:.02},{item_name:"Boar tusk",chance:.02},{item_name:"High quality boar tusk",chance:5e-4}],size:ye.MEDIUM}),X["Angry mountain goat"]=new de({name:"Angry mountain goat",description:"It's a mountain goat and it's angry",xp_value:15,rank:6,tags:["living","beast"],size:ye.MEDIUM,stats:{health:600,attack:120,agility:100,dexterity:60,magic:0,intuition:60,attack_speed:.5,defense:50},loot_list:[{item_name:"Mountain goat hide",chance:.04},{item_name:"Goat meat",chance:.02},{item_name:"Mountain goat horn",chance:.02},{item_name:"Pristine mountain goat horn",chance:5e-4}]}),X["Forest bear"]=new de({name:"Forest bear",description:"A mighty and dangerous predator with thick skin, sharp teeth, and dangerous claws",xp_value:60,rank:9,tags:["living","beast"],stats:{health:6e3,attack:600,agility:160,dexterity:200,intuition:200,magic:0,attack_speed:.8,defense:500},loot_list:[{item_name:"Bear hide",chance:.05},{item_name:"Bear claw",chance:.1},{item_name:"Sharp bear claw",chance:.002}],size:ye.LARGE}),X["Red ant swarm"]=new de({name:"Red ant swarm",description:"A swarm of angry red ants, each the size of a regular rat",xp_value:20,rank:7,tags:["living","insect"],stats:{health:600,attack:4,agility:100,dexterity:200,intuition:100,magic:0,attack_speed:1.5,attack_count:30,defense:10},size:ye.SMALL}),X["Red ant queen"]=new de({name:"Red ant queen",description:"A red ant queen, despite her decent size she's not much of a fighter",xp_value:10,rank:5,tags:["living","insect"],stats:{health:200,attack:20,agility:50,dexterity:200,intuition:100,magic:0,attack_speed:.5,defense:20},size:ye.SMALL}),X["Slums thug"]=new de({name:"Slums thug",description:"A nasty thug with shabby equipment",xp_value:10,rank:5,tags:["living","human"],size:ye.MEDIUM,stats:{health:500,attack:60,agility:60,dexterity:60,magic:0,intuition:60,attack_speed:1.7,defense:45}})})();(function(){X["Village guard (heavy)"]=new de({name:"Village guard (heavy)",description:"",add_to_bestiary:!1,xp_value:1,rank:4,tags:["living","human"],size:ye.MEDIUM,stats:{health:300,attack:50,agility:20,dexterity:80,magic:0,intuition:20,attack_speed:.2,defense:30}}),X["Village guard (quick)"]=new de({name:"Village guard (quick)",description:"",add_to_bestiary:!1,xp_value:1,rank:4,tags:["living","human"],size:ye.MEDIUM,stats:{health:300,attack:20,agility:20,dexterity:50,magic:0,intuition:20,attack_speed:2,defense:10}}),X["Suspicious wall"]=new de({name:"Suspicious wall",description:"",add_to_bestiary:!1,xp_value:1,rank:1,tags:["inanimate"],size:ye.LARGE,stats:{health:1e4,attack:0,agility:0,dexterity:0,magic:0,intuition:0,attack_speed:1e-6,defense:100}}),X["Suspicious man"]=new de({name:"Suspicious man",description:"",add_to_bestiary:!1,xp_value:1,rank:5,tags:["living","human"],size:ye.MEDIUM,stats:{health:400,attack:60,agility:60,dexterity:60,magic:0,intuition:60,attack_speed:2,defense:30}}),X["Angry-looking mountain goat"]=new de({name:"Angry-looking mountain goat",description:"It's a mountain goat and it's angry",add_to_bestiary:!1,xp_value:1,rank:6,tags:["living","beast"],size:ye.MEDIUM,stats:{health:1200,attack:150,agility:100,dexterity:70,magic:0,intuition:60,attack_speed:.5,defense:60}})})();var m={},et={},at={},De=class{constructor({name:t,id:i,description:n,connected_locations:s=[],is_unlocked:a=!0,is_finished:o=!1,dialogues:l=[],traders:u=[],market_region:c=null,types:_=[],housing:h={},light_level:f="normal",getDescription:y,background_noises:b=[],getBackgroundNoises:w,crafting:k=null,tags:H={},is_temperature_static:W=!1,static_temperature:ue=null,reverse_day_night_temperatures:qe=!1,temperature_range_modifier:je=1,temperature_modifier:Ae=0,is_under_roof:He=!1,entrance_rewards:Ut}){this.name=t,this.id=i||t,this.description=n,this.getDescription=y||function(){return n},this.background_noises=b,this.getBackgroundNoises=w||function(){return b},this.connected_locations=s,this.is_unlocked=a,this.is_finished=o,this.dialogues=l,this.traders=u,this.market_region=c,c&&(ks[c]=!0),this.activities={},this.actions={},this.types=_,this.housing=h,this.light_level=f,this.crafting=k,this.tags=H,this.tags.safe_zone=!0,this.entrance_rewards=Ut,this.is_temperature_static=W,this.static_temperature=ue,this.reverse_day_night_temperatures=qe,this.temperature_range_modifier=je,this.temperature_modifier=Ae,this.is_under_roof=He}},we=class{constructor({name:t,id:i,description:n,getDescription:s,is_unlocked:a=!0,is_finished:o=!1,types:l=[],enemy_groups_list:u=[],is_enemy_groups_list_random:c=!0,predefined_lineup_on_nth_group:_=1,enemies_list:h=[],enemy_group_size:f=[1,1],enemy_count:y=30,enemy_stat_variation:b=0,parent_location:w,leave_text:k,first_reward:H={},repeatable_reward:W={},rewards_with_clear_requirement:ue=[],otherUnlocks:qe,unlock_text:je,is_challenge:Ae=!1,tags:He={},is_temperature_static:Ut=!1,static_temperature:Kt=null,reverse_day_night_temperatures:it=!1,temperature_range_modifier:wt=1,temperature_modifier:Y=0,is_under_roof:Me=!1}){if(this.name=t,this.id=i||t,this.unlock_text=je,this.description=n,this.getDescription=s||function(){return n},this.otherUnlocks=qe||function(){},this.is_unlocked=a,this.is_finished=o,this.types=l,this.enemy_groups_list=u,this.is_enemy_groups_list_random=c,this.predefined_lineup_on_nth_group=_,this.enemies_list=h,this.enemy_group_size=f,this.enemy_groups_list||(this.enemy_group_size[0]<1&&(this.enemy_group_size[0]=1,console.error(`Minimum enemy group size in zone "${this.name}" is set to unallowed value of ${this.enemy_group_size[0]} and was corrected to lowest value possible of 1`)),this.enemy_group_size[0]>8&&(this.enemy_group_size[0]=8,console.error(`Minimum enemy group size in zone "${this.name}" is set to unallowed value of ${this.enemy_group_size[0]} and was corrected to highest value possible of 8`)),this.enemy_group_size[1]<1&&(this.enemy_group_size[1]=1,console.error(`Maximum enemy group size in zone "${this.name}" is set to unallowed value of ${this.enemy_group_size[1]} and was corrected to lowest value possible of 1`)),this.enemy_group_size[1]>8&&(this.enemy_group_size[1]=8,console.error(`Maximum enemy group size in zone "${this.name}" is set to unallowed value of ${this.enemy_group_size[1]} and was corrected to highest value possible of 8`))),this.enemy_count=y,this.enemy_groups_list.length==0&&this.enemies_list.length==0)throw new Error(`No enemies provided for zone "${this.name}"`);if(this.enemy_groups_killed=0,this.enemy_stat_variation=b,this.enemy_stat_variation<0&&(this.enemy_stat_variation=0,console.error(`Stat variation for enemies in zone "${this.name}" is set to unallowed value and was corrected to a default 0`)),this.parent_location=w,!m[this.parent_location.id])throw new Error(`Couldn't add parent location "${this.parent_location.name}" to zone "${this.name}"`);this.leave_text=k,this.first_reward=H,this.repeatable_reward=W,this.rewards_with_clear_requirement=ue,this.is_challenge=Ae,this.gained_skills=this.types?.map(se=>({skill:p[et[se.type].stages[se.stage||1].related_skill],xp:se.xp_gain})).filter(se=>se.skill);let nt=this.types.map(se=>se.type);nt.includes("bright")?this.light_level="bright":nt.includes("dark")?this.light_level="dark":this.light_level="normal",this.tags=He,this.tags["Combat zone"]=!0,this.is_temperature_static=Ut,this.static_temperature=Kt,this.reverse_day_night_temperatures=it,this.temperature_range_modifier=wt,this.temperature_modifier=Y,this.is_under_roof=Me}get_next_enemies(){let t=[],i=[];if(this.enemy_groups_list.length>0&&this.enemy_groups_killed%this.predefined_lineup_on_nth_group==0&&(this.enemy_groups_killed>0||this.predefined_lineup_on_nth_group==0))if(this.is_enemy_groups_list_random){let n=Math.floor(Math.random()*this.enemy_groups_list.length);i=this.enemy_groups_list[n].enemies}else{let n=this.enemy_groups_killed%this.enemy_groups_list.length;i=this.enemy_groups_list[n].enemies}else{let n=this.enemy_group_size[0]+Math.round(Math.random()*(this.enemy_group_size[1]-this.enemy_group_size[0]));for(let s=0;s<n;s++)i.push(this.enemies_list[Math.floor(Math.random()*this.enemies_list.length)])}for(let n=0;n<i.length;n++){let s=X[i[n]],a;if(this.enemy_stat_variation!=0){let o=Math.random()*this.enemy_stat_variation,l=1+o,u=2*o;a=new de({name:s.name,description:s.description,xp_value:s.xp_value,stats:{health:Math.round(s.stats.health*(l-Math.random()*u)),attack:Math.round(s.stats.attack*(l-Math.random()*u)),agility:Math.round(s.stats.agility*(l-Math.random()*u)),dexterity:Math.round(s.stats.dexterity*(l-Math.random()*u)),magic:Math.round(s.stats.magic*(l-Math.random()*u)),intuition:Math.round(s.stats.intuition*(l-Math.random()*u)),attack_speed:Math.round(s.stats.attack_speed*(l-Math.random()*u)*100)/100,attack_count:Math.round((s.stats.attack_count||1)*(l-Math.random()*u)),defense:Math.round(s.stats.defense*(l-Math.random()*u))},loot_list:s.loot_list,add_to_bestiary:s.add_to_bestiary,size:s.size})}else a=new de({name:s.name,description:s.description,xp_value:s.xp_value,stats:{health:s.stats.health,attack:s.stats.attack,agility:s.stats.agility,dexterity:s.stats.dexterity,magic:s.stats.magic,intuition:s.stats.intuition,attack_speed:s.stats.attack_speed,attack_count:s.stats.attack_count||1,defense:s.stats.defense},loot_list:s.loot_list,add_to_bestiary:s.add_to_bestiary,size:s.size});a.is_alive=!0,t.push(a)}return t}get_total_effect(){let t={multipliers:{},flats:{}},i={multipliers:{},flats:{}};for(let n=0;n<this.types.length;n++){let s=et[this.types[n].type].stages[this.types[n].stage];!s.related_skill||!s.effects||Object.keys(s.effects).forEach(a=>{s.effects[a].multiplier&&(t.multipliers[a]=(t.multipliers[a]||1)*s.effects[a].multiplier,i.multipliers[a]=(i.multipliers[a]||1)*Qn(this.types[n].type,this.types[n].stage,a,"multiplier")),s.effects[a].flat&&(t.flats[a]=(t.flats[a]||0)+s.effects[a].flat,i.flats[a]=(i.flats[a]||0)+Qn(this.types[n].type,this.types[n].stage,a,"flat"))})}return{base_penalty:t,hero_penalty:i}}},Wi=class extends we{constructor({name:t,description:i,getDescription:n,is_unlocked:s=!0,types:a=[],enemy_groups_list:o=[],enemies_list:l=[],enemy_group_size:u=[1,1],enemy_count:c=30,parent_location:_,leave_text:h,first_reward:f={},repeatable_reward:y={},otherUnlocks:b,is_finished:w,unlock_text:k}){super({name:t,description:i,getDescription:n,is_unlocked:s,types:a,enemy_groups_list:o,enemies_list:l,enemy_group_size:u,enemy_count:c,enemy_stat_variation:0,parent_location:_,leave_text:h,first_reward:f,repeatable_reward:y,is_challenge:!0,otherUnlocks:b,is_finished:w,unlock_text:k})}},oe=class{constructor({activity_name:t,starting_text:i,get_payment:n=()=>1,is_unlocked:s=!0,working_period:a=60,infinite:o=!1,availability_time:l,availability_seasons:u,skill_xp_per_tick:c=1,unlock_text:_,gained_resources:h,require_tool:f=!1,applied_effects:y=[]}){Wn(this,"getActivityEfficiency",function(){let t=1;if(this.gained_resources.scales_with_skill){let s=0;for(let a=0;a<x[this.activity_name].base_skills_names?.length;a++)s+=Math.min(this.gained_resources.skill_required[1]-this.gained_resources.skill_required[0]+1,Math.max(0,G(x[this.activity_name].base_skills_names[a])-this.gained_resources.skill_required[0]+1))/(this.gained_resources.skill_required[1]-this.gained_resources.skill_required[0]+1);t=s/(x[this.activity_name].base_skills_names?.length||1)}let i=Math.floor(this.gained_resources.time_period[0]*(this.gained_resources.time_period[1]/this.gained_resources.time_period[0])**t),n=[];for(let s=0;s<this.gained_resources.resources.length;s++){let a=this.gained_resources.resources[s].chance[0]*(this.gained_resources.resources[s].chance[1]/this.gained_resources.resources[s].chance[0])**t,o=Math.round(this.gained_resources.resources[s].ammount[0][0]*(this.gained_resources.resources[s].ammount[1][0]/this.gained_resources.resources[s].ammount[0][0])**t),l=Math.round(this.gained_resources.resources[s].ammount[0][1]*(this.gained_resources.resources[s].ammount[1][1]/this.gained_resources.resources[s].ammount[0][1])**t);n.push({name:this.gained_resources.resources[s].name,count:[o,l],chance:a})}return{gathering_time_needed:i,gained_resources:n}});if(this.activity_name=t,this.starting_text=i,this.get_payment=n,this.is_unlocked=s,this.unlock_text=_,this.working_period=a,this.infinite=o,this.infinite&&(l||u)&&console.error("Activity is set to be available all the time, so availability_time value will be ignored!"),!this.infinite&&!(l||u))throw new Error("LocationActivities that are not infinitely available, require a specified time of availability!");this.availability_time=l,this.availability_seasons=u,this.skill_xp_per_tick=c,this.require_tool=f,this.applied_effects=y,this.gained_resources=h}},wi=class{constructor({name:t,related_skill:i,scaling_lvl:n,stages:s={}}){if(this.name=t,this.scaling_lvl=n,i)if(p[i])this.related_skill=i;else throw new Error(`No such skill as "${i}"`);this.stages=s}};function Qn(e,t,i,n){let s=p[et[e].stages[t].related_skill],a=et[e].stages[t].scaling_lvl||s.max_level;if(n==="multiplier")return et[e].stages[t].effects[i].multiplier**(1-Math.min(a,G(s.skill_id))/a);if(n==="flat")return et[e].stages[t].effects[i].flat*(1-Math.min(a,G(s.skill_id))/a)**.66667;throw new Error(`Unsupported category of stat effects "${n}", should be either "flat" or "multiplier"!`)}(function(){et.bright=new wi({name:"bright",stages:{1:{description:"A place that's always lit, no matter the time of the day"},2:{description:"An extremely bright place, excessive light makes it hard to keep eyes open",related_skill:"Dazzle resistance",effects:{attack_points:{multiplier:.5},evasion_points:{multiplier:.5}}},3:{description:"A place with so much light that an average person would go blind in an instant",related_skill:"Dazzle resistance",effects:{attack_points:{multiplier:.1},evasion_points:{multiplier:.1}}}}}),et.dark=new wi({name:"dark",stages:{1:{description:"It's dark here, comparable to a bright night",related_skill:"Night vision"},2:{description:"An extremely dark place, darker than most of the nights",related_skill:"Night vision",effects:{attack_points:{multiplier:.8},evasion_points:{multiplier:.8}}},3:{description:"Pure darkness with not even a tiniest flicker of light",related_skill:"Presence sensing",effects:{attack_points:{multiplier:.15},evasion_points:{multiplier:.15}}}}}),et.narrow=new wi({name:"narrow",stages:{1:{description:"A narrow area where there's not much place for maneuvering",related_skill:"Tight maneuvers",scaling_lvl:20,effects:{evasion_points:{multiplier:.5}}},2:{description:"A very tight and narrow area where there's not much place for maneuvering",related_skill:"Tight maneuvers",effects:{evasion_points:{multiplier:.333}},scaling_lvl:40},3:{description:"An area so cramped that it's a miracle you can even move",related_skill:"Tight maneuvers",effects:{evasion_points:{multiplier:.1},dexterity:{multiplier:.5}}}}}),et.open=new wi({name:"open",stages:{1:{description:"A completely open area where attacks can come from any direction",related_skill:"Spatial awareness",scaling_lvl:30,effects:{evasion_points:{multiplier:.75}}},2:{description:"An area that's completely open and simultanously obstructs your view, making it hard to predict where an attack will come from",related_skill:"Spatial awareness",effects:{evasion_points:{multiplier:.5}}}}}),et["thin air"]=new wi({name:"thin air",stages:{1:{description:"Place with thinner air, which negatively impacts your body",related_skill:"Breathing",scaling_lvl:25,effects:{stamina_efficiency:{multiplier:.5},agility:{multiplier:.8},strength:{multiplier:.8},dexterity:{multiplier:.8},intuition:{multiplier:.8}}},2:{description:"Place with very thin air, heavily affecting your body",related_skill:"Breathing",effects:{stamina_efficiency:{multiplier:.1},agility:{multiplier:.5},strength:{multiplier:.5},dexterity:{multiplier:.5},intuition:{multiplier:.5}}}}}),et.eldritch=new wi({name:"eldritch",stages:{1:{description:"This place brings a strong sense of unease",related_skill:"Strength of mind",scaling_lvl:30,effects:{agility:{multiplier:.8},dexterity:{multiplier:.8},intuition:{multiplier:.5},stamina_efficiency:{multiplier:.75},health_loss_flat:{flat:-5}}},2:{description:"This place goes against the laws of the world",related_skill:"Strength of mind",effects:{agility:{multiplier:.3},dexterity:{multiplier:.3},intuition:{multiplier:.2},stamina_efficiency:{multiplier:.5},health_loss_flat:{flat:-50}}}}})})();(function(){m.Village=new De({getDescription:function(){return m["Infested field"].enemy_groups_killed>=5*m["Infested field"].enemy_count?"Medium-sized village, built next to a small and calm river at the foot of the mountains. It's surrounded by many fields, a few of them infested by huge rats, which, while an annoyance, don't seem possible to fully eradicate. Other than that, there's nothing interesting around":m["Infested field"].enemy_groups_killed>=2*m["Infested field"].enemy_count?"Medium-sized village, built next to a small and calm river at the foot of the mountains. It's surrounded by many fields, many of them infested by huge rats. Other than that, there's nothing interesting around":"Medium-sized village, built next to a small and calm river at the foot of the mountains. It's surrounded by many fields, most of them infested by huge rats. Other than that, there's nothing interesting around"},getBackgroundNoises:function(){let e=["*You hear some rustling*"];return M.hour>4&&M.hour<=20&&(e.push("Anyone seen my cow?","Mooooo!","Tomorrow I'm gonna fix the roof","Look, a bird!"),m["Infested field"].enemy_groups_killed<=3?(e.push("These nasty rats almost ate my cat!"),bi()&&e.push("These nasty rats almost ate my rat!","These nasty rats almost ate my rat!","These nasty rats almost ate my rat!")):bi()&&e.push("These nasty rats almost ate my rat!")),M.hour>3&&M.hour<10?e.push("\u266B\u266B Heigh ho, heigh ho, it's off to work I go~ \u266B\u266B","Cock-a-doodle-doo!"):M.hour>18&&M.hour<22&&e.push("\u266B\u266B Heigh ho, heigh ho, it's home from work I go~ \u266B\u266B"),e},dialogues:["village elder","village guard","old craftsman"],traders:["village trader"],market_region:"Village",name:"Village",crafting:{is_unlocked:!0,use_text:"Try to craft something",tiers:{crafting:1,forging:1,smelting:1,cooking:1,alchemy:1,butchering:1,woodworking:1}}}),m.Shack=new De({connected_locations:[{location:m.Village,custom_text:"Go outside to [Village]",travel_time:10}],description:"This small shack was the only spare building in the village. It's surprisingly tidy.",name:"Shack",is_unlocked:!1,housing:{is_unlocked:!0,text_to_sleep:"Take a nap",sleeping_xp_per_tick:1},temperature_range_modifier:.4,is_under_roof:!0}),m.Village.connected_locations.push({location:m.Shack,travel_time:10}),m["Eastern mill"]=new De({name:"Eastern mill",is_unlocked:!1,connected_locations:[{location:m.Village,travel_time:30,custom_text:"Go outside to [Village]"}],description:"Local mill, run by a young duo. It's somewhat tidy, with occasional flour dust in corners.",getBackgroundNoises:function(){let e=["*Creaking*","*A small cloud of flour dust rises in the air*","*Crunch*","*You hear a steady crunching sounds as stones crush grain*","Shhh, not now, we're not alone...","I have a fun idea for later~"];return bi()&&e.push("Shhh, don't move, there's a rat on your shoulder"),Se.is_mofu_mofu_enabled&&e.push("*Their tails brush against each other and the duo blushes*","*A tail brushes against your leg* oh my, sorry for that~"),M.hour>20?e.push("It's getting late","Time for a break","Can't wait to... you know~"):M.hour<4&&e.push("Why are we even working at this hour...","I wanna sleep..."),e},dialogues:["village millers"]}),m.Village.connected_locations.push({location:m["Eastern mill"],travel_time:30}),m["Eastern storehouse"]=new we({name:"Eastern storehouse",is_unlocked:!1,description:"",enemies_list:["Wolf rat"],types:[{type:"narrow",stage:1,xp_gain:3},{type:"dark",stage:1,xp_gain:2}],enemy_count:25,enemy_group_size:[3,5],enemy_stat_variation:.2,parent_location:m["Eastern mill"],first_reward:{xp:60},repeatable_reward:{textlines:[{dialogue:"village millers",lines:["cleared storage"]}],locks:{locations:["Eastern storehouse"]},move_to:{location:"Eastern mill"}},temperature_range_modifier:.8,is_under_roof:!0}),m["Eastern mill"].connected_locations.push({location:m["Eastern storehouse"],travel_time:10}),m["Infested field"]=new we({description:"Field infested with wolf rats. You can see the grain stalks move as these creatures scurry around.",enemy_count:15,enemies_list:["Starving wolf rat","Wolf rat"],types:[{type:"open",stage:1,xp_gain:1}],enemy_stat_variation:.1,is_unlocked:!1,name:"Infested field",parent_location:m.Village,first_reward:{xp:10,reputation:{village:20}},repeatable_reward:{textlines:[{dialogue:"village elder",lines:["cleared field"]}],xp:5},rewards_with_clear_requirement:[{required_clear_count:2,reputation:{village:10}},{required_clear_count:4,reputation:{village:30}},{required_clear_count:10,reputation:{village:50}}]}),m.Village.connected_locations.push({location:m["Infested field"],travel_time:15}),m["Nearby cave"]=new De({connected_locations:[{location:m.Village,custom_text:"Go outside and to the [Village]",travel_time:60}],getDescription:function(){return m["Pitch black tunnel"].enemy_groups_killed>=m["Pitch black tunnel"].enemy_count?"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the cave walls, providing a dim light. Your efforts have secured a decent space and many of the tunnels. It seems like you almost reached the deepest part.":m["Hidden tunnel"].enemy_groups_killed>=m["Hidden tunnel"].enemy_count?"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the walls, providing a dim light. Your efforts have secured a major space and some tunnels, but there are still more places left to clear out.":m["Cave depths"].enemy_groups_killed>=m["Cave depths"].enemy_count?"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the walls, providing a dim light. Your efforts have secured a decent space and even a few tunnels, yet somehow you can still hear the sounds of the wolf rats.":m["Cave room"].enemy_groups_killed>=m["Cave room"].enemy_count?"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the walls, providing a dim light. Your efforts have secured some space, but you can hear more wolf rats in some deeper tunnels.":"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the walls, providing a dim light. You can hear sounds of wolf rats from the nearby room."},getBackgroundNoises:function(){return["*You hear rocks rumbling somewhere*","Squeak!"]},temperature_range_modifier:.8,name:"Nearby cave",is_unlocked:!1,is_under_roof:!0}),m.Village.connected_locations.push({location:m["Nearby cave"],travel_time:60}),m["Cave room"]=new we({description:"It's full of rats. At least the glowing mushrooms provide some light.",enemy_count:25,types:[{type:"narrow",stage:1,xp_gain:3},{type:"bright",stage:1}],enemies_list:["Wolf rat"],enemy_group_size:[2,3],enemy_stat_variation:.2,is_unlocked:!0,name:"Cave room",leave_text:"Go back to entrance",parent_location:m["Nearby cave"],temperature_range_modifier:.7,is_under_roof:!0,first_reward:{xp:20},repeatable_reward:{locations:[{location:"Cave depths"}],xp:10,activities:[{location:"Nearby cave",activity:"weightlifting"},{location:"Nearby cave",activity:"mining"},{location:"Village",activity:"balancing"}]},rewards_with_clear_requirement:[{required_clear_count:1,reputation:{village:10}},{required_clear_count:4,reputation:{village:20}}]}),m["Nearby cave"].connected_locations.push({location:m["Cave room"],travel_time:5}),m["Cave depths"]=new we({description:"It's dark. And full of rats.",enemy_count:40,types:[{type:"narrow",stage:1,xp_gain:3},{type:"dark",stage:2,xp_gain:3}],enemies_list:["Wolf rat"],enemy_group_size:[5,8],enemy_stat_variation:.2,is_unlocked:!1,name:"Cave depths",leave_text:"Climb out",parent_location:m["Nearby cave"],first_reward:{xp:60},repeatable_reward:{textlines:[{dialogue:"village elder",lines:["cleared cave"]}],xp:30},rewards_with_clear_requirement:[{required_clear_count:4,locations:[{location:"Suspicious wall"}],reputation:{village:40}}],temperature_range_modifier:.6,is_under_roof:!0}),m["Hidden tunnel"]=new we({description:"There is, in fact, even more rats here.",enemy_count:50,types:[{type:"narrow",stage:1,xp_gain:3},{type:"dark",stage:3,xp_gain:1}],enemies_list:["Elite wolf rat"],enemy_group_size:[1,2],enemy_stat_variation:.2,is_unlocked:!1,name:"Hidden tunnel",leave_text:"Retreat for now",parent_location:m["Nearby cave"],first_reward:{xp:100},repeatable_reward:{locations:[{location:"Pitch black tunnel"}],xp:50,activities:[{location:"Nearby cave",activity:"mining2"}]},is_temperature_static:!1,temperature_range_modifier:.5,is_under_roof:!0,unlock_text:"As the wall falls apart, you find yourself in front of a new tunnel, leading even deeper. And of course, it's full of wolf rats."}),m["Pitch black tunnel"]=new we({description:"There is no light here. Only rats.",enemy_count:50,types:[{type:"narrow",stage:1,xp_gain:6},{type:"dark",stage:3,xp_gain:3}],enemies_list:["Elite wolf rat"],enemy_group_size:[6,8],enemy_stat_variation:.2,is_unlocked:!1,name:"Pitch black tunnel",leave_text:"Retreat for now",parent_location:m["Nearby cave"],first_reward:{xp:200,messages:["As you descend deeper and deeper, a sudden thought strikes you - what if you instead tried going up?"]},repeatable_reward:{xp:100,global_activities:["climbing"],actions:[{location:"Nearby cave",action:"climb the mountain"}]},rewards_with_clear_requirement:[{required_clear_count:4,locations:[{location:"Mysterious gate"}]}],is_temperature_static:!0,static_temperature:16,is_under_roof:!0,unlock_text:"As you keep going deeper, you barely notice a pitch black hole. Not even a tiniest speck of light reaches it."}),m["Mysterious gate"]=new we({description:"It's dark. And full of rats.",enemy_count:50,types:[{type:"dark",stage:3,xp_gain:5}],enemies_list:["Elite wolf rat guardian"],enemy_group_size:[6,8],enemy_stat_variation:.2,is_unlocked:!1,name:"Mysterious gate",leave_text:"Get away",parent_location:m["Nearby cave"],first_reward:{xp:500},repeatable_reward:{xp:250,activities:[{location:"Nearby cave",activity:"meditating"},{location:"Nearby cave",activity:"mining3"}],actions:[{action:"open the gate",location:"Nearby cave"}],quest_progress:[{quest_id:"The Infinite Rat Saga",task_index:0}],flags:["is_strength_proved"]},is_temperature_static:!0,static_temperature:18,is_under_roof:!0,unlock_text:"After a long and ardous fight, you reach a chamber that ends with a massive stone gate. You can feel it's guarded by some kind of wolf rats, but much bigger than the ones you fought until now."}),m["Nearby cave"].connected_locations.push({location:m["Cave depths"],travel_time:20},{location:m["Hidden tunnel"],custom_text:"Enter the [Hidden tunnel]",travel_time:40},{location:m["Pitch black tunnel"],custom_text:"Go into the [Pitch black tunnel]",travel_time:60},{location:m["Mysterious gate"],custom_text:"Go to the [Mysterious gate]",travel_time:90}),m["Writhing tunnel"]=new we({description:"The walls are moving...",enemy_count:50,types:[{type:"dark",stage:3,xp_gain:5},{type:"narrow",stage:2,xp_gain:5},{type:"eldritch",stage:1,xp_gain:1}],enemies_list:["Wall rat"],enemy_group_size:[4,4],enemy_stat_variation:.2,is_unlocked:!1,name:"Writhing tunnel",leave_text:"Run away...",parent_location:m["Nearby cave"],first_reward:{xp:2500},repeatable_reward:{xp:1250,locations:[{location:"Mysterious depths"}],quest_progress:[{quest_id:"The Infinite Rat Saga",task_index:2}]},is_temperature_static:!0,static_temperature:20,is_under_roof:!0,unlock_text:"You see something. You struggle to comprehend it. When you finally understand, you regret it instantly. It might have been better to be born blind."}),m["Nearby cave"].connected_locations.push({location:m["Writhing tunnel"],travel_time:100}),m["Mysterious depths"]=new De({connected_locations:[{location:m["Nearby cave"],custom_text:"Climb back up to the main level of [Nearby cave]",travel_time:100}],getDescription:function(){return`You find yourself in a large chamber with smooth walls and vaulted ceiling. The floor is covered in square tiles in the center, yet you cannot help but notice that all these squares make a circle, in some impossible to understand way.
There's another gate on the wall in front of you, but you have a strange feeling that you won't be able to open it with brute strength.`},getBackgroundNoises:function(){return["*You hear rocks rumbling somewhere*","Squeak!","*Air vibrates in an impossible to describe manner*","*You feel an immense sense of something being wrong*",'"All these squares make a circle... All these squares make a circle..."']},name:"Mysterious depths",is_unlocked:!1,unlock_text:"You manage to find a way to another chamber.",is_temperature_static:!0,static_temperature:20,is_under_roof:!0}),m["Nearby cave"].connected_locations.push({location:m["Mysterious depths"],custom_text:"Climb down to [Mysterious depths]",travel_time:120}),m["Forest road"]=new De({connected_locations:[{location:m.Village,travel_time:240}],description:"Old trodden road leading through a dark forest, the only path connecting the village to the town. You can hear some animals from the surrounding woods.",name:"Forest road",getBackgroundNoises:function(){return["*You hear some rustling*","Roar!","*You almost tripped on some roots*","*You hear some animal running away*"]},is_unlocked:!1}),m.Village.connected_locations.push({location:m["Forest road"],custom_text:"Leave the village towards [Forest road]",travel_time:240}),m.Forest=new we({description:"Forest surrounding the village, a dangerous place",enemies_list:["Starving wolf","Young wolf"],types:[{type:"narrow",stage:1,xp_gain:1}],enemy_count:30,enemy_stat_variation:.2,name:"Forest",parent_location:m["Forest road"],first_reward:{xp:100},repeatable_reward:{xp:50,locations:[{location:"Deep forest"}],activities:[{location:"Forest road",activity:"herbalism"}]}}),m["Forest road"].connected_locations.push({location:m.Forest,custom_text:"Leave the safe path and walk into the [Forest]",travel_time:30}),m["Deep forest"]=new we({description:"Deeper part of the forest, a dangerous place",enemies_list:["Wolf","Starving wolf","Young wolf"],types:[{type:"narrow",stage:1,xp_gain:2}],enemy_count:50,enemy_group_size:[2,3],enemy_stat_variation:.2,is_unlocked:!1,name:"Deep forest",parent_location:m["Forest road"],first_reward:{xp:70},repeatable_reward:{xp:35,flags:["is_strength_proved"],activities:[{location:"Forest road",activity:"woodcutting"}]},rewards_with_clear_requirement:[{required_clear_count:4,actions:[{action:"follow the trail",location:"Forest road"}]}]}),m["Forest road"].connected_locations.push({location:m["Deep forest"],custom_text:"Venture into the [Deep forest]",travel_time:60}),m["Forest clearing"]=new we({description:"A surprisingly big clearing hidden in the northern part of the forest, covered with very tall grass and filled with a mass of wild boars",enemies_list:["Boar"],enemy_count:50,enemy_group_size:[4,7],is_unlocked:!1,enemy_stat_variation:.2,name:"Forest clearing",types:[{type:"open",stage:2,xp_gain:3}],parent_location:m["Forest road"],first_reward:{xp:200},repeatable_reward:{xp:100,textlines:[{dialogue:"farm supervisor",lines:["defeated boars"]}],activities:[{location:"Forest road",activity:"woodcutting2"}]}}),m["Forest road"].connected_locations.push({location:m["Forest clearing"],custom_text:"Go towards the [Forest clearing] in the north",travel_time:60}),m["Forest den"]=new we({description:"A relatively large cave in the depths of the forest, filled with hordes of direwolves.",enemies_list:["Direwolf"],enemy_count:50,enemy_group_size:[2,3],enemy_groups_list:[{enemies:["Direwolf hunter"]}],predefined_lineup_on_nth_group:4,is_unlocked:!1,enemy_stat_variation:.2,name:"Forest den",types:[{type:"narrow",stage:2,xp_gain:5},{type:"dark",stage:2,xp_gain:5}],parent_location:m["Forest road"],first_reward:{xp:2e3,items:["Warrior's necklace"]},repeatable_reward:{xp:1e3},rewards_with_clear_requirement:[{required_clear_count:2,actions:[{action:"search predator",location:"Forest road"}]}],temperature_range_modifier:.8,is_under_roof:!0}),m["Forest road"].connected_locations.push({location:m["Forest den"],custom_text:"Enter the [Forest den]",travel_time:90}),m["Bears' den"]=new we({description:"A dark, smelly cave in the heart of the forest, with massive bones spread around the entrance.",enemies_list:["Forest bear"],enemy_count:20,enemy_group_size:[1,1],is_unlocked:!1,enemy_stat_variation:.2,name:"Bears' den",types:[{type:"narrow",stage:2,xp_gain:10},{type:"dark",stage:2,xp_gain:10}],parent_location:m["Forest road"],first_reward:{xp:4e3},repeatable_reward:{xp:2e3},temperature_range_modifier:.8,is_under_roof:!0}),m["Forest road"].connected_locations.push({location:m["Bears' den"],custom_text:"Enter the [Bears' den]",travel_time:180}),m["Forest ant nest"]=new we({description:"A labyrinthine nest of red ants",enemies_list:["Red ant swarm"],enemy_groups_list:[{enemies:["Red ant queen","Red ant swarm","Red ant swarm","Red ant swarm","Red ant swarm","Red ant swarm","Red ant swarm","Red ant swarm"]}],predefined_lineup_on_nth_group:99,types:[{type:"narrow",stage:3,xp_gain:10},{type:"dark",stage:2,xp_gain:7}],enemy_count:100,is_unlocked:!1,enemy_group_size:[8,8],enemy_stat_variation:.1,id:"Forest ant nest",name:"Red ant nest",parent_location:m["Forest road"],first_reward:{xp:2e3},repeatable_reward:{xp:1e3},temperature_range_modifier:.7,is_under_roof:!0}),m["Forest road"].connected_locations.push({location:m["Forest ant nest"],custom_text:"Enter the [Red ant nest]",travel_time:120}),m["Town outskirts"]=new De({connected_locations:[{location:m["Forest road"],custom_text:"Return to the [Forest road]",travel_time:240}],description:"The town is surrounded by a tall stone wall. The only gate seems to be closed, with a lone guard outside. You can see farms to the north and slums to the south.",name:"Town outskirts",is_unlocked:!0,dialogues:["gate guard"]}),m["Forest road"].connected_locations.push({location:m["Town outskirts"],custom_text:"Go towards the [Town outskirts]",travel_time:240}),m.Slums=new De({connected_locations:[{location:m["Town outskirts"],travel_time:60}],getDescription:function(){return m["Gang hideout"].is_finished?"A wild settlement next to city walls, filled with decaying buildings, poverty, and occasional thieves":"A wild settlement next to city walls, filled with decaying buildings, poverty, and violent criminals"},name:"Slums",is_unlocked:!0,dialogues:["suspicious man","old woman of the slums"],traders:["suspicious trader","suspicious trader 2"],market_region:"Slums",entrance_rewards:{quests:["Light in the darkness"]},temperature_range_modifier:.9,getBackgroundNoises:function(){let e=["Cough cough","Cough cough cough","*You hear someone sobbing*","*You see someone sleeping in an alleyway.*","I'm so hungry...","Even rotten food is better than nothing"];return M.hour>4&&M.hour<=20?e.push("Please, do you have a coin to spare?"):m["Gang hideout"].is_finished||e.push("*Sounds of someone getting repeatedly stabbed*","Scammed some fools for money today, time to get drunk!","Damn, I need a new dagger"),m["Gang hideout"].is_finished?e.push("You're the one who took out that gang, aren't you? Thank you so much.","Things got a lot better since those thugs left...","The crime isn't as bad as it used to be"):e.push("*You hear a terrified scream.*"),e}}),m["Town farms"]=new De({connected_locations:[{location:m["Town outskirts"],travel_time:60}],description:"Semi-private farms under jurisdiction of the city council. Full of life and sounds of heavy work.",name:"Town farms",is_unlocked:!0,dialogues:["farm supervisor"],getBackgroundNoises:function(){let e=[];return M.hour>4&&M.hour<=20?e.push("Mooooo!","Look, a bird!","Bark bark!","*You notice a goat staring at you menacingly*","Neigh!","Oink oink"):e.push("*You can hear some rustling*","*You can hear snoring workers*"),M.hour>3&&M.hour<10?e.push("\u266B\u266B Heigh ho, heigh ho, it's off to work I go~ \u266B\u266B","Cock-a-doodle-doo!"):M.hour>18&&M.hour<22&&e.push("\u266B\u266B Heigh ho, heigh ho, it's home from work I go~ \u266B\u266B"),e}}),m["Red ant nest 1"]=new we({description:"A labyrinthine nest of red ants",enemies_list:["Red ant swarm"],enemy_groups_list:[{enemies:["Red ant queen"]}],predefined_lineup_on_nth_group:99,types:[{type:"narrow",stage:3,xp_gain:10},{type:"dark",stage:2,xp_gain:7}],enemy_count:100,is_unlocked:!1,enemy_group_size:[5,6],enemy_stat_variation:.1,id:"Red ant nest 1",name:"Red ant nest",parent_location:m["Town farms"],first_reward:{xp:1e3},repeatable_reward:{locks:{locations:["Red ant nest 1"]},move_to:{location:"Town farms"},actions:[{location:"Town farms",action:"dig for ants 2"}]},temperature_range_modifier:.7,is_under_roof:!0}),m["Red ant nest 2"]=new we({description:"A labyrinthine nest of red ants",enemies_list:["Red ant swarm"],enemy_groups_list:[{enemies:["Red ant queen"]}],predefined_lineup_on_nth_group:99,types:[{type:"narrow",stage:3,xp_gain:10},{type:"dark",stage:2,xp_gain:7}],enemy_count:100,is_unlocked:!1,enemy_group_size:[5,6],enemy_stat_variation:.1,id:"Red ant nest 2",name:"Red ant nest",parent_location:m["Town farms"],first_reward:{xp:1e3},repeatable_reward:{locks:{locations:["Red ant nest 2"]},move_to:{location:"Town farms"},actions:[{location:"Town farms",action:"dig for ants 3"}]},temperature_range_modifier:.7,is_under_roof:!0}),m["Red ant nest 3"]=new we({description:"A labyrinthine nest of red ants",enemies_list:["Red ant swarm"],enemy_groups_list:[{enemies:["Red ant queen"]}],predefined_lineup_on_nth_group:99,types:[{type:"narrow",stage:3,xp_gain:10},{type:"dark",stage:2,xp_gain:7}],enemy_count:100,is_unlocked:!1,enemy_group_size:[5,6],enemy_stat_variation:.1,id:"Red ant nest 3",name:"Red ant nest",parent_location:m["Town farms"],first_reward:{xp:1e3},repeatable_reward:{locks:{locations:["Red ant nest 3"]},move_to:{location:"Town farms"},actions:[{location:"Town farms",action:"follow ant trail"}],textlines:[{dialogue:"farm supervisor",lines:["eliminated ants"]}]},temperature_range_modifier:.7,is_under_roof:!0}),m["Town farms"].connected_locations.push({location:m["Red ant nest 1"],custom_text:"Enter the [Red ant nest]",travel_time:10},{location:m["Red ant nest 2"],custom_text:"Enter the [Red ant nest]",travel_time:10},{location:m["Red ant nest 3"],custom_text:"Enter the [Red ant nest]",travel_time:10}),m["Gang hideout"]=new we({description:"Hideout of a local gang. Old building with a labirynth of narrow corridors.",enemies_list:["Slums thug"],types:[{type:"narrow",stage:2,xp_gain:3},{type:"dark",stage:1,xp_gain:3}],enemy_count:30,is_unlocked:!1,enemy_group_size:[4,5],enemy_stat_variation:.1,name:"Gang hideout",parent_location:m.Slums,first_reward:{xp:1e3,reputation:{slums:200,town:50},money:1840},repeatable_reward:{traders:[{trader:"suspicious trader 2",skip_message:!0}],textlines:[{dialogue:"suspicious man",lines:["defeated gang"]}],locks:{traders:["suspicious trader"],locations:["Gang hideout"],textlines:{"suspicious man":["behave 2"]}},move_to:{location:"Slums"},quest_progress:[{quest_id:"Light in the darkness",task_index:1}]},temperature_range_modifier:.6,is_under_roof:!0}),m.Slums.connected_locations.push({location:m["Gang hideout"],travel_time:10}),m["Town square"]=new De({connected_locations:[{location:m["Town outskirts"],travel_time:40}],description:"The town's center of life, connected to all the markets, guilds, and other important places",name:"Town square",is_unlocked:!1,getBackgroundNoises:function(){return[]}}),m["Town outskirts"].connected_locations.push({location:m["Town farms"],travel_time:60},{location:m.Slums,travel_time:60},{location:m["Town square"],travel_time:40}),m["Cat caf\xE9"]=new De({connected_locations:[{location:m["Town square"],travel_time:4}],description:`A cat caf\xE9 in the center of town. There are multiple kitties of all kinds, but two females especially catch your eyes
 - a chubby mackerel tabby with a white belly and neck, and a slender tortoishell that seems blind on the right eye. There's a single worker in the caf\xE9, a person of ambiguous gender with with long ponytail and glasses.`,name:"Cat caf\xE9",is_unlocked:!0,getBackgroundNoises:function(){return["Meow","Nya","Mrrr","Mrrrp meow","*A cat jumps on your lap*","*A cat brushes on your leg*"]},is_under_roof:!0,is_temperature_static:!0,static_temperature:20}),m["Town square"].connected_locations.push({location:m["Cat caf\xE9"],travel_time:4}),m["Mountain path"]=new De({connected_locations:[{location:m["Nearby cave"],custom_text:"Climb down to [Nearby Cave]",travel_time:20,travel_time_skills:["Climbing"]}],description:"A treacherous path high above the village",name:"Mountain path",is_unlocked:!1,getBackgroundNoises:function(){return["You hear a rock tumble and fall down. It takes a very long time to hit the ground...","Strong wind whooshes past you"]},temperature_modifier:-2,unlock_text:"Thanks to your hard effort, you reached a narrow safe spot where you can rest a bit."}),m["Nearby cave"].connected_locations.push({location:m["Mountain path"],custom_text:"Climb up to [Mountain path]",travel_time:60,travel_time_skills:["Climbing"]}),m["Small flat area in mountains"]=new De({connected_locations:[{location:m["Mountain path"],travel_time:120}],description:"A piece of flatland somewhere in the mountains, very high above the village. It's not that big, but more than enough for a camp.",name:"Small flat area in mountains",is_unlocked:!1,getBackgroundNoises:function(){return["You hear a rock tumble and fall down. It takes a very long time to hit the ground...","Strong wind whooshes past you","A pair of birds flies right above you"]},temperature_modifier:-2,unlock_text:"You finally got to a place where a camp can be established"}),m["Mountain path"].connected_locations.push({location:m["Small flat area in mountains"],travel_time:120}),m["Mountain camp"]=new De({connected_locations:[{location:m["Nearby cave"],custom_text:"Climb down to [Nearby cave]",travel_time:140,travel_time_skills:["Climbing","Running"]}],description:"A nice safe camp with a crackling fire, created by you to be a perfect base for further exploration.",name:"Mountain camp",housing:{is_unlocked:!0,sleeping_xp_per_tick:8,text_to_sleep:"Take a nap on the bedroll"},is_unlocked:!1,getBackgroundNoises:function(){return["You hear a rock tumble and fall down. It takes a very long time to hit the ground...","Strong wind whooshes past you","A pair of birds flies right above you"]},temperature_range_modifier:.5}),m["Nearby cave"].connected_locations.push({location:m["Mountain camp"],travel_time:140,travel_time_skills:["Climbing","Running"]}),m["Mountain path"].connected_locations.push({location:m["Mountain camp"],travel_time:120}),m["Gentle mountain slope"]=new we({description:"A surprisingly gentle clearing, with a herd of angry goats protecting it.",enemies_list:["Angry mountain goat"],enemy_count:50,enemy_group_size:[3,4],is_unlocked:!1,enemy_stat_variation:.2,name:"Gentle mountain slope",types:[{type:"open",stage:1,xp_gain:5},{type:"thin air",stage:1,xp_gain:3}],parent_location:m["Mountain camp"],first_reward:{xp:2e3,flags:["is_strength_proved"]},repeatable_reward:{xp:1e3},temperature_modifier:-2}),m["Mountain camp"].connected_locations.push({location:m["Gentle mountain slope"],travel_time:120})})();(function(){m["Sparring with the village guard (heavy)"]=new Wi({description:"She's showing you a technique that makes her attacks slow but deadly",enemy_count:1,enemies_list:["Village guard (heavy)"],enemy_group_size:[1,1],is_unlocked:!1,name:"Sparring with the village guard (heavy)",leave_text:"Give up",parent_location:m.Village,first_reward:{xp:30,reputation:{village:10}},repeatable_reward:{textlines:[{dialogue:"village guard",lines:["heavy"]}]},unlock_text:"You can now spar with the guard (heavy stance) in the Village"}),m["Sparring with the village guard (quick)"]=new Wi({description:"She's showing you a technique that makes her attacks slow but deadly",enemy_count:1,enemies_list:["Village guard (quick)"],enemy_group_size:[1,1],is_unlocked:!1,name:"Sparring with the village guard (quick)",leave_text:"Give up",parent_location:m.Village,first_reward:{xp:30,reputation:{village:10}},repeatable_reward:{textlines:[{dialogue:"village guard",lines:["quick"]}]},unlock_text:"You can now spar with the guard (quick stance) in the Village"}),m.Village.connected_locations.push({location:m["Sparring with the village guard (heavy)"],custom_text:"Spar with the guard [heavy]",travel_time:0},{location:m["Sparring with the village guard (quick)"],custom_text:"Spar with the guard [quick]",travel_time:0}),m["Suspicious wall"]=new Wi({description:"It can be broken with enough force, you can feel it",enemy_count:1,types:[],enemies_list:["Suspicious wall"],enemy_group_size:[1,1],enemy_stat_variation:0,is_unlocked:!1,name:"Suspicious wall",leave_text:"Leave it for now",parent_location:m["Nearby cave"],repeatable_reward:{locations:[{location:"Hidden tunnel"}],textlines:[{dialogue:"village elder",lines:["new tunnel"]}],xp:20,quests:["The Infinite Rat Saga"]},unlock_text:"At some point, one of wolf rats tries to escape through a previously unnoticed hole in a nearby wall. There might be another tunnel behind it!",is_under_roof:!0,temperature_range_modifier:.8}),m["Nearby cave"].connected_locations.push({location:m["Suspicious wall"],custom_text:"Try to break the suspicious wall",travel_time:0}),m["Fight off the assailant"]=new Wi({description:"He attacked you out of nowhere",enemy_count:1,types:[],enemies_list:["Suspicious man"],enemy_group_size:[1,1],enemy_stat_variation:0,is_unlocked:!1,name:"Fight off the assailant",leave_text:"Run away for now",parent_location:m.Slums,repeatable_reward:{textlines:[{dialogue:"suspicious man",lines:["defeated"]}],xp:40},unlock_text:"Defend yourself!"}),m.Slums.connected_locations.push({location:m["Fight off the assailant"],custom_text:"Fight off the suspicious man",travel_time:0}),m["Fight the angry mountain goat"]=new Wi({description:"It won't let you pass...",enemy_count:1,types:[{type:"narrow",stage:1,xp_gain:1},{type:"thin air",stage:1,xp_gain:3}],enemies_list:["Angry-looking mountain goat"],enemy_group_size:[1,1],enemy_stat_variation:0,is_unlocked:!1,name:"Fight the angry mountain goat",leave_text:"Run away and hope it won't follow",parent_location:m["Mountain path"],repeatable_reward:{locations:[{location:"Small flat area in mountains"}],xp:500},unlock_text:"A very angry goat blocks your way!",temperature_modifier:-2}),m["Mountain path"].connected_locations.push({location:m["Fight the angry mountain goat"],custom_text:"Fight the angry goat",travel_time:0})})();(function(){m.Village.activities={fieldwork:new oe({activity_name:"fieldwork",starting_text:"Work on the fields",get_payment:()=>15+Math.round(25*G("Farming")/p.Farming.max_level),is_unlocked:!1,working_period:60*2,availability_time:{start:6,end:20},availability_seasons:["Spring","Summer","Autumn"],skill_xp_per_tick:1}),running:new oe({activity_name:"running",infinite:!0,starting_text:"Go for a run around the village",skill_xp_per_tick:1,is_unlocked:!1}),weightlifting:new oe({activity_name:"weightlifting",infinite:!0,starting_text:"Try to carry some bags of grain",skill_xp_per_tick:1,is_unlocked:!1}),swimming:new oe({activity_name:"swimming",starting_text:"Swim in the river",availability_seasons:["Spring","Summer","Autumn"],skill_xp_per_tick:1,is_unlocked:!0,applied_effects:[{effect:"Wet",duration:30}]}),balancing:new oe({activity_name:"balancing",infinite:!0,starting_text:"Try to keep your balance on rocks in the river",unlock_text:"All this fighting while surrounded by stone and rocks gives you a new idea",skill_xp_per_tick:1,is_unlocked:!1}),meditating:new oe({activity_name:"meditating",infinite:!0,starting_text:"Sit down and meditate",skill_xp_per_tick:1,is_unlocked:!0}),patrolling:new oe({activity_name:"patrolling",starting_text:"Go on a patrol around the village.",get_payment:()=>50,is_unlocked:!1,infinite:!0,working_period:60*2,skill_xp_per_tick:1}),woodcutting:new oe({activity_name:"woodcutting",infinite:!0,starting_text:"Gather wood on the outskirts",skill_xp_per_tick:1,is_unlocked:!0,gained_resources:{resources:[{name:"Piece of rough wood",ammount:[[1,1],[1,3]],chance:[.5,1]}],time_period:[20,10],skill_required:[0,10],scales_with_skill:!0},require_tool:!0}),sand:new oe({activity_id:"sand",activity_name:"digging",infinite:!0,starting_text:"Dredge up some sand from the riverbed",skill_xp_per_tick:1,is_unlocked:!1,gained_resources:{resources:[{name:"Silica Sand",ammount:[[1,1],[1,3]],chance:[.4,1]}],time_period:[120,60],skill_required:[0,10],scales_with_skill:!0},require_tool:!0,unlock_text:"You realize that the river near the village might contain the type of sand you need"})},m["Nearby cave"].activities={weightlifting:new oe({activity_name:"weightlifting",infinite:!0,starting_text:"Try lifting some of the rocks",skill_xp_per_tick:4,is_unlocked:!1,unlock_text:"After the fight, you realize there's quite a lot of rocks of different sizes that could be used for exercises"}),climbing:new oe({activity_name:"climbing",infinite:!0,starting_text:"Attempt climbing the mountain walls outside",skill_xp_per_tick:1,is_unlocked:!0}),meditating:new oe({activity_name:"meditating",infinite:!0,starting_text:"Sit down and meditate in front of the gate",skill_xp_per_tick:4,is_unlocked:!1,unlock_text:"As you finish fighting your enemies and it becomes quiet, you feel a strange sense of tranquility. This spot in front of the mysterious gate, surrounded by calm and darkness, seems perfect to sit down and focus your mind."}),mining:new oe({activity_name:"mining",infinite:!0,starting_text:"Mine the strange looking iron vein",skill_xp_per_tick:1,is_unlocked:!1,gained_resources:{resources:[{name:"Low quality iron ore",ammount:[[1,1],[1,3]],chance:[.4,.8]}],time_period:[60,30],skill_required:[0,10],scales_with_skill:!0},unlock_text:"As you clear the area of wolf rats, you notice a vein of an iron ore"}),mining2:new oe({activity_name:"mining",infinite:!0,starting_text:"Mine the deeper iron vein",skill_xp_per_tick:5,is_unlocked:!1,gained_resources:{resources:[{name:"Iron ore",ammount:[[1,1],[1,3]],chance:[.3,.7]}],time_period:[90,40],skill_required:[7,17],scales_with_skill:!0},unlock_text:"Going deeper, you find a vein of an iron ore that seems to be of much higher quality"}),mining3:new oe({activity_name:"mining",infinite:!0,starting_text:"Mine the atratan vein",skill_xp_per_tick:12,is_unlocked:!1,gained_resources:{resources:[{name:"Atratan ore",ammount:[[1,1],[1,3]],chance:[.3,.7]}],time_period:[120,60],skill_required:[12,25],scales_with_skill:!0},unlock_text:"As you finish the fight and get a time to look around, you notice a metal vein of different color than iron. You recall another ore called Atratan, this must be it."})},m["Forest road"].activities={running:new oe({activity_name:"running",infinite:!0,starting_text:"Go for a run through the forest",skill_xp_per_tick:4}),woodcutting:new oe({activity_name:"woodcutting",infinite:!0,starting_text:"Gather wood from nearby trees",skill_xp_per_tick:5,is_unlocked:!1,gained_resources:{resources:[{name:"Piece of wood",ammount:[[1,1],[1,3]],chance:[.3,1]}],time_period:[90,40],skill_required:[7,17],scales_with_skill:!0}}),woodcutting2:new oe({activity_name:"woodcutting",infinite:!0,starting_text:"Gather wood from sturdy trees",skill_xp_per_tick:12,is_unlocked:!1,gained_resources:{resources:[{name:"Piece of ash wood",ammount:[[1,1],[1,3]],chance:[.3,1]}],time_period:[120,60],skill_required:[12,25],scales_with_skill:!0},unlock_text:"Finishing your fight, you notice that the trees on the side of the clearing look really healthy and sturdy, they could be a useful material."}),herbalism:new oe({activity_name:"herbalism",infinite:!0,starting_text:"Gather useful herbs throughout the forest",skill_xp_per_tick:2,is_unlocked:!1,gained_resources:{resources:[{name:"Oneberry",ammount:[[1,1],[1,1]],chance:[.1,.5]},{name:"Golmoon leaf",ammount:[[1,1],[1,1]],chance:[.1,.7]},{name:"Belmart leaf",ammount:[[1,1],[1,1]],chance:[.1,.7]}],time_period:[120,45],skill_required:[0,10],scales_with_skill:!0},require_tool:!0})},m["Town outskirts"].activities={herbalism:new oe({activity_name:"herbalism",infinite:!0,starting_text:"Search for useful herbs by the roadside",skill_xp_per_tick:4,is_unlocked:!1,gained_resources:{resources:[{name:"Cooking herbs",ammount:[[1,1],[1,3]],chance:[.1,.8]}],time_period:[120,50],skill_required:[5,15],scales_with_skill:!0},require_tool:!0,unlock_text:"You learned that some useful herbs can be found right under your nose."})},m["Town farms"].activities={fieldwork:new oe({activity_name:"fieldwork",starting_text:"Work on the fields",get_payment:()=>30+Math.round(30*G("Farming")/p.Farming.max_level),is_unlocked:!1,working_period:60*2,availability_time:{start:6,end:20},availability_seasons:["Spring","Summer","Autumn"],skill_xp_per_tick:2}),"animal care":new oe({activity_name:"animal care",infinite:!0,starting_text:"Take care of local sheep in exchange for some wool",skill_xp_per_tick:3,is_unlocked:!1,gained_resources:{resources:[{name:"Wool",ammount:[[1,1],[1,3]],chance:[.1,1]}],time_period:[120,60],skill_required:[0,10],scales_with_skill:!0}})},m["Mountain path"].activities={balancing:new oe({activity_name:"balancing",infinite:!0,starting_text:"Stupidly risk your life by trying to balance on some stones on the very edge of the cliff",skill_xp_per_tick:4,is_unlocked:!0})},m["Mountain camp"].activities={herbalism:new oe({activity_name:"herbalism",infinite:!0,starting_text:"Search for useful herbs on the mountainside",skill_xp_per_tick:6,is_unlocked:!1,gained_resources:{resources:[{name:"Silver thistle",ammount:[[1,1],[1,1]],chance:[.1,.5]}],time_period:[120,60],skill_required:[7,17],scales_with_skill:!0},require_tool:!0}),balancing:new oe({activity_name:"balancing",infinite:!0,starting_text:"Stupidly risk your life by trying to balance on some stones on the very edge of the cliff",skill_xp_per_tick:4,is_unlocked:!0}),climbing:new oe({activity_name:"climbing",infinite:!0,starting_text:"Take a lesson from the goats and try to climb a wall near the camp",skill_xp_per_tick:4,is_unlocked:!0})}})();(function(){m.Village.actions={"search for delivery":new ge({action_id:"search for delivery",starting_text:"Search the village for the missing grain delivery",description:"It might take some time, but it has to be somewhere",action_text:"Searching the village",success_text:"There it is! You see a cart loaded with grain bags, an annoyed driver, and a horse ignoring everything and calmly munching on grass",failure_texts:{random_loss:["You look around for some time, but end up with nothing. Keep searching!"]},attempt_duration:15,success_chances:[.5],rewards:{actions:[{location:"Village",action:"carry grain"},{location:"Village",action:"pull cart"},{location:"Village",action:"convince horse"}]}}),"carry grain":new ge({action_id:"carry grain",starting_text:"Try to carry the grain bags yourself",description:"It won't be quick...",action_text:"Carrying bags",success_text:"After a few hours of slow and heavy work, you place the final bag in front of the storehouse. You should let that mischievous duo know that the task is done.",failure_texts:{unable_to_begin:["You try for a bit, but you quickly realize you are not fit enough for this task."]},attempt_duration:480,success_chances:[1],conditions:[{stats:{strength:20,max_stamina:80}}],rewards:{move_to:{location:"Eastern mill"},skill_xp:{Weightlifting:300},textlines:[{dialogue:"village millers",lines:["delivered"]}],locks:{actions:[{location:"Village",action:"pull cart"},{location:"Village",action:"convince horse"}]}}}),"pull cart":new ge({action_id:"pull cart",starting_text:"Attempt to pull the cart by yourself",description:"It own't be easy, but at least will be somewhat quick",action_text:"Pulling the cart",success_text:"Lo and behold, the cart begins moving as you pull it. Slow but steady, after some time you reach the storehouse. You should let that mischievous duo know that the task is done.",failure_texts:{unable_to_begin:["You try and try, but it won't budge"]},attempt_duration:60,success_chances:[1],conditions:[{stats:{strength:45}}],rewards:{move_to:{location:"Eastern mill"},skill_xp:{Weightlifting:300},textlines:[{dialogue:"village millers",lines:["delivered"]}],locks:{actions:[{location:"Village",action:"carry grain"},{location:"Village",action:"convince horse"}]}}}),"convince horse":new ge({action_id:"convince horse",starting_text:"Try to convince the horse to go back to its work",description:"Getting that animal back to work is the fastest way to be done",action_text:"Being nice",success_text:"The horse seems to understand you, as it abandons its snack and obediently pulls the cart towards the storehouse. You should let that mischievous duo know that the task is done.",failure_texts:{conditional_loss:["No matter what you try, the horse does not care. Maybe if you had some actual experience with animals..."]},attempt_duration:10,success_chances:[1],conditions:[{skills:{"Animal handling":8}}],rewards:{move_to:{location:"Eastern mill"},skill_xp:{"Animal handling":300},textlines:[{dialogue:"village millers",lines:["delivered"]}],locks:{actions:[{location:"Village",action:"pull cart"},{location:"Village",action:"carry grain"}]}}})},m["Nearby cave"].actions={"open the gate":new ge({action_id:"open the gate",starting_text:"Try to push the mysterious gate open",description:"It's an ancient massive gate, but maybe with enough strength and training you could actually manage to push it at least a tiny bit to create enough space to walk through.",action_text:"Huffing and puffing",success_text:"When you are almost ready to give up, you hear the ancient hinges creak, as the gate slowly moves. Finally, you can continue deeper!",failure_texts:{conditional_loss:["Despite trying your best, you can feel that you are just too weak for it. You should get stronger first."]},conditions:[{stats:{strength:150}}],attempt_duration:10,success_chances:[1],rewards:{locations:[{location:"Writhing tunnel"}],quest_progress:[{quest_id:"The Infinite Rat Saga",task_index:1}]}}),"climb the mountain":new ge({action_id:"climb the mountain",starting_text:"Try to climb up the mountain",description:"It is an ardous task that will require some good long rope and actual skill in climbing, together with good physical abilities. It will take some time, so you need to make sure you won't run out of energy halfway through.",action_text:"Climbing up",success_text:"Somehow you did it, you climbed all the way up! Thanks to the rope you tied on your way, further trips up and down will be much easier.",failure_texts:{conditional_loss:["Despite trying your best, you can feel that you won't manage to do it without more training"],random_loss:["You almost had it, but at some point you grabbed a rock that turned out to be unstable. Be more careful next time!","You were really close, but a gust of wind at a bad moment knocked you off balance.","You failed to notice a falling rock and got knocked down."],unable_to_begin:["While seemingly prepared, you realize you're missing an important accessory - some nice long rope is gonna be a necessity for this, especially if you want to go back down at some point."]},required:{items_by_id:{"Coil of rope":{count:1,remove_on_success:!0}}},conditions:[{skills:{Climbing:7},stats:{strength:50,agility:50,max_stamina:50}},{skills:{Climbing:12},stats:{strength:120,agility:120,max_stamina:50}}],attempt_duration:60,success_chances:[.3,1],rewards:{locations:[{location:"Mountain path"}],move_to:{location:"Mountain path"},skill_xp:{Climbing:1e3}}})},m["Mountain path"].actions={explore:new ge({action_id:"explore",starting_text:"Explore the area",description:"Now that you are here, it's time to find if there's anything worthy of your time. Too bad you couldn't do it beforehand.",action_text:"Looking around",success_text:"The good news: you noticed a nice little piece of flat land that would be perfect for a camp. The bad news: there's a very angry-looking mountain goat blocking your way.",failure_texts:{random_loss:["You looked under rocks and between the bushes, but you found nothing. Keep looking!","You looked and looked, but you couldn't find anything. Rest a bit and go back to it!"]},conditions:[],is_unlocked:!0,attempt_duration:60,success_chances:[.6],rewards:{locations:[{location:"Fight the angry mountain goat"}]}})},m["Small flat area in mountains"].actions={"create camp":new ge({action_id:"create camp",starting_text:"Establish a camp here",description:"Prepare a tent, a fireplace, and a storage here to create a new base. It will be necessary before exploring further up the mountains.",action_text:"Working",success_text:"After a few hours of hard work, your camp is ready. You can rest here before venturing further in the mountains",conditions:[{items_by_id:{"Camping supplies":{count:1,remove:!0}}}],is_unlocked:!0,check_conditions_on_finish:!1,failure_texts:{conditional_loss:["You lack camping supplies!"]},attempt_duration:180,success_chances:[1],rewards:{locations:[{location:"Mountain camp"}],move_to:{location:"Mountain camp"},locks:{locations:["Mountain path","Small flat area in mountains"]}}})},m["Mountain camp"].actions={explore1:new ge({action_id:"explore1",starting_text:"Explore the area further",description:"With the camp created, it's time to keep exploring",action_text:"Looking around",success_text:"You find a reasonably gentle mountain slope with green grass and... more angry goats. At least they seem slightly smaller.",failure_texts:{random_loss:["You looked under rocks and between the bushes, but you found nothing. Keep looking!","You looked and looked, but you couldn't find anything. Rest a bit and go back to it!"]},conditions:[],is_unlocked:!0,attempt_duration:60,success_chances:[.6],rewards:{locations:[{location:"Gentle mountain slope"}],actions:[{location:"Mountain camp",action:"explore2"}]}}),explore2:new ge({action_id:"explore2",starting_text:"Keep exploring",description:"You have a feeling that there must be something more of value than just goats.",action_text:"Looking around",success_text:"You notice some plants, that you soon recognize as a potent healing ingredient that was mentioned to you by that old craftsman. It's gonna be useful if you know proper recipes.",failure_texts:{random_loss:["You looked under rocks and between the bushes, but you found nothing. Keep looking!","You looked and looked, but you couldn't find anything. Rest a bit and go back to it!"],conditional_loss:["You spot a lot of curious plants. You have a hunch that at least some of them must be useful for something, but you fail to recognize any of them. If only you knew more about herbs..."]},conditions:[{skills:{Herbalism:6}},{skills:{Herbalism:10}}],is_unlocked:!1,attempt_duration:60,success_chances:[.5],rewards:{activities:[{location:"Mountain camp",activity:"herbalism"}]}})},m["Forest road"].actions={"search for boars":new ge({action_id:"search for boars",starting_text:"Search forest for the clearing with boars",description:"It might take some time and a few attempts, but you are sure you can manage",action_text:"Searching the forest",success_text:"There they are! You see a clearing with tall grass and hear unmistakeable grunts and squeals",failure_texts:{random_loss:["You search for some time, but end up with nothing. Next time you will try a slightly different direction"]},attempt_duration:90,success_chances:[.5],rewards:{locations:[{location:"Forest clearing"}]}}),"follow the trail":new ge({action_id:"follow the trail",starting_text:"Follow the mysterious trail deeper into the forest...",description:"It doesn't seem to be a smart thing to do",action_text:"Following the trail",success_text:"The trail leads you to a large cave. There are some broken bones lying around the entrance",failure_texts:{random_loss:["At some point you got distracted and lost your way"]},attempt_duration:180,success_chances:[.7],rewards:{locations:[{location:"Forest den"}]},unlock_text:"At some point during your fights, you notice a path trodden by animals. There's a lot of footprints that look like wolf's, except much larger..."}),"search predator":new ge({action_id:"search predator",starting_text:"Search for the predator that hunts direwolves",description:"It's a terrible idea",action_text:"Searching for the predator",success_text:"You end up finding another large cave. There's a lot of bones around the entrance, some belonging to direwolves and boars",failure_texts:{random_loss:["At some point you got distracted and lost your way"]},attempt_duration:180,success_chances:[.4],rewards:{locations:[{location:"Bears' den"}]},unlock_text:"At some point during your fights you notice a direwolf with terrible scars, clearly inflicted by an even larger predator. What could have it been?"})},m["Town farms"].actions={"dig for ants 1":new ge({action_id:"dig for ants 1",action_name:"Search for ant nests",starting_text:"Dig in search of red ant nests",description:"They live somewhere down there",action_text:"Digging",success_text:"You find an ant tunnel, just barely wide enough for you to enter",attempt_duration:180,success_chances:[1],rewards:{locations:[{location:"Red ant nest 1"}],skill_xp:{Digging:20}}}),"dig for ants 2":new ge({action_id:"dig for ants 2",action_name:"Search for ant nests",starting_text:"Dig in search of red ant nests",description:"They live somewhere down there",action_text:"Digging",success_text:"You find an ant tunnel, just barely wide enough for you to enter",attempt_duration:240,success_chances:[1],rewards:{locations:[{location:"Red ant nest 2"}],skill_xp:{Digging:30}}}),"dig for ants 3":new ge({action_id:"dig for ants 3",action_name:"Search for ant nests",starting_text:"Dig in search of red ant nests",description:"They live somewhere down there",action_text:"Digging",success_text:"You find an ant tunnel, just barely wide enough for you to enter",attempt_duration:300,success_chances:[1],rewards:{locations:[{location:"Red ant nest 3"}],skill_xp:{Digging:40}}}),"follow ant trail":new ge({action_id:"follow ant trail",action_name:"Follow ant trail towards the forest",starting_text:"Follow ant trail towards the forest",description:"There must be other nests out there",action_text:"Searching",success_text:"You find a massive complex of ant tunnels, just barely wide enough for you to enter",attempt_duration:600,success_chances:[1],failure_texts:{unable_to_begin:["You can't do that without a shovel!"]},conditions:[{tools_by_slot:["shovel"]}],rewards:{locations:[{location:"Forest ant nest"}],move_to:{location:"Forest road"},skill_xp:{Digging:50}},unlock_text:"While your task is finished, it seems that you might be able to find more ants away from the farms"})}})();(function(){Object.keys(m).forEach(e=>{Object.keys(m[e].activities||{}).forEach(t=>{m[e].activities[t].activity_id=t})})})();Xo();var Z={},me=class{constructor({name:t,id:i,duration:n,effects:s,tags:a,potency:o,group_tags:l,affected_by_travel:u=!0}){this.name=t,this.id=i||t,this.duration=n??0,this.effects=s,this.effects.bonus_skill_levels||(this.effects.bonus_skill_levels={}),this.effects.stats||(this.effects.stats={}),this.affected_by_travel=u,this.tags=a||{},this.group_tags=l||{},this.tags.effect=!0,this.potency=o||0}};Z.Wet=new me({name:"Wet",effects:{stats:{cold_tolerance:{flat:-5}}}}),Z.Cold=new me({name:"Cold",effects:{stats:{stamina_efficiency:{multiplier:.8},strength:{multiplier:.9}}},group_tags:{cold:1}}),Z["Very cold"]=new me({name:"Very cold",effects:{stats:{stamina_efficiency:{multiplier:.6},dexterity:{multiplier:.8},agility:{multiplier:.8},strength:{multiplier:.8}}},group_tags:{cold:2}}),Z.Freezing=new me({name:"Freezing",effects:{stats:{stamina_efficiency:{multiplier:.3},dexterity:{multiplier:.6},agility:{multiplier:.6},strength:{multiplier:.6},health_regeneration_flat:{multiplier:.6},health_regeneration_percent:{multiplier:.6}},xp_multipliers:{all:.6}},group_tags:{cold:3}}),Z.Hypothermia=new me({name:"Hypothermia",effects:{stats:{stamina_efficiency:{multiplier:.1},dexterity:{multiplier:.3},agility:{multiplier:.3},strength:{multiplier:.4},health_regeneration_flat:{multiplier:.2},health_regeneration_percent:{multiplier:.2}},xp_multipliers:{all:.3}},group_tags:{cold:4}});Z["Basic meal"]=new me({name:"Basic meal",effects:{stats:{stamina_regeneration_flat:{flat:.5}}},tags:{buff:!0,food:!0}}),Z["Well hydrated"]=new me({name:"Well hydrated",effects:{stats:{stamina_regeneration_flat:{flat:1}}},tags:{buff:!0,food:!0}}),Z["Weak healing powder"]=new me({name:"Weak healing powder",effects:{stats:{health_regeneration_flat:{flat:2}}},tags:{buff:!0,medicine:!0}}),Z["Healing powder"]=new me({name:"Healing powder",effects:{stats:{health_regeneration_flat:{flat:5}}},tags:{buff:!0,medicine:!0}}),Z["Weak healing potion"]=new me({name:"Weak healing potion",effects:{stats:{health_regeneration_flat:{flat:8},health_regeneration_percent:{flat:1}}},tags:{buff:!0,medicine:!0}}),Z["Healing potion"]=new me({name:"Healing potion",effects:{stats:{health_regeneration_flat:{flat:20},health_regeneration_percent:{flat:2}}},tags:{buff:!0,medicine:!0}}),Z["Weak healing balm"]=new me({name:"Weak healing balm",effects:{stats:{health_regeneration_flat:{flat:5},health_regeneration_percent:{flat:.5}}},tags:{buff:!0,medicine:!0}}),Z["Cheap meat meal"]=new me({name:"Cheap meat meal",effects:{stats:{stamina_regeneration_flat:{flat:1}}},tags:{buff:!0,food:!0}}),Z["Simple meat meal"]=new me({name:"Simple meat meal",effects:{stats:{stamina_regeneration_flat:{flat:1},health_regeneration_flat:{flat:1}}},tags:{buff:!0,food:!0}}),Z["Decent meat meal"]=new me({name:"Decent meat meal",effects:{stats:{stamina_regeneration_flat:{flat:2},health_regeneration_flat:{flat:2}}},tags:{buff:!0,food:!0}}),Z["Hot meal"]=new me({name:"Hot meal",effects:{stats:{cold_tolerance:{flat:3}}},tags:{buff:!0,food:!0}}),Z["Slight food poisoning"]=new me({name:"Slight food poisoning",effects:{stats:{health_loss_flat:{flat:-.5}}},tags:{debuff:!0,poison:!0}});Z.Recovering=new me({name:"Recovering",effects:{xp_multipliers:{all:.2}},tags:{debuff:!0},affected_by_travel:!1});Z["Spark of Inspiration"]=new me({name:"Spark of Inspiration",effects:{xp_multipliers:{all:1.5}},tags:{buff:!0},affected_by_travel:!1});var st=new fi,Ts=!1;function Cc(e){st.add_to_inventory(e),Ta()}function Ac(e){st.remove_from_inventory(e),Ta()}function yl(e){Ta(e),Ts=!0}function wl(e){xl(e),Ts=!1}function bl(e){let t=Math.min(e.count,r.inventory[e.item_key].count);dt([{...e,item_count:t}]),Cc([{...e,count:t}])}function vl(e){let t=Math.min(e.count,st.inventory[e.item_key].count);ze([{...e,count:t}]),Ac([{...e,item_count:t}])}function kl(){return Ts}var O={},tt={},he=class{constructor({task_description:t="",task_condition:i={},task_rewards:n={},is_hidden:s=!1,is_finished:a=!1}){this.task_description=t,this.task_condition=i,this.task_rewards=n,this.is_hidden=s,this.is_finished=a,Object.keys(this.task_condition).forEach(o=>{Object.keys(this.task_condition[o]).forEach(l=>{Object.keys(this.task_condition[o][l]).forEach(u=>{this.task_condition[o][l][u].current=0})})})}},It=class{constructor({quest_name:t,quest_id:i,quest_description:n,questline:s,quest_tasks:a=[],quest_condition:o,quest_rewards:l,display_priority:u=1/0,is_hidden:c=!1,is_finished:_=!1,is_repeatable:h=!1,getQuestName:f=()=>this.quest_name,getQuestDescription:y=()=>this.quest_description}){this.quest_name=t,this.quest_id=i,this.questline=s,this.quest_tasks=a,this.quest_description=n,this.quest_rewards=l||{},this.display_priority=u,this.is_hidden=c,this.is_finished=_,this.is_repeatable=h,this.quest_condition=o,this.getQuestName=f,this.getQuestDescription=y}getCompletedTaskCount(){return this.quest_tasks.length==0?0:this.quest_tasks.filter(t=>t.is_finished).length}},le={startQuest({quest_id:e,should_inform:t=!0}){let i=O[e];(!i.is_finished||i.is_repeatable)&&!this.isQuestActive(e)&&(tt[e]=new It(O[e])),i.is_hidden||(ql(e),t&&S(`Started a new quest: ${O[e].getQuestName()}`))},isQuestActive(e){return e in tt},finishQuest({quest_id:e,only_unlocks:t,is_from_loading:i,skip_rewards:n}){if(this.isQuestActive(e)){let s=O[e];s.is_repeatable||(s.is_finished=!0),delete tt[e],O[e].is_hidden||Un(e),n||Ye({rewards:O[e].quest_rewards,source_type:"Quest",source_name:O[e].getQuestName(),only_unlocks:t,is_from_loading:i})}},finishQuestTask({quest_id:e,task_index:t,only_unlocks:i,skip_warning:n=!1,allowed_to_finish_quest:s=!0,skip_message:a=!1}){if(this.isQuestActive(e)){let o=O[e];o.quest_tasks[t].is_finished=!0,O[e].is_hidden||(Un(e),a||(O[e].quest_tasks[t].is_hidden?S(`Made some progress in quest: "${O[e].getQuestName()}"`):S(`Finished a task for a quest: "${O[e].getQuestName()}"`))),Ye({rewards:o.quest_tasks[t].task_rewards,source_type:"Quest",source_name:O[e].getQuestName(),only_unlocks:i});let l=tt[e].quest_tasks.filter(u=>!u.is_finished);s&&l.length==0&&this.finishQuest({quest_id:e})}else n||console.warn(`Cannot finish task at index ${t} for quest "${e}", as it's not a currently active quest!`)},catchQuestEvent({quest_event_type:e,quest_event_target:t,quest_event_count:i,additional_quest_tags:n={}}){Object.keys(tt).forEach(s=>{if(!(s in tt))return;let a=tt[s].quest_tasks.findIndex(_=>!_.is_finished),o=tt[s].quest_tasks[a];if(!("any"in o.task_condition)&&!("all"in o.task_condition))return;let l=!1,u=!0;Object.keys(o.task_condition).forEach(_=>{Object.keys(o.task_condition[_]).forEach(h=>{Object.keys(o.task_condition[_][h]).forEach(f=>{if(o.task_condition[_][h][f].current||(o.task_condition[_][h][f].current=0),e===h&&t===f){let y=!0,b=o.task_condition[_][h][f].requirements;if(Object.keys(b||{}).forEach(w=>{(!n[w]||n[w]!=b[w])&&(y=!1)}),y){let w=o.task_condition[_][h][f].restrictions;Object.keys(w||{}).forEach(k=>{n[k]&&n[k]===w[k]&&(y=!1)})}if(!y){u=!1;return}h==="reach_skill"?o.task_condition[_][h][f].current=i:o.task_condition[_][h][f].current+=i}_==="any"&&o.task_condition[_][h][f].current>=o.task_condition[_][h][f].target?l=!0:_==="all"&&o.task_condition[_][h][f].current<o.task_condition[_][h][f].target&&(u=!1)})})}),(l||!("any"in o.task_condition))&&(u||!("all"in o.task_condition))?this.finishQuestTask({quest_id:s,task_index:a,allowed_to_finish_quest:!1}):!tt[s].is_hidden&&!tt[s].quest_tasks[a.is_hidden]&&Ml(s,a),tt[s].quest_tasks.filter(_=>!_.is_finished).length==0&&this.finishQuest({quest_id:s})})}};O["Lost memory"]=new It({quest_name:"Lost memory",display_priority:0,getQuestDescription:()=>{let e=O["Lost memory"].getCompletedTaskCount();if(e==0)return"You woke up in some village and you have no idea how you got here or who you are. Just what could have happened?";if(e==1)return"You lost your memories after being attacked by unknown assailants and were rescued by local villagers. You need to find out who, why, and if possible, how to recover them."},questline:"Lost memory",quest_tasks:[new he({task_description:"Find out what happened"}),new he({is_hidden:!0}),new he({task_description:"Help with the wolf rat infestation"}),new he({task_description:"Continue your search"}),new he({task_description:"Get into the town (tbc)"})]}),O["The Infinite Rat Saga"]=new It({quest_name:"The Infinite Rat Saga",display_priority:0,getQuestDescription:()=>"You found more rats in the caves. You might as well try getting to the bottom of that issue.",questline:"The Infinite Rat Saga",quest_tasks:[new he({task_description:"Go deeper"}),new he({task_description:"Open the mysterious gate"}),new he({task_description:"Get through the corrupted tunnel"}),new he({task_description:"Go even deeper (tbc)"})]});O["It won't mill itself"]=new It({quest_name:"It won't mill itself",display_priority:1,getQuestDescription:()=>O["It won't mill itself"].quest_tasks[0].is_finished?"Boys running the eastern mill could use your help":'Village elder asked you to check how the "kids" running the eastern mill are doing',quest_tasks:[new he({task_description:"Check on the eastern mill"}),new he({task_description:"Clear the infested storehouse"}),new he({task_description:"Find the missing grain delivery and bring it to the mill"})],quest_rewards:{money:500,xp:250,reputation:{village:100}}}),O["Bonemeal delivery"]=new It({quest_name:"Bonemeal delivery",quest_description:"The farm supervisor is in a dire need of 50 packs of bonemeal, and he needs the entire order delivered in one go.",quest_tasks:[new he({task_description:"Bring 50 packs of bonemeal"})],quest_rewards:{money:6e3,xp:5e3,reputation:{town:40}}}),O["Light in the darkness"]=new It({quest_name:"Light in the darkness",display_priority:1,getQuestDescription:()=>"People of the slums live in suffering and fear. Maybe you could improve their situation at least a bit?",quest_tasks:[new he({is_hidden:!0}),new he({task_description:"Deal with the gang"}),new he({task_description:"[To be continued]"})]}),O["Ploughs to swords"]=new It({quest_name:"Ploughs to swords",display_priority:1,getQuestDescription:()=>O["Ploughs to swords"].quest_tasks[1].is_finished?"Supervisor of the town's farms has a need for a capable fighter":"Supervisor of the town's farms seems to have some interesting tasks, but first requires you to be strong enough for it.",quest_tasks:[new he({task_description:"Prove your strength"}),new he({task_description:"Deal with the boars and then report back"}),new he({is_hidden:!0}),new he({task_description:"Exterminate the red ants under the farm and then report back"})],quest_rewards:{money:5e3,xp:5e4,reputation:{town:60}}});O["Swimming/climbing unlock"]=new It({is_hidden:!0,quest_tasks:[new he({task_condition:{all:{reach_skill:{Running:{target:12},Weightlifting:{target:12}}}}})],quest_rewards:{textlines:[{dialogue:"village elder",lines:["more training"],skip_message:!0}]}}),O["Swimming alternative unlock"]=new It({is_hidden:!0,quest_rewards:{global_activities:["swimming"],messages:["With all the training you have done so far, the idea of submerging yourself in the river passing by the village is really tempting"]},quest_tasks:[new he({task_condition:{all:{reach_skill:{Running:{target:15},Weightlifting:{target:15}}}}}),new he({task_condition:{all:{enter_location:{Village:{target:1,restrictions:{season:"Winter"}}}}}})]});Object.keys(O).forEach(e=>{O[e].quest_id=e});var Hc=20,gn,Bc={Winter:-20,Spring:-5,Summer:0,Autumn:-8},Oc={Plus:3,Minus:-8},Nc={0:0,1:-1,2:0,3:-2,4:3,5:6,6:1,7:-2,8:0,9:-5,10:-1},$l={0:0,1:0,2:0,3:0,4:-1,5:-2,6:-2,7:-2,8:0,9:0,10:0,11:-1,12:0};function jc(e){return e.hour>=14||e.hour<5?"Plus":"Minus"}function Ca(e){return Bc[e.getSeason()]+Oc[jc(e)]+Nc[e.day_count%11]+$l[e.day_count%13]}function Aa(){if(!v)return 0;gn||(gn=Ca(M));let e,t,i;if(M.hour>=14?(t={hours:5,days:1},e={hour:14},i=900,gn=Ca(M)):M.hour<5?(t={hours:5,days:0},e={hour:14},i=900):M.hour>=5&&(t={hours:14,days:0},e={hour:5},i=540,gn=Ca(M)),v.is_temperature_static)return v.static_temperature;let n;M.hour<e.hour?n=60*(24-e.hour+M.hour)+M.minute:n=60*(M.hour-e.hour)+M.minute;let s=n/i,a=Ca(new ka({year:M.year,month:M.month,day:M.day+t.days,hour:t.hours,minute:0,day_count:M.day_count+t.days})),o=v.temperature_range_modifier;if(isNaN(o))throw new Error(`Temperature modifier for "${v.name}" is not a number!`);return Math.round(10*(Hc+(v.temperature_modifier||0)+o*(gn+s*(a-gn))))/10}function Ha(){return $l[M.day_count%13]<0}var Kn=class{constructor({canvas:t,size:i}){this.x=Math.random()*(t.width-i-1)+i+1,this.starting_x=this.x,this.distance=Math.random()*50+1,this.opacity=Math.random()*.5+.5,this.radians=Math.random()*Math.PI*2,this.y=Math.random()*(t.height-i-1)+i+1}},Ba=class extends Kn{constructor({canvas:t}){let i=Math.random()*2+2;super({canvas:t,size:i}),this.size=i,this.fall_speed=10,this.context=t.getContext("2d"),this.draw=()=>{this.y>t.height+this.size?this.y=-this.size:this.y+=this.fall_speed,this.x=this.starting_x+this.distance,this.context.fillStyle=`rgba(128,128,255, ${this.opacity})`,this.context.fillRect(this.x,this.y,this.size,this.size)}}},Oa=class extends Kn{constructor({canvas:t}){let i=Math.random()*2+2;super({canvas:t,size:i}),this.size=i,this.fall_speed=Math.random()*1.5+.5,this.context=t.getContext("2d"),this.draw=()=>{this.y>t.height+this.size?this.y=-this.size:this.y+=this.fall_speed,this.radians+=.02,this.x=this.starting_x+this.distance*Math.sin(this.radians),this.context.fillStyle=`rgba(255,255,255,${this.opacity})`,this.context.fillRect(this.x,this.y,this.size,this.size)}}};var Na=class extends Kn{constructor({canvas:t}){let i=Math.random()*6+6;super({canvas:t,size:i}),this.size=i,this.context=t.getContext("2d");let n=45;this.draw=()=>{this.radians+=.01,this.tempSize=Math.max(4,this.size*Math.abs(Math.sin(this.radians))),this.tempX=this.x-this.tempSize/2,this.tempY=this.y-this.tempSize/2,this.context.save(),this.context.fillStyle=`rgba(255,255,100,${this.opacity})`,this.context.fillRect(this.tempX,this.tempY,this.tempSize,this.tempSize),this.context.translate(this.tempX+this.tempSize/2,this.tempY+this.tempSize/2),this.context.rotate(n*Math.PI/180),this.context.fillStyle=`rgba(255,255,100,${this.opacity})`,this.context.fillRect(-this.tempSize/2,-this.tempSize/2,this.tempSize,this.tempSize),this.context.restore()}}};var Cs="v0.5.0.28";function ja(){return Cs}var Jn={getText:(e,t)=>(ii[e]?.[t]||(e.startsWith("mofu")&&ii[e.replace("mofu_","")]?.[t]?e=e.replace("mofu_",""):e="english"),ii[e][t]?ii[e][t]:"text not found, id: "+t)},ii={english:{"elder description":"You see an older man with white hair, but with a still strong posture as if still ready to fight if need be. He eyes you with curiosity.","elder hello":"Hello?","elder hello answ":"Hello. Glad to see you got better","elder head hurts":"My head hurts.. What happened?","elder head hurts answ":"Some of our people found you unconscious in the forest, wounded and with nothing but pants and an old sword, so they brought you to our village. It would seem you were on your way to a nearby town when someone attacked you and hit you really hard in the head.","elder where":"Where am I?","elder where answ":"Some of our people found you unconscious in the forest, wounded and with nothing but pants and an old sword, so they brought you to our village. It would seem you were on your way to a nearby town when someone attacked you and hit you really hard in the head.","elder remember":"I don't remember how I got here, what happened?","elder remember answ":"Some of our people found you unconscious in the forest, wounded and with nothing but pants and an old sword, so they brought you to our village. It would seem you were on your way to a nearby town when someone attacked you and hit you really hard in the head.","elder who":"Who are you?","elder who answ":"I'm the unofficial leader of this village. If you have any questions, come to me","elder leave 1":"Great... Thank you for help, but I think I should go there then. Maybe it will help me remember more.","elder leave 1 answ":"Nearby lands are dangerous and you are still too weak to leave. Do you plan on getting ambushed again?","elder need to":"But I want to leave","elder need to answ":"You first need to recover, to get some rest and maybe also training, as you seem rather frail... Well, you know what? Killing a few wolf rats could be a good exercise. You could help us clear some field of them, how about that?","elder eq":"Is there any way I could get a weapon and proper clothes?","elder eq answ":"We don't have anything to spare, but you can check out our market. Just go over there *[points a direction]*, then turn right. It's nowhere near what you can find in a town, but people always have some gear, food, and other useful stuff to sell. If you need money, try selling some rat remains there. Fangs, tails or pelts, people will buy them all. I have no idea what they do with this stuff...","elder leave 2":"Can I leave the village?","elder leave 2 answ":"We talked about this, you are still too weak","elder money":"Are there other ways to make money?","elder money answ":"You could help us with some fieldwork. I'm afraid it won't pay too well.","elder rats":"Are wolf rats a big issue?","elder rats answ":"Oh yes, quite a big one. Not literally, no, though they are much larger than normal rats... They are a nasty vermin that's really hard to get rid of. And with their numbers they can be seriously life-threatening. Only in a group though, single wolf rat is not much of a threat","elder cleared 1":"I cleared the field, just as you asked me to","elder cleared 1 answ":"You did? That's good. How about a stronger target? Nearby cave is just full of this vermin. Try yourself against whatever occupies the frontal room, and then also the deeper parts. Before that, maybe get some sleep? Some folks prepared that shack over there for you. It's clean, it's dry, and it will give you some privacy. Oh, and before I forget, our old craftsman wanted to talk to you.","elder leave 3":"Can I leave the village?","elder leave 3 answ":"You still need to get stronger.","elder room clear":"I dealt with some rats in the cave, but is there anything else to help with?","elder room clear answ":"Ahh, good to hear you are making progress. Let me think... Could you check on the eastern mill? I'm a bit worried if the two kids running it can manage everything by themselves.","elder cave clear":"I cleared the cave. Most of it, at least","elder cave clear answ":`Then I can't call you "too weak" anymore, can I? You are free to leave whenever you want, but still, be careful. You might also want to ask the guard for some tips about the outside. She used to be an adventurer.`,"elder leave 4":"Can I leave the village?","elder leave 4 answ":"You are strong enough, you can leave and come whenever you want.","elder tunnel":"I found an even deeper tunnel in the cave","elder tunnel answ":"The what? I have a very bad feeling about this... You better avoid it until you get better equipment and some solid shield, I can bet it's gonna be a lot more dangerous.","elder training":"I think I went far enough with basic training, do you have any other suggestions?","elder training answ 1":"You did? Well, let me think... You could try swimming in the river nearby if you haven't done that yet, just remember not to do it in cold weather. Or you could try some wall climbing, but be sure to start with low heights to be safe.","elder training answ 2":"You did? Well, let me think... Swimming in the river nearby would be a good exercise, but it's mostly frozen now in winter. You could try some wall climbing though, but be sure to start with low heights to be safe.","craftsman description":"You see an old man who clearly experienced a lot in life. He's wearing some handmade accessories. Despite his age, his fingers seem exceptionally nimble.","craftsman hello":"Hello, I heard you wanted to talk to me?","craftsman hello answ":"Ahh, good to see you traveler. I just thought of a little something that could be of help for someone like you. See, young people this days don't care about the good old art of crafting and prefer to buy everything from the store, but I have a feeling that you just might be different. Would you like a quick lesson?","craftsman learn":"Sure, I'm in no hurry.","craftsman learn answ":`Ahh, that's great. Well then... 
*[Old man spends some time explaining all the important basics of crafting and providing you with tips]*
Ahh, and before I forget, here, take these. They will be helpful for gathering necessary materials.`,"craftsman leave":"I'm not interested.","craftsman leave answ":"Ahh, I see. Maybe some other time then, when you change your mind, hmm?","craftsman remind 1":"Could you remind me how to create equipment for myself?","craftsman remind 1 answ":"Ahh, of course. Unless you are talking about something simple like basic clothing, then you will first need to create components that can then be assembled together. For weapons, you generally need a part that you use to hit an enemy and a part that you hold in your hand. For armor, you will need some actual armor and then something softer to wear underneath, which would mostly mean some clothes.","craftsman remind 2":"Could you remind me how to improve my creations?","craftsman remind 2 answ":"Ahh, that's simple, you just need more experience. This alone will be a great boon to your efforts. For equipment, you might also want to start with better components. After all, even with the most perfect assembling you can't turn a bent blade into a legendary sword.","craftsman remind 3":"Could you remind me how to get crafting materials?","craftsman remind 3 answ":"Ahh, there's multiple ways of that. You can gain them from fallen foes, you can gather them around, or you can even buy them if you have some spare coin.","craftsman remind 4":"How do I get better at crafting?","craftsman remind 4 answ":"Ahh, there aren't any secrets, you just need to keep practicing it. Just don't spend your entire life working on same louse materials, try to work on stronger stuff when you feel confident. There's a limit to how much you can learn by working with rat leather, isn't there?","guard description":"You see a woman in light armor, with a spear in her hand and two daggers on her belt. There's a scar across her face.","guard hello":"Hello?","guard hello answ":"Hello. I see you are finally leaving, huh?","guard job":"Do you maybe have any jobs for me?","guard job answ":"You are somewhat combat capable now, so how about you help me and the boys on patrolling? Not much happens, but it pays better than working on fields","guard tips":"Can you give me any tips for the journey?","guard tips answ":"First and foremost, don't rush. It's fine to spend some more time here, to better prepare yourself. There's a lot of dangerous animals out there, much stronger than those damn rats, and in worst case you might even run into some bandits. If you see something that is too dangerous to fight, try to run away. There's no shame in staying alive to fight on another day, when chances of survival become better, and it would be a pity if someone with your looks were to die~","guard teach":"Could you maybe teach me something that would be of use?","guard teach answ":`Lemme take a look... Yes, it looks like you know some basics. Do you know any proper techniques? No? I thought so. I could teach you the most standard three. They might be more tiring than fighting the "normal" way, but if used in a proper situation, they will be a lot more effective. Two can be easily presented through some sparring, so let's start with it. The third I'll just have to explain. How about that?`,"guard quick":"So about the quick stance...","guard quick answ":`It's usually called "quick steps". As you have seen, it's about being quick on your feet. While power of your attacks will suffer, it's very fast, making it perfect against more fragile enemies`,"guard heavy":"So about the heavy stance...","guard heavy answ":`It's usually called "crushing force". As you have seen, it's about putting all your strength in attacks. It will make your attacks noticeably slower, but it's a perfect solution if you face an enemy that's too tough for normal attacks`,"guard wide":"What's the third technique?","guard wide answ":`It's usually called "broad arc". Instead of focusing on a single target, you make a wide swing to hit as many as possible. It might work great against groups of weaker enemies, but it will also significantly reduce the power of your attacks and will be even more tiring than the other two stances.`,"guard hi":"Hi again, how's it going?","guard hi answ":`Hey there. I heard you've been helping around a lot, good job cutie~
 *[As she says that, she bends forward and pats your head a few times with a surprisingly gentle touch]*`,"guard serious":"Can we try a more serious fight?","guard serious answ":"Ohhh, someone wants to impress the cute guard lady? Sorry, but I'm way too strong for you~","millers description":"You see two teenagers with mischievous looks on their faces. It's only with great deal of effort that you manage to recognize them both as males. One of them has red hair, the other gray.","millers hello":"Hello there","millers hello answ":"[Red] Hi~! <br> [Gray]: Hello","millers how":"Are you doing alright? Elder asked me to check on you.","millers how answ":"[Gray] We are fine, mostly. <br> [Red] Except for rats in the storehouse, especially since we are about to have grain delivery. <br> [Gray] The big rats, like on the fields... <br> [Red] So if you could help us with them, it would be great!","millers young":"Aren't you two a bit too young to have a job?","millers young answ":"Nope, we are both adults, even if barely, but we will take that as a compliment~ <br> *[They both smirk as they say that, apparently happy with their looks]*","millers sure":"Sure, I can deal with them.","millers sure answ":"[Red] Ehehe, thank you~ <br> [Gray] We will get you some reward for it later. <br> [Red] A bit of money, and maybe a kiss or two~","millers cleared":"I cleared out your storehouse","millers cleared answ":"[Red] Nice job! <br>[Gray] Now where is that grain? <br> [Red] Oh right, it was supposed to be delivered by now. <br>[Gray] Could you search the village for a cart loaded with bags of grain that's 'supposed' to be heading our way?","millers delivered":"Your delivery has arrived.","millers delivered answ":"[Red] Thanks <br>[Gray] Thank you! <br>[Red] And here's your reward.","millers kiss":"So about that kiss you promised...","millers kiss answ":"[Red] Yes? Which one of us do you want it from?","millers kiss mouse":"How about... your gray-haired friend?","millers kiss mouse answ":"*[Gray-haired teen slowly approaches you from the side and gives you a gentle smooch on your cheek, then steps back with a slightly shy smile]*","millers kiss cat":"How about... you?","millers kiss cat answ":"*[Red-haired teen slowly approaches you from the side and gives a gentle smooch on your cheek, then steps back with a smirk]*","millers kiss both":"How about... both of you?","millers kiss both answ":"*[The two slowly approach you from both sides and you receive two simultanous gentle smooches, one of each of your cheek, after which they take a step back]*","millers reject nice":"I appreciate the offer, but I'm not interested in that kind of thing","millers reject nice answ":"[Red] Oh well, that's a pity~","millers reject mean":"Ewww, it's a terrible idea.","millers reject mean answ":"[Red] Whatever you say~","millers kiss more":"Can I get one more kiss?","millers kiss more answ":"[Red] Hmmm... should we? <br>[Gray] Maybe some other time. <br>[Red] You heard him~","millers how2":"So, how's it going?","millers how2 answ":"[Red] Kinda boring, but at least company is good. <br>[Gray] What he said.","g guard description":"You see a massive man in a steel chainmail, with a spear in his hand and a sword on his belt.","g guard hello":"Hello, can I get in?","g guard hello answ":"The town is currently closed to everyone who isn't a citizen or a merchant guild's member. No exceptions.","sus description 1":"You see a young man in shabby clothes and with messy hair, who keeps looking around. He appears to have some nervous ticks, or maybe he's just really stressed. He notices you and stares.","sus description 2":"You see a young man in shabby clothes and with messy hair, who keeps calmly looking around. The moment he notices you, he appears to get calmer.","sus hello":"Hello? Why are you looking at me like that?","sus hello answ":"Y-you! You should be dead! *the man pulls out a dagger*","sus defeated":"What was that about?","sus defeated answ":"I... We... It was my group that robbed you. I thought you came back from your grave for revenge... Please, I don't know anything. If you want answers, ask my ex-boss. He's somewhere in the town.","sus behave":"Are you behaving yourself?","sus behave answ":"Y-yes, boss! Please don't beat me again!","sus boss":"Stop calling me 'boss'","sus boss answ":"Yes, boss! Sorry, boss!","sus situation":"By the way, how are things in this slum?","sus situation answ":"A-as you can see and hear boss, it's pretty b-bad, but it can't be helped without taking out the g-gang...","sus gang":"What gang?","sus gang answ":"It's j-just a gang, they don't have any name, boss. Their hideout is over t-there, you should stay away from it. Almost every k-killer and thug around t-the slum is a part of their group...","sus gang defeated":"That gang you mentioned? I dealt with them.","sus gang defeated answ":"I know boss, we all heard the commotion! You're the best! I think the local trader already pulled out some gear he was hiding from them, you should check it out! <br><strong>*Pauses for a moment*</strong> I wish I had shown you my defensive tricks before that, it might have made your job easier...","sus behave 2":"Are you behaving yourself?","sus behave 2 answ":"Y-yes, I didn't do anything bad since the last time, boss!","sus behave 3":"Are you behaving yourself?","sus behave 3 answ":"Of course boss!","sus tricks":"You said something about defensive tricks? Show me","sus tricks answ":"Sure, boss! So, it's really about focusing on your legs to either jump away faster or to better brace the shield, and... <strong>*He continues explaining for a while*</strong>","sus headpat":"[Pat his head]","sus headpat answ":"[He smiles like a little puppy]","old description 1":"With some safety returned to the area, more folk are now out on the streets. One of them, an elderly lady, is looking at you.","old description 2":"You see a gentle elderly lady with warm look in her eyes","old hello":"[Let her approach you.]","old hello answ":"Hello young warrior. I understand it is you who we have to thank for freeing us from those thugs. Few these days have the gumption, and even fewer the strength to take them on. Well done! Such heroism deserves a reward, and while none of us have much to offer as you can see, but the least I can do is make sure our hero doesn't go hungry. Would you care to join me for dinner?","old dinner":"[Accept the offer.]","old dinner answ":"[You join the woman in her shack for a humble, yet satisfying meal. While the main ingredients are simple, they are well flavoured and garnished with herbs.]","old ingredients":"[Compliment the food and ask where she gets ingredients.]","old ingredients answ":"Surprised? Live here long enough, and you learn how to get by without a lot of pricey things. No, I'm not talking about stealing - I may be poor, but I still have my pride! No, I'm talking about the plants that grow all around. Most people pass them by, without realizing how useful they can be. Ha! Maybe there IS another way I can reward you! I can teach you what to look for, if you're interested.","sup hello":"Hello","sup hello answ":"Hello stranger","sup work":"Do you have any work with decent pay?","sup work answ":"We sure could use more hands. Feel free to help my boys on the fields whenever you have time!","sup anything":"Is there anything I can help you with?","sup anything answ":"I don't think so, nothing aside from normal work... Actually there is one thing. We're in a dire need of 50 packs of bonemeal and lost our supplier on top of that, so I'm willing to pay you a triple price. Bad news is, you will have to bring all 50 in a single delivery.","sup bonemeal":"More bonemeal, you say?","sup bonemeal answ":"Absolutely! I know the lower price might not be the most appealing, but at least it's stable, unlike the market, and at times might be a lot better than what any trader would pay you for it.","sup animals":"Do you sell anything?","sup animals answ":"Sorry, I'm not allowed to. However if you were to help us produce something, I could let you take part of it. It just so happens our sheep need shearing, if you're interested in some free wool.","sup fight0":"Do you have any task that requires some good old violence?","sup fight0 answ":"I kinda do, but you don't seem strong enough for that. I'm sorry.","sup fight":"Do you have any task that requires some good old violence?","sup fight answ":"Actually yes. There's that annoying group of boars that keep destroying our fields. They don't do enough damage to cause any serious problems, but I would certainly be calmer if someone took care of them. Go to the forest and search for a clearing in north, that's where they usually roam when they aren't busy eating our crops. I will of course pay you for that. 4 silver coins is most I can offer, I'm running on a strict budget here.","sup things":"How are things around here?","sup things answ":"Nothing to complain about. Trouble is rare, pay is good, and the soil is as fertile as my wife!","sup defeated boars":"I took care of those boars","sup defeated boars answ":"Really? That's great! Here, this is for you.","sup troubled":"You look troubled","sup troubled answ":"Troubled? I'm fuming, I'm going insane here! Those damn accursed ants, they keep destroying crops by eating their roots over and over again! If I could, I would drop everything, grab a sword and a shovel and go find their damn nests, and then slaughter every last one of them! Not just soldiers and workers, but queens and larvae too! Destroy their nests for me and you will have my gratitude, I will even pay you out of my own pocket!... Oh, and you can borrow a shovel from the farm if you don't have your own.","sup eliminated":"The ants are gone, though there are some trails leading to the forest","sup eliminated answ":"That's just... thank you, thank you so much! Here, take this, you earned it! As for the forest, I don't really care, as long as they don't come back.","sup deliver":"[Deliver the bonemeal]","sup deliver answ":"Thank you very much, here's your money! If you ever want to make more deliveries of this size, we will gladly take them, although it will have to be for the regular price","sup deliver not":"I'm sorry, but that's not enough","sup deliver 2":"[Deliver the bonemeal]","sup deliver 2 answ":"Thank you very much, here's your money! We will gladly take more, whenever you have it!","sup deliver 2 not":"I'm sorry, but that's not enough","sup description":"You see a well dressed man with a notebook on his belt and a hat on his head. Despite seeming more like a scribe, he's buff and tanned."},mofu_english:{"elder description":"You see an older man with curly white hair and dull, heavy horns. Despite his years, he stands with a strong posture, ready to ram any threat to the village. He eyes you with curiosity.","craftsman description":"You see an old man with a medium length white tail, who clearly experienced a lot in life. His hair is composed of a black and a white part, with the former very dulled by age. He's wearing some handmade accessories. Despite his age and his massive hands, his fingers seem exceptionally nimble.","craftsman learn answ":`Ahh, that's great. Well then... 
*[Old man spends some time explaining all the important basics of crafting and providing you with tips, his large fingers proving to be as nimble as they seemed]*
Ahh, and before I forget, here, take these. They will be helpful for gathering necessary materials.`,"guard description":"You see a tall woman in light armor, with a spear in her hand and two daggers on her belt. Her sharp fuzzy ears rotate every now and then towards any new sound, while her fluffy tail remains motionless. There's a scar across her face. When she spots you, she looks at you as if you were a prey, but then adopts a more neutral expression","guard hi answ":`Hey there. I heard you've been helping around a lot, good job cutie~
 *[As she says that, she bends forward and pats your head a few times with a surprisingly gentle touch, her tail slightly wagging]*`,"guard serious answ":"Ohhh, someone wants to impress the cute fluffy wolf lady? Sorry, but I'm way too strong for you~","millers description":"You see two teenagers with mischievous looks on their faces. One has cat ears and a fluffy tail, the other mouse ears and a tail with barely any hair on it. It's only with great deal of effort that you manage to recognize them both as males. The cat has red hair, the mouse gray.","millers hello answ":"[Cat] Hi~! <br> [Mouse]: Hello","millers how answ":"[Mouse] We are fine, mostly. <br> [Cat] Except for rats in the storehouse, especially since we are about to have grain delivery. <br> [Mouse] The big rats, like on the fields... <br> [Cat] I would prefer mice, at least those are cute. <br> [Mouse] Shut up. <br> [Cat] So if you could help us with them, it would be great!","millers sure answ":"[Cat] Ehehe, thank you~ <br> [Mouse] We will get you some reward for it later. <br> [Cat] A bit of money, and maybe a kiss or two~","millers cleared answ":"[Cat] Nice job! <br>[Mouse] Now where is that grain? <br> [Cat] Oh right, it was supposed to be delivered by now. <br>[Mouse] Could you search the village for a cart loaded with bags of grain that's 'supposed' to be heading our way?","millers delivered answ":"[Cat] Thanks <br>[Mouse] Thank you! <br>[Cat] And here's your reward.","millers kiss answ":"[Cat] Yes? Which one of us do you want it from?","millers kiss mouse answ":"*[Mouse teen slowly approaches you from the side and gives you a gentle smooch on your cheek with his tail brushing against your legs, then steps back with a slightly shy smile]*","millers kiss cat answ":"*[Cat teen slowly approaches you from the side and gives a gentle smooch on your cheek with his tail brushing against your legs, then steps back with a smirk]*","millers kiss both answ":"*[The two slowly approach you from both sides and you receive two simultanous gentle smooches, one of each of your cheek  with their tails brushing against your legs, after which they take a step back]*","millers reject nice answ":"[Cat] Oh well, that's a pity~","millers reject mean answ":"[Cat] Whatever you say~","millers kiss more answ":"[Cat] Hmmm... should we? <br>[Mouse] Maybe some other time. <br>[Mouse] You heard him~","millers how2 answ":"[Cat] Kinda boring, but at least company is good. <br>[Mouse] What he said.","g guard description":"You see a massive, hairy man with round ears and a tiny tail. He's clad in a steel chainmail, with a spear in his hand and an axe on his belt.","sus description 1":"You see a young man in shabby clothes and with messy hair, who keeps looking around. He appears to have some nervous ticks, or maybe he's just really stressed. Both his doggy ears and his tail are lowered and not moving. He notices you and stares.","sus description 2":"You see a young man in shabby clothes and with messy hair, who keeps calmly looking around, with ears straight up and occasionally turning towards new sounds. The moment he notices you, he appears to get calmer and his tail starts slowly wagging.","sus headpat answ":"[He smiles like a little puppy, his tail wagging a lot faster]","old description 1":"With some safety returned to the area, more folk are now out on the streets. One of them, an elderly tanuki lady, is looking at you.","old description 2":"You see a gentle elderly tanuki lady with warm look in her eyes","sup description":"You see a well dressed man with a notebook on his belt and a hat on his head, awkwardly placed between a pair of antlers. Despite seeming more like a scribe, he's buff and tanned."}};var Bl,be={},U=document.getElementById("location_actions_div"),Ol=document.getElementById("trade_div"),Nl=document.getElementById("storage_div"),jl=document.getElementById("location_name_span"),As=document.getElementById("location_icon_span"),Fa=document.getElementById("location_types_div"),Gs=document.getElementById("location_name_tooltip"),Ve,Qi,Pl,Wl,Ra=[],vn=document.getElementById("inventory_content_div"),te={},Le={},_t={},vi={},ki={},ia=document.getElementById("trader_inventory_div"),Ga=document.getElementById("storage_inventory_div"),Xn=document.getElementById("message_box_div"),Rl=document.getElementById("combat_div"),Qe=document.getElementById("enemies_div"),Fs=document.getElementById("enemy_count_div"),Pc=[{backgroundColor:"rgba(0, 0, 0, 0)",rotate:"0deg"},{backgroundColor:"rgba(255, 0, 0, 0.2)",rotate:"0.3deg"}],Wc={duration:100,iterations:2,direction:"alternate"},Rc=[{opacity:"0.2",backgroundColor:"rgba(0, 124, 17, 0.2)"},{opacity:"1"}],Gc={duration:800,iterations:1},na={},Fc=document.getElementById("character_health_value"),zc=document.getElementById("character_healthbar_current"),yn=document.getElementById("character_health_tooltip"),Dc=document.getElementById("character_stamina_value"),Yc=document.getElementById("character_stamina_bar_current"),xi=document.getElementById("character_stamina_tooltip"),El=document.getElementById("character_xp_div"),Vc=document.getElementById("character_level_div"),wn=document.getElementById("character_xp_tooltip"),Hs=document.getElementById("effects_tooltip"),Qc=document.getElementById("active_effect_count"),Uc=document.getElementById("time_div"),Zn=document.getElementById("weather_div"),ne={},ht=document.getElementById("skill_list"),Ie=[],ot={},Ri=document.getElementById("stance_list"),Tt={},Bs=document.getElementById("books_list"),Yi={},Os=document.getElementById("bestiary_list"),Mi=document.getElementById("switch_to_combat"),Gl=document.getElementById("switch_to_inventory"),zs={},Ds=document.getElementById("quest_list"),Sl={reputation:document.getElementById("data_tab_reputation_div")},ea="name",Gi="asc",Ll="name",Fi="asc",Il="name",zi="asc",Tl="name",Di="asc",ee={message_combat:0,message_unlocks:0,message_loot:0,message_events:0,message_background:0,message_crafting:0},Vi={strength:document.getElementById("strength_slot"),agility:document.getElementById("agility_slot"),dexterity:document.getElementById("dexterity_slot"),intuition:document.getElementById("intuition_slot"),magic:document.getElementById("magic_slot"),attack_speed:document.getElementById("attack_speed_slot"),attack_power:document.getElementById("attack_power_slot"),defense:document.getElementById("defense_slot"),crit_rate:document.getElementById("crit_rate_slot"),crit_multiplier:document.getElementById("crit_multiplier_slot")},si={attack_points:document.getElementById("hit_chance_slot"),defensive_action:document.getElementById("defensive_action_slot"),defensive_points:document.getElementById("defensive_action_chance_slot")},oi={},Kc=document.getElementById("character_attack_bar"),qi={head:document.getElementById("head_slot"),torso:document.getElementById("torso_slot"),arms:document.getElementById("arms_slot"),ring:document.getElementById("ring_slot"),weapon:document.getElementById("weapon_slot"),"off-hand":document.getElementById("off-hand_slot"),legs:document.getElementById("legs_slot"),feet:document.getElementById("feet_slot"),amulet:document.getElementById("amulet_slot"),artifact:document.getElementById("artifact_slot"),cape:document.getElementById("cape_slot"),pickaxe:document.getElementById("pickaxe_slot"),axe:document.getElementById("axe_slot"),sickle:document.getElementById("sickle_slot"),shovel:document.getElementById("shovel_slot")},Rt={trash:"lightgray",common:"white",uncommon:"lightgreen",rare:"blue",epic:"pink",legendary:"purple",mythical:"orange"},Ue={},Ks,Ys,Jc=document.getElementById("loading_screen_loading_progress"),ni=document.getElementById("backup_load_button"),xt=document.getElementById("import_other_save_button"),Cl=document.getElementById("export_button_tooltip"),Xc="Nevermind";function mt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Fl(e,t){let i=document.createElement("div");t.x=t.x+Math.random()*80-40,i.style.top=t.y+"px",i.style.left=t.x+"px",i.classList.add("floating_effect"),i.innerText=e,i.posX=t.x,i.posY=t.y,document.body.appendChild(i);let n=0,s;Math.random()>.5?s=setInterval(()=>{i.style.top=i.posY-2*n**.95+"px",i.style.left=i.posX-Math.sin(n/10)*20+"px",i.style.opacity=(100-n**.95)/100,n++},30):s=setInterval(()=>{i.style.top=i.posY-2*n**.95+"px",i.style.left=i.posX-Math.cos(n/8)*16+"px",i.style.opacity=(100-n**.95)/100,n++},30),setTimeout(()=>{clearInterval(s),i.remove()},4*1e3)}function Ki(){for(;U.lastElementChild;)U.removeChild(U.lastElementChild),be={}}function Ji(e,t={},i=!1){let n=document.createElement("span");return n.classList.add(t?.class_name||"item_tooltip"),n.innerHTML=kn({item:e,options:t,is_trade:i}),n}function kn({item:e,options:t={},is_trade:i=!1}){let n="",s=i?"getValue":"getBaseValue";n=`<b>${e.getName()}</b>`,e.description&&(n+=`<br>${e.description}`);let a=e.quality;if(e.item_type==="EQUIPPABLE"){if(t?.quality&&t.quality[0]&&(a=t.quality[0]),e.ignore_quality||(!t.skip_quality&&t?.quality?.length==2?(n+=`<br><br><b>Quality: <span style="color: ${Rt[e.getRarity(t.quality[0])]}"> ${t.quality[0]}% </span> - <span style="color: ${Rt[e.getRarity(t.quality[1])]}"> ${t.quality[1]}% </span>`,n+=`<br>[<span style="color: ${Rt[e.getRarity(t.quality[0])]}">${e.getRarity(t.quality[0])}</span>-<span style="color: ${Rt[e.getRarity(t.quality[1])]}">${e.getRarity(t.quality[1])}</span>] </b>`):n+=`<br><br><b style="color: ${Rt[e.getRarity(a)]}">Quality: ${a}% [${e.getRarity(a)}]</b>`),e.tags.unique&&(n+='<br><br><b class="item_unique">Unique</b>'),n+=`<br><br>Slot: <b>${e.equip_slot}</b>`,e.equip_slot==="weapon"&&(n+=`<br>Type: <b>${e.weapon_type}</b>`),e.components){let l='<br><br><span class="item_component_list">',u=Object.keys(e.components);e.components&&(l+=`[${d[e.components[u[0]]].name}]`,e.components[u[1]]?l+=`<br>+<br>[${d[e.components[u[1]]].name}]`:l+=`<br>+<br>no [${u[1]}]`),l+="</span>",n+=l}if(!t.skip_quality&&t?.quality?.length==2){e.getAttack?n+=`<br><br>Attack: ${Math.round(10*e.getAttack(t.quality[0]),!0)/10} - ${Math.round(10*e.getAttack(t.quality[1],!0))/10}`:e.getDefense?n+=`<br><br>Defense: ${Math.round(10*e.getDefense(t.quality[0]))/10} - ${Math.round(10*e.getDefense(t.quality[1]))/10}`:e.offhand_type==="shield"&&(e.tags.ignore_skill?n+=`<br><br>Can block up to: ${Math.round(10*e.getShieldStrength(t.quality[0]))/10} - ${Math.round(10*e.getShieldStrength(t.quality[1]))/10} damage [base: ${e.getShieldStrength(t.quality[0])}-${e.getShieldStrength(t.quality[1])}]`:n+=`<br><br>Can block up to: ${Math.round(10*e.getShieldStrength(t.quality[0])*r.stats.total_multiplier.block_strength)/10} - ${Math.round(10*e.getShieldStrength(t.quality[1])*r.stats.total_multiplier.block_strength)/10} damage [base: ${e.getShieldStrength(t.quality[0])}-${e.getShieldStrength(t.quality[1])}]`);let l=e.getStats(t.quality[0]),u=e.getStats(t.quality[1]);Object.keys(l).length>0&&(n+="<br>"),Object.keys(l).forEach(c=>{l[c].flat!=null&&(n+=`<br>${mt(c).replace("_"," ")}: +${l[c].flat} - ${u[c].flat}`),l[c].multiplier!=null&&(n+=`<br>${mt(c).replace("_"," ")}: x${l[c].multiplier} - ${u[c].multiplier}`)})}else{e.getAttack?n+=`<br><br>Attack: ${Math.round(10*e.getAttack())/10}`:e.getDefense?n+=`<br><br>Defense: ${Math.round(10*e.getDefense())/10}`:e.offhand_type==="shield"&&(e.tags.ignore_skill?n+=`<br><br>Can block up to: ${Math.round(10*e.getShieldStrength())/10} damage [unaffected by skill]`:n+=`<br><br>Can block up to: ${Math.round(10*e.getShieldStrength()*r.stats.total_multiplier.block_strength)/10} damage [base: ${e.getShieldStrength()}]`);let l=e.getStats();Object.keys(l).length>0&&(n+="<br>"),Object.keys(l).forEach(function(u){l[u].flat!=null&&(n+=`<br>${mt(u).replace("_"," ")}: +${l[u].flat}`),l[u].multiplier!=null&&(n+=`<br>${mt(u).replace("_"," ")}: x${l[u].multiplier}`)})}let o=e.getBonusSkillLevels();Object.keys(o).length>0&&(n+="<br>"),Object.keys(o).forEach(l=>{l.includes("category_")?n+=`<br>${l} skills level: +${o[l]}`:n+=`<br>${p[l].name()} level: +${o[l]}`}),n+="<br>"}else if(e.item_type==="USABLE"){n+="<br>",e.effects.length>0&&(n+="<br>Effects: ");for(let o=0;o<e.effects.length;o++)n+=zl({effect_name:e.effects[o].effect,duration:e.effects[o].duration,add_bonus:!0}).outerHTML}else e.item_type==="BOOK"?(D[e.name].is_finished?(n+=`<br><br>Reading it provided ${r.name} with:`,Object.keys(D[e.name].bonuses).length>0&&(n+=`<br>- ${Zc(D[e.name].bonuses)}`),D[e.name].rewards?.skills&&(D[e.name].rewards.skills.length==1?n+="<br>- a new skill":n+="<br>- new skills"),D[e.name].rewards?.recipes&&(D[e.name].rewards.recipes.length==1?n+="<br>- a new recipe":n+="<br>- new recipes")):n+=`<br><br>Time to read: ${e.getRemainingTime()} minutes`,n+="<br>"):(e.tags.component&&(t?.quality&&t.quality[0]&&(a=t.quality[0]),!t.skip_quality&&t?.quality?.length==2?(n+=`<br><br><b>Quality: <span style="color: ${Rt[e.getRarity(t.quality[0])]}"> ${t.quality[0]}% </span> - <span style="color: ${Rt[e.getRarity(t.quality[1])]}"> ${t.quality[1]}% </span>`,n+=`<br>[<span style="color: ${Rt[e.getRarity(t.quality[0])]}"> ${e.getRarity(t.quality[0])}</span> - <span style="color: ${Rt[e.getRarity(t.quality[1])]}"> ${e.getRarity(t.quality[1])}</span>]</b>`):n+=`<br><br><b style="color: ${Rt[e.getRarity(a)]}">Quality: ${a}% [${e.getRarity(a)}]</b>`,e.component_tier&&(n+=`<br><br>Component tier: ${e.component_tier}`),(Object.keys(e.component_stats).length>0||e?.attack_value!==0||e?.attack_multiplier!==1||e?.defense_value!==0)&&(n+="<br><br>Basic stats: "),e?.attack_value&&(n+=`<br>Attack power: +${e.attack_value}`),e?.attack_multiplier&&e.attack_multiplier!==1&&(n+=`<br>Size-specific attack power: x${e.attack_multiplier}`),e?.defense_value&&(n+=`<br>Defense: +${e.defense_value}`),Object.keys(e.component_stats).forEach(function(o){e.component_stats[o].flat!=null&&(n+=`<br>${mt(o).replace("_"," ")}: +${e.component_stats[o].flat}`),e.component_stats[o].multiplier!=null&&(n+=`<br>${mt(o).replace("_"," ")}: x${e.component_stats[o].multiplier}`)})),n+="<br>");return e.material_type&&(n+=`<br>Material type: ${e.material_type}<br>`),!t.skip_quality&&t?.quality?.length==2?n+=`<br>Value: ${Pe($e(e[s]({quality:t.quality[0],region:v?.market_region})))} - ${Pe($e(e.getBaseValue({quality:t.quality[1]})))}`:(n+=`<br>Value: ${Pe($e(e[s]({quality:a,region:v?.market_region,multiplier:t&&t.trader?P[Ne].getProfitMargin():1})))}`,e.saturates_market&&(n+=` [originally ${Pe($e(e.getBaseValue({quality:a,region:v?.market_region})*(t&&t.trader?P[Ne].getProfitMargin():1)||1))}]`)),n}function zl({effect_name:e,duration:t,add_bonus:i=!1}){let n=Z[e],s=document.createElement("div");s.classList.add("active_effect_tooltip");let a=document.createElement("span");a.classList.add("active_effect_name"),a.innerHTML=`'${n.name}' : `;let o=document.createElement("span");o.classList.add("active_effect_duration"),o.innerHTML=""+bt({time:{minutes:t}});let l=document.createElement("div");l.classList.add("active_effect_name_and_duration"),l.appendChild(a),l.appendChild(o),s.appendChild(l);let u=document.createElement("div"),c;i?c=xo(n):c=n.effects;for(let[h,f]of Object.entries(c.stats)){s.innerHTML+=`<br>${mt(We[h])}`;let y=!1;if(f.flat){let b=f.flat>0?"+":"";s.innerHTML+=`: ${b}${Math.round(100*f.flat)/100}`,y=!0}f.multiplier&&(y?s.innerHTML+=`, x${Math.round(100*f.multiplier)/100}`:s.innerHTML+=`: x${Math.round(100*f.multiplier)/100}`)}let _=Object.keys(c.xp_multipliers);if(_.length>0){let h;_[0]!=="all"&&_[0]!=="hero"&&_[0]!=="all_skill"?h=p[_[0]].name():h=_[0].replace("_"," "),h=mt(h),s.innerHTML?s.innerHTML+=`<br>${h} xp gain: x${c.xp_multipliers[_[0]]}`:s.innerHTML=`${h} xp gain: x${c.xp_multipliers[_[0]]}`;for(let f=1;f<_.length;f++){let y;_[f]!=="all"&&_[f]!=="hero"&&_[f]!=="all_skill"?y=p[_[f]].name():y=_[f].replace("_"," "),s.innerHTML+=`<br>${y} xp gain: x${c.xp_multipliers[_[f]]}`}}return s.appendChild(u),s}function li(e){clearInterval(Bl);let t=document.getElementById("action_status_div");e&&t&&(t.innerHTML="")}function S(e,t){if(typeof e>"u")return;let i=document.createElement("div");i.classList.add("message_common");let n="message_default",s="message_events";switch(t){case"enemy_defeated":n="message_victory",s="message_combat",ee.message_combat+=1;break;case"hero_defeat":n="message_hero_defeated",s="message_combat",ee.message_combat+=1;break;case"enemy_attacked":n="message_enemy_attacked",s="message_combat",ee.message_combat+=1;break;case"enemy_attacked_critically":n="message_enemy_attacked_critically",s="message_combat",ee.message_combat+=1;break;case"hero_attacked":n="message_hero_attacked",s="message_combat",ee.message_combat+=1;break;case"hero_missed":s="message_combat",ee.message_combat+=1;break;case"hero_blocked":s="message_combat",ee.message_combat+=1;break;case"enemy_missed":s="message_combat",ee.message_combat+=1;break;case"hero_attacked_critically":n="message_hero_attacked_critically",s="message_combat",ee.message_combat+=1;break;case"combat_loot":n="message_items_obtained",s="message_loot",ee.message_loot+=1;break;case"gathered_loot":n="message_items_obtained",s="message_loot",ee.message_loot+=1;break;case"total_gathered_loot":n="message_total_items_obtained",s="message_loot",ee.message_loot+=1;break;case"location_reward":s="message_loot",ee.message_loot+=1;break;case"skill_raised":n="message_skill_leveled_up",s="message_unlocks",ee.message_unlocks+=1;break;case"level_up":s="message_unlocks",ee.message_unlocks+=1;break;case"activity_unlocked":s="message_unlocks",ee.message_unlocks+=1;break;case"location_unlocked":n="message_location_unlocked",s="message_unlocks",ee.message_unlocks+=1;break;case"dialogue_unlocked":s="message_unlocks",ee.message_unlocks+=1;break;case"message_travel":n="message_travel",s="message_events",ee.message_events+=1;break;case"export_reward":n="message_export_reward",s="message_events",ee.message_events+=1;break;case"activity_finished":s="message_events",ee.message_events+=1;break;case"activity_money":s="message_events",ee.message_events+=1;break;case"notification":ee.message_events+=1,s="message_events",n="message_notification";break;case"background":ee.message_background+=1,s="message_background";break;case"crafting":ee.message_crafting+=1,s="message_crafting";break;case"message_critical":ee.message_events+=1,s="message_events",n="message_critical";break}(s==="message_combat"&&ee.message_combat>80||s==="message_loot"&&ee.message_loot>28||s==="message_unlocks"&&ee.message_unlocks>40||s==="message_events"&&ee.message_events>40||s==="message_background"&&ee.message_background>28||s==="message_crafting"&&ee.message_crafting>28)&&Xn.removeChild(Xn.getElementsByClassName(s)[0]),i.classList.add(n,s),i.innerHTML=e+"<div class='message_border'> </>",Xn.appendChild(i);let a=s.replace("_","_show_");document.getElementById(a).classList.contains("active_selection_button")&&(Xn.scrollTop=Xn.scrollHeight)}function Zc(e){let t="";if(e.stats){let i=Object.keys(e.stats);t=`+${e.stats[i[0]]} ${We[i[0]]}`;for(let n=1;n<i.length;n++)t+=`, +${e.stats[i[n]]} ${We[i[n]]}`}if(e.multipliers){let i=Object.keys(e.multipliers);t?t+=`, x${e.multipliers[i[0]]} ${We[i[0]]}`:t=`x${e.multipliers[i[0]]} ${We[i[0]]}`;for(let n=1;n<i.length;n++)t+=`, x${e.multipliers[i[n]]} ${We[i[n]]}`}if(e.xp_multipliers){let i=Object.keys(e.xp_multipliers),n;i[0]!=="all"&&i[0]!=="hero"&&i[0]!=="all_skill"?n=p[i[0]].name():n=i[0].replace("_"," "),t?t+=`, x${e.xp_multipliers[i[0]]} ${n} xp gain`:t=`x${e.xp_multipliers[i[0]]} ${n} xp gain`;for(let s=1;s<i.length;s++){let a;i[s]!=="all"&&i[s]!=="hero"&&i[s]!=="all_skill"?a=p[i[s]].name():a=i[s].replace("_"," "),t+=`, x${e.xp_multipliers[i[s]]} ${a} xp gain`}}return t}function za({loot_list:e,is_combat:t=!1,is_a_summary:i=!1}){if(e.length==0)return;let n;e[0].item_id?n=d[e[0].item_id]:e[0].item_key&&(n=Oe(e[0].item_key));let s,a;if(t?(a="combat_loot",s='Looted "'):i?(a="total_gathered_loot",s='Gained in total: "'):(a="gathered_loot",s='Gained "'),s+=n.getName()+'" x'+e[0].count,e.length>1)for(let o=1;o<e.length;o++)e[o].item_id?n=d[e[o].item_id]:e[o].item_key&&(n=Oe(e[o].item_key)),s+=', "'+n.getName()+'" x'+e[o].count;S(s,a)}function Da(e){li(),Bl=setInterval(()=>{let t=document.getElementById("action_status_div"),i="";t.innerHTML.endsWith("...")?i="...":t.innerHTML.endsWith("..")?i="..":t.innerHTML.endsWith(".")&&(i="."),e?.book_title&&(t.innerHTML=t.innerHTML.split(",")[0]+`, ${Bi(d[e.book_title].getRemainingTime())} left`,t.innerHTML+=i),i.length<3?t.innerHTML+=".":t.innerHTML=t.innerHTML.substring(0,t.innerHTML.length-3)},600)}function fl(){U.style.display="none",Ol.style.display="inherit",document.getElementById("trader_cost_mult_value").textContent=`${Math.round(100*P[Ne].getProfitMargin())}%`,jt()}function Ta(){U.style.display="none",Nl.style.display="inherit",Js()}function fn(){document.getElementById("money_div").innerHTML=`Your purse contains: ${Pe(r.money)}`}function Dl(e){document.getElementById("trade_price_value").innerHTML=Pe(e)}function eu(){let e=document.createElement("div");e.classList.add("trade_ammount_buttons");let t=document.createElement("div");t.classList.add("trade_ammount_button"),t.innerText="5",t.setAttribute("data-trade_ammount",5),e.appendChild(t);let i=document.createElement("div");i.classList.add("trade_ammount_button"),i.innerText="10",i.setAttribute("data-trade_ammount",10),e.appendChild(i);let n=document.createElement("div");return n.classList.add("trade_ammount_button"),n.innerText="all",n.setAttribute("data-trade_ammount",1/0),e.appendChild(n),e}function qn({sort_by:e="name",target:t="character",change_direction:i=!1}){let n,s;if(t==="trader")i&&(e&&e===Ll?Fi==="asc"?Fi="desc":Fi="asc":e==="price"?Fi="desc":Fi="asc"),t=ia,n=Fi==="asc"?1:-1,s=Fi==="asc"?-1:1,Ll=e||"name";else if(t==="character")i&&(e&&e===Tl?Di==="asc"?Di="desc":Di="asc":e==="price"?Di="desc":Di="asc"),t=vn,n=Di==="asc"?1:-1,s=Di==="asc"?-1:1,Tl=e||"name";else if(t==="storage")i&&(e&&e===Il?zi==="asc"?zi="desc":zi="asc":e==="price"?zi="desc":zi="asc"),t=Ga,n=zi==="asc"?1:-1,s=zi==="asc"?-1:1,Il=e||"name";else{console.warn(`Something went wrong, no such inventory as '${t}'`);return}[...t.children].sort((a,o)=>{if(a.classList.contains("equipped_item_control")&&!o.classList.contains("equipped_item_control"))return-1;if(!a.classList.contains("equipped_item_control")&&o.classList.contains("equipped_item_control")||a.classList.contains("item_to_trade")&&!o.classList.contains("item_to_trade"))return 1;if(!a.classList.contains("item_to_trade")&&o.classList.contains("item_to_trade"))return-1;if(a.classList.contains("character_item_equippable")&&!o.classList.contains("character_item_equippable"))return 1;if(!a.classList.contains("character_item_equippable")&&o.classList.contains("character_item_equippable"))return-1;if(a.classList.contains("trader_item_equippable")&&!o.classList.contains("trader_item_equippable"))return 1;if(!a.classList.contains("trader_item_equippable")&&o.classList.contains("trader_item_equippable"))return-1;if(a.classList.contains("storage_item_equippable")&&!o.classList.contains("storage_item_equippable"))return 1;if(!a.classList.contains("storage_item_equippable")&&o.classList.contains("storage_item_equippable"))return-1;if(a.children[0].children[0].children[0].innerText==="[Comp]"&&o.children[0].children[0].children[0].innerText!=="[Comp]")return 1;if(a.children[0].children[0].children[0].innerText!=="[Comp]"&&o.children[0].children[0].children[0].innerText==="[Comp]")return-1;if(a.children[0].children[0].children[0].innerText==="[Book]"&&o.children[0].children[0].children[0].innerText!=="[Book]")return 1;if(a.children[0].children[0].children[0].innerText!=="[Book]"&&o.children[0].children[0].children[0].innerText==="[Book]")return-1;let l=a.dataset.item_slot,u=o.dataset.item_slot;if(e==="type"){if(l!=u)return Object.keys(qi).indexOf(a.dataset.item_slot)-Object.keys(qi).indexOf(o.dataset.item_slot);if(a.classList.contains("character_item_usable")!=o.classList.contains("character_item_usable"))return o.classList.contains("character_item_usable")-a.classList.contains("character_item_usable");if(a.classList.contains("trader_item_usable")!=o.classList.contains("trader_item_usable"))return o.classList.contains("trader_item_usable")-a.classList.contains("trader_item_usable");if(a.classList.contains("storage_item_usable")!=o.classList.contains("storage_item_usable"))return o.classList.contains("storage_item_usable")-a.classList.contains("storage_item_usable");let c=null,_=null;if(t===vn?(c=d[JSON.parse(a.dataset.character_item).id],_=d[JSON.parse(o.dataset.character_item).id]):t===ia?(c=d[JSON.parse(a.dataset.trader_item).id],_=d[JSON.parse(o.dataset.trader_item).id]):t===Ga&&(c=d[JSON.parse(a.dataset.storage_item).id],_=d[JSON.parse(o.dataset.storage_item).id]),c&&_){if(c.material_type!=_.material_type)return c.material_type>_.material_type?n:s;if(c.component_type!=_.component_type)return c.component_type>_.component_types?n:s;if(c.component_tier!=_.component_tier)return c.component_tier>_.component_tier?n:s}}if(e==="name"||e==="type"){let c=a.children[0].children[0].children[1].innerText.toLowerCase().replaceAll('"',""),_=o.children[0].children[0].children[1].innerText.toLowerCase().replaceAll('"',"");if(c>_)return n;if(c<_)return s;{let h=Number.parseInt(a.dataset.item_quality),f=Number.parseInt(o.dataset.item_quality);return h>f?n:s}}else if(e==="price"){let c=Number.parseInt(a.getAttribute("data-item_value")),_=Number.parseInt(o.getAttribute("data-item_value"));return c>_||c===_&&"item_quality"in a.dataset&&"item_quality"in o.dataset&&Number.parseInt(a.dataset.item_quality)>Number.parseInt(o.dataset.item_quality)?n:s}}).forEach(a=>t.appendChild(a))}function jt({item_key:e,trader_sorting:t="name",sorting_direction:i="asc",was_anything_new_added:n=!1}={}){let s=P[Ne];if(e||(Object.keys(Le).forEach(a=>{s.inventory[a]||(Le[a].remove(),delete Le[a])}),Object.keys(ki).forEach(a=>{I.items.filter(o=>o.item_key===a).length===0&&(ki[a].remove(),delete ki[a])})),e){let a=s.inventory[e].count;n=Le[e];let o=Ft({key:e,item_count:a,target:"trader",is_trade:!0});Le[e]?(Le[e].replaceWith(o),Le[e]=o):(Le[e]=o,ia.appendChild(o))}else{Object.keys(s.inventory).forEach(a=>{let o=s.inventory[a].count;for(let l=0;l<L.items.length;l++)if(a===L.items[l].item_key){if(o-=Number(L.items[l].count),o==0){Le[a]?.remove(),delete Le[a];return}if(o<0)throw new Error("Something is wrong with trader item count");break}if(!Le[a])Le[a]=Ft({key:a,item_count:o,target:"trader",is_trade:!0}),ia.appendChild(Le[a]),n=!0;else{let l=Number.parseInt(Le[a].getElementsByClassName("item_count")[0].innerText.replace("x",""));Number.isNaN(l)&&(l=0),l!=o&&(o>1?Le[a].getElementsByClassName("item_count")[0].innerText=` x${o}`:Le[a].getElementsByClassName("item_count")[0].innerText=""),Le[a].querySelector(".item_tooltip").replaceWith(Ji(s.inventory[a].item,{trader:!0},!0));let c=Le[a].getElementsByClassName("item_value")[0];c.innerHTML=`${Pe($e(s.inventory[a].item.getValue({region:v.market_region,multiplier:P[Ne].getProfitMargin()||1})),!0)}`}});for(let a=0;a<I.items.length;a++){let o=I.items[a].item_key;if(!ki[o])ki[o]=Ft({target:"trader",trade_index:a,is_trade:!0}),ia.appendChild(ki[o]);else{let l=Le[o]?.dataset.item_count??0,u=I.items[a].count;l!==u&&(u>1?ki[o].getElementsByClassName("item_count")[0].innerText=` x${u}`:ki[o].getElementsByClassName("item_count")[0].innerText="")}}}n&&qn({target:"trader",sort_by:t,direction:i})}function ve({item_key:e,equip_slot:t,character_sorting:i="name",sorting_direction:n="asc",was_anything_new_added:s=!1,is_trade:a=!1,skip_sorting:o=!1}={}){if(e||(Object.keys(te).forEach(l=>{if(te[l].classList.contains("equipped_item_control")){let u=te[l].dataset.character_item;(!r.equipment[l]||u!==r.equipment[l].getInventoryKey())&&(te[l].remove(),delete te[l])}else r.inventory[l]||(te[l].remove(),delete te[l])}),Object.keys(vi).forEach(l=>{L.items.filter(u=>u.item_key===l).length===0&&(vi[l].remove(),delete vi[l])})),e){let l=r.inventory[e].count;s=Le[e];let u=Ft({key:e,item_count:l,target:"character",is_trade:!0});te[e]?(te[e].replaceWith(u),te[e]=u):(te[e]=u,vn.appendChild(u))}else if(t)te[t]=Ft({key:t,target:"character",is_equipped:!0,is_trade:a});else{Object.keys(r.inventory).forEach(l=>{let u=r.inventory[l].count;for(let c=0;c<I.items.length;c++)if(l===I.items[c].item_key){if(u-=Number(I.items[c].count),u==0){te[l]?.remove(),delete te[l];return}if(u<0)throw new Error("Something is wrong with character item count");break}if(!te[l])te[l]=Ft({key:l,item_count:u,target:"character",is_trade:a}),vn.appendChild(te[l]),s=!0;else{let c=Number.parseInt(te[l].getElementsByClassName("item_count")[0].innerText.replace("x",""));Number.isNaN(c)&&(c=0),c!=u&&(u>1?te[l].getElementsByClassName("item_count")[0].innerText=` x${u}`:te[l].getElementsByClassName("item_count")[0].innerText=""),te[l].querySelector(".item_tooltip").replaceWith(Ji(r.inventory[l].item,{},a));let h=te[l].getElementsByClassName("item_value")[0];a?h.innerHTML=`${Pe($e(r.inventory[l].item.getValue({region:v.market_region})),!0)}`:h.innerHTML=`${Pe($e(r.inventory[l].item.getBaseValue()),!0)}`}}),Object.keys(r.equipment).forEach(l=>{if(!te[l]&&r.equipment[l]){if(r.equipment[l]?.tags.tool)return;te[l]=Ft({key:l,target:"character",is_equipped:!0,is_trade:a}),vn.appendChild(te[l]),s=!0}});for(let l=0;l<L.items.length;l++){let u=L.items[l].item_key;if(!vi[u])vi[u]=Ft({target:"character",trade_index:l,is_trade:a}),vn.appendChild(vi[u]);else{let c=te[u]?.dataset.item_count??0,_=L.items[l].count;c!==_&&(_>1?vi[u].getElementsByClassName("item_count")[0].innerText=` x${_}`:vi[u].getElementsByClassName("item_count")[0].innerText="")}}}s&&!o&&qn({target:"character",sort_by:i,direction:n})}function Js({item_key:e,storage_sorting:t="name",sorting_direction:i="asc",was_anything_new_added:n=!1}={}){if(e||Object.keys(_t).forEach(s=>{st.inventory[s]||(_t[s].remove(),delete _t[s])}),e){let s=st.inventory[e].count;_t[e].remove(),delete _t[e],_t[e]=Ft({key:e,item_count:s,target:"storage"}),Ga.appendChild(_t[e]),n=!0}else Object.keys(st.inventory).forEach(s=>{let a=st.inventory[s].count;if(!_t[s])_t[s]=Ft({key:s,item_count:a,target:"storage"}),Ga.appendChild(_t[s]),n=!0;else{let o=Number.parseInt(_t[s].getElementsByClassName("item_count")[0].innerText.replace("x",""));Number.isNaN(o)&&(o=0),o!=a&&(a>1?_t[s].getElementsByClassName("item_count")[0].innerText=` x${a}`:_t[s].getElementsByClassName("item_count")[0].innerText="")}});!e&&n&&qn({target:"storage",sort_by:t,direction:i})}function xl(){U.style.display="",Nl.style.display="none"}function Ft({key:e,item_count:t,target:i,is_equipped:n,trade_index:s,is_trade:a=!1}){let o=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div"),c=document.createElement("div");c.classList.add("item_additional_content");let _,h,f,y={},b=1;if(i==="trader"?(y.trader=!0,b=P[Ne].getProfitMargin()||b):i==="storage"&&(y.storage=!0),n)_=r.equipment[e],t=t??1,f="equipped_item",h="character_item";else if(f="inventory_item",i==="character")typeof s>"u"?(_=r.inventory[e].item,t=t||r.inventory[e].count):(_=P[Ne].inventory[L.items[s].item_key].item,t=t||L.items[s].count),h="character_item";else if(i==="trader")typeof s>"u"?(_=P[Ne].inventory[e].item,t=t||P[Ne].inventory[e].count):(_=r.inventory[I.items[s].item_key].item,t=t||I.items[s].count),h="trader_item";else if(i==="storage")_=st.inventory[e].item,t=t||st.inventory[e].count,h="storage_item";else throw new Error(`"${i}" is not a correct inventory owner`);if("quality"in _&&(o.dataset.item_quality=_.quality),_.tags?.equippable?(_.tags.tool?u.innerHTML=`<span class = "item_slot" >[tool]</span> <span>${_.getName()}</span>`:u.innerHTML=`<span class = "item_slot" >[${_.equip_slot}]</span> <span>${_.getName()}</span>`,u.classList.add(`${f}_name`),l.appendChild(u),o.classList.add(`${f}_control`,`${h}_control`,`${h}_equippable`),o.appendChild(l),typeof s<"u"?l.classList.add(`${f}`,`${h}`,"trade_item_equippable"):l.classList.add(`${f}`,`${h}`,"item_equippable"),o.dataset.item_slot=_.equip_slot):_.tags.component?(u.innerHTML=`<span class = "item_category">[Comp]</span> <span class="item_name">${_.getName()}</span>`,u.classList.add(`${f}_name`),l.appendChild(u),o.classList.add(`${f}_control`,`${h}_control`,`${h}_component`),o.appendChild(l),l.classList.add(`${f}`,`${h}`,"item_component")):_.tags.book?(u.innerHTML='<span class = "item_category">[Book]</span>',u.classList.add(`${f}`),u.innerHTML+=` <span class = "book_name item_name">"${_.name}"</span>`,D[_.name].is_finished?l.classList.add("book_finished"):qo()===_.name&&o.classList.add("book_active")):u.innerHTML=`<span class = "item_category"></span> <span class = "item_name">${_.getName()}</span>`,t>1?u.innerHTML+=`<span class="item_count"> x${t}</span>`:u.innerHTML+='<span class="item_count"></span>',u.classList.add(`${f}_name`),l.appendChild(u),l.classList.add(`${f}`,`${h}`,`item_${_.item_type.toLowerCase()}`),l.appendChild(Ji(_,y,a)),o.classList.add(`${f}_control`,`${h}_control`,`${h}_${_.item_type.toLowerCase()}`),o.setAttribute(`data-${h}`,`${_.getInventoryKey()}`),o.setAttribute("data-item_count",`${t}`),o.setAttribute("data-item_value",`${_.getBaseValue()}`),o.appendChild(l),i==="character"){if(_.item_type==="USABLE"){let k=document.createElement("div");k.classList.add("item_use_button"),k.innerText="[use]";let H=document.createElement("div");H.classList.add("item_auto_use_button"),H.innerText="auto",Ht[_.id]&&H.classList.add("item_auto_use_button_active"),c.appendChild(k),c.appendChild(H)}else if(_.item_type==="BOOK"){let k=document.createElement("div");k.classList.add("item_use_button"),k.innerText="[read]",c.appendChild(k),l.classList.add("item_book")}if(typeof s>"u"&&_.tags.equippable)if(n){let k=document.createElement("div");k.innerHTML="[take off]",k.classList.add("unequip_item_button","item_controls"),c.appendChild(k)}else{let k=document.createElement("span");k.innerHTML="[equip]",k.classList.add("equip_item_button","item_controls"),c.appendChild(k)}}c.appendChild(eu());let w=document.createElement("span");return w.innerHTML=`${Pe($e(_.getValue({region:v?.market_region,multiplier:b})),!0)}`,w.classList.add("item_value","item_controls"),c.appendChild(w),o.appendChild(c),typeof s<"u"&&o.classList.add("item_to_trade"),o}function Xi(){Object.keys(qi).forEach(function(e){let t;r.equipment[e]==null?(t=document.createElement("span"),t.classList.add("item_tooltip"),qi[e].innerHTML=`${e} slot`,qi[e].classList.add("equipment_slot_empty"),t.innerHTML=`Your ${e} slot`):(qi[e].innerHTML=r.equipment[e].getName(),qi[e].classList.remove("equipment_slot_empty"),t=Ji(r.equipment[e])),qi[e].appendChild(t)})}function Ya(e){let t=d[e],i=t.getInventoryKey();D[t.name].is_finished?(te[i].classList.add("book_finished"),te[i].classList.remove("book_active")):qo()===t.name?te[i].classList.add("book_active"):te[i].classList.remove("book_active"),te[i].getElementsByClassName("item_tooltip")[0].remove(),te[i].getElementsByClassName("item_book")[0].appendChild(Ji(t))}function Xs(){for(let e=0;e<8;e++)if(e<j.length){Qe.children[e].children[0].style.display=null,Qe.children[e].children[0].children[0].innerHTML=j[e].name;let t;j[e].stats.attack_speed>20?t=Math.round(j[e].stats.attack_speed):j[e].stats.attack_speed>2?t=Math.round(j[e].stats.attack_speed*10)/10:t=Math.round(j[e].stats.attack_speed*100)/100;let i=j.filter(o=>o.is_alive).length**(-1/4);j[e].size==="small"&&(i*=A({scaling_type:"multiplicative",skill_id:"Pest killer"}));let n=j.filter(o=>o.is_alive).length**(-1/3);j[e].size==="large"&&(n*=A({scaling_type:"multiplicative",skill_id:"Giant slayer"}));let s=1-_n(r.stats.full.attack_points*i,j[e].stats.agility*Math.sqrt(j[e].stats.intuition??1)),a=_n(j[e].stats.dexterity*Math.sqrt(j[e].stats.intuition??1),r.stats.full.evasion_points*n);r.equipment["off-hand"]?.offhand_type==="shield"&&(a=1),Qe.children[e].children[0].children[1].children[0].innerHTML=`Atk: ${j[e].stats.attack}dmg`,j[e].stats.attack_count>1&&(Qe.children[e].children[0].children[1].children[0].innerHTML+=` x${j[e].stats.attack_count}`),Qe.children[e].children[0].children[1].children[1].innerHTML=`Spd: ${t}`,Qe.children[e].children[0].children[1].children[2].innerHTML=`Hit: ${Math.min(100,Math.max(0,Math.round(100*a)))}%`,Qe.children[e].children[0].children[1].children[3].innerHTML=`Ddg: ${Math.min(100,Math.max(0,Math.round(100*s)))}%`,Qe.children[e].children[0].children[1].children[4].innerHTML=`Def: ${j[e].stats.defense}`}else Qe.children[e].children[0].style.display="none"}function Zs(){for(let e=0;e<j.length;e++)j[e].is_alive?Qe.children[e].children[0].style.filter="brightness(100%)":(Qe.children[e].children[0].style.filter="brightness(30%)",Xs()),Qe.children[e].children[0].children[2].children[0].children[0].style.width=Math.max(0,100*j[e].stats.health/j[e].stats.max_health)+"%",Qe.children[e].children[0].children[2].children[1].innerText=`${Math.ceil(j[e].stats.health)}/${Math.ceil(j[e].stats.max_health)} hp`}function Va(e){if(Ki(),Fa.innerHTML="",Rl.style.display="none",Gs.innerText="",document.documentElement.style.setProperty("--location_desc_tooltip_visibility","hidden"),Fs.style.display="none",document.documentElement.style.setProperty("--actions_div_height",getComputedStyle(document.body).getPropertyValue("--actions_div_height_default")),document.documentElement.style.setProperty("--actions_div_top",getComputedStyle(document.body).getPropertyValue("--actions_div_top_default")),Gl.click(),Mi.style.pointerEvents="none",Mi.style.cursor="default",Mi.style.color="gray",jl.innerText=v.name,document.getElementById("location_description_div").innerText=v.getDescription(),aa(e),Se.is_crafting_unlocked&&e.crafting?.is_unlocked){let c=document.createElement("div");c.classList.add("location_choices","choice_craft"),c.setAttribute("onclick","openCraftingWindow()"),c.innerHTML=`<i class="material-icons">construction</i> ${e.crafting.use_text}`,U.appendChild(c)}if(e.housing?.is_unlocked){let c=document.createElement("div");c.innerHTML='<i class="material-icons">bed</i>  '+e.housing.text_to_sleep,c.id="start_sleeping_div",c.setAttribute("onclick","start_sleeping()");let _=document.createElement("div");_.innerHTML='<i class="material-icons">inventory_2</i>  Open your personal chest',_.id="open_storage_div",_.setAttribute("onclick","openStorage()"),U.appendChild(c),U.appendChild(_)}e.dialogues.filter(c=>{if(!q[c].is_unlocked||q[c].is_finished)return!1;{let _=!1;return Object.keys(q[c].textlines).forEach(h=>{_||(_=q[c].textlines[h].is_unlocked&&!q[c].textlines[h].is_finished)}),_}}).length>0&&(be.dialogues=ai({name:"Talk to someone",icon:"question_answer",class_name:"choice_dialogue"}),be.dialogues.append(...Gt({location:e,category:"talk"}))),e.traders.filter(c=>P[c].is_unlocked&&!P[c].is_finished).length>0&&(be.traders=ai({name:"Visit a merchant",icon:"storefront",class_name:"choice_trade"}),be.traders.append(...Gt({location:e,category:"trade"}))),Object.values(e.activities).filter(c=>x[c.activity_name].type==="JOB"&&x[c.activity_name].is_unlocked&&c.is_unlocked&&x[c.activity_name].base_skills_names.filter(_=>!p[_].is_unlocked).length==0).length>0&&(be.jobs=ai({name:"Find work",icon:"work_outline",class_name:"choice_work"}),be.jobs.append(...Gt({location:e,category:"work"}))),Object.values(e.activities).filter(c=>x[c.activity_name].type==="TRAINING"&&x[c.activity_name].is_unlocked&&c.is_unlocked&&x[c.activity_name].base_skills_names.filter(_=>!p[_].is_unlocked).length==0).length>0&&(be.trainings=ai({name:"Train",icon:"fitness_center",class_name:"choice_train"}),be.trainings.append(...Gt({location:e,category:"train"}))),Se.is_gathering_unlocked&&Object.values(e.activities).filter(_=>x[_.activity_name].type==="GATHERING"&&x[_.activity_name].is_unlocked&&_.is_unlocked&&x[_.activity_name].base_skills_names.filter(h=>!p[h].is_unlocked).length==0).length>0&&(be.gatherings=ai({name:"Gather resources",icon:"search",class_name:"choice_gather"}),be.gatherings.append(...Gt({location:e,category:"gather"}))),Object.values(e.actions).filter(c=>c.is_unlocked&&!c.is_finished).length>0&&(be.actions=ai({name:"Take an action",icon:"circle",class_name:"choice_action"}),be.actions.append(...Gt({location:e,category:"action"}))),e.connected_locations.filter(c=>c.location.is_unlocked&&!c.location.is_finished&&!c.location.is_challenge).length>0&&(be.locations=ai({name:"Move somewhere else",icon:"directions",class_name:"choice_travel"}),be.locations.append(...Gt({location:e,category:"travel"}))),e.connected_locations.filter(c=>c.location.is_challenge&&c.location.is_unlocked&&!c.location.is_finished).length>0&&(be.challenges=ai({name:"Take on a challenge",icon:"warning_amber",class_name:"choice_travel"}),be.challenges.append(...Gt({location:e,category:"challenge"}))),[...Object.keys(at).filter(c=>c!==v.id),...Object.keys(Ln).filter(c=>c!==v.id&&m[c].is_unlocked&&!m[c].is_finished)].length+(qt?1:0)>0&&(be.fast_travel=ai({name:"Fast travel",icon:"directions",class_name:"choice_travel"}),be.fast_travel.append(...Gt({location:e,category:"fast_travel"}))),U.append(...Object.values(be))}function aa(){v.housing&&v.housing.is_unlocked?As.innerHTML='<i class="material-icons location_bed_icon">bed</i>':at[v.id]?As.innerHTML='<i class="material-icons">star</i>':As.innerHTML='<i class="material-icons">star_border</i>'}function ai({name:e,icon:t,class_name:i}){let n=document.createElement("div");return n.innerHTML=`<i class="material-icons">${t}</i> ${e}`,n.classList.add("location_choice_dropdown",i),n.addEventListener("click",s=>{let a=s.target;a.classList.contains("material-icons")&&(a=a.parentNode),a.classList.contains("location_choice_dropdown")&&(a.classList.toggle("location_choice_dropdown_expanded"),a.classList.contains("location_choice_dropdown_expanded")&&a.scrollIntoView({block:"end",inline:"nearest",behavior:"smooth"}))}),n}function Gt({location:e,category:t,is_combat:i=!1}){let n=[];if(t==="talk")for(let s=0;s<e.dialogues.length;s++){if(!q[e.dialogues[s]].is_unlocked||q[e.dialogues[s]].is_finished||!(e.dialogues.filter(l=>{let u=!1;return Object.keys(q[l].textlines).forEach(c=>{u||(u=q[l].textlines[c].is_unlocked&&!q[l].textlines[c].is_finished)}),u}).length>0))continue;let o=document.createElement("div");o.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+q[e.dialogues[s]].starting_text,o.classList.add("start_dialogue","location_choice"),o.setAttribute("data-dialogue",e.dialogues[s]),o.setAttribute("onclick","start_dialogue(this.getAttribute('data-dialogue'));"),n.push(o)}else if(t==="trade")for(let s=0;s<e.traders.length;s++){if(!P[e.traders[s]].is_unlocked||P[e.traders[s]].is_finished)continue;let a=document.createElement("div");a.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+P[e.traders[s]].trade_text,a.classList.add("start_trade","location_choice"),a.setAttribute("data-trader",e.traders[s]),a.setAttribute("onclick","startTrade(this.getAttribute('data-trader'));"),n.push(a)}else if(t==="work")Object.keys(e.activities).forEach(s=>{if(!x[e.activities[s].activity_name]?.is_unlocked||!e.activities[s]?.is_unlocked||x[e.activities[s].activity_name].type!=="JOB")return;let a=document.createElement("div");a.classList.add("activity_div","location_choice"),a.setAttribute("data-activity",s),a.setAttribute("onclick","start_activity(this.getAttribute('data-activity'));"),In(e.activities[s])?a.classList.add("start_activity"):a.classList.add("activity_unavailable");let o=document.createElement("div");if(o.classList.add("job_tooltip"),!e.activities[s].infinite&&(e.activities[s].availability_time&&(o.innerHTML=`Available from ${e.activities[s].availability_time.start} to ${e.activities[s].availability_time.end} <br>`),e.activities[s].availability_seasons))if(e.activities[s].availability_seasons.length===3){let l=Ai.filter(u=>!e.activities[s].availability_seasons.includes(u));o.innerHTML+=`Not available during ${l.toString().replaceAll(",",", ")} <br>`}else o.innerHTML+=`Available during ${e.activities[s].availability_seasons.toString().replaceAll(",",", ")} <br>`;o.innerHTML+=`Pays ${Pe(e.activities[s].get_payment())} per every ${Rn(e.activities[s].working_period)} worked`,a.appendChild(o),a.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+e.activities[s].starting_text,n.push(a)});else if(t==="train")Object.keys(e.activities).forEach(s=>{if(!x[e.activities[s].activity_name]?.is_unlocked||!e.activities[s]?.is_unlocked||x[e.activities[s].activity_name].type!=="TRAINING"||x[e.activities[s].activity_name].base_skills_names.filter(o=>!p[o].is_unlocked).length>0)return;let a=document.createElement("div");if(a.classList.add("activity_div","start_activity","location_choice"),a.setAttribute("data-activity",s),a.setAttribute("onclick","start_activity(this.getAttribute('data-activity'));"),e.activities[s].availability_seasons){let o=document.createElement("div");if(o.classList.add("job_tooltip"),e.activities[s].availability_seasons.length===3){let l=Ai.filter(u=>!e.activities[s].availability_seasons.includes(u));o.innerHTML=`Not available during ${l.toString().replaceAll(",",", ")} <br>`}else o.innerHTML=`Available during ${e.activities[s].availability_seasons.toString().replaceAll(",",", ")} <br>`;a.appendChild(o)}a.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+e.activities[s].starting_text,n.push(a)});else if(t==="gather")Object.keys(e.activities).forEach(s=>{if(!x[e.activities[s].activity_name]?.is_unlocked||!e.activities[s]?.is_unlocked||x[e.activities[s].activity_name].type!=="GATHERING"||x[e.activities[s].activity_name].base_skills_names.filter(o=>!p[o].is_unlocked).length>0)return;let a=document.createElement("div");a.classList.add("activity_div","start_activity","location_choice"),a.setAttribute("data-activity",s),a.setAttribute("onclick","start_activity(this.getAttribute('data-activity'));"),a.appendChild(ir(e.activities[s])),a.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+e.activities[s].starting_text,n.push(a)});else if(t==="travel"){if(i){let s=document.createElement("div");s.classList.add("travel_normal","action_travel","location_choice");let a=bt({time:{minutes:Mt[e.id][e.parent_location.id]}}),o="";a&&(o=" ["+a+"]"),e.leave_text?s.innerHTML=e.leave_text+o:s.innerHTML="Go back to ["+e.parent_location.name+"]"+o,s.setAttribute("data-travel",e.parent_location.id),s.setAttribute("onclick","change_location({location_id:this.getAttribute('data-travel')});"),n.push(s)}else for(let s=0;s<e.connected_locations.length;s++){if(!e.connected_locations[s].location.is_unlocked||e.connected_locations[s].location.is_finished||e.connected_locations[s].location.is_challenge)continue;let a=document.createElement("div"),o=bt({time:{minutes:Mt[e.id][e.connected_locations[s].location.id]}});"connected_locations"in e.connected_locations[s].location?(a.classList.add("travel_normal"),"custom_text"in e.connected_locations[s]?a.innerHTML=`<div class='location_choice_icon_box'><i class="material-icons location_choice_icon">check_box_outline_blank</i></div> `+e.connected_locations[s].custom_text+" ["+o+"]":a.innerHTML=`<div class='location_choice_icon_box'><i class="material-icons location_choice_icon">check_box_outline_blank</i></div> Go to [`+e.connected_locations[s].location.name+"] ["+o+"]"):(a.classList.add("travel_combat"),"custom_text"in e.connected_locations[s]?a.innerHTML=`<div class='location_choice_icon_box'><i class="material-icons">warning_amber</i></div> `+e.connected_locations[s].custom_text+" ["+o+"]":a.innerHTML=`<div class='location_choice_icon_box'><i class="material-icons">warning_amber</i></div>  Enter the [`+e.connected_locations[s].location.name+"] ["+o+"]"),a.classList.add("action_travel","location_choice"),a.setAttribute("data-travel",e.connected_locations[s].location.id),a.setAttribute("onclick","change_location({location_id: this.getAttribute('data-travel')});"),n.push(a)}if(Ei&&!e.housing?.is_unlocked&&!e.connected_locations){let s=m[Ei],a=document.createElement("div");a.classList.add("action_travel","travel_normal","location_choice");let o=bt({time:{minutes:Mt[e.id][s.id]}});i||(a.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '),o?a.innerHTML+=`Quick return to [${s.name}] [`+o+"]":a.innerHTML+=`Quick return to [${s.name}]`,a.setAttribute("data-travel",s.name),a.setAttribute("onclick","change_location({location_id:this.getAttribute('data-travel')});"),n.push(a)}n.sort((s,a)=>a.classList.contains("travel_normal")-s.classList.contains("travel_normal"))}else if(t==="challenge"){let s=e.connected_locations.filter(a=>a.location.is_challenge&&a.location.is_unlocked&&!a.location.is_finished);for(let a=0;a<s.length;a++){let o=document.createElement("div");o.classList.add("travel_combat","location_choice"),"custom_text"in s[a]?o.innerHTML='<i class="material-icons">warning_amber</i>  '+s[a].custom_text:o.innerHTML='<i class="material-icons">warning_amber</i>  Enter the '+s[a].location.name,o.classList.add("action_travel"),o.setAttribute("data-travel",s[a].location.id),o.setAttribute("onclick","change_location({location_id:this.getAttribute('data-travel')});"),n.push(o)}}else t==="action"?Object.keys(e.actions).forEach(s=>{if(e.actions[s].is_finished||!e.actions[s].is_unlocked)return;let a=document.createElement("div");a.classList.add("location_action_div","start_game_action","location_choice"),a.setAttribute("data-location_action",s),a.setAttribute("onclick","start_game_action(this.getAttribute('data-location_action'));"),a.appendChild(nu(e.actions[s])),a.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+e.actions[s].starting_text,n.push(a)}):t==="fast_travel"&&(n=tu());return n}function tu(){let e=[],t=[...Object.keys(at).filter(i=>i!==v.id),...Object.keys(Ln).filter(i=>i!==v.id&&m[i].is_unlocked&&!m[i].is_finished)];qt&&!t.includes(qt)&&t.push(qt),t=t.sort((i,n)=>m[i].housing?.is_unlocked&&!m[n].housing?.is_unlocked?-1:!m[i].housing?.is_unlocked&&m[n].housing?.is_unlocked?1:m[i].tags.safe_zone&&!m[n].tags.safe_zone?-1:!m[i].tags.safe_zone&&m[n].tags.safe_zone?1:0);for(let i=0;i<t.length;i++){if(!m[t[i]].is_unlocked||m[t[i]].is_finished||t[i]===v.id)continue;let n=document.createElement("div"),s=bt({time:{minutes:Mt[v.id][t[i]]}});if(m[t[i]].tags.safe_zone?(n.classList.add("travel_normal"),m[t[i]].housing?.is_unlocked?n.innerHTML='<i class="material-icons">bed</i> <span class="fast_travel_name">Travel to ['+m[t[i]].name+"] ["+s+"]</span>":n.innerHTML='<i class="material-icons location_choice_icon">check_box_outline_blank</i> <span class="fast_travel_name">Travel to ['+m[t[i]].name+"] ["+s+"]</span>",n.classList.add("action_travel","location_choice"),n.setAttribute("data-travel",m[t[i]].id),n.setAttribute("onclick","change_location({location_id:this.getAttribute('data-travel'), event});")):(n.classList.add("travel_combat"),n.innerHTML=`<i class="material-icons">warning_amber</i> <span class="fast_travel_name">Travel to [${m[t[i]].name}] [${s}] </span>`,n.classList.add("action_travel","location_choice"),n.setAttribute("data-travel",m[t[i]].id),n.setAttribute("onclick","change_location({location_id: this.getAttribute('data-travel'), event});")),!m[t[i]].housing?.is_unlocked&&m[t[i]].id!==qt){let a=document.createElement("span");a.innerHTML='<i class="material-icons fast_travel_removal_button">close</i>',a.setAttribute("onclick","remove_location_from_favourites({location_id:this.parentNode.getAttribute('data-travel')})"),n.appendChild(a)}e.push(n)}return e}function Qa({location_id:e}){if(!be.fast_travel)return;let t=be.fast_travel.querySelector(`[data-travel="${e}"`);t&&(e===qt||m[e].housing?.is_unlocked?t.getElementsByClassName("fast_travel_removal_button")[0].parentNode.remove():t.remove())}function Yl(e){document.documentElement.style.setProperty("--location_desc_tooltip_visibility","visible"),Ki(),Fa.innerHTML="";let t;aa(e),Fs.style.display="block",Rl.style.display="block",C.disable_combat_autoswitch||(Mi.click(),Mi.classList.add("active_selection_button"),Gl.classList.remove("active_selection_button")),Mi.style.pointerEvents="auto",Mi.style.cursor="pointer",Mi.style.color="white",document.documentElement.style.setProperty("--actions_div_height",getComputedStyle(document.body).getPropertyValue("--actions_div_height_combat")),document.documentElement.style.setProperty("--actions_div_top",getComputedStyle(document.body).getPropertyValue("--actions_div_top_combat")),Fs.children[0].children[1].innerHTML=e.enemy_count-e.enemy_groups_killed%e.enemy_count,t=Gt({location:e,category:"travel",is_combat:!0}),U.append(...t),jl.innerText=v.name,v.types.length==0?document.documentElement.style.setProperty("--location_name_div_width","390px"):document.documentElement.style.setProperty("--location_name_div_width","250px"),Gs.innerText=v.getDescription(),Gs.classList.add("location_tooltip"),document.getElementById("location_description_div").innerText=v.getDescription(),Vl(v)}function Vl(e){for(let t=0;t<e.types?.length;t++){let i=document.createElement("div");i.innerHTML=e.types[t].type+(e.types[t].stage>1?` ${"I".repeat(e.types[t].stage)}`:""),i.classList.add("location_type_div");let n=document.createElement("div");n.innerHTML=et[e.types[t].type].stages[e.types[t].stage].description,n.classList.add("location_type_tooltip");let{type:s,stage:a}=e.types[t],{effects:o}=et[s].stages[a];Object.keys(o||{}).length>0&&(n.innerHTML+="<br>",Object.keys(o).forEach(l=>{if(o[l].multiplier){let u=o[l].multiplier,c=Qn(s,a,l,"multiplier");n.innerHTML+=`<br>${We[l]} x${Math.round(1e3*c)/1e3}`,u!=c&&(n.innerHTML+=` [base: x${o[l].multiplier}]`)}if(o[l].flat){let u=o[l].flat,c=Qn(s,a,l,"flat");n.innerHTML+=`<br>${We[l]}: ${Math.round(1e3*c)/1e3}`,u!=c&&(n.innerHTML+=` [base: ${o[l].flat}]`)}})),i.appendChild(n),Fa.appendChild(i)}}function Ql(e){Fa.innerHTML="",Vl(e)}function Ul(){U.style.display="none",document.getElementById("crafting_window").style.display="block",(!Ks||!Ys)&&eo("crafting"),io()}function Kl(){U.style.display="block",document.getElementById("crafting_window").style.display="none",Va(v)}function eo(e){Ks=e;let t=document.getElementById("crafting_subpage_buttons").children;for(let i=0;i<t.length;i++)t[i].style.display=F[e][t[i].dataset.crafting_subcategory]?"":"none";t[0].click(),Xl()}function Jl(e){Ys=e;let t=document.querySelectorAll("[data-crafting_category][data-crafting_subcategory]");for(let i=0;i<t.length;i++)t[i].dataset.crafting_category==Ks&&t[i].dataset.crafting_subcategory==Ys?t[i].style.display="":t[i].style.display="none";Xl()}function Xl(){let e=["selected_recipe","selected_component_list","selected_component_category"];for(let t=0;t<e.length;t++){let i=document.getElementsByClassName(e[t]);for(let n=0;n<i.length;n++)i[n].classList.remove(e[t])}}function Zl(e,t){if(Ue[e]||(Ue[e]={}),Ue[e][t]||(Ue[e][t]=document.querySelector(`[data-crafting_category="${e}"][data-crafting_subcategory="${t}"]`)),!Ue[e][t]){let i=document.createElement("div");i.classList.add("crafting_category"),i.classList.add("crafting_recipe_list"),i.dataset.crafting_category=e,i.dataset.crafting_subcategory=t,Ue[e][t]=document.getElementById("recipe_categories").appendChild(i)}return Ue[e][t]}function to(){Object.keys(F).forEach(e=>{Object.keys(F[e]).forEach(t=>{t==="items"&&(Zl(e,t).innerHTML=""),Object.keys(F[e][t]).forEach(i=>{er({category:e,subcategory:t,recipe_id:i})})})}),so()}function er({category:e,subcategory:t,recipe_id:i}){let n=F[e][t][i];if(!n.is_unlocked)return;let s=document.createElement("div"),a=document.createElement("span");if(a.innerHTML=n.name,s.append(a),s.classList.add("recipe_div"),s.dataset.recipe_id=i,t==="items"){a.classList.add("recipe_item_name"),s.children[0].innerHTML='<i class="material-icons icon" style="visibility:hidden"> keyboard_double_arrow_down </i>'+s.children[0].innerHTML,n.get_availability().available_ammount||s.classList.add("recipe_unavailable"),s.addEventListener("click",_=>{_.target.classList.contains("recipe_item_name")&&!_.target.parentNode.classList.contains("recipe_unavailable")?window.useRecipe(_.target):_.target.classList.contains("craft_ammount_button")&&window.useRecipe(_.target.parentNode,Number(_.target.dataset.craft_ammount))});let o=document.createElement("div");o.classList.add("craft_ammount_buttons");let l=document.createElement("div");l.innerHTML="5",l.dataset.craft_ammount=5,l.classList.add("craft_ammount_button"),o.append(l);let u=document.createElement("div");u.innerHTML="10",u.dataset.craft_ammount=10,u.classList.add("craft_ammount_button"),o.append(u);let c=document.createElement("div");c.innerHTML="all",c.dataset.craft_ammount=1/0,c.classList.add("craft_ammount_button"),o.append(c),s.append(o),s.append(Vs({category:e,subcategory:t,recipe_id:i}))}else if(t==="components"){a.classList.add("recipe_name"),s.children[0].innerHTML='<i class="material-icons icon crafting_dropdown_icon"> keyboard_double_arrow_down </i>'+s.children[0].innerHTML;let o=document.createElement("div");o.classList.add("folded_material_list"),s.addEventListener("click",l=>{(l.target.classList.contains("recipe_name")||l.target.classList.contains("crafting_dropdown_icon"))&&(window.updateDisplayedMaterialChoice({category:e,subcategory:t,recipe_id:i}),Wa({element:s,class_name:"selected_recipe"}))}),s.append(o)}else if(n.recipe_type==="component"||n.recipe_type==="componentless"){a.classList.add("recipe_name"),n.item_type==="Armor"&&s.classList.add("clothing_recipe"),s.children[0].innerHTML='<i class="material-icons icon crafting_dropdown_icon"> keyboard_double_arrow_down </i>'+s.children[0].innerHTML;let o=document.createElement("div");o.classList.add("folded_material_list"),s.addEventListener("click",l=>{(l.target.classList.contains("recipe_name")||l.target.classList.contains("crafting_dropdown_icon"))&&(Pa("selected_component_list"),Pa("selected_component_category"),window.updateDisplayedMaterialChoice({category:e,subcategory:t,recipe_id:i}),Wa({element:s,class_name:"selected_recipe"}))}),s.append(o)}else if(t==="equipment"){n.item_type==="Armor"?s.classList.add("armor_recipe"):n.item_type==="Weapon"?s.classList.add("weapon_recipe"):n.item_type==="Shield"?s.classList.add("shield_recipe"):console.warn(`Recipe "${e}" -> "${t}" -> "${i}" has wrong type of resulting item ("${n.item_type}")`),a.classList.add("recipe_name"),s.children[0].innerHTML='<i class="material-icons icon crafting_dropdown_icon"> keyboard_double_arrow_down </i>'+s.children[0].innerHTML;let o=document.createElement("div");o.innerHTML=`<span class="crafting_selection"><i class="material-icons icon subcrafting_dropdown_icon"> keyboard_double_arrow_down </i>Select a [${n.components[0]}]</span>`;let l=document.createElement("div");l.classList.add("folded_crafting_selection"),o.appendChild(l);let u=document.createElement("div");u.innerHTML=`<span class="crafting_selection"><i class="material-icons icon subcrafting_dropdown_icon"> keyboard_double_arrow_down </i>Select a [${n.components[1]}]</span>`;let c=document.createElement("div");c.classList.add("folded_crafting_selection"),u.appendChild(c);let _=document.createElement("div");_.append(o),_.append(u),s.addEventListener("click",k=>{(k.target.classList.contains("recipe_name")||k.target.classList.contains("crafting_dropdown_icon"))&&(Pa("selected_component_list"),Pa("selected_component_category"),Wa({element:s,class_name:"selected_recipe"}),window.updateDisplayedComponentChoice({category:e,subcategory:t,recipe_id:i}),Ui({category:e,subcategory:t,recipe_id:i,components:[]}))}),o.parentNode.children[0].addEventListener("click",k=>{(k.target.classList.contains("crafting_selection")||k.target.classList.contains("subcrafting_dropdown_icon"))&&(o.children[1].classList.toggle("selected_component_list"),o.children[0].classList.toggle("selected_component_category"),s.querySelectorAll(".folded_crafting_selection").item(0).lastChild&&!Us(s.querySelectorAll(".folded_crafting_selection").item(0).lastChild,document.getElementById("exit_crafting_button"))&&s.querySelectorAll(".folded_crafting_selection").item(0).lastChild.scrollIntoView({block:"end",inline:"nearest"}))}),u.parentNode.children[1].addEventListener("click",k=>{(k.target.classList.contains("crafting_selection")||k.target.classList.contains("subcrafting_dropdown_icon"))&&(u.children[1].classList.toggle("selected_component_list"),u.children[0].classList.toggle("selected_component_category"),Us(s.querySelector(".recipe_creation_button"),document.getElementById("exit_crafting_button"))||s.querySelector(".recipe_creation_button").scrollIntoView({block:"end",inline:"nearest"}))});let h=document.createElement("div");h.innerHTML="<span class='recipe_creation_span'>Create</span>",h.classList.add("recipe_creation_button");let f=document.createElement("div");f.classList.add("craft_ammount_buttons");let y=document.createElement("div");y.innerHTML="5",y.dataset.craft_ammount=5,y.classList.add("craft_ammount_button"),f.append(y);let b=document.createElement("div");b.innerHTML="10",b.dataset.craft_ammount=10,b.classList.add("craft_ammount_button"),f.append(b);let w=document.createElement("div");w.innerHTML="all",w.dataset.craft_ammount=1/0,w.classList.add("craft_ammount_button"),f.append(w),h.append(f),h.addEventListener("click",k=>{k.target.classList.contains("recipe_creation_button")?window.useRecipe(k.target):k.target.classList.contains("craft_ammount_button")?window.useRecipe(k.target.parentNode.parentNode,Number(k.target.dataset.craft_ammount)):window.useRecipe(k.target.parentNode)}),s.append(_),s.append(h),h.append(Vs({category:e,subcategory:t,recipe_id:i,components:[]}))}else throw new Error(`No such crafting subcategory as "${t}"`);Zl(e,t).appendChild(s)}function io(){Object.keys(F).forEach(e=>{Object.keys(F[e]).forEach(t=>{Object.keys(F[e][t]).forEach(i=>{F[e][t][i].is_unlocked&&(Ue[e][t].querySelector(`[data-recipe_id="${i}"]`)?iu({category:e,subcategory:t,recipe_id:i}):er({category:e,subcategory:t,recipe_id:i}))})})})}function iu({category:e,subcategory:t,recipe_id:i}){let n=Ue[e][t].querySelector(`[data-recipe_id="${i}"]`),s=F[e][t][i];t==="items"?(s.get_availability().available_ammount?n.classList.remove("recipe_unavailable"):n.classList.add("recipe_unavailable"),Ui({category:e,subcategory:t,recipe_id:i})):t==="components"||s.recipe_type==="component"?Ui({category:e,subcategory:t,recipe_id:i}):t==="equipment"||console.error(`No such crafting subcategory as "${t}"`)}function Vs({category:e,subcategory:t,recipe_id:i,material:n,components:s}){let a=F[e][t][i],o=document.createElement("div");if(o.classList.add("recipe_tooltip"),t==="items")o.innerHTML=xn({category:e,subcategory:t,recipe_id:i}),o.classList.add("items_recipe_tooltip");else if(t==="components"||a.recipe_type==="component"){if(!n)throw new Error(`Component recipes require passing a material, but recipe "${e}" -> "${t}" -> "${i}" had none!`);o.innerHTML=xn({category:e,subcategory:t,recipe_id:i,material:n}),o.classList.add("component_recipe_tooltip")}else t==="equipment"?(o.innerHTML=xn({category:e,subcategory:t,recipe_id:i,material:n,components:s}),o.classList.add("equipment_recipe_tooltip")):console.error(`No such crafting subcategory as "${t}"`);return o}function tr(){Object.keys(F).forEach(e=>{Object.keys(F[e]).forEach(t=>{t==="items"&&Object.keys(F[e][t]).forEach(i=>{F[e][t][i].is_unlocked&&Ui({category:e,subcategory:"items",recipe_id:i})})})})}function Ui({category:e,subcategory:t,recipe_id:i,components:n}){let s=F[e][t][i];if(t==="items"){let a=Ue[e][t].querySelector(`[data-recipe_id="${i}"]`).querySelector(`.${t}_recipe_tooltip`);a.innerHTML=xn({category:e,subcategory:t,recipe_id:i})}else if(t==="components"||s.recipe_type==="component"||s.recipe_type==="componentless"){let a=Ue[e][t].querySelector(`[data-recipe_id='${i}']`).children[1];for(let o=0;o<a.children.length;o++){let l=a.children[o].querySelector(`[data-recipe_id="${i}"]`)?.querySelector(`.${t}_recipe_tooltip`);if(!l)return;let u=a.children[o].dataset.item_key,{id:c}=JSON.parse(u),_=s.materials.filter(h=>h.material_id===c);l.innerHTML=xn({category:e,subcategory:t,recipe_id:i,material:_[0]})}}else if(t==="equipment"){let a=Ue[e][t].querySelector(`[data-recipe_id="${i}"]`)?.querySelector(`.${t}_recipe_tooltip`);if(!a)return;a.innerHTML=xn({category:e,subcategory:t,recipe_id:i,components:n})}else console.error(`No such crafting subcategory as "${t}"`)}function xn({category:e,subcategory:t,recipe_id:i,material:n,components:s}){let a=F[e][t][i],o=v?.crafting?.tiers[e]||1,l="";if(t==="items"){let u=Math.round(100*a.get_success_chance(o));l+=`Success chance: <b><span style="color:${u>74?"lime":u>49?"yellow":u>24?"orange":"red"}">${u}%</span></b><br><br>Materials required:<br>`;for(let _=0;_<a.materials.length;_++)if(a.materials[_].material_id){let h=d[a.materials[_].material_id].getInventoryKey();r.inventory[h]?.count>=a.materials[_].count?l+=`<span style="color:lime"><b>${d[a.materials[_].material_id].getName()} x${r.inventory[h]?.count||0}/${a.materials[_].count}</b></span><br>`:l+=`<span style="color:red"><b>${d[a.materials[_].material_id].getName()} x${r.inventory[h]?.count||0}/${a.materials[_].count}</b></span><br>`}else if(a.materials[_].material_type){let h=[];Object.keys(r.inventory).forEach(b=>{r.inventory[b].item.material_type===a.materials[_].material_type&&h.push(r.inventory[b])}),h=h.sort((b,w)=>b.item.getBaseValue()-w.item.getBaseValue());let f=!1,y="";for(let b=0;b<h.length;b++)h[b].count>=a.materials[_].count?(f=!0,y+=`<span style="color:lime"><b>${h[b].item.getName()} x${h[b].count||0}/${a.materials[_].count}</b></span><br>`):y+=`<span style="color:red"><b>${h[b].item.getName()} x${h[b].count||0}/${a.materials[_].count}</b></span><br>`;h.length>0?(f?l+=`<span style="color:lime"><b>Any ${a.materials[_].material_type} x${a.materials[_].count}:</b></span><br>`:l+=`<span style="color:red"><b>Any ${a.materials[_].material_type} x${a.materials[_].count}:</b></span><br>`,l+=`<div class="crafting_tooltip_mat_list">${y}</div>`):l+=`<span style="color:red"><b>Any ${a.materials[_].material_type} x${a.materials[_].count}:</b></span><br>`}let c=vt({category:e,subcategory:t,recipe_id:i});l+=`<br>XP value: ${c}`,l+=`<br>Result:<br><div class="recipe_result">${kn({item:d[a.getResult().result_id],options:{skip_quality:!0,anchor_tooltip:!0}})}</div>`}else if(t==="components"||a.recipe_type==="component"){l+="Material required:<br>",r.inventory[d[n.material_id].getInventoryKey()]?.count>=n.count?l+=`<span style="color:lime"><b>${d[n.material_id].getName()} x${r.inventory[d[n.material_id].getInventoryKey()]?.count||0}/${n.count}</b></span><br>`:l+=`<span style="color:red"><b>${d[n.material_id].getName()} x${r.inventory[d[n.material_id].getInventoryKey()]?.count||0}/${n.count}</b></span><br>`;let u=a.get_quality_range(o-d[n.result_id].component_tier),c=vt({category:e,subcategory:t,recipe_id:i,material_count:n.count,result_tier:d[n.result_id].component_tier,rarity_multiplier:ke[Ke(u[0])]}),_=vt({category:e,subcategory:t,recipe_id:i,material_count:n.count,result_tier:d[n.result_id].component_tier,rarity_multiplier:ke[Ke(u[1])]});l+=`<br>XP value: ${c} - ${_}<br>`,l+=`<br>Result:<br><div class="recipe_result">${kn({item:d[n.result_id],options:{quality:u}})}</div>`}else if(t==="equipment")if(s)if(s.length<2)l+='Result:<br><div class="recipe_result">Select one component from each category</div>';else if(s.length==2){let u="";if(a.item_type==="Weapon")u=new fe({components:{head:s[0].item.id,handle:s[1].item.id}});else if(a.item_type==="Armor")u=new Q({components:{internal:s[0].item.id,external:s[1].item.id}});else if(a.item_type==="Shield")u=new Ze({components:{shield_base:s[0].item.id,handle:s[1].item.id}});else throw new Error(`Recipe "${e}" -> "${t}" -> "${i}" has an incorrect item type "${a.item_type}"`);let c=a.get_quality_range(a.get_component_quality_weighted(s[0].item,s[1].item),o-Math.max(s[0].item.component_tier,s[1].item.component_tier)||0),_=vt({category:e,subcategory:t,recipe_id:i,selected_components:[d[s[0].item.id],d[s[1].item.id]],rarity_multiplier:ke[Ke(c[0])]}),h=vt({category:e,subcategory:t,recipe_id:i,selected_components:[d[s[0].item.id],d[s[1].item.id]],rarity_multiplier:ke[Ke(c[1])]});l+=`<br>XP value: ${_} - ${h}<br>`,l+=`Result:<br><div class="recipe_result">${kn({item:u,options:{quality:c}})}</div>`}else throw new Error(`Somehow recipe "${e}" -> "${t}" -> "${i}" received more components than there should be (${s.length} instead of 2)`);else{l+="Material required:<br>",r.inventory[d[n.material_id].getInventoryKey()]?.count>=n.count?l+=`<span style="color:lime"><b>${d[n.material_id].getName()} x${r.inventory[d[n.material_id].getInventoryKey()]?.count||0}/${n.count}</b></span><br>`:l+=`<span style="color:red"><b>${d[n.material_id].getName()} x${r.inventory[d[n.material_id].getInventoryKey()]?.count||0}/${n.count}</b></span><br>`;let u=a.get_quality_range(o-d[n.result_id].item_tier),c=vt({category:e,subcategory:t,recipe_id:i,material_count:n.count,result_tier:d[n.result_id].item_tier,rarity_multiplier:ke[Ke(u[0])]}),_=vt({category:e,subcategory:t,recipe_id:i,material_count:n.count,result_tier:d[n.result_id].item_tier,rarity_multiplier:ke[Ke(u[1])]});l+=`<br>XP value: ${c} - ${_}<br>`,l+=`<br>Result:<br><div class="recipe_result">${kn({item:d[n.result_id],options:{quality:u}})}</div>`}else console.error(`No such crafting subcategory as "${t}"`);return l}function no({category:e,recipe_id:t,component_keys:i={}}){let n=Ue[e].equipment.querySelector(`[data-recipe_id="${t}"]`),s=F[e].equipment[t],a=Ue[e].equipment.querySelector(`[data-recipe_id='${t}']`).children[1].children;a[0].children[1].innerHTML="",a[1].children[1].innerHTML="";let o=[];o.push(Object.values(r.inventory).filter(l=>s.components[0]===l.item.component_type)),o.push(Object.values(r.inventory).filter(l=>s.components[1]===l.item.component_type));for(let l=0;l<2;l++)for(let u=0;u<o[l].length;u++){let c=document.createElement("div");c.innerHTML=`<i class="material-icons icon selected_component_icon"> check </i>${o[l][u].item.name}, ${o[l][u].item.quality}%, x${o[l][u].count}`,c.classList.add("selectable_component"),c.dataset.item_key=o[l][u].item.getInventoryKey(),c.dataset.item_quality=o[l][u].item.quality,c.dataset.item_name=o[l][u].item.getName(),c.dataset.component_tier=o[l][u].item.component_tier,c.appendChild(Ji(o[l][u].item,{class_name:"recipe_tooltip"})),c.addEventListener("click",()=>{Wa({element:c,siblings_only:!0,class_name:"selected_component"});let _=[],h=n.children[1].children[0].children[1].querySelector(".selected_component")?.dataset.item_key;h&&_.push(r.inventory[h]);let f=n.children[1].children[1].children[1].querySelector(".selected_component")?.dataset.item_key;f&&_.push(r.inventory[f]),Ui({category:e,subcategory:"equipment",recipe_id:t,components:_})}),a[l].children[1].appendChild(c),i[c.dataset.item_key]&&c.click()}Us(n.querySelector(".recipe_creation_button"),document.getElementById("exit_crafting_button"))||n.querySelector(".recipe_creation_button").scrollIntoView({block:"end",inline:"nearest"});for(let l=0;l<2;l++)[...a[l].children[1].children].sort((u,c)=>Number.parseInt(u.dataset.component_tier)>Number.parseInt(c.dataset.component_tier)?-1:Number.parseInt(u.dataset.component_tier)<Number.parseInt(c.dataset.component_tier)||u.dataset.item_name>c.dataset.item_name?1:u.dataset.item_name<c.dataset.item_name||Number.parseInt(u.dataset.item_quality)>Number.parseInt(c.dataset.item_quality)?-1:1).forEach(u=>a[l].children[1].appendChild(u))}function ao({category:e,subcategory:t,recipe_id:i,refreshing:n}){let s=F[e][t][i],a=Ue[e][t].querySelector(`[data-recipe_id='${i}']`).children[1];a.innerHTML="";let o=Object.values(r.inventory).filter(l=>s.materials.filter(u=>u.material_id===l.item?.id).length>0);for(let l=0;l<o.length;l++){let u=s.materials.filter(w=>w.material_id===o[l].item.id)[0],c=document.createElement("div"),_=document.createElement("span");_.innerHTML=`<i class="material-icons icon selected_material_icon"> check </i>${d[u.result_id].getName()}`,_.classList.add("recipe_comp_name"),c.append(_),c.classList.add("selectable_material"),c.dataset.item_key=o[l].item.getInventoryKey(),u.count<=o[l].count?c.addEventListener("click",w=>{c.classList.add("selected_material"),w.target.classList.contains("selectable_material")?window.useRecipe(w.target.parentNode):w.target.classList.contains("craft_ammount_button")?window.useRecipe(w.target.parentNode.parentNode.parentNode,Number(w.target.dataset.craft_ammount)):window.useRecipe(w.target.parentNode.parentNode),c.classList.remove("selected_material")}):c.classList.add("recipe_unavailable");let h=document.createElement("div");h.classList.add("craft_ammount_buttons");let f=document.createElement("div");f.innerHTML="5",f.dataset.craft_ammount=5,f.classList.add("craft_ammount_button"),h.append(f);let y=document.createElement("div");y.innerHTML="10",y.dataset.craft_ammount=10,y.classList.add("craft_ammount_button"),h.append(y);let b=document.createElement("div");b.innerHTML="all",b.dataset.craft_ammount=1/0,b.classList.add("craft_ammount_button"),h.append(b),c.append(h),c.append(Vs({category:e,subcategory:t,recipe_id:i,material:u})),a.appendChild(c)}n||a.lastChild?.scrollIntoView()}function so(){Object.keys(F).forEach(e=>{Object.keys(F[e]).forEach(t=>{t==="items"&&Object.keys(F[e][t]).forEach(i=>{if(!F[e][t][i].is_unlocked)return;let n=Ue[e][t].querySelector(`[data-recipe_id="${i}"`);F[e][t][i].get_availability().available_ammount?n.classList.remove("recipe_unavailable"):n.classList.add("recipe_unavailable")})})})}function nu(e){let t=document.createElement("div");return t.id="location_action_tooltip",t.classList.add("job_tooltip"),t.innerHTML=e.description,t}function ir(e){let t=document.createElement("div");t.classList.add("job_tooltip"),t.dataset.job_tooltip=e.activity_id;let{gathering_time_needed:i,gained_resources:n}=e.getActivityEfficiency(),s="";for(let a=0;a<x[e.activity_name].base_skills_names.length;a++)s+=p[x[e.activity_name].base_skills_names[a]].name();e.gained_resources.scales_with_skill&&(t.innerHTML=`<span class="activity_efficiency_info">Efficiency scaling:<br>"${s}" skill lvl ${e.gained_resources.skill_required[0]} to ${e.gained_resources.skill_required[1]}</span><br><br>`),t.innerHTML+=`Every ${bt({time:{minutes:i},round:!1})}, chance to find:`;for(let a=0;a<n.length;a++){let o=d[n[a].name].getName();t.innerHTML+=`<br>x${n[a].count[0]===n[a].count[1]?n[a].count[0]:`${n[a].count[0]}-${n[a].count[1]}`} "${o}" at ${Math.round(100*n[a].chance)}%`}return t}function Ua(e){let t=document.querySelector(`[data-activity="${e.activity_id}"]`),i;if(t?i=t.getElementsByClassName("job_tooltip")[0]:i=document.getElementById("gathering_progress_bar_max")?.querySelector(`[data-job_tooltip="${e.activity_id}"]`),!i)return;let{gathering_time_needed:n,gained_resources:s}=e.getActivityEfficiency(),a="";for(let o=0;o<x[e.activity_name].base_skills_names.length;o++)a+=p[x[e.activity_name].base_skills_names[o]].name();e.gained_resources.scales_with_skill&&(i.innerHTML=`<span class="activity_efficiency_info">Efficiency scaling:<br>"${a}" skill lvl ${e.gained_resources.skill_required[0]} to ${e.gained_resources.skill_required[1]}</span><br><br>`),i.innerHTML+=`Every ${Rn(n)}, chance to find:`;for(let o=0;o<s.length;o++)i.innerHTML+=`<br>x${s[o].count[0]===s[o].count[1]?s[o].count[0]:`${s[o].count[0]}-${s[o].count[1]}`} "${s[o].name}" at ${Math.round(100*s[o].chance)}%`}function ri(){Fc.innerText=Math.ceil(r.stats.full.health)+"/"+Math.ceil(r.stats.full.max_health)+" hp",zc.style.width=(r.stats.full.health*100/r.stats.full.max_health).toString()+"%"}function Zi(){Dc.innerText=Math.round(r.stats.full.stamina)+"/"+Math.round(r.stats.full.max_stamina)+" stamina",Yc.style.width=(r.stats.full.stamina*100/r.stats.full.max_stamina).toString()+"%"}function Ka(){Object.keys(Vi).forEach(function(n){n==="crit_rate"||n==="crit_multiplier"?Vi[n].innerHTML=`${(r.stats.full[n]*100).toFixed(1)}%`:n==="attack_speed"?Vi[n].innerHTML=`${r.get_attack_speed().toFixed(1)}`:n==="attack_power"?Vi[n].innerHTML=`${r.get_attack_power().toFixed(1)}`:Vi[n].innerHTML=`${r.stats.full[n].toFixed(1)}`,Ns(n)});let e=document.getElementById("attack_stats"),t=Math.round(r.stats.full.attack_points);if(si.attack_points.innerHTML=`${t}`,r.equipment["off-hand"]!=null&&r.equipment["off-hand"].offhand_type==="shield"){let n=(r.stats.full.block_chance*100).toFixed(1);si.defensive_action.innerHTML="Block :",si.defensive_points.innerHTML=`${n}%`,si.defensive_points.parentNode.children[2].children[0].innerHTML="Chance to block an attack",e.children[3].innerHTML=`Block : ${Math.round(n)}%`}else{let n=Math.round(r.stats.full.evasion_points);si.defensive_action.innerHTML="EP : ",si.defensive_points.innerHTML=`${n}`,si.defensive_points.parentNode.children[2].children[0].innerHTML="Evasion points, a total value of everything that contributes to the evasion chance, except for some situational skills and modifiers",e.children[3].innerHTML=`EP: ${Math.round(n)} `}Ns("defensive_points"),Ns("attack_points"),au();let i=r.get_attack_power();i>100?i=Math.round(i):i=Math.round(10*i)/10,e.children[0].innerHTML=`Atk: ${i}`,e.children[1].innerHTML=`Spd: ${Math.round(r.get_attack_speed()*100)/100}`,e.children[2].innerHTML=`AP:  ${Math.round(t)}`,e.children[4].innerHTML=`Def: ${Math.round(r.stats.full.defense)} `}function Ns(e){let t;if(Vi[e])t=Vi[e].parentNode.children[2].children[1];else if(si[e]&&e!=="defensive_action")t=si[e].parentNode.children[2].children[1];else return;t.innerHTML=zt(e)}function au(){su(),nr(),ar()}function su(){yn.innerHTML="<b>Max health:</b> "+Math.round(r.stats.full.max_health)+"<br>",yn.innerHTML+=zt("max_health"),yn.innerHTML+="<br>------------------------<br><b>Health regen (flat):</b> "+Math.round(10*r.stats.full.health_regeneration_flat)/10+"<br>",yn.innerHTML+=zt("health_regeneration_flat"),yn.innerHTML+="<br>------------------------<br><b>Health regen (%):</b> "+Math.round(10*r.stats.full.health_regeneration_percent)/10+"<br>",yn.innerHTML+=zt("health_regeneration_percent")}function nr(){xi.innerHTML="<b>Max stamina:</b> "+Math.round(r.stats.full.max_stamina)+"<br>",xi.innerHTML+=zt("max_stamina"),xi.innerHTML+="<br>------------------------<br><b>Stamina efficiency:</b> "+Math.round(100*r.stats.full.stamina_efficiency)/100+"<br>",xi.innerHTML+=zt("stamina_efficiency"),xi.innerHTML+="<br>------------------------<br><b>Stamina regen (flat):</b> "+Math.round(10*r.stats.full.stamina_regeneration_flat)/10+"<br>",xi.innerHTML+=zt("stamina_regeneration_flat"),xi.innerHTML+="<br>------------------------<br><b>Stamina regen (%):</b> "+Math.round(10*r.stats.full.stamina_regeneration_percent)/10+"<br>",xi.innerHTML+=zt("stamina_regeneration_percent")}function ar(){wn.innerHTML="<b>Global xp multiplier:</b> "+Math.round(100*r.xp_bonuses.total_multiplier.all)/100+"<br>",wn.innerHTML+=js("all",!1),wn.innerHTML+="<br>------------------------<br><b>Hero xp multiplier:</b> "+Math.round(100*r.xp_bonuses.total_multiplier.hero)/100+" (with global: "+Math.round(Er()*100)/100+")<br>",wn.innerHTML+=js("hero",!1),wn.innerHTML+="<br>------------------------<br><b>Skill xp multiplier:</b> "+Math.round(100*r.xp_bonuses.total_multiplier.all_skill)/100+" (with global: "+Math.round($r()*100)/100+")<br>",wn.innerHTML+=js("all_skill",!1)}function zt(e){let t="";return e==="attack_power"?t+=`<br>Breakdown:
        <br>Base value (weapon * str/10): ${Math.round(100*r.stats.total_flat.attack_power)/100}`:e==="attack_points"?t+=`<br>Breakdown:
        <br>Base value: ${Math.round(100*r.stats.total_flat.attack_points)/100}`:e==="defensive_points"?(r.equipment["off-hand"]!=null&&r.equipment["off-hand"].offhand_type==="shield"?e="block_chance":e="evasion_points",t+=`<br>Breakdown:
            <br>Base value: ${Math.round(100*r.stats.total_flat[e])/100}`):t+=`<br>Breakdown:
        <br>Base value: ${Math.round(100*r.base_stats[e])/100}`,Object.keys(r.stats.flat).forEach(i=>{if(r.stats.flat[i][e]&&r.stats.flat[i][e]!==0){let n=r.stats.flat[i][e]>=0?"+":"";t+=`<br>${mt(i.replace("_"," "))}: ${n}${Math.round(100*r.stats.flat[i][e])/100}`}}),Object.keys(r.stats.multiplier).forEach(i=>{r.stats.multiplier[i][e]&&r.stats.multiplier[i][e]!==1&&(t+=`<br>${mt(i.replace("_"," "))}: x${Math.round(100*r.stats.multiplier[i][e])/100}`)}),t}function js(e,t){let i="",n=1;return t&&e!=="all"&&(e!=="all_skill"&&e!=="hero"?n=ko(e):n*=r.xp_bonuses.total_multiplier.all||1),i+=`<br>Breakdown:
        <br>Base value: ${Math.round(100*n)/100}`,Object.keys(r.xp_bonuses.multiplier).forEach(s=>{r.xp_bonuses.multiplier[s]?.[e]&&r.xp_bonuses.multiplier[s]?.[e]!==1&&(i+=`<br>${mt(s.replace("_"," "))}: x${Math.round(100*r.xp_bonuses.multiplier[s][e])/100}`)}),i}function Mn(){let e=Object.keys(pe).length;Qc.innerText=e,e>0?(Hs.innerHTML="",Object.values(oi).forEach(t=>{t.remove()}),oi={},Object.values(pe).forEach(t=>{oi[t.name]=zl({effect_name:t.name,duration:t.duration,add_bonus:!0}),Hs.appendChild(oi[t.name])})):(Hs.innerHTML="No active effects",oi={}),oo()}function oo(){Object.keys(oi).forEach(e=>{pe[e]?.duration?oi[e].querySelector(".active_effect_duration").innerHTML=bt({time:{minutes:pe[e].duration},round:!1}):(oi[e].remove(),delete oi[e])})}function lo(){let e=M.getTimeOfDaySimple();Uc.innerHTML=M.toString()+", <b>"+e+"</b>"}function Ja(){let e=Aa(),t=C.use_uncivilised_temperature_scale?Fn(e):e,i=C.use_uncivilised_temperature_scale?"\xB0F":"\xB0C",n=e<Sn[0]-$i(),s="normal_temperature";n&&(s="cold_temperature"),t=t.toString(),t.includes(".")||(t+=".0"),v.is_under_roof?Zn.innerHTML=t+i:Ha()?e>0?Zn.innerHTML=`<span class="material-icons icon">cloud</span><span class="${s}">`+t+i+"</span>":Zn.innerHTML=`<span class="material-icons icon">ac_unit</span><span class="${s}">`+t+i+"</span>":Zn.innerHTML=`<span class="${s}">`+t+i+"</span>",Zn.appendChild(ou())}function ou(){let e=document.createElement("div");return e.id="temperature_tooltip",C.use_uncivilised_temperature_scale?(e.innerHTML=`Lowest tolerable temperature: <strong>${Math.round(10*Fn(ta-$i()))/10}</strong>`,e.innerHTML+=`<br>(<strong>${Math.round(10*Fn(ta))/10}</strong> base minus <strong>${Math.round(10*Fn($i())-320)/10}</strong> cold protection)<br>`,e.innerHTML+=zt("cold_tolerance"),e.innerHTML+="<br>Scale conversion: x1.8"):(e.innerHTML=`Lowest tolerable temperature: <strong>${Math.round(10*(ta-$i()))/10}</strong>`,e.innerHTML+=`<br>(<strong>${ta}</strong> base minus <strong>${Math.round(10*$i())/10}</strong> cold protection)<br>`,e.innerHTML+=zt("cold_tolerance")),e}function Pe(e){let t,i=e>=0?"":"-";return e=Math.abs(e),e>0?(t=e%10!=0?`${e%10}<span class="coin coin_wood">W</span>`:"",e>9&&(t=(Math.floor(e/10)%100!=0?`${Math.floor(e/10)%100}<span class="coin coin_copper">C</span>${t?" ":""}`:"")+t,e>999&&(t=(Math.floor(e/1e3)%100!=0?`${Math.floor(e/1e3)%100}<span class="coin coin_silver">S</span>${t?" ":""}`:"")+t,e>99999&&(t=`${Math.floor(e/1e5)}<span class="coin coin_gold">G</span>${t?" ":""}`+t))),i+t):"nothing"}function sr(e=!1){El.children[0].children[0].style.width=`${100*r.xp.current_xp/r.xp.xp_to_next_lvl}%`,El.children[1].innerText=`${Xt(r.xp.current_xp)} / ${Xt(r.xp.xp_to_next_lvl)} xp`,e&&(Vc.innerText=`Level: ${r.xp.current_level}`,ri())}function Xa(){ar()}function Za(){nr()}function ro(){Sl.reputation.innerHTML="",Object.keys(r.reputation).forEach(e=>{if(r.reputation[e]>0){let t=document.createElement("div"),i=document.createElement("span"),n=document.createElement("span");t.classList.add("data_entry"),i.classList.add("data_entry_name"),n.classList.add("data_entry_value"),i.innerHTML=mt(e)+" reputation",n.innerHTML=r.reputation[e],t.appendChild(i),t.appendChild(n),Sl.reputation.appendChild(t)}})}function Ps({dialogue_key:e,textlines:t,origin:i}){let n=q[e];Ki();let s=document.createElement("div");s.innerHTML=mt(q[e].name),s.id="dialogue_name_div",U.appendChild(s);let a=document.createElement("div");if(a.id="dialogue_answer_div",U.appendChild(a),t){for(let l=0;l<t.length;l++){let u=t[l];if(n.textlines[u].is_unlocked&&!n.textlines[u].is_finished&&ji(n.textlines[u].display_conditions,r)){if(n.textlines[u].required_flags){if((n.textlines[u].required_flags.yes&&!Array.isArray(n.textlines[u].required_flags.yes)||n.textlines[u].required_flags.no&&!Array.isArray(n.textlines[u].required_flags.no))&&console.error(`Textline "${u}" in dialogue "${e}" has required flag passed as a single value but it should be an array!`),n.textlines[u].required_flags.yes){for(let _=0;_<n.textlines[u].required_flags.yes.length;_++)if(!Se[n.textlines[u].required_flags.yes[_]])return}if(n.textlines[u].required_flags.no){for(let _=0;_<n.textlines[u].required_flags.no.length;_++)if(Se[n.textlines[u].required_flags.no[_]])return}}let c=document.createElement("div");c.innerHTML=`"${Jn.getText(Ct,n.textlines[u].name)}"`,c.classList.add("dialogue_textline"),c.setAttribute("data-textline",u),c.setAttribute("onclick",`start_textline(this.getAttribute('data-textline'), ${i})`),U.appendChild(c)}}let o=document.createElement("div");o.innerHTML="<i class='material-icons'>arrow_back</i> "+Xc,o.classList.add("backstep_dialogue_button"),o.setAttribute("onclick",`start_dialogue("${e}")`),U.appendChild(o)}else{if(Object.keys(n.textlines).forEach(l=>{if(n.textlines[l].is_unlocked&&!n.textlines[l].is_finished&&!n.textlines[l].is_branch_only&&ji(n.textlines[l].display_conditions,r)){if(n.textlines[l].required_flags){if((n.textlines[l].required_flags.yes&&!Array.isArray(n.textlines[l].required_flags.yes)||n.textlines[l].required_flags.no&&!Array.isArray(n.textlines[l].required_flags.no))&&console.error(`Textline "${l}" in dialogue "${e}" has required flag passed as a single value but it should be an array!`),n.textlines[l].required_flags.yes){for(let c=0;c<n.textlines[l].required_flags.yes.length;c++)if(!Se[n.textlines[l].required_flags.yes[c]])return}if(n.textlines[l].required_flags.no){for(let c=0;c<n.textlines[l].required_flags.no.length;c++)if(Se[n.textlines[l].required_flags.no[c]])return}}let u=document.createElement("div");u.innerHTML=`"${Jn.getText(Ct,n.textlines[l].name)}"`,u.classList.add("dialogue_textline"),u.setAttribute("data-textline",l),u.setAttribute("onclick","start_textline(this.getAttribute('data-textline'))"),U.appendChild(u)}}),Object.keys(n.actions).forEach(l=>{if(n.actions[l].is_unlocked&&!n.actions[l].is_finished&&n.actions[l].can_be_displayed(r)){let u=document.createElement("div");u.innerHTML=`${Jn.getText(Ct,n.actions[l].starting_text)}`,u.classList.add("dialogue_textline"),u.setAttribute("data-location_action",l),u.setAttribute("onclick","start_game_action(this.getAttribute('data-location_action'), event)"),U.appendChild(u)}}),n.trader){let l=document.createElement("div");l.innerHTML='<i class="material-icons">storefront</i>  '+P[n.trader].trade_text,l.classList.add("dialogue_trade"),l.setAttribute("data-trader",n.trader),l.setAttribute("onclick","startTrade(this.getAttribute('data-trader'))"),U.appendChild(l)}let o=document.createElement("div");o.innerHTML="<i class='material-icons'>arrow_back</i> "+n.ending_text,o.classList.add("end_dialogue_button"),o.setAttribute("onclick","end_dialogue()"),U.appendChild(o)}}function Ws({text:e,is_description:t}){e=Jn.getText(Ct,e),t?document.getElementById("dialogue_answer_div").innerHTML="*"+e+"*":document.getElementById("dialogue_answer_div").innerHTML='<i>"'+e+'"</i>'}function gl(){U.style.display="",Ol.style.display="none"}function lu(e){Ki();let t=document.createElement("div");t.innerText=x[e.activity_name].action_text,t.id="action_status_div";let i=document.createElement("div");if(x[e.activity_name].base_skills_names){let a=G(x[e.activity_name].base_skills_names)==p[x[e.activity_name].base_skills_names].max_level?"Max":`${Math.round(1e4*p[x[e.activity_name].base_skills_names].current_xp/p[x[e.activity_name].base_skills_names].xp_to_next_lvl)/100}%`,o=G(x[e.activity_name].base_skills_names)==p[x[e.activity_name].base_skills_names].max_level?"Max":`${Math.floor(p[x[e.activity_name].base_skills_names].current_xp)}`,l=G(x[e.activity_name].base_skills_names)==p[x[e.activity_name].base_skills_names].max_level?"Max":`${Math.ceil(p[x[e.activity_name].base_skills_names].xp_to_next_lvl)}`;if(x[e.activity_name].type!=="GATHERING"?i.innerText=`Getting ${e.skill_xp_per_tick} base xp per in-game minute to `:i.innerText=`Getting ${e.skill_xp_per_tick} base xp per gathering cycle to `,o!=="Max"?i.innerText+=` ${p[x[e.activity_name].base_skills_names].name()} (${a}  [${Xt(o)} / ${Xt(l)}])`:i.innerText+=` ${p[x[e.activity_name].base_skills_names].name()} (Maxxed out!)`,x[e.activity_name].type!=="GATHERING"){let u=Math.ceil((l-o)/(e.skill_xp_per_tick*At(p[x[e.activity_name].base_skills_names].skill_id)));isNaN(u)||(i.innerHTML+=`<br>Next level in ${Bi(u)} (${bt({time:{minutes:u/60},long_names:!0})}realtime)`)}else{let u=Math.ceil(e.gathering_time_needed*(l-o)/(e.skill_xp_per_tick*At(p[x[e.activity_name].base_skills_names].skill_id)));isNaN(u)||(i.innerHTML+=`<br>Next level in ${Bi(u)} (${bt({time:{minutes:u/60},long_names:!0})}realtime)`)}}else console.warn(`Activity "${e.activity_name}" has no skills assigned!`);i.id="action_xp_div";let n=document.createElement("div");n.setAttribute("onclick","end_activity()"),n.id="action_end_div";let s=document.createElement("div");if(s.innerText=`Finish ${e.activity_name}`,s.id="action_end_text",n.appendChild(s),x[e.activity_name].type==="JOB"){let a=document.createElement("div");a.innerHTML=`(earnings: ${Pe(0)})`,a.id="action_end_earnings",n.appendChild(a)}if(U.appendChild(t),U.appendChild(i),e.gained_resources){let a=document.createElement("div"),o=document.createElement("div");a.appendChild(o),o.id="gathering_progress_bar",o.style.width=385*e.gathering_time/e.gathering_time_needed+"px",a.id="gathering_progress_bar_max",U.appendChild(a),a.appendChild(ir(e))}if(U.appendChild(n),x[e.activity_name].type==="JOB"){let a=document.createElement("div");a.id="time_for_earnings_div",Mo(e)?a.innerHTML=`Next earnings in: ${Rn(e.working_period-e.working_time)}`:a.innerHTML=`There's not enough time left to earn more, but ${r.name} might still learn something...`,U.insertBefore(a,U.children[2])}Da()}function co(e,t){if(t){document.getElementById("action_end_earnings").innerHTML=`(earnings: ${Pe(e.earnings)})`;let o=document.getElementById("time_for_earnings_div");Mo(e)?o.innerHTML=`Next earnings in: ${Rn(e.working_period-e.working_time%e.working_period)}`:o.innerHTML=`There's not enough time left to earn more, but ${r.name} might still learn something...`}let i=document.getElementById("action_xp_div");if(!i){console.warn(`Failed to find htmlElement with id "action_xp_div" for activity "${e.activity_id}"`);return}let n=G(x[e.activity_name].base_skills_names)==p[x[e.activity_name].base_skills_names].max_level?"Max":`${Math.round(1e4*p[x[e.activity_name].base_skills_names].current_xp/p[x[e.activity_name].base_skills_names].xp_to_next_lvl)/100}%`,s=G(x[e.activity_name].base_skills_names)==p[x[e.activity_name].base_skills_names].max_level?"Max":`${Math.floor(p[x[e.activity_name].base_skills_names].current_xp)}`,a=G(x[e.activity_name].base_skills_names)==p[x[e.activity_name].base_skills_names].max_level?"Max":`${Math.ceil(p[x[e.activity_name].base_skills_names].xp_to_next_lvl)}`;if(x[e.activity_name].type!=="GATHERING"?i.innerText=`Getting ${e.skill_xp_per_tick} base xp per in-game minute to `:i.innerText=`Getting ${e.skill_xp_per_tick} base xp per gathering cycle to `,s!=="Max"?i.innerText+=` ${p[x[e.activity_name].base_skills_names].name()} (${n}  [${Xt(s)} / ${Xt(a)}])`:i.innerText+=` ${p[x[e.activity_name].base_skills_names].name()} (Maxxed out!)`,x[e.activity_name].type!=="GATHERING"){let o=Math.ceil((a-s)/(e.skill_xp_per_tick*At(p[x[e.activity_name].base_skills_names].skill_id)));isNaN(o)||(i.innerHTML+=`<br>Next level in ${Bi(o)} (${bt({time:{minutes:o/60},long_names:!0})}realtime)`)}else{let o=Math.ceil(e.gathering_time_needed*(a-s)/(e.skill_xp_per_tick*At(p[x[e.activity_name].base_skills_names].skill_id)));isNaN(o)||(i.innerHTML+=`<br>Next level in ${Bi(o)} (${bt({time:{minutes:o/60},long_names:!0})}realtime)`)}e.gained_resources&&(document.getElementById("gathering_progress_bar").style.width=385*e.gathering_time/e.gathering_time_needed+"px")}function ru(e,t){Ki();let i;e?i=q[e].actions[t]:i=v.actions[t];let n=document.createElement("div");n.innerText=i.action_text,n.id="action_status_div",U.appendChild(n);let s=document.createElement("div"),a=document.createElement("div");s.appendChild(a),a.id="action_progress_bar",a.style.width="0px",s.id="action_progress_bar_max",U.appendChild(s);let o=document.createElement("div");o.setAttribute("onclick","end_game_action()"),o.id="action_end_div";let l=document.createElement("div");l.innerText="Give up for now",l.id="action_end_text",o.appendChild(l),U.appendChild(o),Da()}function uo(e){document.getElementById("action_progress_bar").style.width=385*e+"px"}function or(e){document.getElementById("action_status_div").innerHTML=e}function lr(){document.getElementById("action_end_div").innerHTML="Finish"}function es({content_type:e,data:t}){let i="";if(t.special?.upstack_result_message&&(i=t.special.upstack_result_message),e==="dialogue")Ps({dialogue_key:t.dialogue_key}),i||(i=q[t.dialogue_key].getDescription()),Ws({text:i,is_description:!0});else if(e==="dialogue_answer")Ps({dialogue_key:t.dialogue_key}),i||(i=t.text),Ws({text:i});else if(e==="dialogue_branch")Ps({dialogue_key:t.dialogue_key,textlines:t.textlines}),i||(i=t.text),Ws({text:i});else if(e==="action")ru(t.dialogue_key,t.action_key);else if(e==="activity")lu(t.activity);else throw new Error(`Error on filling action box content: no such content type as "${e}"`)}function rr(){Ki();let e=document.createElement("div");e.innerText="Sleeping...",e.id="action_status_div";let t=document.createElement("div");t.setAttribute("onclick","end_sleeping()"),t.id="action_end_div";let i=document.createElement("div");i.innerText="Wake up",i.id="action_end_text",t.appendChild(i),U.appendChild(e),U.appendChild(t),Da()}function cr(e){Ki();let t=document.createElement("div");t.innerText=`Reading the book, ${Bi(d[e].getRemainingTime())} left`,t.id="action_status_div";let i=document.createElement("div");i.setAttribute("onclick","end_reading()"),i.id="action_end_div";let n=document.createElement("div");n.innerText="Stop reading for now",n.id="action_end_text",i.appendChild(n),U.appendChild(t),U.appendChild(i),Da({book_title:e})}function _o(e){if(!ne[e.category]){ne[e.category]={};let y=document.createElement("div");y.innerHTML=`<i class="material-icons icon skill_dropdown_icon"> keyboard_double_arrow_down </i>${e.category} skills`,y.dataset.skill_category=e.category,y.classList.add("skill_category_div");let b=document.createElement("a");b.className="material-icons icon",b.style.float="right",b.innerHTML="keyboard_arrow_up",b.addEventListener("click",H=>{let W=Ie.indexOf(e.category);W>0&&([Ie[W],Ie[W-1]]=[Ie[W-1],Ie[W]],Rs(),Al())});let w=document.createElement("a");w.className="material-icons icon",w.style.float="right",w.innerHTML="keyboard_arrow_down",w.addEventListener("click",H=>{let W=Ie.indexOf(e.category);W<Ie.length-1&&([Ie[W],Ie[W+1]]=[Ie[W+1],Ie[W]],Rs(),Al())}),y.appendChild(b),y.appendChild(w);let k=document.createElement("div");k.dataset.skill_category_skills=!0,y.appendChild(k),ht.appendChild(y),y.addEventListener("click",H=>{H.target.classList.contains("skill_category_div")?H.target.classList.toggle("skill_category_expanded"):H.target.classList.contains("skill_dropdown_icon")&&H.target.parentNode.classList.toggle("skill_category_expanded")}),Ie.indexOf(e.category)==-1&&Ie.push(e.category)}if(ne[e.category][e.skill_id]){console.trace(`Tried to create a skillbar for skill "${e.skill_id}", but it already has one!`);return}ne[e.category][e.skill_id]=document.createElement("div");let t=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div"),c=document.createElement("div"),_=document.createElement("div"),h=document.createElement("div"),f=document.createElement("div");t.classList.add("skill_bar_max"),i.classList.add("skill_bar_current"),n.classList.add("skill_bar_text"),s.classList.add("skill_bar_name"),a.classList.add("skill_bar_xp"),o.classList.add("skill_tooltip"),f.classList.add("skill_tooltip_next_milestone"),n.appendChild(s),n.append(a),u.classList.add("skill_xp_gain"),o.appendChild(l),o.appendChild(u),o.appendChild(c),o.appendChild(_),o.appendChild(h),o.appendChild(f),c.innerHTML=`<span class="skill_id">id: "${e.skill_id}"</span><br><br>${e.description}<br>`,e.flavour_text&&(c.innerHTML+=`<br><span class="skill_flavour_text">"${e.flavour_text}"</span>`),e.parent_skill&&(c.innerHTML+=`<br>Parent skill: ${e.parent_skill}<br><br>`),t.appendChild(n),t.appendChild(i),t.appendChild(o),ne[e.category][e.skill_id].appendChild(t),ne[e.category][e.skill_id].setAttribute("data-skill",e.skill_id),ne[e.category][e.skill_id].classList.add("skill_div"),ht.querySelector(`[data-skill_category=${e.category}]`).querySelector("[data-skill_category_skills]").appendChild(ne[e.category][e.skill_id]),ns({}),Rs(),$n(e)}function en(e,t=!0){ne[e.category][e.skill_id]&&(ts(e),e.current_xp!=="Max"?(ne[e.category][e.skill_id].children[0].classList.remove("skill_bar_capped"),ne[e.category][e.skill_id].children[0].children[0].children[1].innerHTML=`${100*Math.floor(e.current_xp/e.xp_to_next_lvl*1e3)/1e3}%`,ne[e.category][e.skill_id].children[0].children[2].children[0].innerHTML=`${Xt(e.current_xp)} / ${Xt(e.xp_to_next_lvl)}`):(ne[e.category][e.skill_id].children[0].classList.add("skill_bar_capped"),ne[e.category][e.skill_id].children[0].children[0].children[1].innerHTML="Max!",ne[e.category][e.skill_id].children[0].children[2].children[0].innerHTML="Maxed out!"),ne[e.category][e.skill_id].children[0].children[1].style.width=`${100*e.current_xp/e.xp_to_next_lvl}%`,Es(e.skill_id)&&(ne[e.category][e.skill_id].children[0].children[2].children[4].innerHTML=`<br>${Es(e.skill_id)}`),typeof Ss(e.skill_id)<"u"?ne[e.category][e.skill_id].children[0].children[2].children[5].innerHTML=`lvl ${Ss(e.skill_id)}: ???`:ne[e.category][e.skill_id].children[0].children[2].children[5].innerHTML="",typeof e.get_effect_description<"u"&&(ne[e.category][e.skill_id].children[0].children[2].children[3].innerHTML=`${e.get_effect_description()}`),t&&ns({sort_by:ea}))}function ts(e){if(!ne[e.category]?.[e.skill_id])return;ne[e.category][e.skill_id].children[0].children[0].children[0].innerHTML=`${e.name()} : level ${e.current_level}/${e.max_level}`;let t=r.bonus_skill_levels.full[e.skill_id];t!=0&&(t>0?ne[e.category][e.skill_id].children[0].children[0].children[0].innerHTML+=` <b>[+${t}]</b>`:ne[e.category][e.skill_id].children[0].children[0].children[0].innerHTML+=` <b>[${t}]</b>`)}function ur(e){ne[e.category][e.skill_id]&&(ne[e.category][e.skill_id].children[0].children[2].children[3].innerHTML=`${e.get_effect_description()}`)}function $n(e){if(!ne[e.category]||!ne[e.category][e.skill_id])return;let t=Math.round(100*e.get_parent_xp_multiplier()*At(e.skill_id))/100||1;ne[e.category][e.skill_id].children[0].children[2].children[1].innerHTML=`XP gain: x${t}<br><span>XP cost scaling: x${e.xp_scaling}</span>`}function is(){Object.keys(ne).forEach(e=>{Object.keys(ne[e]).forEach(t=>{$n(p[t])})})}function ns({sort_by:e="name",change_direction:t=!1}){t&&(e&&e===ea?Gi==="asc"?Gi="desc":Gi="asc":e==="level"?Gi="desc":Gi="asc"),ea=e;let i=Gi=="asc"?1:-1,n=Gi==="asc"?-1:1;for(let s=0;s<ht.children.length;s++)[...ht.children[s].querySelector("[data-skill_category_skills]").children].sort((a,o)=>{let l,u;if(e==="level")ea=e,l=p[a.getAttribute("data-skill")].current_level,u=p[o.getAttribute("data-skill")].current_level;else if(e==="progress"){if(isNaN(p[a.getAttribute("data-skill")].current_xp))return 1;if(isNaN(p[o.getAttribute("data-skill")].current_xp))return-1;l=-p[a.getAttribute("data-skill")].current_xp/p[a.getAttribute("data-skill")].xp_to_next_lvl,u=-p[o.getAttribute("data-skill")].current_xp/p[o.getAttribute("data-skill")].xp_to_next_lvl}else l=p[a.getAttribute("data-skill")].name(),u=p[o.getAttribute("data-skill")].name(),ea="name";return l>u?i:n}).forEach(a=>ht.children[s].querySelector("[data-skill_category_skills").appendChild(a))}function Rs(){[...ht.children].sort((e,t)=>{let i=Ie.indexOf(e.dataset.skill_category),n=Ie.indexOf(t.dataset.skill_category);return i==-1||n==-1?e.dataset.skill_category>t.dataset.skill_category?1:-1:i>n?1:-1}).forEach(e=>ht.appendChild(e))}function Al(){Ie.length=0,[...ht.children].forEach((e,t)=>{Ie[t]=e.dataset.skill_category})}function as(e,t,i){for(;Ri.firstChild;)Ri.removeChild(Ri.lastChild);Object.keys(ot).forEach(n=>{delete ot[n]}),Ri.innerHTML=`<tr class="stance_list_entry stance_list_header">
        <th class="stance_list_header stance_list_header_fav">Fav</th>
        <th class="stance_list_header stance_list_header_select">Select</th>
        <th class="stance_list_header stance_list_header_name">Name</th>
    </tr>`,Object.keys(e).forEach(n=>{if(e[n].is_unlocked){ot[n]=document.createElement("tr"),ot[n].classList.add("stance_list_entry"),ot[n].dataset.stance=n;let s=`<td class="stances_button stances_button_checkbox"><input type="checkbox" id="stances_fav_${n}" name="stance_fav_selection" onclick="fav_stance('${n}')"></td>`,a=`<td class="stances_button stances_button_radio"><input type="radio" id="stances_select_${n}" name="stance_list_selection" onclick="select_stance('${n}')"></td>`,o=`<td class="stances_name"><label for="stances_select_${n}">${e[n].name}</td>`;ot[n].innerHTML=s,ot[n].innerHTML+=a,ot[n].innerHTML+=o;let l=document.createElement("td");l.appendChild(cu(e[n])),ot[n].appendChild(l),Ri.append(ot[n])}}),[...Ri.children].sort((n,s)=>{let a=e[n.getAttribute("data-stance")],o=e[s.getAttribute("data-stance")];if(o){if(!a)return-1}else return 1;return(!a||!o||!a.is_unlocked||!o.is_unlocked)&&console.error(`No such stance as either '${a}' or '${o}', or at least one of them is not yet unlocked!`),a.stamina_cost<o.stamina_cost?-1:a.stamina_cost>o.stamina_cost||a.name>o.name?1:-1}).forEach(n=>Ri.appendChild(n)),mo(t),ho(i)}function cu(e){let t=document.createElement("div");t.classList.add("stance_tooltip"),t.innerHTML=`<div>${e.name}</div><br>
    <div>${e.getDescription()}</div><br>
    <div>Stamina cost: ${e.stamina_cost}</div>
    <div class='stance_tooltip_stats'>${dr(e)}</div`;let i=e.target_count;return i>1&&e.related_skill&&(i=i+Math.round(i*G(e.related_skill)/p[e.related_skill].max_level)),i>1&&(t.innerHTML+=`
        <br><div class='stance_tooltip_hitcount'>${e.randomize_target_count?"Randomly hits up to":"Hits up to"} ${i} enemies</div>`),t}function dr(e){let t="",i=e.getStats();return Object.keys(i).forEach(n=>{t+=`<br>x${Math.round(100*i[n])/100} ${We[n]}`}),t}function _r(e){ot[e.id].querySelector(".stance_tooltip_stats").innerHTML=dr(e);let t=e.target_count;t>1&&(e.related_skill&&(t=t+Math.round(t*G(e.related_skill)/p[e.related_skill].max_level)),ot[e.id].querySelector(".stance_tooltip_hitcount").innerHTML=`${e.randomize_target_count?"Randomly hits up to":"Hits up to"} ${t} enemies</div>`)}function mo(e){ot[e.id].children[1].children[0].checked=!0,document.getElementById("character_stance_name").children[0].innerHTML=e.name;let t=document.getElementById("character_stance_selection");t.children&&(t.querySelector(`[data-stance='${e.id}']`)?t.querySelector(`[data-stance='${e.id}']`).children[0].checked=!0:!Dt[e.id]&&t.querySelector("[data-stance] :checked")&&(t.querySelector("[data-stance] :checked").checked=!1))}function ho(e){let t=document.getElementById("character_stance_selection");t.innerHTML="",Object.keys(Dt).forEach(n=>{ot[n].children[0].children[0].checked=!0;let s=`<div data-stance="${n}"><input type="radio" id="stances_quick_select_${n}" name="stance_quick_selection" onclick="select_stance('${n}')">
         <label for="stances_quick_select_${n}">${e[n].name}</div>`;t.innerHTML+=s}),[...t.children].sort((n,s)=>{let a=e[n.getAttribute("data-stance")],o=e[s.getAttribute("data-stance")];return(!a||!o)&&console.error(`No such stance as either '${a}' or '${o}'!`),a.stamina_cost<o.stamina_cost?-1:a.stamina_cost>o.stamina_cost||a.name>o.name?1:-1}).forEach(n=>t.appendChild(n));let i=document.getElementById("character_stance_selection");i.children&&i.querySelector(`[data-stance='${pt}']`)&&(i.querySelector(`[data-stance='${pt}']`).children[0].checked=!0)}function po(e){let t=X[e];Yi[e]=document.createElement("div"),Yi[e].innerHTML=uu(e),Yi[e].setAttribute("data-bestiary_rank",t.rank),Yi[e].classList.add("bestiary_entry_div"),Os.appendChild(Yi[e]),[...Os.children].sort((i,n)=>parseInt(i.getAttribute("data-bestiary_rank"))-parseInt(n.getAttribute("data-bestiary_rank"))).forEach(i=>Os.appendChild(i))}function uu(e){let t=document.createElement("div"),i=document.createElement("div");i.innerHTML=e,i.classList.add("bestiary_entry_name");let n=document.createElement("div");return n.innerHTML=Wt[e],n.classList.add("bestiary_entry_kill_count"),t.appendChild(i),t.appendChild(n),t.appendChild(mr(e)),t.innerHTML}function mr(e){let t=X[e],i=document.createElement("div");i.classList.add("bestiary_entry_tooltip");let n=document.createElement("div");n.innerHTML=`<br>Base xp value: ${t.xp_value} <br><br>`;let s=document.createElement("div");s.innerHTML=t.description;let a=document.createElement("div");Object.keys(t.tags).forEach(h=>{a.innerHTML+=`[${h}] `}),a.innerHTML+="<br><br>";let o=document.createElement("div");o.innerHTML="Stats: <br>";let l=document.createElement("div");l.classList.add("grid_container"),l.append(bn(t,"Health"),bn(t,"Defense"));let u=document.createElement("div");u.classList.add("grid_container"),u.append(bn(t,"Attack power"),bn(t,"Attack speed"));let c=document.createElement("div");c.classList.add("grid_container"),c.append(bn(t,"AP"),bn(t,"EP")),o.appendChild(l),o.appendChild(u),o.appendChild(c);let _=document.createElement("div");_.classList.add("loot_slots_div"),t.loot_list.length>0&&_.appendChild(Hl());for(let h=0;h<t.loot_list.length;h++)_.appendChild(Hl(t,t.loot_list[h]));return i.appendChild(s),i.appendChild(n),i.appendChild(a),i.appendChild(o),i.appendChild(_),i}function hr(e){Yi[e].querySelector(".bestiary_entry_tooltip").replaceWith(mr(e))}function pr(e){Yi[e].children[1].innerHTML=Wt[e]}function Hl(e,t){let i=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div");return i.classList.add("loot_slot_div"),n.classList.add("loot_name"),s.classList.add("loot_chance"),a.classList.add("loot_chance_base"),o.classList.add("loot_chance_current"),e?(n.innerHTML=`${t.item_name}`,a.innerHTML=`[${t.chance*100}%]`,o.innerHTML=`${Math.round(1e4*t.chance*e.get_droprate_modifier())/100}%`,s.append(o,a),i.append(n,s)):(n.innerHTML="Item name",a.innerHTML="base %",o.innerHTML="current %",s.append(o,a),i.append(n,s)),i}function bn(e,t){let i=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div");switch(i.classList.add("stat_slot_div"),n.classList.add("stat_name"),s.classList.add("stat_value"),t){case"Health":n.innerHTML="Health:",s.innerHTML=`${e.stats.health}`,i.append(n,s);break;case"Defense":n.innerHTML="Defense:",s.innerHTML=`${e.stats.defense}`,i.append(n,s);break;case"Attack power":n.innerHTML="Attack power:",s.innerHTML=`${e.stats.attack}`,e.stats.attack_count>1&&(s.innerHTML+=`x${e.stats.attack_count}`),i.append(n,s);break;case"Attack speed":n.innerHTML="Attack speed:",s.innerHTML=`${e.stats.attack_speed}`,i.append(n,s);break;case"AP":n.innerHTML="AP:",s.innerHTML=`${Math.round(e.stats.dexterity*Math.sqrt(e.stats.intuition||1))}`,i.append(n,s);break;case"EP":n.innerHTML="EP:",s.innerHTML=`${Math.round(e.stats.agility*Math.sqrt(e.stats.intuition||1))}`,i.append(n,s);break}return i}function du(e){Tt[e]=document.createElement("div");let t=d[e],i=document.createElement("div");i.innerHTML=e,i.classList.add("anthology_entry_name");let n=Ji(t);n.classList.add("anthology_entry_tooltip"),Tt[e].appendChild(i),Tt[e].appendChild(n),Tt[e].setAttribute("data-book",e),Tt[e].classList.add("anthology_entry_div"),Bs.appendChild(Tt[e]),[...Bs.children].sort((s,a)=>s.getAttribute("data-book")-a.getAttribute("data-book")).forEach(s=>Bs.appendChild(s))}function ss(e,t){Tt[e]||du(e),Tt[e].children[1].innerHTML=kn({item:d[e]}),Tt[e].style.display=t?"flex":"none"}function fo(e,t){Qe.children[e].querySelector(".enemy_attack_bar").style.width=`${Math.min(t*100,100)}%`}function fr(e){let t=Qe.children[e];na[e]?.cancel(),na[e]=t.animate(Pc,Wc)}function go(e){na[e]?.cancel()}function gr(e){let t=Qe.children[e];na[e]?.cancel(),na[e]=t.animate(Rc,Gc)}function yo(e){Kc.style.width=`${Math.min(e*100,100)}%`}function ql(e){if(zs[e]){console.warn(`Tried to add quest "${e}" to display, but it's already there!`);return}else if(O[e].is_hidden){console.warn(`Tried to add quest "${e}" to display, but it's a hidden quest!`);return}let t=O[e],i=_u(e);zs[e]=i,Ds.appendChild(i),t.is_finished&&i.classList.add("quest_finished"),yr()}function Un(e){if(O[e].is_hidden){console.warn(`Tried to update display of quest "${e}", but it's a hidden quest!`),console.trace();return}else if(!zs[e]){console.warn(`Tried to update display of quest "${e}", but it's not in display!`);return}let t=O[e],i=document.querySelector(`[data-quest_id="${e}"]`),n=i.querySelector(".quest_name_div");n.innerHTML=t.getQuestName();let s=i.querySelector(".quest_description_div");s.innerHTML=t.getQuestDescription()??"",t.is_finished&&i.classList.add("quest_finished"),mu(e),yr()}function yr(){[...Ds.children].sort((e,t)=>{let i=O[e.getAttribute("data-quest_id")],n=O[t.getAttribute("data-quest_id")];return i.is_finished&&!n.is_finished?1:!i.is_finished&&n.is_finished?-1:i.display_priority!==n.display_priority?i.display_priority-n.display_priority:i.getQuestName()>n.getQuestName()?1:-1}).forEach(e=>Ds.appendChild(e))}function _u(e){let t=O[e],i=document.createElement("div");i.dataset.quest_id=e;let n=document.createElement("div"),s=document.createElement("div");return i.classList.add("quest_div"),s.innerHTML=t.getQuestName(),s.classList.add("quest_name_div"),n.innerHTML=t.getQuestDescription(),n.classList.add("quest_description_div"),i.appendChild(s),i.appendChild(n),i.appendChild(wr(e)),i.addEventListener("click",a=>{a.target.classList.contains("quest_name_div")&&i.classList.toggle("quest_div_expanded")}),i}function wr(e){let t=O[e],i=document.createElement("div");i.classList.add("quest_task_list_div");let n=t.quest_tasks.findIndex(s=>!s.is_finished);n=n==-1?t.quest_tasks.length:n;for(let s=0;s<n;s++)t.quest_tasks[s].is_hidden||i.appendChild(Qs(e,s));return n!==t.quest_tasks.length&&(t.quest_tasks[n].is_hidden||i.appendChild(Qs(e,n))),i}function Qs(e,t){let i=O[e].quest_tasks[t],n=document.createElement("div");n.classList.add("quest_task_div");let s=document.createElement("span");s.classList.add("task_status_icon"),i.is_finished?(n.classList.add("task_finished"),s.innerHTML='<i class="material-icons">check_box</i>'):s.innerHTML='<i class="material-icons">check_box_outline_blank</i>';let a=document.createElement("div");a.classList.add("task_description_div"),a.innerHTML=i.task_description;let o=document.createElement("div"),l=0;if(Object.keys(i.task_condition).forEach(u=>{if(Object.keys(i.task_condition[u]).length){let c=document.createElement("div");c.classList.add("task_condition_div"),c.innerHTML+=u+":",Object.keys(i.task_condition[u]).forEach(_=>{let h=document.createElement("div");h.classList.add("task_type_div"),h.innerHTML+=Ko[_]+":",Object.keys(i.task_condition[u][_]).forEach(f=>{let y=document.createElement("div");y.classList.add("task_target_div"),y.innerHTML+=f+": "+i.task_condition[u][_][f].current+"/"+i.task_condition[u][_][f].target,h.appendChild(y),l++}),c.appendChild(h)}),o.appendChild(c)}}),l==1){let u=o.getElementsByClassName("task_condition_div");for(let c=0;c<u.length;c++)u.item(c).innerHTML=u.item(c).innerHTML.replace("any:","").replace("all:","")}return n.appendChild(s),n.appendChild(a),n.appendChild(o),n}function Ml(e,t){let i=O[e];if(i.quest_tasks[t].is_hidden||i.is_hidden)return;let s=document.querySelector(`[data-quest_id="${e}"]`).querySelector(".quest_task_list_div");(s.children.item(t)||s.children.item(t-1)).replaceWith(Qs(e,t))}function mu(e){let i=document.querySelector(`[data-quest_id="${e}"]`).querySelector(".quest_task_list_div");i.replaceWith(wr(e)),i.remove()}function tn(){wo("rain")}function nn(){wo("snow")}function an(){wo("stars")}function wo(e){sa();let t;switch(e){case"snow":t=Oa,Ve=document.getElementById("foreground_canvas");break;case"rain":t=Ba,Ve=document.getElementById("foreground_canvas");break;case"stars":t=Na,Ve=document.getElementById("background_canvas");break;default:break}Qi=Ve.getContext("2d"),Ve.width=Qi.canvas.clientWidth,Ve.height=Qi.canvas.clientHeight,Ra=[];for(let i=0;i<Math.ceil(Ve.width*Ve.height/5e3);i++)Ra.push(new t({canvas:Ve}));br()}function sa(){Ve=Ve||document.getElementById("foreground_canvas"),Qi=Qi||Ve.getContext("2d"),Qi.clearRect(0,0,Ve.width,Ve.height),cancelAnimationFrame(Pl),clearTimeout(Wl)}function br(){Wl=setTimeout(()=>{Pl=requestAnimationFrame(br),Qi.clearRect(0,0,Ve.width,Ve.height);for(let e=0;e<Ra.length;e++)Ra[e].draw()},1e3/60)}function vr(e,t){if(e>t)Cl.innerHTML="Reward available!";else{let i=t-e;i/=1e3;let n=Math.floor(i%60);i=Math.floor(i/60);let s=Math.floor(i%60);i=Math.floor(i/60);let a=i;Cl.innerHTML=`Reward available in: ${a}:${s}:${n} real time`}}function En(e){e?(ni.innerText=`Load the backup autosave [${e.replaceAll("_",":")}]`,ni.style["background-image"]="var(--options_gradient);",ni.style["background-color"]="transparent",ni.style.color="white",ni.style.cursor="pointer"):(ni.style["background-image"]="none",ni.style["background-color"]="#181818",ni.style.color="gray",ni.style.cursor="not-allowed")}function oa(e,t){t?xt.innerText="Import save from main version":xt.innerText="Import save from dev version",e!==void 0?(xt.style["background-image"]="var(--options_gradient);",xt.style["background-color"]="transparent",xt.style.color="white",xt.style.cursor="pointer",e?xt.innerText+=` [${e.replaceAll("_",":")}]`:xt.innerText+=" [unknown date]"):(xt.style["background-image"]="none",xt.style["background-color"]="#181818",xt.style.color="gray",xt.style.cursor="not-allowed")}function kr(){document.getElementById("loading_screen").style.visibility="hidden"}function os(e){let t=document.getElementById("loading_screen_version_info"),i=ja();t.innerHTML=`Save game version: ${e||"none"}<br>
 Current game version: ${i}<br>`,e&&(e===i?t.innerHTML+="<div class='top_border'>No changes since the last time you played~</div>":Xe(e,i)?t.innerHTML+="<div class='top_border'>Game has been updated since the last time you played, check the changelog for more details</div>":t.innerHTML+="<div class='top_border'>Your save is from a newer version of the game. Continuing is likely to lead to multiple issues!</div>")}function $t(e){Jc.innerHTML=e}function bo(){document.getElementById("loading_screen_loading_text").classList.add("fade")}function xr(){let e=document.getElementById("loading_screen_status");e.classList.remove("loading_screen_status_warnings"),e.classList.add("loading_screen_status_errors"),e.innerHTML="An error has occured on loading! Please open the browser console to check for details and then let the developer know!"}function qr(){let e=document.getElementById("loading_screen_status");e.classList.add("loading_screen_status_warnings"),e.innerHTML="A potential issue has occured on loading. Please open the browser console to check for details."}function vo(){let e=document.getElementById("loading_screen_play_button");e.classList.remove("none_display"),e.classList.add("fade_in")}function Mr(e){let t=document.getElementById("loading_screen_play_button");t.innerText=e}function Wa({element:e,siblings_only:t=!1,class_name:i}){let n=t?e.parentNode.querySelectorAll(`.${i}`):document.getElementsByClassName(i),s=e.classList.contains(i);for(let a=0;a<n.length;a++)n[a].classList.remove(i);s||e.classList.add(i)}function Pa(e){let t=document.getElementsByClassName(e);for(;t.length>0;)t.item(0).classList.remove(e)}function Us(e,t){let i=e.getBoundingClientRect(),n=t.getBoundingClientRect();return i.bottom<=n.top}var hu=.75,$o=10;var bi=()=>r.name.match(/\b(?<![\w])rat\b/i),Sr=10,Lr=60,Ir=20,Sn=[14,8,2,-4],ta=Sn[0],ls=["Cold","Very cold","Freezing","Hypothermia"],Eo=class extends fi{constructor(){super(),this.base_stats={max_health:50,health:50,health_regeneration_flat:0,health_regeneration_percent:0,health_loss_flat:0,health_loss_percent:0,max_stamina:50,stamina:50,stamina_regeneration_flat:0,stamina_regeneration_percent:0,stamina_efficiency:1,max_mana:0,mana:0,mana_regeneration_flat:0,mana_regeneration_percent:0,mana_efficiency:1,strength:10,agility:10,dexterity:10,intuition:10,magic:0,attack_speed:1,crit_rate:.05,crit_multiplier:1.3,attack_power:0,defense:0,block_strength:0,block_chance:0,evasion_points:0,attack_points:0,heat_tolerance:0,cold_tolerance:0,unarmed_power:1,armor_penetration:0},this.name="Hero",this.titles={},this.stats={full:{...this.base_stats},total_flat:{},total_multiplier:{},flat:{level:{},skills:{},equipment:{},skill_milestones:{},books:{},light_level:{},environment:{}},multiplier:{skills:{},skill_milestones:{},equipment:{},books:{},stance:{},light_level:{},environment:{}}},this.reputation={village:0,slums:0,town:0},this.bonus_skill_levels={full:{},flat:{equipment:{},active_effects:{},skills:{}}},this.xp_bonuses={total_multiplier:{hero:1,all:1,all_skill:1},multiplier:{levels:{},skills:{},books:{},active_effects:{}}},this.equipment={head:null,torso:null,arms:null,ring:null,weapon:null,"off-hand":null,legs:null,feet:null,amulet:null,artifact:null,cape:null,axe:null,pickaxe:null,sickle:null,shovel:null},this.money=0,this.xp={current_level:0,total_xp:0,current_xp:0,xp_to_next_lvl:$o,total_xp_to_next_lvl:$o,base_xp_cost:$o,xp_scaling:1.6}}add_xp({xp_to_add:t,use_bonus:i=!0}){if(i&&(t*=(r.xp_bonuses.total_multiplier.hero||1)*(r.xp_bonuses.total_multiplier.all||1)),r.xp.total_xp+=t,t+r.xp.current_xp<r.xp.xp_to_next_lvl)r.xp.current_xp+=t;else{let n=0;for(;r.xp.total_xp>=r.xp.total_xp_to_next_lvl;)n+=1,r.xp.total_xp_to_next_lvl=Math.round(r.xp.base_xp_cost*(1-r.xp.xp_scaling**(n+1))/(1-r.xp.xp_scaling));let s=Math.round(r.xp.base_xp_cost*(1-r.xp.xp_scaling**n)/(1-r.xp.xp_scaling)),a=r.get_level_bonus(n);return r.xp.xp_to_next_lvl=r.xp.total_xp_to_next_lvl-s,r.xp.current_level=n,r.xp.current_xp=r.xp.total_xp-s,`${r.name} is getting stronger. Reached level ${r.xp.current_level} ${a}`}}get_level_bonus(t){let i=0,n=0,s=0,a=0,o=0,l=0,u=1.03,c=1;for(let h=r.xp.current_level+1;h<=t;h++)h%2==1?(s+=Math.ceil(h/10),l+=Math.ceil(h/10)):(a+=Math.ceil(h/10),o+=Math.ceil(h/10)),i+=10*Math.ceil(h/10),n+=5,c=c*u;r.stats.flat.level.max_health=(r.stats.flat.level.max_health||0)+i,r.stats.flat.level.health=r.stats.flat.level.max_health,r.stats.flat.level.max_stamina=(r.stats.flat.level.max_stamina||0)+n,r.stats.flat.level.stamina=r.stats.flat.level.max_stamina,r.stats.flat.level.strength=(r.stats.flat.level.strength||0)+s,r.stats.flat.level.intuition=(r.stats.flat.level.intuition||0)+l,r.stats.flat.level.agility=(r.stats.flat.level.agility||0)+a,r.stats.flat.level.dexterity=(r.stats.flat.level.dexterity||0)+o,r.xp_bonuses.multiplier.levels.all_skill=(r.xp_bonuses.multiplier.levels.all_skill||1)*c;let _=`<br>HP increased by ${i}<br>Stamina increased by ${n}`;return s>0&&(_+=`<br>Strength increased by ${s}`),a>0&&(_+=`<br>Agility increased by ${a}`),o>0&&(_+=`<br>Dexterity increased by ${o}`),l>0&&(_+=`<br>Intuition increased by ${l}`),_+=`<br>Skill xp gains increased by ${Math.round((u-1)*100)}%`,_}},r=new Eo;r.stats.add_skill_milestone_bonus=function({stats:e={},xp_multipliers:t={}}){Object.keys(e).forEach(i=>{e[i].flat&&(r.stats.flat.skill_milestones[i]=(r.stats.flat.skill_milestones[i]||0)+e[i].flat),e[i].multiplier&&(r.stats.multiplier.skill_milestones[i]=(r.stats.multiplier.skill_milestones[i]||1)*e[i].multiplier)}),t?.hero&&(r.xp_bonuses.multiplier.skills.hero=(r.xp_bonuses.multiplier.skills.hero||1)*t.hero),t?.all&&(r.xp_bonuses.multiplier.skills.all=(r.xp_bonuses.multiplier.skills.all||1)*t.all),t?.all_skill&&(r.xp_bonuses.multiplier.skills.all_skill=(r.xp_bonuses.multiplier.skills.all_skill||1)*t.all_skill),Object.keys(p).forEach(i=>{t[i]&&(r.xp_bonuses.multiplier.skills[i]=(r.xp_bonuses.multiplier.skills[i]||1)*t[i])}),Object.keys(Ni).forEach(i=>{let n="category_"+i;t[n]&&(r.xp_bonuses.multiplier.skills[n]=(r.xp_bonuses.multiplier.skills[n]||1)*t[n])})};r.stats.add_book_bonus=function({multipliers:e={},xp_multipliers:t={}}){Object.keys(r.base_stats).forEach(i=>{e[i]&&(r.stats.multiplier.books[i]=(r.stats.multiplier.books[i]||1)*e[i])}),t?.hero&&(r.xp_bonuses.multiplier.books.hero=(r.xp_bonuses.multiplier.books.hero||1)*t.hero),t?.all&&(r.xp_bonuses.multiplier.books.all=(r.xp_bonuses.multiplier.books.all||1)*t.all),t?.all_skill&&(r.xp_bonuses.multiplier.books.all_skill=(r.xp_bonuses.multiplier.books.all_skill||1)*t.all_skill),Object.keys(p).forEach(i=>{t[i]&&(r.xp_bonuses.multiplier.books[i]=(r.xp_bonuses.multiplier.books[i]||1)*t[i])})};r.stats.add_active_effect_bonus=function(){r.stats.flat.active_effects={},r.stats.multiplier.active_effects={},r.bonus_skill_levels.flat.active_effects={},r.xp_bonuses.multiplier.active_effects={},Object.keys(pe).forEach(e=>{let t=1,i=xo(pe[e]);for(let[n,s]of Object.entries(i.stats))s.flat&&(r.stats.flat.active_effects[n]=(r.stats.flat.active_effects[n]||0)+s.flat*t),s.multiplier&&(r.stats.multiplier.active_effects[n]=(r.stats.multiplier.active_effects[n]||1)*s.multiplier*t);for(let[n,s]of Object.entries(i.bonus_skill_levels))r.bonus_skill_levels.flat.active_effects[n]=(r.bonus_skill_levels.flat.active_effects[n]||0)+s;for(let[n,s]of Object.entries(i.xp_multipliers))r.xp_bonuses.multiplier.active_effects[n]=(r.xp_bonuses.multiplier.active_effects[n]||1)*s})};r.stats.add_all_equipment_bonus=function(){r.stats.flat.equipment={},r.stats.multiplier.equipment={},r.bonus_skill_levels.flat.equipment={},Object.keys(r.equipment).forEach(e=>{if(!r.equipment[e])return;r.equipment[e].getDefense&&(r.stats.flat.equipment.defense=(r.stats.flat.equipment.defense||0)+r.equipment[e].getDefense());let t=r.equipment[e].getStats(),i=r.equipment[e].getBonusSkillLevels();Object.keys(t).forEach(n=>{t[n].flat&&(r.stats.flat.equipment[n]=(r.stats.flat.equipment[n]||0)+t[n].flat),t[n].multiplier&&(r.stats.multiplier.equipment[n]=(r.stats.multiplier.equipment[n]||1)*t[n].multiplier)}),Object.keys(i).forEach(n=>{i[n]&&(r.bonus_skill_levels.flat.equipment[n]=(r.bonus_skill_levels.flat.equipment[n]||0)+i[n])})}),r.stats.add_weapon_type_bonuses()};r.stats.add_weapon_type_bonuses=function(){r.equipment.weapon==null?(r.stats.multiplier.skills.attack_power=A({skill_id:"Unarmed"}),r.stats.multiplier.skills.attack_speed=A({scaling_type:"multiplicative",skill_id:"Unarmed"})**.3333,r.stats.multiplier.skills.attack_points=A({scaling_type:"multiplicative",skill_id:"Unarmed"})**.3333,r.stats.multiplier.skills.evasion_points=A({scaling_type:"multiplicative",skill_id:"Unarmed"})**.3333):(r.stats.multiplier.skills.attack_speed=1,r.stats.multiplier.skills.attack_power=A({skill_id:Dn[r.equipment.weapon.weapon_type]}),r.stats.multiplier.skills.attack_points=A({skill_id:Dn[r.equipment.weapon.weapon_type]})**.3333,r.stats.multiplier.skills.evasion_points=1)};r.stats.add_all_skill_level_bonus=function(){r.stats.flat.skills.defense=kt("Iron skin"),r.stats.multiplier.skills.stamina_efficiency=A({scaling_type:"multiplicative",skill_id:"Running"}),r.stats.multiplier.skills.strength=A({scaling_type:"multiplicative",skill_id:"Weightlifting"})*A({scaling_type:"multiplicative",skill_id:"Climbing"})*A({scaling_type:"multiplicative",skill_id:"Breathing"}),r.stats.multiplier.skills.block_strength=1+5*kt("Shield blocking"),r.stats.multiplier.skills.agility=A({scaling_type:"multiplicative",skill_id:"Equilibrium"})*A({scaling_type:"multiplicative",skill_id:"Climbing"})*A({scaling_type:"multiplicative",skill_id:"Breathing"})*A({scaling_type:"multiplicative",skill_id:"Swimming"}),r.stats.multiplier.skills.dexterity=A({scaling_type:"multiplicative",skill_id:"Climbing"}),r.stats.multiplier.skills.max_stamina=A({scaling_type:"multiplicative",skill_id:"Breathing"})*A({scaling_type:"multiplicative",skill_id:"Swimming"}),r.stats.multiplier.skills.max_health=A({scaling_type:"multiplicative",skill_id:"Fortitude"}),r.stats.multiplier.skills.intuition=A({scaling_type:"multiplicative",skill_id:"Meditation"}),r.stats.flat.skills.unarmed_power=p.Unarmed.current_level*.1,r.stats.add_weapon_type_bonuses(),r.stats.flat.skills.cold_tolerance=.5*G("Cold resistance")};r.stats.add_all_stance_bonus=function(){let e=Ce.getStats();Object.keys(r.base_stats).forEach(t=>{e[t]?r.stats.multiplier.stance[t]=e[t]||1:r.stats.multiplier.stance[t]=1})};r.stats.add_location_penalties=function(){let e={},t=1;v&&("connected_locations"in v||(e=v.get_total_effect().hero_penalty),v.light_level==="dark"||v.light_level==="normal"&&pi(M)?(t=.5+.5*G("Night vision")/p["Night vision"].max_level,r.stats.multiplier.light_level.evasion_points=t,r.stats.multiplier.light_level.attack_points=t):(r.stats.multiplier.light_level.evasion_points=1,r.stats.multiplier.light_level.attack_points=1)),r.stats.multiplier.environment={},r.stats.flat.environment={},Object.keys(e.multipliers||{}).forEach(i=>{r.stats.multiplier.environment[i]=e.multipliers[i]}),Object.keys(e.flats||{}).forEach(i=>{r.stats.flat.environment[i]=e.flats[i]})};r.get_character_cold_tolerance=function(){return r.stats.full.cold_tolerance};r.get_character_heat_tolerance=function(){return r.stats.full.heat_tolerance};r.update_stats=function(){let e=Math.max(r.stats.full.max_health-r.stats.full.health,0)||0,t=Math.max(r.stats.full.max_stamina-r.stats.full.stamina,0)||0,i=Math.max(r.stats.full.max_mana-r.stats.full.mana,0)||0;r.stats.add_all_skill_level_bonus(),r.stats.add_all_stance_bonus(),Object.keys(r.stats.full).forEach(n=>{let s=0,a=1;n==="block_chance"?s=hu+Math.round(kt("Shield blocking")*1e4)/1e4:n==="attack_points"?s=Math.sqrt(r.stats.full.intuition)*r.stats.full.dexterity*A({scaling_type:"multiplicative",skill_id:"Combat"}):n==="evasion_points"?s=r.stats.full.agility*Math.sqrt(r.stats.full.intuition)*A({scaling_type:"multiplicative",skill_id:"Evasion"}):Object.values(r.stats.flat).forEach(o=>{s+=o[n]||0}),Object.values(r.stats.multiplier).forEach(o=>{a*=o[n]||1}),r.stats.full[n]=(r.base_stats[n]+s)*a,r.stats.total_flat[n]=r.base_stats[n]+s,r.stats.total_multiplier[n]=a||1,n==="health"?r.stats.full.health=Math.max(0,r.stats.full.max_health-e):n==="stamina"?r.stats.full.stamina=Math.max(0,r.stats.full.max_stamina-t):n==="mana"&&(r.stats.full.mana=Math.max(0,r.stats.full.max_mana-i))}),r.equipment.weapon!=null?r.stats.full.attack_power=r.stats.full.strength/10*r.equipment.weapon.getAttack()*r.stats.total_multiplier.attack_power:r.stats.full.attack_power=r.stats.full.strength/10*r.stats.total_multiplier.attack_power*r.stats.full.unarmed_power,r.stats.total_flat.attack_power=r.stats.full.attack_power/r.stats.total_multiplier.attack_power,Object.keys(r.xp_bonuses.total_multiplier).forEach(n=>{r.xp_bonuses.total_multiplier[n]=(r.xp_bonuses.multiplier.levels[n]||1)*(r.xp_bonuses.multiplier.skills[n]||1)*(r.xp_bonuses.multiplier.books[n]||1)*(r.xp_bonuses.multiplier.active_effects[n]||1),r.xp_bonuses.total_multiplier[n]!=1&&(n!=="hero"&&(n==="all"||n==="all_skill"||n.includes("category_")?is():$n(p[n])),(n==="hero"||n==="all")&&Xa())}),Object.keys(r.bonus_skill_levels.full).forEach(n=>{if(n.includes("category_"))return;let s="category_"+p[n].category;r.bonus_skill_levels.full[n]=(r.bonus_skill_levels.flat.equipment[n]||0)+(r.bonus_skill_levels.flat.active_effects[n]||0)+(r.bonus_skill_levels.flat.skills[n]||0)+(r.bonus_skill_levels.flat.equipment[s]||0)+(r.bonus_skill_levels.flat.active_effects[s]||0)+(r.bonus_skill_levels.flat.skills[s]||0),r.bonus_skill_levels.full[n]!=0&&ts(p[n])})};r.get_stamina_multiplier=function(){return r.stats.full.stamina==0?.5+kt("Persistence"):1};r.get_attack_speed=function(){return r.stats.full.attack_speed*r.get_stamina_multiplier()};r.get_attack_power=function(){return r.stats.full.attack_power*r.get_stamina_multiplier()};r.wears_armor=function(){return r.equipment.head&&r.equipment.head.getDefense()!==0||r.equipment.torso&&r.equipment.torso.getDefense()!==0||r.equipment.arms&&r.equipment.arms.getDefense()!==0||r.equipment.legs&&r.equipment.legs.getDefense()!==0||r.equipment.feet&&r.equipment.feet.getDefense()!==0||r.equipment.cape&&r.equipment.cape.getDefense()!==0};r.take_damage=function({damage_values:e,can_faint:t=!0,give_skill_xp:i=!0}){let n;e=e.map(a=>a<1?Math.max(Math.ceil(10*a)/10,0):Math.ceil(10*Math.max(a-r.stats.full.defense,a*.05,1))/10);let s=e.reduce((a,o)=>a+o);return r.stats.full.health-=s,r.stats.full.health<=0&&t?(n=!0,r.stats.full.health=0):n=!1,{damage_taken:s,fainted:n}};r.get_character_money=function(){return r.money};function ze(e){let t=r.add_to_inventory(e);ve({was_anything_new_added:t})}function dt(e){r.remove_from_inventory(e),ve();for(let t=0;t<e.length;t++){if(r.inventory[e[t].item_key])continue;let{id:i}=JSON.parse(e[t].item_key);i&&d[i].tags.usable&&Ht[i]&&rs(i)}}function ci(e,t){if(e){let i=r.equipment[e.equip_slot];Lo(e.equip_slot,!0),r.equipment[e.equip_slot]=e,Xi(),ve({skip_sorting:t}),r.stats.add_all_equipment_bonus(),Te(),So(e),i&&So(i)}else{Xi(),ve({skip_sorting:t}),r.stats.add_all_equipment_bonus(),Te();return}}function Tr(e){e in r.inventory&&(ci(r.inventory[e].item),dt([{item_key:e}]))}function Lo(e,t=!1){if(r.equipment[e]!=null){let i=r.equipment[e];ze([{item_key:i.getInventoryKey()}]),r.equipment[e]=null,Xi(),ve(),t||(r.stats.add_all_equipment_bonus(),Te(),So(i))}}function So(e){let t=Object.keys(e.getBonusSkillLevels());if(t.length>0)for(let i=0;i<t.length;i++)t[i].includes("category_")||ts(p[t[i]])}function $i(){return r.get_character_cold_tolerance()}function Te(){r.stats.add_location_penalties(),r.update_stats(),Ka(),ri(),Zi(),Za()}function At(e){return(r.xp_bonuses.total_multiplier[e]||1)*ko(e)}function ko(e){let t="category_"+p[e].category;return(r.xp_bonuses.total_multiplier.all_skill||1)*(r.xp_bonuses.total_multiplier.all||1)*(r.xp_bonuses.total_multiplier[t]||1)}function $r(){return(r.xp_bonuses.total_multiplier.all_skill||1)*(r.xp_bonuses.total_multiplier.all||1)}function Er(){return(r.xp_bonuses.total_multiplier.hero||1)*(r.xp_bonuses.total_multiplier.all||1)}function G(e){return p[e].current_level+(r.bonus_skill_levels.full[e]||0)}function kt(e){return p[e].get_level_bonus(G(e))}function A({scaling_type:e,skill_id:t}){return p[t].get_coefficient({scaling_type:e,skill_level:G(t)})}function xo(e){let t=1;Object.keys(Hi).forEach(n=>{e.tags[Hi[n]]&&(t*=A({scaling_type:"multiplicative",skill_id:n}))});let i={stats:{},bonus_skill_levels:{...e.effects.bonus_skill_levels},xp_multipliers:{...e.effects.xp_multipliers}};for(let[n,s]of Object.entries(e.effects.stats))i.stats[n]={},s.flat?n.includes("_percent")?i.stats[n].flat=s.flat*(t>0?t:1):i.stats[n].flat=s.flat*(t>0?t:1)**2:s.multiplier&&(i.stats[n].multiplier=s.multiplier*(t>1?t:1));return i}var ke={trash:1,common:1,uncommon:1.1,rare:1.3,epic:1.6,legendary:2,mythical:2.5},d={};function ra(e){let t;if(d[e].component_type==="helmet interior")t="head";else if(d[e].component_type==="chestplate interior")t="torso";else if(d[e].component_type==="leg armor interior")t="legs";else if(d[e].component_type==="glove interior")t="arms";else if(d[e].component_type==="shoes interior")t="feet";else return console.error(`Component type "${d[e].component_type}" doesn't correspond to any armor slot!`),null;return t}function Ke(e){let t;return e<50?t="trash":e<=100?t="common":e<130?t="uncommon":e<160?t="rare":e<200?t="epic":e<246?t="legendary":t="mythical",t}function pu({components:e,quality:t=100}){let i=0;return Object.values(e).forEach(n=>{i+=d[n].value}),$e(1.25*i*(t/100)*ke[Ke(t)])}var on=class{constructor({name:t,description:i,value:n=0,tags:s={},market_saturation_group:a,saturates_market:o,material_type:l=null,quality:u=null,id:c=null,components:_=null,getName:h=()=>this.name}){if(this.name=t,this.name?.startsWith(Ee))throw new Error(`Item name of item "${this.name}" starts with a forbidden prefix!`);this.id=c,this.description=i,this.saturates_market=o??!0,this.material_type=l,this.quality=u,this.components=_,this.value=n,this.tags=s,this.tags.item=!0,this.market_saturation_group=a,this.getName||(this.getName=h)}getMarketSaturationGroup(){return this.market_saturation_group||{group_key:this.id,group_tier:0}}getInventoryKey(){return this.inventory_key||(this.inventory_key=this.createInventoryKey()),this.inventory_key}createInventoryKey(){let t={};return this.components?(t.components={},Object.keys(this.components).forEach(i=>{t.components[i]=this.components[i]})):t.id=this.id,this.quality&&(t.quality=this.quality),JSON.stringify(t)}getBaseValue({quality:t,multiplier:i=1}={}){return t=t||this.quality||100,this.components?pu({components:this.components,quality:t}):$e(i*this.value*(t/100)*ke[Ke(t)])}getValue({quality:t,region:i,multiplier:n}){return t=t||this.quality||100,!this.saturates_market||!i?this.getBaseValue({quality:t,multiplier:n}):this.getValueWithSaturation(i,n)}getValueWithSaturation(t,i=1){let{group_key:n,group_tier:s}=this.getMarketSaturationGroup();return il({item:this,value:$e(this.getBaseValue()*i),group_key:n,group_tier:s,region:t})}getValueOfMultiple({additional_traded_count:t=0,count:i,region:n,price_multiplier:s=1,is_selling:a=!0,stop_multiplier_at:o=1/0}){if(this.saturates_market){let{group_key:l,group_tier:u}=this.getMarketSaturationGroup(),c=this.getBaseValue(),_=tl({value:$e(c*s),start_count:xs({region:n,group_key:l,group_tier:u})+t,how_many_to_trade:i,region:n,is_group:l.startsWith(Ee),is_selling:a,stop_multiplier_at:o});return Math.max(i,_)}else return $e(this.getBaseValue()*s)*i}getDescription(){return this.description}},ft=class extends on{constructor(t){super(t),this.item_type="OTHER"}},B=class extends ft{constructor(t){super(t),this.item_type="MATERIAL",this.tags.material=!0}},la=class extends on{constructor(t){super(t),this.item_type="COMPONENT",this.component_tier=t.component_tier||1,this.component_stats=t.component_stats||{},this.tags.component=!0,this.quality=Math.round(t.quality)||100}getRarity(t){return t?Ke(t):(this.rarity||(this.rarity=Ke(this.quality)),this.rarity)}calculateRarity(t){let i;return t<50?i="trash":t<100?i="common":t<130?i="uncommon":t<160?i="rare":t<200?i="epic":t<246?i="legendary":i="mythical",i}getStats(){return this.component_stats}},V=class extends la{constructor(t){if(super(t),t.component_type!=="axe head"&&t.component_type!=="hammer head"&&t.component_type!=="short blade"&&t.component_type!=="long blade"&&t.component_type!=="short handle"&&t.component_type!=="long handle"&&t.component_type!=="medium handle")throw new Error(`No such weapon component type as ${t.component_type}`);this.component_type=t.component_type,this.attack_value=t.attack_value||0,t.component_type==="short handle"?(this.attack_multiplier=1,this.market_saturation_group={group_key:Ee+"handle",group_tier:this.component_tier-1}):t.component_type==="medium handle"?(this.attack_multiplier=1,this.market_saturation_group={group_key:Ee+"handle",group_tier:this.component_tier-1}):t.component_type==="long handle"?(this.attack_multiplier=1.5,this.market_saturation_group={group_key:Ee+"handle",group_tier:this.component_tier-1}):(this.attack_multiplier=1,this.market_saturation_group={group_key:Ee+"weapon",group_tier:this.component_tier-1}),this.name_prefix=t.name_prefix,this.tags["weapon component"]=!0,this.tags.component=!0}},Fe=class extends la{constructor(t){if(super(t),t.component_type!=="shield base"&&t.component_type!=="shield handle")throw new Error(`No such shield component type as ${t.component_type}`);this.component_type=t.component_type,t.component_type==="shield base"?this.market_saturation_group={group_key:Ee+"shield",group_tier:this.component_tier-1}:this.market_saturation_group={group_key:Ee+"handle",group_tier:this.component_tier-1},this.shield_strength=t.shield_strength,this.shield_name=t.shield_name||t.name,this.tags["shield component"]=!0,this.tags.component=!0}},ae=class extends la{constructor(t){if(super(t),t.component_type!=="helmet interior"&&t.component_type!=="helmet exterior"&&t.component_type!=="chestplate interior"&&t.component_type!=="chestplate exterior"&&t.component_type!=="leg armor interior"&&t.component_type!=="leg armor exterior"&&t.component_type!=="glove interior"&&t.component_type!=="glove exterior"&&t.component_type!=="shoes interior"&&t.component_type!=="shoes exterior")throw new Error(`No such armor component type as ${t.component_type}`);this.component_type=t.component_type,this.defense_value=t.defense_value,this.stats=t.stats||{},this.equip_slot=t.equip_slot,this.full_armor_name=t.full_armor_name,this.armor_name=t.armor_name,this.name_prefix=t.name_prefix,this.name_suffix=t.name_suffix,this.tags["armor component"]=!0,this.tags.component=!0,this.market_saturation_group={group_key:Ee+"armor",group_tier:this.component_tier-1}}},xe=class extends on{constructor(t){super(t),this.item_type="USABLE",this.effects=t.effects||{},this.recovery_chances=t.recovery_chances||{},this.saturates_market=!1,this.tags.usable=!0}},ui=class extends on{constructor(t){super(t),this.item_type="EQUIPPABLE",this.bonus_skill_levels=t.bonus_skill_levels||{},this.quality=Math.round(Number(t.quality))||100,this.tags.equippable=!0}getItemTier(){if(this.components){let t=1;return Object.values(this.components).forEach(i=>{d[i].component_tier>t&&(t=d[i].component_tier)}),t}else return this.component_tier?this.component_tier:1}getRarity(t){return t?Ke(t):(this.rarity||(this.rarity=Ke(this.quality)),this.rarity)}getStats(t){return t?this.calculateStats(t):(this.stats||(this.stats=this.calculateStats(this.quality)),this.stats)}calculateStats(t){let i={};if(this.components){let n=Object.values(this.components).map(s=>d[s]).filter(s=>s);for(let s=0;s<n.length;s++)Object.keys(n[s].component_stats).forEach(a=>{i[a]||(i[a]={}),!(a==="defense"||a==="attack_power"||a==="block_strength")&&(n[s].component_stats[a].multiplier&&(i[a].multiplier=(i[a].multiplier||1)*n[s].component_stats[a].multiplier),n[s].component_stats[a].flat&&(i[a].flat=(i[a].flat||0)+n[s].component_stats[a].flat))});Object.keys(i).forEach(s=>{i[s].multiplier&&(i[s].multiplier>=1?i[s].multiplier=Math.round(100*(1+(i[s].multiplier-1)*ke[this.getRarity(t)]))/100:i[s].multiplier=Math.round(100*i[s].multiplier)/100),i[s].flat&&(i[s].flat>0?i[s].flat=Math.round(100*i[s].flat*ke[this.getRarity(t)])/100:i[s].flat=Math.round(100*i[s].flat)/100)})}else{let n=this.component_stats||this.base_stats||{};Object.keys(n).forEach(s=>{i[s]={},n[s].multiplier&&(i[s].multiplier=1,n[s].multiplier>=1?i[s].multiplier=Math.round(100*(1+(n[s].multiplier-1)*ke[this.getRarity(t)]))/100:i[s].multiplier=Math.round(100*n[s].multiplier)/100),n[s].flat&&(i[s].flat=0,n[s].flat>0?i[s].flat=Math.round(100*n[s].flat*ke[this.getRarity(t)])/100:i[s].flat=Math.round(100*n[s].flat)/100)})}return i}getBonusSkillLevels(){return this.bonus_skill_levels}},sn=class extends ui{constructor(t){super(t),this.equip_slot="artifact",this.stats=t.stats,this.ignore_quality=!0,this.tags.artifact=!0,this.id||(this.id=this.getName())}getStats(){return this.stats}},Bt=class extends ui{constructor(t){super(t),this.equip_slot=t.equip_slot,this.ignore_quality=!0,this.tags.tool=!0,this.tags[this.equip_slot]=!0,this.id||(this.id=this.getName())}getStats(){return{}}},Ze=class extends ui{constructor(t){if(super(t),this.equip_slot="off-hand",this.offhand_type="shield",!d[t.components.shield_base])throw new Error(`No such shield base component as: ${t.components.shield_base}`);if(this.components.shield_base=t.components.shield_base,t.components.handle&&!d[t.components.handle])throw new Error(`No such shield handle component as: ${t.components.handle}`);this.components.handle=t.components.handle,this.tags={...this.tags,...d[this.components.handle].tags,...d[this.components.shield_base].tags},this.tags.shield=!0,this.id||(this.id=this.getName()),this.market_saturation_group={group_key:Ee+"shield",group_tier:this.getItemTier()-1}}getShieldStrength(t){return t?this.calculateShieldStrength(t):(this.shield_strength||(this.shield_strength=this.calculateShieldStrength(this.quality)),this.shield_strength)}calculateShieldStrength(t){return Math.round(10*Math.ceil(10*d[this.components.shield_base].shield_strength*(d[this.components.handle].component_stats?.block_strength?.multiplier||1)*(t/100)*ke[this.getRarity(t)]))/100}getName(){return d[this.components.shield_base].shield_name}},Q=class extends ui{constructor(t){if(super(t),t.components){if(!d[t.components.internal])throw new Error(`No such internal armor element as: ${t.components.internal}`);if(this.components.internal=t.components.internal,this.components.external=t.components.external,d[this.components.internal].component_type==="helmet interior")this.equip_slot="head";else if(d[this.components.internal].component_type==="chestplate interior")this.equip_slot="torso";else if(d[this.components.internal].component_type==="leg armor interior")this.equip_slot="legs";else if(d[this.components.internal].component_type==="glove interior")this.equip_slot="arms";else if(d[this.components.internal].component_type==="shoes interior")this.equip_slot="feet";else throw new Error(`Component type "${d[this.components.internal].component_type}" doesn't correspond to any armor slot!`);if(t.external&&!d[t.external])throw new Error(`No such external armor element as: ${t.components.external}`);this.market_saturation_group={group_key:Ee+"armor",group_tier:this.getItemTier()-1}}else{if(this.tags.component=!0,this.tags["armor component"]=!0,this.tags.clothing=!0,this.component_stats=t.component_stats||{},delete this.components,!t.name)throw new Error("Component-less item needs to be provided a name!");if(this.name=t.name,!t.value)throw new Error(`Component-less item "${this.getName()}" needs to be provided a monetary value!`);if(this.component_type=t.component_type,this.value=t.value,this.component_tier=t.component_tier||1,this.base_defense=t.base_defense,this.market_saturation_group={group_key:Ee+"clothing",group_tier:this.getItemTier()-1},t.component_type==="helmet interior")this.equip_slot="head";else if(t.component_type==="chestplate interior")this.equip_slot="torso";else if(t.component_type==="leg armor interior")this.equip_slot="legs";else if(t.component_type==="glove interior")this.equip_slot="arms";else if(t.component_type==="shoes interior")this.equip_slot="feet";else throw new Error(`Component type "${t.component_type}" doesn't correspond to any armor slot!`)}this.tags.armor=!0,this.id||(this.id=this.getName())}getDefense(t){return t?this.calculateDefense(t):(this.defense_value||(this.defense_value=this.calculateDefense(this.quality)),this.defense_value)}calculateDefense(t){return this.components?Math.ceil(((d[this.components.internal].defense_value||d[this.components.internal].base_defense||0)+(d[this.components.external]?.defense_value||0))*(t/100||this.quality/100)*ke[this.getRarity(t||this.quality)]):Math.ceil((this.base_defense||0)*(t/100||this.quality/100)*ke[this.getRarity(t||this.quality)])}getName(){return this.name||(this.components.external?d[this.components.external].full_armor_name?this.name=d[this.components.external].full_armor_name:this.name=(d[this.components.external].name_prefix||"")+" "+d[this.components.internal].armor_name.toLowerCase()+" "+(d[this.components.external].name_suffix||""):this.name=d[this.components.internal].armor_name),this.name}},fe=class extends ui{constructor(t){if(super(t),this.equip_slot="weapon",!d[t.components.head])throw new Error(`No such weapon head as: ${t.components.head}`);if(this.components.head=t.components.head,!d[t.components.handle])throw new Error(`No such weapon handle as: ${t.components.handle}`);if(this.components.handle=t.components.handle,d[this.components.handle].component_type==="long handle"&&(d[this.components.head].component_type==="short blade"||d[this.components.head].component_type==="long blade"))this.weapon_type="spear";else if(d[this.components.handle].component_type==="medium handle"&&d[this.components.head].component_type==="axe head")this.weapon_type="axe";else if(d[this.components.handle].component_type==="medium handle"&&d[this.components.head].component_type==="hammer head")this.weapon_type="hammer";else if(d[this.components.handle].component_type==="short handle"&&d[this.components.head].component_type==="short blade")this.weapon_type="dagger";else if(d[this.components.handle].component_type==="short handle"&&d[this.components.head].component_type==="long blade")this.weapon_type="sword";else throw new Error(`Combination of elements of types ${d[this.components.handle].component_type} and ${d[this.components.head].component_type} does not exist!`);this.tags.weapon=!0,this.tags[this.weapon_type]=!0,this.id||(this.id=this.getName()),this.market_saturation_group={group_key:Ee+"weapon",group_tier:this.getItemTier()-1}}getAttack(t){return t?this.calculateAttackPower(t):(this.attack_power||(this.attack_power=this.calculateAttackPower(this.quality)),this.attack_power)}calculateAttackPower(t){return Math.ceil((d[this.components.head].attack_value+d[this.components.handle].attack_value+(d[this.components.handle].component_stats?.attack_power?.flat||0))*d[this.components.head].attack_multiplier*d[this.components.handle].attack_multiplier*(d[this.components.handle].component_stats?.attack_power?.multiplier||1)*(t/100)*ke[this.getRarity(t)])}getName(){return`${d[this.components.head].name_prefix} ${this.weapon_type==="hammer"?"battle hammer":this.weapon_type}`}},Nt=class extends ui{constructor(t){if(super(t),this.components=void 0,this.equip_slot="cape",this.base_stats=t.base_stats,this.item_tier=t.item_tier,this.tags.cape=!0,!t.name)throw new Error("Component-less item needs to be provided a name!");if(this.name=t.name,!t.value)throw new Error(`Component-less item "${this.getName()}" needs to be provided a monetary value!`);this.value=t.value,this.base_defense=t.base_defense,this.id||(this.id=this.getName()),this.market_saturation_group={group_key:Ee+"cape",group_tier:this.getItemTier()-1}}getDefense(t){return t?this.calculateDefense(t):(this.defense_value||(this.defense_value=this.calculateDefense(this.quality)),this.defense_value)}calculateDefense(t){return Math.ceil((this.base_defense||0)*(t/100||this.quality/100)*ke[this.getRarity(t||this.quality)])}},cs=class extends ui{constructor(t){super(t),this.equip_slot="amulet",this.stats=t.stats,this.ignore_quality=!0,this.tags.amulet=!0,this.id||(this.id=this.getName())}getStats(){return this.stats}},di=class{constructor({required_time:t=1,required_skills:i={literacy:0},literacy_xp_rate:n=1,finish_reward:s={},bonuses:a={},rewards:o={}}){this.required_time=t,this.accumulated_time=0,this.required_skills=i,this.literacy_xp_rate=n,this.finish_reward=s,this.is_finished=!1,this.bonuses=a,this.rewards=o}},D={},Yt=class extends on{constructor(t){super(t),this.item_type="BOOK",this.name=t.name,this.tags.book=!0,this.saturates_market=!1}getReadingTime(){let{required_time:t}=D[this.name];return t}getRemainingTime(){return Math.max(D[this.name].required_time-D[this.name].accumulated_time,0)}addProgress(t=1){D[this.name].accumulated_time+=t,D[this.name].accumulated_time>=D[this.name].required_time&&this.setAsFinished()}setAsFinished(){D[this.name].is_finished=!0,D[this.name].accumulated_time=D[this.name].required_time}};function _e(e){switch(e.item_type){case"EQUIPPABLE":switch(e.equip_slot){case"weapon":return new fe(e);case"off-hand":return new Ze(e);case"artifact":return new sn(e);case"axe":case"pickaxe":case"sickle":case"shovel":return new Bt(e);case"cape":return new Nt(e);case"amulet":return new cs(e);default:return new Q(e)}case"USABLE":return new xe(e);case"BOOK":return new Yt(e);case"OTHER":return new ft(e);case"COMPONENT":if(e.tags["weapon component"])return new V(e);if(e.tags["armor component"])return new ae(e);if(e.tags["shield component"])return new Fe(e);throw new Error(`Item ${e.name} has a wrong component type`);case"MATERIAL":return new B(e);default:throw new Error(`Wrong item type: ${e.item_type}`)}}function Oe(e){let{id:t,components:i,quality:n}=JSON.parse(e);if(t&&!n){if(d[t])return _e(d[t]);throw new Error(`Inventory item "${e}" couldn't be found!`)}else if(i){let{head:s,handle:a,shield_base:o,internal:l,external:u}=i;if(s)if(d[s]){if(d[a])return _e({components:i,quality:n,equip_slot:"weapon",item_type:"EQUIPPABLE"});throw new Error(`Weapon handle component "${a}" couldn't be found!`)}else throw new Error(`Weapon head component "${s}" couldn't be found!`);else if(o)if(d[o]){if(d[a])return _e({components:i,quality:n,equip_slot:"off-hand",item_type:"EQUIPPABLE"});throw new Error(`Shield handle component "${a}" couldn't be found!`)}else throw new Error(`Shield base component "${o}" couldn't be found!`);else if(l)if(d[l])if(d[u]){let c=ra(l);return c?_e({components:i,quality:n,equip_slot:c,item_type:"EQUIPPABLE"}):void 0}else throw new Error(`External armor component "${u}" couldn't be found!`);else throw new Error(`Internal armor component "${l}" couldn't be found!`);else throw new Error(`Inventory key "${e}" seems to refer to non-existing item type!`)}else{if(n)return _e({...d[t],quality:n});throw new Error(`Inventory key "${e}" is incorrect!`)}}D["ABC for kids"]=new di({required_time:120,literacy_xp_rate:1,bonuses:{xp_multipliers:{all:1.1}}});D["Old combat manual"]=new di({required_time:320,literacy_xp_rate:1,bonuses:{xp_multipliers:{Combat:1.2}}});D["Twist liek a snek"]=new di({required_time:320,literacy_xp_rate:1,bonuses:{xp_multipliers:{Evasion:1.2},multipliers:{agility:1.1}}});D["Medicine for dummies"]=new di({required_time:420,literacy_xp_rate:2,rewards:{recipes:[{category:"alchemy",subcategory:"items",recipe_id:"Weak healing powder"},{category:"alchemy",subcategory:"items",recipe_id:"Healing balm"},{category:"alchemy",subcategory:"items",recipe_id:"Oneberry juice"},{category:"alchemy",subcategory:"items",recipe_id:"Healing powder"},{category:"alchemy",subcategory:"items",recipe_id:"Healing potion"}]},bonuses:{xp_multipliers:{Medicine:1.2}}});D["Butchering and you"]=new di({required_time:240,literacy_xp_rate:2,rewards:{skills:["Butchering"],recipes:[{category:"cooking",subcategory:"items",recipe_id:"Animal fat"}]}});D["Ode to Whimsy, and other poems"]=new di({required_time:120,literacy_xp_rate:4,bonuses:{xp_multipliers:{all:1.1}}});D["A Glint On The Sand"]=new di({required_time:420,literacy_xp_rate:4,rewards:{recipes:[{category:"alchemy",subcategory:"items",recipe_id:"Potash"},{category:"smelting",subcategory:"items",recipe_id:"Raw Glass"},{category:"crafting",subcategory:"items",recipe_id:"Glass phial"},{category:"crafting",subcategory:"items",recipe_id:"Glass bottle"}],activities:[{location:"Village",activity:"sand"}]}});d["ABC for kids"]=new Yt({name:"ABC for kids",description:"The simplest book on the market",value:100}),d["Old combat manual"]=new Yt({name:"Old combat manual",description:"Old book about combat, worn and outdated, but might still contain something useful",value:200}),d["Twist liek a snek"]=new Yt({name:"Twist liek a snek",description:"This book has a terrible grammar, seemingly written by some uneducated bandit, but despite that it quite well details how to properly evade attacks",value:200}),d["Medicine for dummies"]=new Yt({name:"Medicine for dummies",description:"A simple book about healing, describing how to create some basic medicines",value:320}),d["Butchering and you"]=new Yt({name:"Butchering and you",description:"An introductory book to animal butchering, that goes into further detail on how to make a use of animal parts, especially hides and bones",value:240}),d["Ode to Whimsy, and other poems"]=new Yt({name:"Ode to Whimsy, and other poems",description:"A short and wonderful book of poetry that fills one with appreciation for life",value:200}),d["A Glint On The Sand"]=new Yt({id:"A Glint On The Sand",name:"A Glint On The Sand",description:"This books recounts a tale of shipwrecked crew accidentally discovering glassmaking while cooking on a beach. More importantly, it details the processees and materials necessary to manufacture glass",value:300});(function(){d["Rat fang"]=new ft({name:"Rat fang",description:"Fang of a huge rat, not very sharp, but can still pierce a human skin if enough force is applied",value:8,material_type:"animal tooth"}),d["Wolf fang"]=new ft({name:"Wolf fang",description:"Fang of a wild wolf. Somewhat sharp, still not very useful. Maybe if it had a bit better quality...",value:12,material_type:"animal tooth"}),d["Boar tusk"]=new B({name:"Boar tusk",description:"Tusk of a wild boar. Visibly worn and not very sharp",value:20}),d["Rat meat chunks"]=new ft({name:"Rat meat chunks",description:"Eww",value:8}),d["Glass phial"]=new ft({name:"Glass phial",description:"Small glass phial, a perfect container for a potion",value:10}),d["Glass bottle"]=new ft({name:"Glass bottle",description:"A glass bottle, perfect for carrying a drink around",value:20}),d["Camping supplies"]=new ft({name:"Camping supplies",description:"Bedroll, tent, small chest, and generally just anything that could be needed to establish a camp",value:2e3}),d["Coil of rope"]=new ft({name:"Coil of rope",description:"A nice, long coil of rope, for whatever use you might find (although you have a feeling it will only be very situational)",value:400}),d["Mountain goat horn"]=new ft({name:"Mountain goat horn",description:"A curved and sturdy horn of a mountain goat. While not very useful in itself, it makes for a nice decoration",value:30})})();(function(){d["Rat tail"]=new B({name:"Rat tail",description:"Tail of a huge rat. Doesn't seem very useful, but maybe some meat could be recovered from it",value:4}),d["Rat pelt"]=new B({name:"Rat pelt",description:"Pelt of a huge rat. Fur has terrible quality, but maybe leather could be used for something if you gather more?",value:10,material_type:"pelt"}),d["High quality wolf fang"]=new B({name:"High quality wolf fang",description:"Fang of a wild wolf. Very sharp, undamaged and surprisingly clean",value:15,material_type:"miscellaneous"}),d["Wolf pelt"]=new B({name:"Wolf pelt",description:"Pelt of a wild wolf. It's a bit damaged so it won't fetch a great price, but the leather itself could be useful",value:20,material_type:"pelt"}),d["Boar hide"]=new B({name:"Boar hide",description:"Thick hide of a wild boar. Too stiff for clothing, but might be useful for an armor",value:30,material_type:"pelt"}),d["Boar meat"]=new B({name:"Boar meat",description:"Fatty meat of a wild boar, all it needs is to be cooked",value:20}),d["High quality boar tusk"]=new B({name:"High quality boar tusk",description:"Tusk of a wild boar. Sharp and long enough to easily kill an adult human",value:25,material_type:"miscellaneous"}),d["Bear hide"]=new B({description:"A strong hide of a wild bear, so strong that even steel struggles against it",value:50,material_type:"pelt"}),d["Bear claw"]=new B({description:"Large and dangerous claw of a wild bear, but it has seen better days",value:50}),d["Sharp bear claw"]=new B({description:"Large and dangerous of a wild bear, sharp enough to easily cut through meat",value:80,material_type:"miscellaneous"}),d["Weak monster bone"]=new B({name:"Weak monster bone",description:"Mutated and dark bone of a monster. While on the weaker side, it's still very strong and should be useful for crafting after some processing",value:30,material_type:"bone"}),d["Goat meat"]=new B({name:"Goat meat",description:"Lean meat of a goat, it's pretty tough and needs to be cooked for a long time",value:25}),d["Mountain goat hide"]=new B({name:"Mountain goat hide",description:"Thick hide of a mountain goat hide. Not as strong as boar hide, but this one can actually be turned into clothes after some processing",value:30,material_type:"pelt"}),d["Pristine mountain goat horn"]=new B({name:"Pristine mountain goat horn",description:"Curved and sturdy horn of a mountain goat. It's noticeably bigger than average and seems to be even sturdier",value:70,material_type:"miscellaneous"})})();(function(){d["Low quality iron ore"]=new B({name:"Low quality iron ore",description:"Iron content is rather low and there are a lot of problematic components that can't be fully removed, which will affect created materials",value:3,material_type:"raw metal"}),d["Iron ore"]=new B({name:"Iron ore",description:"It has a decent iron content and can be smelt into market-quality iron",value:5,material_type:"raw metal"}),d["Atratan ore"]=new B({name:"Atratan ore",description:"A dark-colored ore that's useless by itself but can be mixed with iron to create steel",value:6,material_type:"raw metal"}),d.Coal=new B({name:"Coal",description:"A flammable material with extremely high carbon content",value:7,material_type:"coal"}),d.Charcoal=new B({name:"Charcoal",description:"A flammable material with extremely high carbon content, created by strongly heating wood",value:5,material_type:"coal"}),d["Piece of rough wood"]=new B({description:"Cheapest form of wood. There's a lot of bark and malformed pieces",value:2,material_type:"raw wood",getName:()=>bi()?"Piece of rat wood":"Piece of rough wood"}),d["Piece of wood"]=new B({description:"Average quality wood. There's a lot of bark and malformed pieces",value:4,material_type:"raw wood"}),d["Piece of ash wood"]=new B({description:"Strong yet elastic, it's best wood you can hope to find around. There's a lot of bark and malformed pieces",value:7,material_type:"raw wood"}),d["Belmart leaf"]=new B({description:"Small, round, dark-green leaves with with very good disinfectant properties",value:8,material_type:"disinfectant herb"}),d["Golmoon leaf"]=new B({description:"Big green-brown leaves that can be applied to wounds to speed up their healing",value:8,material_type:"healing herb"}),d.Oneberry=new B({description:"Small blue berries capable of stimulating body's natural healing",value:8,material_type:"healing herb"}),d["Silver thistle"]=new B({description:"Rare herb that usually grows high up in mountains, a potent healing ingredient",value:20,material_type:"healing herb"}),d["Cooking herbs"]=new B({name:"Parsley, sage, rosemary and thyme",description:"A collection of various herbs commonly used to enhance the flavour and nutrition of dishes",value:10,material_type:"culinary herb"}),d.Wool=new B({description:"A handful of wool, raw and unprocessed",value:8,material_type:"raw fabric"}),d["Silica Sand"]=new B({name:"Silica sand",description:"Sand made potent by the remains of countless generations of creatures that lived and died in the body of water it was taken from",value:1})})();(function(){d.Bonemeal=new B({description:"Powdered bones and teeth, that can be used as an organic fertilizer",value:100}),d["Low quality iron ingot"]=new B({description:"It has a lot of impurities, resulting in it being noticeably below the market standard",value:10,material_type:"metal"}),d["Iron ingot"]=new B({description:"It doesn't suffer from any excessive impurities and can be used without worries",value:20,material_type:"metal"}),d["Steel ingot"]=new B({description:"Basic alloy of iron, harder and more resistant",value:40,material_type:"metal"}),d["Piece of wolf rat leather"]=new B({description:"It's slightly damaged and seems useless for anything that requires precise work",value:10,material_type:"piece of leather"}),d["Processed rat pelt"]=new B({description:"Processed pelt of a huge rat. It's of a barely acceptable quality, but it's still a miracle with how terrible the basic material was",value:15,material_type:"processed pelt"}),d["Piece of wolf leather"]=new B({description:"Somewhat strong, should offer some protection when turned into armor",value:20,material_type:"piece of leather"}),d["Processed wolf pelt"]=new B({description:"Processed pelt of a wild wolf. It's a nice, stylish material",value:30,material_type:"processed pelt"}),d["Piece of boar leather"]=new B({description:"Thick and resistant leather, too stiff for clothes but perfect for armor",value:30,material_type:"piece of leather"}),d["Processed boar hide"]=new B({description:"Processed hide of a wild boar. It's a rough, heavy material, but it's quite strong",value:45,material_type:"processed pelt"}),d["Piece of goat leather"]=new B({description:"Thick and resistant, just barely elastic enough to be used for clothing",value:40,material_type:"piece of leather"}),d["Processed goat hide"]=new B({description:"Processed hide of a wild goat. It's a rough and resistant material",value:60,material_type:"processed pelt"}),d["Piece of bear leather"]=new B({description:"Strong and resistant, but too thick for clothing",value:60,material_type:"piece of leather"}),d["Processed bear hide"]=new B({description:"Strong, resistan, and warm",value:90,material_type:"piece of leather"}),d["Animal fat"]=new B({description:"White, thick, oily substance, rendered from animal tissue",value:40,material_type:"fat"}),d["Wool cloth"]=new B({description:"Thick and warm, might possibly absorb some punches",value:8,material_type:"fabric"}),d["Iron chainmail"]=new B({description:"Dozens of tiny iron rings linked together. Nowhere near a wearable form, turning it into armor will still take a lot of effort and focus",value:12,material_type:"chainmail"}),d["Steel chainmail"]=new B({description:"Dozens of tiny steel rings linked together. Nowhere near a wearable form, turning it into armor will still take a lot of effort and focus",value:18,material_type:"chainmail"}),d["Scraps of wolf rat meat"]=new B({description:"Ignoring where they come from and all the attached diseases, they actually look edible. Just remember to cook it first",value:8,material_type:"meat"}),d["Processed rough wood"]=new B({description:"Cheapest form of wood, ready to be used. Despite being rather weak, it still has a lot of uses",value:6,material_type:"wood"}),d["Processed wood"]=new B({description:"Average quality wood, ready to be used",value:11,material_type:"wood"}),d["Processed ash wood"]=new B({description:"High quality wood, just waiting to be turned into a piece of equipment",value:20,material_type:"wood"}),d["Processed weak monster bone"]=new B({description:"Polished and cleaned bones of a weak monster, just waiting to be turned into a piece of equipment",value:40,material_type:"bone"}),d.Potash=new B({description:"An alchemical substance derived from plant ash, sought after for production of bleach, soap and glass",value:25}),d["Raw Glass"]=new B({name:"Raw glass",description:"Molten piece of glass, yet to be shaped into something useful",value:100})})();(function(){d["Basic spare parts"]=new ft({name:"Basic spare parts",description:"Some cheap and simple spare parts, like bindings and screws, necessary for crafting equipment",value:30,component_tier:1})})();(function(){d["Cheap short iron blade"]=new V({name:"Cheap short iron blade",description:"Crude blade made of iron. Perfect length for a dagger, but could be also used for a spear",component_type:"short blade",value:70,component_tier:1,name_prefix:"Cheap iron",attack_value:5,component_stats:{crit_rate:{flat:.06},attack_speed:{multiplier:1.2},evasion_points:{multiplier:1.05}}}),d["Short iron blade"]=new V({name:"Short iron blade",description:"A good iron blade. Perfect length for a dagger, but could be also used for a spear",component_type:"short blade",value:160,component_tier:2,name_prefix:"Iron",attack_value:8,component_stats:{crit_rate:{flat:.08},attack_speed:{multiplier:1.3},evasion_points:{multiplier:1.13}}}),d["Short steel blade"]=new V({name:"Short steel blade",description:"A good steel blade. Perfect length for a dagger, but could be also used for a spear",component_type:"short blade",value:240,component_tier:3,name_prefix:"Steel",attack_value:11,component_stats:{crit_rate:{flat:.1},attack_speed:{multiplier:1.35},evasion_points:{multiplier:1.2}}}),d["Cheap long iron blade"]=new V({name:"Cheap long iron blade",description:"Crude blade made of iron, with a perfect length for a sword",component_type:"long blade",value:100,name_prefix:"Cheap iron",component_tier:1,attack_value:8,component_stats:{attack_speed:{multiplier:1.1},crit_rate:{flat:.02},attack_points:{multiplier:1.05}}}),d["Long iron blade"]=new V({name:"Long iron blade",description:"Good blade made of iron, with a perfect length for a sword",component_type:"long blade",value:210,name_prefix:"Iron",component_tier:2,attack_value:13,component_stats:{attack_speed:{multiplier:1.15},crit_rate:{flat:.04},attack_points:{multiplier:1.13}}}),d["Long steel blade"]=new V({name:"Long steel blade",description:"Good blade made of steel, with a perfect length for a sword",component_type:"long blade",value:310,name_prefix:"Steel",component_tier:3,attack_value:18,component_stats:{attack_speed:{multiplier:1.2},crit_rate:{flat:.05},attack_points:{multiplier:1.2}}}),d["Cheap iron axe head"]=new V({name:"Cheap iron axe head",description:"A heavy axe head made of low quality iron",component_type:"axe head",value:100,name_prefix:"Cheap iron",component_tier:1,attack_value:10,component_stats:{attack_speed:{multiplier:.9}}}),d["Iron axe head"]=new V({name:"Iron axe head",description:"A heavy axe head made of steel",component_type:"axe head",value:210,name_prefix:"Iron",component_tier:2,attack_value:16,component_stats:{attack_speed:{multiplier:.95}}}),d["Steel axe head"]=new V({name:"Steel axe head",description:"A heavy axe head made of steel",component_type:"axe head",value:310,name_prefix:"Steel",component_tier:3,attack_value:22}),d["Cheap iron hammer head"]=new V({name:"Cheap iron hammer head",description:"A crude ball made of low quality iron, with a small hole for the handle",component_type:"hammer head",value:100,name_prefix:"Cheap iron",component_tier:1,attack_value:12,component_stats:{attack_speed:{multiplier:.8}}}),d["Iron hammer head"]=new V({name:"Iron hammer head",description:"A crude ball made of iron, with a small hole for the handle",component_type:"hammer head",value:210,name_prefix:"Iron",component_tier:2,attack_value:19,component_stats:{attack_speed:{multiplier:.85}}}),d["Steel hammer head"]=new V({name:"Steel hammer head",description:"A blocky piece of steel, with a small hole for the handle",component_type:"hammer head",value:300,name_prefix:"Steel",component_tier:3,attack_value:26,component_stats:{attack_speed:{multiplier:.9}}}),d["Simple short wooden hilt"]=new V({name:"Simple short wooden hilt",description:"A short handle for a sword or maybe a dagger",component_type:"short handle",value:8,component_tier:1}),d["Short wooden hilt"]=new V({name:"Short wooden hilt",description:"A short handle for a sword or maybe a dagger",component_type:"short handle",value:32,component_tier:2,component_stats:{attack_speed:{multiplier:1.05}}}),d["Short ash wood hilt"]=new V({name:"Short ash wood hilt",description:"A short handle for a sword or maybe a dagger",component_type:"short handle",value:48,component_tier:3,component_stats:{attack_speed:{multiplier:1.1}}}),d["Simple medium wooden handle"]=new V({name:"Simple medium wooden handle",description:"A medium handle for an axe or a hammer",component_type:"medium handle",value:16,component_tier:1,component_stats:{attack_speed:{multiplier:.95}}}),d["Medium wooden handle"]=new V({name:"Medium wooden handle",description:"A medium handle for an axe or a hammer",component_type:"medium handle",value:64,component_tier:2}),d["Medium ash wood handle"]=new V({name:"Medium ash wood handle",description:"A medium handle for an axe or a hammer",component_type:"medium handle",value:96,component_tier:3,component_stats:{attack_speed:{multiplier:1.05}}}),d["Simple long wooden shaft"]=new V({name:"Simple long wooden shaft",description:"A long shaft for a spear, somewhat uneven",component_type:"long handle",value:24,component_tier:1,component_stats:{attack_speed:{multiplier:.9}}}),d["Long wooden shaft"]=new V({name:"Long wooden shaft",description:"A long shaft for a spear, somewhat uneven",component_type:"long handle",value:100,component_tier:2,component_stats:{attack_speed:{multiplier:.95}}}),d["Long ash wood shaft"]=new V({name:"Long ash wood shaft",description:"A long shaft for a spear",component_type:"long handle",value:150,component_tier:3}),d["Cheap short iron hilt"]=new V({name:"Cheap short iron hilt",description:"A short handle for a sword or maybe a dagger, heavy",component_type:"short handle",value:56,component_tier:1,component_stats:{attack_speed:{multiplier:.9},attack_power:{multiplier:1.05}}}),d["Short iron hilt"]=new V({name:"Short iron hilt",description:"A short handle for a sword or maybe a dagger, heavy",component_type:"short handle",value:80,component_tier:2,component_stats:{attack_power:{multiplier:1.05}}}),d["Short steel hilt"]=new V({name:"Short steel hilt",description:"A short handle for a sword or maybe a dagger, heavy",component_type:"short handle",value:120,component_tier:3,component_stats:{attack_power:{multiplier:1.1}}}),d["Cheap medium iron handle"]=new V({name:"Cheap medium iron handle",description:"A medium handle for an axe or a hammer, very heavy",component_type:"medium handle",value:64,component_tier:1,component_stats:{attack_speed:{multiplier:.7},attack_power:{multiplier:1.2}}}),d["Medium iron handle"]=new V({name:"Medium iron handle",description:"A medium handle for an axe or a hammer, very heavy",component_type:"medium handle",value:100,component_tier:2,component_stats:{attack_speed:{multiplier:.8},attack_power:{multiplier:1.2}}}),d["Medium steel handle"]=new V({name:"Medium steel handle",description:"A medium handle for an axe or a hammer, very heavy",component_type:"medium handle",value:150,component_tier:3,component_stats:{attack_speed:{multiplier:.8},attack_power:{multiplier:1.27}}}),d["Cheap long iron shaft"]=new V({name:"Cheap long iron shaft",description:"A long shaft for a spear, extremely heavy",component_type:"long handle",value:92,component_tier:1,component_stats:{attack_speed:{multiplier:.5},attack_power:{multiplier:1.6}}}),d["Long iron shaft"]=new V({name:"Long iron shaft",description:"A long shaft for a spear,  extremely heavy",component_type:"long handle",value:128,component_tier:2,component_stats:{attack_speed:{multiplier:.6},attack_power:{multiplier:1.6}}}),d["Long steel shaft"]=new V({name:"Long steel shaft",description:"A long shaft for a spear, extremely heavy",component_type:"long handle",value:192,component_tier:3,component_stats:{attack_speed:{multiplier:.6},attack_power:{multiplier:1.75}}}),d["Short weak bone hilt"]=new V({name:"Short weak bone hilt",description:"A short handle for a sword or maybe a dagger, made of a weak monster's bone",component_type:"short handle",value:120,component_tier:3,component_stats:{attack_power:{multiplier:1.05},attack_speed:{multiplier:1.05}}}),d["Medium weak bone handle"]=new V({name:"Medium weak bone handle",description:"A medium handle for an axe or a hammer, made of a weak monster's bone",component_type:"medium handle",value:150,component_tier:3,component_stats:{attack_speed:{multiplier:.95},attack_power:{multiplier:1.1}}}),d["Long weak bone shaft"]=new V({name:"Long weak bone shaft",description:"A long shaft for a spear, made of weak monster's bone",component_type:"long handle",value:192,component_tier:3,component_stats:{attack_speed:{multiplier:.8},attack_power:{multiplier:1.5}}})})();(function(){d["Cheap iron spear"]=new fe({components:{head:"Cheap short iron blade",handle:"Simple long wooden shaft"}}),d["Iron spear"]=new fe({components:{head:"Short iron blade",handle:"Simple long wooden shaft"}}),d["Steel spear"]=new fe({components:{head:"Short steel blade",handle:"Long wooden shaft"}}),d["Cheap iron dagger"]=new fe({components:{head:"Cheap short iron blade",handle:"Simple short wooden hilt"}}),d["Iron dagger"]=new fe({components:{head:"Short iron blade",handle:"Simple short wooden hilt"}}),d["Steel dagger"]=new fe({components:{head:"Short steel blade",handle:"Short wooden hilt"}}),d["Cheap iron sword"]=new fe({components:{head:"Cheap long iron blade",handle:"Simple short wooden hilt"}}),d["Iron sword"]=new fe({components:{head:"Long iron blade",handle:"Simple short wooden hilt"}}),d["Steel sword"]=new fe({components:{head:"Long steel blade",handle:"Short wooden hilt"}}),d["Cheap iron axe"]=new fe({components:{head:"Cheap iron axe head",handle:"Simple medium wooden handle"}}),d["Iron axe"]=new fe({components:{head:"Iron axe head",handle:"Simple medium wooden handle"}}),d["Steel axe"]=new fe({components:{head:"Steel axe head",handle:"Medium wooden handle"}}),d["Cheap iron battle hammer"]=new fe({components:{head:"Cheap iron hammer head",handle:"Simple medium wooden handle"}}),d["Iron battle hammer"]=new fe({components:{head:"Iron hammer head",handle:"Simple medium wooden handle"}}),d["Steel battle hammer"]=new fe({components:{head:"Steel hammer head",handle:"Medium wooden handle"}})})();(function(){d["Wolf leather helmet armor"]=new ae({name:"Wolf leather helmet armor",description:"Strenghtened wolf leather, ready to be used as a part of a helmet",component_type:"helmet exterior",value:240,component_tier:2,full_armor_name:"Wolf leather helmet",defense_value:2,component_stats:{agility:{multiplier:.95}}}),d["Boar leather helmet armor"]=new ae({name:"Boar leather helmet armor",description:"Strong boar leather, ready to be used as a part of a helmet",component_type:"helmet exterior",value:400,component_tier:3,full_armor_name:"Boar leather helmet",defense_value:3,component_stats:{agility:{multiplier:.95}}}),d["Bear leather helmet armor"]=new ae({name:"Bear leather helmet armor",description:"Strong bear leather, ready to be used as a part of a helmet",component_type:"helmet exterior",value:600,component_tier:4,full_armor_name:"Bear leather helmet",defense_value:4,component_stats:{agility:{multiplier:.95}}}),d["Wolf leather chestplate armor"]=new ae({id:"Wolf leather chestplate armor",name:"Wolf leather cuirass",description:"Simple cuirass made of solid wolf leather, all it needs now is something softer to wear under it",component_type:"chestplate exterior",value:480,component_tier:2,full_armor_name:"Wolf leather armor",defense_value:4,component_stats:{agility:{multiplier:.95}}}),d["Boar leather chestplate armor"]=new ae({id:"Boar leather chestplate armor",name:"Boar leather cuirass",description:"Strong cuirass made of boar leather",component_type:"chestplate exterior",value:800,component_tier:3,full_armor_name:"Boar leather armor",defense_value:6,component_stats:{agility:{multiplier:.95}}}),d["Bear leather chestplate armor"]=new ae({id:"Bear leather chestplate armor",name:"Bear leather cuirass",description:"Strong cuirass made of bear leather",component_type:"chestplate exterior",value:1e3,component_tier:4,full_armor_name:"Bear leather armor",defense_value:8,component_stats:{agility:{multiplier:.95}}}),d["Wolf leather greaves"]=new ae({name:"Wolf leather greaves",description:"Greaves made of wolf leather. Just attach them onto some pants and you are ready to go",component_type:"leg armor exterior",value:240,component_tier:2,full_armor_name:"Wolf leather armored pants",defense_value:2,component_stats:{agility:{multiplier:.95}}}),d["Boar leather greaves"]=new ae({name:"Boar leather greaves",description:"Greaves made of thick boar leather. Just attach them onto some pants and you are ready to go",component_type:"leg armor exterior",value:400,component_tier:3,full_armor_name:"Boar leather armored pants",defense_value:3,component_stats:{agility:{multiplier:.95}}}),d["Bear leather greaves"]=new ae({name:"Bear leather greaves",description:"Greaves made of thick bear leather. Just attach them onto some pants and you are ready to go",component_type:"leg armor exterior",value:600,component_tier:4,full_armor_name:"Bear leather armored pants",defense_value:4,component_stats:{agility:{multiplier:.95}}}),d["Wolf leather glove armor"]=new ae({name:"Wolf leather glove armor",description:"Pieces of wolf leather shaped for gloves",component_type:"glove exterior",value:240,component_tier:2,full_armor_name:"Wolf leather gloves",defense_value:2}),d["Boar leather glove armor"]=new ae({name:"Boar leather glove armor",description:"Pieces of boar leather shaped for gloves",component_type:"glove exterior",value:400,component_tier:3,full_armor_name:"Boar leather gloves",defense_value:3}),d["Bear leather glove armor"]=new ae({name:"Bear leather glove armor",description:"Pieces of bear leather shaped for gloves",component_type:"glove exterior",value:600,component_tier:4,full_armor_name:"Bear leather gloves",defense_value:4}),d["Wolf leather shoe armor"]=new ae({name:"Wolf leather shoe armor",description:"Pieces of wolf leather shaped for shoes",component_type:"shoes exterior",value:240,component_tier:2,full_armor_name:"Wolf leather shoes",defense_value:2}),d["Boar leather shoe armor"]=new ae({name:"Boar leather shoe armor",description:"Pieces of boar leather shaped for shoes",component_type:"shoes exterior",value:400,component_tier:3,full_armor_name:"Boar leather shoes",defense_value:3}),d["Bear leather shoe armor"]=new ae({name:"Bear leather shoe armor",description:"Pieces of bear leather shaped for shoes",component_type:"shoes exterior",value:600,component_tier:4,full_armor_name:"Bear leather shoes",defense_value:4}),d["Iron chainmail helmet armor"]=new ae({name:"Iron chainmail helmet armor",description:"Best way to keep your head in one piece",component_type:"helmet exterior",value:320,component_tier:2,full_armor_name:"Iron chainmail helmet",defense_value:4,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),d["Steel chainmail helmet armor"]=new ae({name:"Steel chainmail helmet armor",description:"Best way to keep your head in one piece",component_type:"helmet exterior",value:480,component_tier:3,full_armor_name:"Steel chainmail helmet",defense_value:6,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),d["Iron chainmail vest"]=new ae({name:"Iron chainmail vest",description:"Basic iron chainmail. Nowhere near as strong as a plate armor",component_type:"chestplate exterior",value:640,component_tier:2,full_armor_name:"Iron chainmail armor",defense_value:8,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),d["Steel chainmail vest"]=new ae({name:"Steel chainmail vest",description:"Basic steel chainmail. Nowhere near as strong as a plate armor",component_type:"chestplate exterior",value:960,component_tier:3,full_armor_name:"Steel chainmail armor",defense_value:11,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),d["Iron chainmail greaves"]=new ae({name:"Iron chainmail greaves",description:"Greaves made of iron chainmail. Just attach them onto some pants and you are ready to go",component_type:"leg armor exterior",value:320,component_tier:2,full_armor_name:"Iron chainmail pants",defense_value:4,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),d["Steel chainmail greaves"]=new ae({name:"Steel chainmail greaves",description:"Greaves made of steel chainmail. Just attach them onto some pants and you are ready to go",component_type:"leg armor exterior",value:480,component_tier:3,full_armor_name:"Steel chainmail pants",defense_value:6,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),d["Iron chainmail glove"]=new ae({name:"Iron chainmail glove",description:"Iron chainmail in a form ready to be applied onto a glove",component_type:"glove exterior",value:320,component_tier:2,full_armor_name:"Iron chainmail gloves",defense_value:4,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),d["Steel chainmail glove"]=new ae({name:"Steel chainmail glove",description:"Steel chainmail in a form ready to be applied onto a glove",component_type:"glove exterior",value:480,component_tier:3,full_armor_name:"Steel chainmail gloves",defense_value:6,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),d["Iron chainmail shoes"]=new ae({name:"Iron chainmail shoes",description:"Iron chainmail in a form ready to be applied onto a pair of shoes",component_type:"shoes exterior",value:320,component_tier:2,full_armor_name:"Iron chainmail boots",defense_value:4,component_stats:{agility:{multiplier:.9},cold_tolerance:{flat:-1}}}),d["Steel chainmail shoes"]=new ae({name:"Steel chainmail shoes",description:"Steel chainmail in a form ready to be applied onto a pair of shoes",component_type:"shoes exterior",value:480,component_tier:3,full_armor_name:"Steel chainmail boots",defense_value:6,component_stats:{agility:{multiplier:.9},cold_tolerance:{flat:-1}}})})();(function(){d["Cheap leather vest"]=new Q({name:"Cheap leather vest",description:"Vest providing very low protection. Better not to know what's it made from",value:100,component_type:"chestplate interior",base_defense:2,component_tier:1,component_stats:{attack_speed:{multiplier:.99},cold_tolerance:{flat:1}}}),d["Leather vest"]=new Q({name:"Leather vest",description:"Comfortable leather vest, offering a low protection",value:300,component_type:"chestplate interior",base_defense:2,component_tier:2,component_stats:{cold_tolerance:{flat:1}}}),d["Goat leather vest"]=new Q({name:"Goat leather vest",description:"Comfortable leather vest, offering a mediocre protection",value:450,component_type:"chestplate interior",base_defense:3,component_tier:3,component_stats:{cold_tolerance:{flat:1}}}),d["Cheap leather pants"]=new Q({name:"Cheap leather pants",description:"Leather pants made from cheapest resources available",value:100,component_type:"leg armor interior",base_defense:1,component_tier:1,component_stats:{attack_speed:{multiplier:.99},cold_tolerance:{flat:1}}}),d["Leather pants"]=new Q({name:"Leather pants",description:"Solid leather pants",value:300,component_type:"leg armor interior",base_defense:2,component_tier:2,component_stats:{cold_tolerance:{flat:2}}}),d["Goat leather pants"]=new Q({name:"Goat leather pants",description:"Solid leather pants",value:450,component_type:"leg armor interior",base_defense:3,component_tier:3,component_stats:{cold_tolerance:{flat:2}}}),d["Cheap leather hat"]=new Q({name:"Cheap leather hat",description:"A cheap leather hat to protect your head",value:100,component_type:"helmet interior",base_defense:1,component_tier:1,component_stats:{attack_speed:{multiplier:.99},cold_tolerance:{flat:1}}}),d["Leather hat"]=new Q({name:"Leather hat",description:"A nice leather hat to protect your head",value:300,component_type:"helmet interior",base_defense:2,component_tier:2,component_stats:{cold_tolerance:{flat:1}}}),d["Goat leather hat"]=new Q({name:"Goat leather hat",description:"A solid leather hat to protect your head",value:450,component_type:"helmet interior",base_defense:3,component_tier:3,component_stats:{cold_tolerance:{flat:1}}}),d["Leather gloves"]=new Q({name:"Leather gloves",description:"Strong leather gloves, perfect for handling rough and sharp objects",value:300,component_type:"glove interior",base_defense:1,component_tier:2,component_stats:{cold_tolerance:{flat:2}}}),d["Goat leather gloves"]=new Q({name:"Goat leather gloves",description:"Strong leather gloves, perfect for handling rough and sharp objects",value:450,component_type:"glove interior",base_defense:2,component_tier:3,component_stats:{cold_tolerance:{flat:2}}}),d["Cheap leather shoes"]=new Q({name:"Cheap leather shoes",description:"Shoes made of thin and cheap leather. Even then, they are in every single aspect better than not having any",value:100,component_type:"shoes interior",base_defense:0,component_tier:1,component_stats:{agility:{multiplier:1.05},cold_tolerance:{flat:2}}}),d["Work shoes"]=new Q({name:"Work shoes",description:"Work shoes made of a mix of leather and wool. While they provide no protection, they are very comfortable for moving around",value:300,component_type:"shoes interior",base_defense:0,component_tier:2,component_stats:{attack_speed:{multiplier:1.02},agility:{multiplier:1.15},cold_tolerance:{flat:2}}}),d["Leather shoes"]=new Q({name:"Leather shoes",description:"Solid shoes made of leather, a must have for any traveler",value:300,component_type:"shoes interior",base_defense:1,component_tier:2,component_stats:{attack_speed:{multiplier:1.02},agility:{multiplier:1.1},cold_tolerance:{flat:2}}}),d["Goat leather shoes"]=new Q({name:"Goat leather shoes",description:"Strong shoes made of leather, a must have for any traveler",value:450,component_type:"shoes interior",base_defense:2,component_tier:3,component_stats:{attack_speed:{multiplier:1.02},agility:{multiplier:1.15},cold_tolerance:{flat:2}}}),d["Wool shirt"]=new Q({name:"Wool shirt",description:"It's not thick enough to provide any physical protection, but on the plus side it's light, it's warm, and it and doesn't block your moves",value:300,component_type:"chestplate interior",base_defense:0,component_tier:2,component_stats:{attack_speed:{multiplier:1.01},agility:{multiplier:1.02},cold_tolerance:{flat:3}}}),d["Wool pants"]=new Q({name:"Wool pants",description:"Nice woollen pants. Slightly itchy",value:100,component_type:"leg armor interior",base_defense:0,component_tier:2,component_stats:{cold_tolerance:{flat:3}}}),d["Wool hat"]=new Q({name:"Wool hat",description:"Simple woollen hat to protect your head from cold",value:300,component_type:"helmet interior",base_defense:0,component_tier:2,component_stats:{attack_speed:{multiplier:1.01},agility:{multiplier:1.01},cold_tolerance:{flat:2}}}),d["Wool gloves"]=new Q({name:"Wool gloves",description:"Warm and comfy, but they don't provide any protection",value:300,component_type:"glove interior",base_defense:0,component_tier:2,component_stats:{cold_tolerance:{flat:3}}}),d["Rat pelt cape"]=new Nt({name:"Rat pelt cape",item_tier:1,description:"It's a cape... made of wolf rat pelts. Only for poor or insane",value:100,base_stats:{cold_tolerance:{flat:2}}}),d["Wolf pelt cape"]=new Nt({name:"Wolf pelt cape",description:"An elegant cape made from wolf pelts. Doesn't provide much protection, but is light enough to not hinder your movements",value:400,item_tier:2,base_defense:2,base_stats:{cold_tolerance:{flat:4}}}),d["Boar hide cape"]=new Nt({name:"Boar hide cape",description:"A rough cape made from boar hides. Offers a nice protection, but is heavy and stiff",value:700,item_tier:3,base_defense:5,base_stats:{attack_speed:{multiplier:.9},agility:{multiplier:.9},cold_tolerance:{flat:5}}}),d["Goat hide cape"]=new Nt({name:"Goat hide cape",description:"A rough cape made from goat hides",value:700,item_tier:3,base_defense:3,base_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.95},cold_tolerance:{flat:4}}}),d["Bear hide cape"]=new Nt({name:"Bear hide cape",description:"A thick, heavy, and warm furry cape, made from a bear hide",value:1e3,item_tier:4,base_defense:7,base_stats:{attack_speed:{multiplier:.95},agility:{multiplier:.95},cold_tolerance:{flat:7}}})})();(function(){d["Wolf leather armor"]=new Q({components:{internal:"Leather vest",external:"Wolf leather chestplate armor"}}),d["Wolf leather helmet"]=new Q({components:{internal:"Leather hat",external:"Wolf leather helmet armor"}}),d["Wolf leather armored pants"]=new Q({components:{internal:"Leather pants",external:"Wolf leather greaves"}}),d["Iron chainmail armor"]=new Q({components:{internal:"Leather vest",external:"Iron chainmail vest"}}),d["Iron chainmail helmet"]=new Q({components:{internal:"Leather hat",external:"Iron chainmail helmet armor"}}),d["Iron chainmail pants"]=new Q({components:{internal:"Leather pants",external:"Iron chainmail greaves"}}),d["Steel chainmail armor"]=new Q({components:{internal:"Goat leather vest",external:"Steel chainmail vest"}}),d["Steel chainmail helmet"]=new Q({components:{internal:"Goat leather hat",external:"Steel chainmail helmet armor"}}),d["Steel chainmail pants"]=new Q({components:{internal:"Goat leather pants",external:"Steel chainmail greaves"}})})();(function(){d["Wooden training shield base"]=new Fe({name:"Wooden training shield base",description:"A primitive but cheap form of a shield",value:16,tags:{ignore_skill:!0},shield_strength:.5,shield_name:"Wooden training shield",component_tier:1,component_type:"shield base",component_stats:{attack_speed:{multiplier:.95}}}),d["Cheap wooden shield base"]=new Fe({name:"Cheap wooden shield base",description:"Cheap shield component made of wood, basically just a few planks barely holding together",value:16,shield_strength:1,shield_name:"Cheap wooden shield",component_tier:1,component_type:"shield base",component_stats:{attack_speed:{multiplier:.95}}}),d["Crude wooden shield base"]=new Fe({name:"Crude wooden shield base",description:"A shield base of rather bad quality, but at least it won't fall apart by itself",value:32,shield_strength:3,shield_name:"Crude wooden shield",component_tier:1,component_type:"shield base",component_stats:{attack_speed:{multiplier:.95}}}),d["Wooden shield base"]=new Fe({name:"Wooden shield base",description:"Proper wooden shield base, although it could use some additional reinforcement",value:80,shield_strength:5,shield_name:"Wooden shield",component_tier:2,component_type:"shield base",component_stats:{attack_speed:{multiplier:.95}}}),d["Ash wood shield base"]=new Fe({name:"Ash wood shield base",description:"Solid wooden shield base, although still nowhere near as resistant as metal",value:120,shield_strength:8,shield_name:"Ash wood shield",component_tier:3,component_type:"shield base",component_stats:{attack_speed:{multiplier:.95}}}),d["Crude iron shield base"]=new Fe({name:"Crude iron shield base",description:"Heavy shield base made of low quality iron",value:128,shield_strength:6,shield_name:"Crude iron shield",component_tier:1,component_type:"shield base",component_stats:{attack_speed:{multiplier:.75}}}),d["Iron shield base"]=new Fe({name:"Iron shield base",description:"Solid and strong shield base, although it's quite heavy",value:210,shield_strength:10,shield_name:"Iron shield",component_tier:2,component_type:"shield base",component_stats:{attack_speed:{multiplier:.8}}}),d["Steel shield base"]=new Fe({name:"Steel shield base",description:"Mighty shield base, although it's quite heavy",value:300,shield_strength:14,shield_name:"Steel shield",component_tier:3,component_type:"shield base",component_stats:{attack_speed:{multiplier:.85}}}),d["Basic shield handle"]=new Fe({id:"Basic shield handle",name:"Crude wooden shield handle",description:"A simple handle for holding the shield",value:10,component_tier:1,component_type:"shield handle"}),d["Wooden shield handle"]=new Fe({name:"Wooden shield handle",description:"A decent wooden handle for holding the shield",value:32,component_tier:2,component_type:"shield handle",component_stats:{block_strength:{multiplier:1.1}}}),d["Ash wood shield handle"]=new Fe({name:"Ash wood shield handle",description:"A solid wooden handle for holding the shield",value:48,component_tier:3,component_type:"shield handle",component_stats:{block_strength:{multiplier:1.2}}})})();(function(){d["Wooden training shield"]=new Ze({components:{shield_base:"Wooden training shield base",handle:"Basic shield handle"}}),d["Cheap wooden shield"]=new Ze({components:{shield_base:"Cheap wooden shield base",handle:"Basic shield handle"}}),d["Crude wooden shield"]=new Ze({components:{shield_base:"Crude wooden shield base",handle:"Basic shield handle"}}),d["Wooden shield"]=new Ze({components:{shield_base:"Wooden shield base",handle:"Wooden shield handle"}}),d["Ash wood shield"]=new Ze({components:{shield_base:"Ash wood shield base",handle:"Ash wood shield handle"}}),d["Crude iron shield"]=new Ze({components:{shield_base:"Crude iron shield base",handle:"Basic shield handle"}}),d["Iron shield"]=new Ze({components:{shield_base:"Iron shield base",handle:"Wooden shield handle"}}),d["Steel shield"]=new Ze({components:{shield_base:"Steel shield base",handle:"Ash wood shield handle"}})})();(function(){d["Wolf trophy"]=new sn({name:"Wolf trophy",value:100,stats:{armor_penetration:{flat:50},crit_rate:{flat:.02}}}),d["Boar trophy"]=new sn({name:"Boar trophy",value:160,stats:{attack_power:{multiplier:1.1},crit_multiplier:{flat:.2}}}),d["Mountain goat trophy"]=new sn({name:"Mountain goat trophy",value:250,stats:{attack_power:{multiplier:1.05},defense:{flat:5,multiplier:1.05}}}),d["Bear trophy"]=new sn({name:"Bear trophy",value:400,stats:{attack_power:{multiplier:1.3},attack_speed:{multiplier:.9}}})})();(function(){d["Warrior's necklace"]=new cs({value:1e3,tags:{unique:!0},stats:{attack_power:{multiplier:1.1},attack_speed:{multiplier:1.1}}})})();(function(){d["Old pickaxe"]=new Bt({name:"Old pickaxe",description:"An old pickaxe that has seen better times, but is still usable",value:10,equip_slot:"pickaxe"}),d["Old axe"]=new Bt({name:"Old axe",description:"An old axe that has seen better times, but is still usable",value:10,equip_slot:"axe"}),d["Old sickle"]=new Bt({name:"Old sickle",description:"And old herb sickle that has seen better times, but is still usable",value:10,equip_slot:"sickle"}),d["Old shovel"]=new Bt({name:"Old shovel",description:"And old shovel that has seen better times, but can still be used to dig something up",value:10,equip_slot:"shovel"}),d["Iron pickaxe"]=new Bt({name:"Iron pickaxe",description:"A decent pickaxe made of iron, strong enough for most ores",value:1e3,equip_slot:"pickaxe",bonus_skill_levels:{Mining:3}}),d["Iron chopping axe"]=new Bt({name:"Iron chopping axe",description:"A decent axe made of iron, hard and sharp enough for most of trees, even if they will still require an effort",value:1e3,equip_slot:"axe",bonus_skill_levels:{Woodcutting:3}}),d["Iron sickle"]=new Bt({name:"Iron sickle",description:"A decent sickle made of iron, sharp enough for most of plants",value:1e3,equip_slot:"sickle",bonus_skill_levels:{Herbalism:3}}),d["Iron shovel"]=new Bt({name:"Iron shovel",description:"A decent shovel made of iron, solid enough for most of your digging needs",value:1e3,equip_slot:"shovel",bonus_skill_levels:{Digging:3}})})();(function(){d["Stale bread"]=new xe({name:"Stale bread",description:"Big piece of an old bread, still edible",value:20,effects:[{effect:"Basic meal",duration:60}],tags:{food:!0},material_type:"bread"}),d["Fresh bread"]=new xe({name:"Fresh bread",description:"Freshly baked bread, delicious",value:40,effects:[{effect:"Basic meal",duration:150}],tags:{food:!0},material_type:"bread"}),d["Bread kwas"]=new xe({name:"Bread kwas",description:"Tastes like bread",value:40,effects:[{effect:"Well hydrated",duration:60}],recovery_chances:{"Glass bottle":.6},tags:{drink:!0}}),d.Carrot=new xe({name:"Carrot",description:"A delicious root that can be eaten raw",value:20,effects:[{effect:"Basic meal",duration:10}],tags:{food:!0}}),d["Cooked carrot"]=new xe({name:"Cooked carrot",description:"A delicious root, cooked",value:30,effects:[{effect:"Basic meal",duration:150}],tags:{food:!0}}),d.Potato=new xe({name:"Potato",description:"A common tuber with versatile culinary usage. Just remember to cook it first!",value:15,effects:[{effect:"Slight food poisoning",duration:20}],tags:{food:!0}}),d["Cooked potato"]=new xe({name:"Potato",description:"A common tuber with versatile culinary usage, though this one was simply cooked",value:40,effects:[{effect:"Basic meal",duration:150}],tags:{food:!0}}),d["Weak healing powder"]=new xe({name:"Weak healing powder",description:"Not very potent, but can still make body heal noticeably faster for quite a while",value:40,effects:[{effect:"Weak healing powder",duration:240}],tags:{medicine:!0}}),d["Healing powder"]=new xe({name:"Healing powder",description:"Not exactly powerful in its effects, but still makes the body heal noticeably faster and for a long time",value:100,effects:[{effect:"Healing powder",duration:300}],tags:{medicine:!0}}),d["Oneberry juice"]=new xe({name:"Oneberry juice",description:"Tastes kinda nice and provides a quick burst of healing",value:80,effects:[{effect:"Weak healing potion",duration:10}],recovery_chances:{"Glass phial":.75},tags:{medicine:!0}}),d["Healing potion"]=new xe({name:"Healing potion",description:"Tastes nice at first but has a bitter aftertase. Povides a quick burst of healing",value:200,effects:[{effect:"Healing potion",duration:10}],recovery_chances:{"Glass phial":.75},tags:{medicine:!0}}),d["Healing balm"]=new xe({name:"Healing balm",description:"Simply apply it to your wound and watch it heal",value:120,effects:[{effect:"Weak healing balm",duration:90}],tags:{medicine:!0}}),d["Roasted rat meat"]=new xe({name:"Roasted rat meat",description:"Smell might be fine now, but it still seems like a bad idea to eat it",value:10,effects:[{effect:"Cheap meat meal",duration:45},{effect:"Slight food poisoning",duration:45}],tags:{food:!0}}),d["Roasted purified rat meat"]=new xe({name:"Roasted purified rat meat",description:"Smells alright and should be safe to eat, yet you still have some doubts",value:20,effects:[{effect:"Cheap meat meal",duration:45}],tags:{food:!0}}),d["Fried pork"]=new xe({name:"Fried pork",description:"It's dripping with fat and smells fantastic, all it lacks is some spices and a good side dish",value:40,effects:[{effect:"Simple meat meal",duration:90}],tags:{food:!0}}),d["Fried goat meat"]=new xe({name:"Fried goat meat",description:"It has a nice aroma, but is a bit too tough. Perhaps a stew would have been a better choice?",value:40,effects:[{effect:"Simple meat meal",duration:90}],tags:{food:!0}}),d["Pork roast"]=new xe({name:"Pork roast",description:"A generous amount of herbs has been rubbed into the meat, resulting in a hearty meal with a mouthwatering aroma",value:100,effects:[{effect:"Decent meat meal",duration:120}],tags:{food:!0}}),d["Goat stew"]=new xe({name:"Goat stew",description:"Goat meat boiled to tenderness in a herbal broth. Perfect to warm yourself up for the road",value:100,effects:[{effect:"Decent meat meal",duration:120},{effect:"Hot meal",duration:60}],tags:{food:!0}})})();Object.keys(d).forEach(e=>{d[e].id=e,d[e].getName()||(d[e].name=e)});var ie={},_i=class{constructor({name:t,id:i,related_skill:n,target_count:s=1,randomize_target_count:a=!1,is_unlocked:o=!1,stat_multipliers:l={},stamina_cost:u=1,description:c=""}){Wn(this,"getDescription",function(){if(this.description)return this.description;if(this.related_skill)return p[this.related_skill].description});Wn(this,"getStats",function(){if(this.related_skill){let t={};return Object.keys(this.stat_multipliers).forEach(i=>{this.stat_multipliers[i]<1?t[i]=this.stat_multipliers[i]+(1-this.stat_multipliers[i])*G(this.related_skill)/(2*p[this.related_skill].max_level):t[i]=this.stat_multipliers[i]+(this.stat_multipliers[i]-1)*G(this.related_skill)/p[this.related_skill].max_level}),t}else return this.stat_multipliers});if(n&&!p[n])throw`Tried to attach skill "${n}" to stance "${t}", but such a skill doesnt exist!`;if(this.name=t,this.id=i,this.related_skill=n,this.description=c,this.target_count<1)throw"Combat stance cannot target less than 1 enemy!";this.target_count=s,this.randomize_target_count=a,this.is_unlocked=o,this.stat_multipliers=l,this.stamina_cost=u}};ie.normal=new _i({name:"Normal Stance",id:"normal",is_unlocked:!0,description:"A normal and basic stance. It doesn't excell in anything, but also doesn't suffer any major flaws and is energy efficient.",stat_multipliers:{}});ie.quick=new _i({name:"Quick Steps",id:"quick",related_skill:"Quick steps",description:"A swift and precise technique that abandons strength in favor of greater speed",stat_multipliers:{attack_power:.8,attack_speed:1.2},stamina_cost:2});ie.heavy=new _i({name:"Crushing Force",id:"heavy",related_skill:"Heavy strike",stat_multipliers:{attack_power:1.2,attack_speed:.8},stamina_cost:2});ie.defensive=new _i({name:"Defensive Measures",id:"defensive",related_skill:"Defensive measures",stat_multipliers:{attack_power:.8,attack_speed:.8,evasion_points:1.2,block_strength:1.1},target_count:1,stamina_cost:2});ie.wide=new _i({name:"Broad Arc",id:"wide",related_skill:"Wide swing",stat_multipliers:{attack_power:.4,attack_speed:.8},target_count:4,stamina_cost:4});ie.berserk=new _i({name:"Berserker's Stride",id:"berserk",related_skill:"Berserker's stride",stat_multipliers:{attack_power:1.2,hit_chance:1.2,agility:.4,block_strength:.4},target_count:3,randomize_target_count:!0,stamina_cost:4});ie["flowing water"]=new _i({name:"Flowing Water",id:"flowing water",related_skill:"Flowing water",stat_multipliers:{attack_power:1.2,agility:1.2,attack_speed:1.2},target_count:2,stamina_cost:4});var re=1e6;function Cr(){let e=[0,0],t=performance.now(),i=performance.now(),n=[0,0];console.log("Began verifying game objects."),console.log("Began verifying items.");for(let[f,y]of Object.entries(d)){let b=!1;if(f!==y.id&&(console.error(`Id mismatch: "${f}" - "${y.id}"`),b=!0),y.tags.usable)for(let w=0;w<y.effects.length;w++)Z[y.effects[w].effect]||(console.error(`Effect "${y.effects[w].effect}" of item "${f}" is not defined in effect templates`),b=!0);y.stats&&Object.keys(y.stats).forEach(w=>{r.base_stats[w]===void 0?(console.error(`Item "${f}" has a non-existent stat "${w}"`),b=!0):Object.keys(y.stats[w]).forEach(k=>{k!=="multiplier"&&k!=="flat"&&(console.error(`Item "${f}" has a non-existent stat type "${k}" (should be 'multiplier' or 'flat')`),b=!0)})}),n[0]++,n[1]+=b,e[0]++,e[1]+=b}let s=performance.now();n[1]>0?console.log(`Finished verifying items in: ${Math.round(re*(s-i))/re}s
Found issue in ${n[1]} out of ${n[0]}`):console.log(`Finished verifying ${n[0]} items in: ${Math.round(re*(s-i))/re}s
No issues were found.`),i=performance.now();let a=[0,0];console.log("Began verifying skills.");for(let[f,y]of Object.entries(p)){let b=!1;f!==y.skill_id&&(console.error(`Id mismatch: "${f}" - "${y.skill_id}"`),b=!0),y.milestones&&Object.values(y.milestones).forEach(w=>{Object.keys(w).forEach(k=>{k!=="unlocks"&&k!=="stats"&&k!=="xp_multipliers"?(console.error(`Skill "${f}" has a milestone reward to a non-existent category of "${k}"`),b=!0):k==="unlocks"?Object.keys(w[k]).forEach(H=>{H!=="skills"&&H!=="recipes"&&H!=="quests"&&(console.error(`Skill "${f}" has a milestone reward in form of unlocking "${H}" which is not supported`),b=!0)}):k==="stats"?Object.keys(w[k]).forEach(H=>{r.base_stats[H]===void 0&&(console.error(`Skill "${f}" has a milestone reward for a non-existent stat "${H}"`),b=!0),Object.keys(w[k][H]).forEach(W=>{W!=="flat"&&W!=="multiplier"&&(console.error(`Skill "${f}" has a milestone reward to stats of wrong type "${W}". Should be "flat" or "multiplier"`),b=!0)})}):Object.keys(w[k]).forEach(H=>{H!=="all"&&H!=="all_skill"&&H!=="hero"&&!p[H]&&(H.includes("category_")?Ni[H.replace("category_","")]||(b=!0,console.error(`Skill "${f}" has a milestone reward for a non-existent skill "${H}"`)):(b=!0,console.error(`Skill "${f}" has a milestone reward for a non-existent skill "${H}"`)))})})}),a[0]++,a[1]+=b,e[0]++,e[1]+=b}s=performance.now(),a[1]>0?console.log(`Finished verifying skills in: ${Math.round(re*(s-i))/re}s
Found issue in ${a[1]} out of ${a[0]}`):console.log(`Finished verifying ${a[0]} skills in: ${Math.round(re*(s-i))/re}s
No issues were found.`),i=performance.now();let o=[0,0];console.log("Began verifying locations.");for(let[f,y]of Object.entries(m)){let b=!1;if(f!==y.id&&(console.error(`Id mismatch: "${f}" - "${y.id}"`),b=!0),y.tags.safe_zone){for(let w=0;w<y.dialogues.length;w++)q[y.dialogues[w]]||(console.error(`Location "${f}" refers to a non-existent dialogue "${q[y.dialogues[w]]}"`),b=!0);if(y.traders?.length>0){y.market_region?Be[y.market_region]||(console.error(`Location "${f}" has market region "${y.market_region}" assigned, but no such region is present in region mapping!`),b=!0):(console.error(`Location "${f}" has at least one trader but no trade region assigned!`),b=!0);for(let w=0;w<y.traders.length;w++)P[y.traders[w]]||(console.error(`Location "${f}" refers to a non-existent trader "${y.traders[w]}"`),b=!0)}for(let w=0;w<y.connected_locations.length;w++)y.connected_locations[w].location||(console.error(`Location "${f}" is connected to a non-existent location.`),b=!0);Object.keys(y.activities).forEach(w=>{x[y.activities[w].activity_name]||(console.error(`Location "${f}" refers to a non-existent activity "${y.activities[w].activity_name}"`),b=!0);for(let k=0;k<y.activities[w].gained_resources?.length;k++)d[y.activities[w].gained_resources.resources[k].name]||(console.error(`Activity "${w}" in location "${f}" refers to a non-existent item "${y.activities[w].gained_resources.resources[k].name}"`),b=!0)})}else if(y.tags["Combat zone"]){for(let w=0;w<y.enemies_list?.length;w++)X[y.enemies_list[w]]||(console.error(`Location "${f}" refers to a non-existent enemy "${y.enemies_list[w]}"`),b=!0);for(let w=0;w<y.enemy_groups_list?.length;w++)for(let k=0;k<y.enemy_groups_list[w].enemies.length;k++)X[y.enemy_groups_list[w].enemies[k]]||(console.error(`Location "${f}" refers to a non-existent enemy "${y.enemy_groups_list[w].enemies[k]}"`),b=!0);if(y.first_reward&&us(y.first_reward,"location",f),y.repeatable_reward&&(us(y.repeatable_reward,"location",f)||(b=!0)),y.rewards_with_clear_requirement)for(let w=0;w<y.rewards_with_clear_requirement.length;w++)us(y.rewards_with_clear_requirement[w],"location",f)||(b=!0)}o[0]++,o[1]+=b,e[0]++,e[1]+=b}s=performance.now(),o[1]>0?console.log(`Finished verifying locations in: ${Math.round(re*(s-i))/re}s
Found issue in ${o[1]} out of ${o[0]}`):console.log(`Finished verifying ${o[0]} locations in: ${Math.round(re*(s-i))/re}s
No issues were found.`),i=performance.now();let l=[0,0];console.log("Began verifying enemies.");for(let[f,y]of Object.entries(X)){let b=!1;f!==y.id&&(console.error(`Id mismatch: "${f}" - "${y.id}"`),b=!0);for(let w=0;w<y.loot_list.length;w++)d[y.loot_list[w].item_name]||(console.error(`Enemy "${f}" refers to a non-existent item "${y.loot_list[w].item_name}"`),b=!0);l[0]++,l[1]+=b,e[0]++,e[1]+=b}s=performance.now(),l[1]>0?console.log(`Finished verifying enemies in: ${Math.round(re*(s-i))/re}s
Found issue in ${l[1]} out of ${l[0]}`):console.log(`Finished verifying ${l[0]} in: ${Math.round(re*(s-i))/re}s
No issues were found.`),i=performance.now();let u=[0,0];console.log("Began verifying market regions.");for(let[f]of Object.entries(Be)){let y=!1,b=!1;Object.values(m).forEach(w=>{w.market_region===f&&(b=!0)}),b||(y=!0,console.error(`Market region "${f}" is not used for any location despite being defined in region connections!`)),u[0]++,u[1]+=y,e[0]++,e[1]+=y}s=performance.now(),u[1]>0?console.log(`Finished verifying market regions in: ${Math.round(re*(s-i))/re}s
Found issue in ${u[1]} out of ${u[0]}`):console.log(`Finished verifying ${u[0]} market regions in: ${Math.round(re*(s-i))/re}s
No issues were found.`),i=performance.now();let c=[0,0];console.log("Began verifying dialogues.");for(let[f,y]of Object.entries(q)){let b=!1;for(let[w,k]of Object.entries(y.textlines))ii.english[k.name]||(b=!0,console.error(`Textline "${w}" in "${f}" has no translation provided for starting text`)),ii.english[k.getText()]||(b=!0,console.error(`Textline "${w}" in "${f}" has no translation provided for answer text`)),k.rewards&&(us(k.rewards,"textline",f,w)||(b=!0));for(let[w,k]of Object.entries(y.actions))ii.english[k.starting_text]||(b=!0,console.error(`Action "${w}" in "${f}" has no translation provided for starting text`)),ii.english[k.success_text]||(b=!0,console.error(`Textline "${w}" in "${f}" has no translation provided for success text`));c[0]++,c[1]+=b,e[0]++,e[1]+=b}s=performance.now(),c[1]>0?console.log(`Finished verifying dialogues in: ${Math.round(re*(s-i))/re}s
Found issue in ${c[1]} out of ${c[0]}`):console.log(`Finished verifying ${c[0]} dialogues in: ${Math.round(re*(s-i))/re}s
No issues were found.`);let _=performance.now(),h;return e[1]>0?h=`Finished verifying game objects in: ${Math.round(re*(_-t))/re}s
Found issue in ${e[1]} out of ${e[0]}`:h=`Finished verifying ${e[0]} game objects in: ${Math.round(re*(_-t))/re}s
No issues were found.`,console.log(h),e[1]==0}function us(e,t,i,n){let s=!0;return Object.keys(e).forEach(a=>{if(a==="xp"&&typeof e[a]!="number")console.error(mi(t,i,n)+"wrong kind of reward of 'xp' type, should be Number but found '"+typeof e[a]+"'"),s=!1;else if(a==="skill_xp")Object.keys(e[a]).forEach(o=>{p[o]||(console.error(mi(t,i,n)+"wrong skill id for 'skill_xp', no such skill as '"+o+"'"),s=!1),typeof e[a][o]!="number"&&(console.error(mi(t,i,n)+"wrong kind of reward of 'skill xp' type for '"+o+"', should be Number but found '"+typeof e[a][o]+"'"),s=!1)});else if(a==="locations")for(let o=0;o<e[a].length;o++)m[e[a][o].location]||(console.error(mi(t,i,n)+`non-existent location '${e[a][o].location}' listed for unlocks`),s=!1);else if(a==="textlines")for(let o=0;o<e[a].length;o++){q[e[a][o].dialogue]||(console.error(mi(t,i,n)+`non-existent dialogue '${e[a][o].dialogue}' listed for textline unlocks`),s=!1);for(let l=0;l<e[a][o].lines.length;l++)q[e[a][o].dialogue].textlines[e[a][o].lines[l]]||(console.error(mi(t,i,n)+`non-existent textline '${e[a][o].lines[l]}' listed for unlocks in dialogue '${e[a][o].dialogue}'`),s=!1)}else if(a==="move_to")m[e[a].location]||(console.error(mi(t,i,n)+`non-existent location '${e[a].location}' listed for moving to`),s=!1);else if(a==="quest_progress")for(let o=0;o<e[a].length;o++)O[e[a][o].quest_id]||(console.error(mi(t,i,n)+`non-existent quest '${e[a][o].quest_id}' listed for progressing`),s=!1),O[e[a][o].quest_id].quest_tasks.length<e[a][o].task_index&&(console.error(mi(t,i,n)+`too high task index for progressing quest '${e[a][o].quest_id}'`),s=!1)}),s}function mi(e,t,i){if(e==="location")return`Location "${t}" has a `;if(e==="textline")return`Textline "${i}" in dialogue "${t}" has a `}var Ar={add_reputation:({reputation:e,region:t})=>{if(Number.isInteger(e))if(t in r.reputation)r.reputation[t]+=e;else throw new Error(`Tried to add reputation to "${t}", which is not a valid reputation region!`);else throw new Error(`Tried to add "${e}", which is not a valid integer!`)}};var ln={},Hr="Running",Br=60,Or=4,Io=class{constructor(){this.queue=[]}add_to_queue(t){this.queue.push(t),this.queue.sort((i,n)=>i[0]-n[0])}shift_from_queue(){return this.is_queue_empty()?"Queue is empty":this.queue.shift()}is_queue_empty(){return this.queue.length==0}},Tn=class{constructor(){this.adjacent={},this.vertice_count=0}add_connection(t,i,n){this.adjacent[t]||(this.adjacent[t]=[]),this.adjacent[t].push([i,n])}update_time_skill_modifiers(){Object.keys(ln).forEach(t=>{ln[t]=1/Or**(p[t].current_level/p[t].max_level)})}update_time_skill_modifier(t){ln[t]=1/Or**(p[t].current_level/p[t].max_level)}get_total_skills_modifier(t){let i=1;for(let n=0;n<t.length;n++)t[n]in ln||this.update_time_skill_modifier(t[n]),i*=ln[t[n]];return i**t.length}fill_connections(t){Object.values(t).forEach(i=>{if(i.is_unlocked&&!i.is_finished){if(i.parent_location){let n=i.parent_location.connected_locations.find(o=>o.location===i).travel_time??Br,s=i.parent_location.connected_locations.find(o=>o.location===i).travel_time_skills||[Hr],a=this.get_total_skills_modifier(s);this.add_connection(i.id,i.parent_location.id,n*a)}else for(let n=0;n<i.connected_locations.length;n++)if(i.connected_locations[n].location.is_unlocked&&!i.connected_locations[n].location.is_finished){let s=i.connected_locations[n].travel_time_skills||[Hr],a=this.get_total_skills_modifier(s);this.add_connection(i.id,i.connected_locations[n].location.id,(i.connected_locations[n].travel_time??Br)*a)}}})}find_shortest_paths(t){let i=new Io,n={};for(i.add_to_queue([0,t]),n[t]=0;!i.is_queue_empty();){let[,s]=i.shift_from_queue();if(this.adjacent[s])for(let[a,o]of this.adjacent[s])n[s]==null&&(n[s]=1/0),n[a]==null&&(n[a]=1/0),n[a]>n[s]+o&&(n[a]=n[s]+o,i.add_to_queue([n[a],a]))}return Object.keys(n).forEach(s=>{n[s]=Math.round(n[s])}),n}};var rt="save data",gt="dev save data",ga="backup save",ya="dev backup save",Se={is_gathering_unlocked:!1,is_crafting_unlocked:!1,is_strength_proved:!1,is_mofu_mofu_enabled:!0},Nr={is_gathering_unlocked:"You have gained the ability to gather new materials! Remember to equip your tools first <br>[Note: equipped tools do not appear in inventory as you will be swapping them very rarely]",is_crafting_unlocked:"You have gained the ability to craft items and equipment!"},Oo=document.getElementById("loading_screen_play_button"),On={english:"english",mofu_english:"mofu_english"},Ct=On.mofu_english,Wr=!1,No=0,jo=0,ma=0,ha=0,Po=0,Wo=0,Ro=0,Go=0,Fo=0,ps=0,fs={},fu=5,gu=1/360,yu=.2,dn=0,Ho=1e3*60*60*20,To=20,rn=0,cn=[0,0,0,0],ca=!1,ua=!1,j=null,wa={},Ii,hi=[],un=[],Hn=[],Rr,Si=0,An=0,da=[],Et=10,v,$,gs,Nn,Mt={},Vt,Ln={},wu=!0,Ci=!1,Ei=null,qt=null,lt=null,bu=60,ms=0,vu=3600,Co=0,Cn=0,ds=0,_a,jr,Je,pe={},pt=ie.normal,Ce=ie.normal,Dt={},Ht={},ce=1,ku=1,C={uniform_text_size_in_action:!1,auto_return_to_bed:!0,remember_message_log_filters:!1,remember_sorting_options:!1,combat_disable_autoswitch:!1,log_every_gathering_period:!0,log_total_gathering_gain:!0,auto_use_when_longest_runs_out:!0,use_uncivilised_temperature_scale:!1,do_background_animations:!1,skip_play_button:!1,mofu_mofu_mode:!0,do_enemy_onhit_animations:!0},Li={unlocks:!0,events:!0,combat:!0,loot:!0,crafting:!0,background:!0},xu=.1,qu=2,Qt=[],Ti={TOP:"top",ALL:"all"},pa=document.getElementById("character_name_field");pa.value=r.name;pa.addEventListener("change",()=>r.name=pa.value.toString().trim().length>0?pa.value:"Hero");var Gr=document.getElementById("time_div");Gr.innerHTML=M.toString();(function(){Object.keys(p).forEach(t=>{r.xp_bonuses.total_multiplier[t]=1,r.bonus_skill_levels.full[t]=0}),Object.keys(Ni).forEach(t=>{r.xp_bonuses.total_multiplier["category_"+t]=1})})();function Fr(e){let t=document.getElementById("options_textsize");t.checked||e?(C.uniform_text_size_in_action=!0,document.documentElement.style.setProperty("--options_action_textsize","20px")):(C.uniform_text_size_in_action=!1,document.documentElement.style.setProperty("--options_action_textsize","16px")),e!==void 0&&(t.checked=e)}function zr(e){let t=document.getElementById("options_bed_return");t.checked||e?C.auto_return_to_bed=!0:C.auto_return_to_bed=!1,e!==void 0&&(t.checked=e)}function Dr(e){let t=document.getElementById("options_save_messagelog_settings");t.checked||e?C.remember_message_log_filters=!0:C.remember_message_log_filters=!1,e!==void 0&&(t.checked=e,Li.unlocks?document.documentElement.style.setProperty("--message_unlocks_display","inline-block"):(document.documentElement.style.setProperty("--message_unlocks_display","none"),document.getElementById("message_show_unlocks").classList.remove("active_selection_button")),Li.combat?document.documentElement.style.setProperty("--message_combat_display","inline-block"):(document.documentElement.style.setProperty("--message_combat_display","none"),document.getElementById("message_show_combat").classList.remove("active_selection_button")),Li.events?document.documentElement.style.setProperty("--message_events_display","inline-block"):(document.documentElement.style.setProperty("--message_events_display","none"),document.getElementById("message_show_events").classList.remove("active_selection_button")),Li.loot?document.documentElement.style.setProperty("--message_loot_display","inline-block"):(document.documentElement.style.setProperty("--message_loot_display","none"),document.getElementById("message_show_loot").classList.remove("active_selection_button")),Li.crafting?document.documentElement.style.setProperty("--message_crafting_display","inline-block"):(document.documentElement.style.setProperty("--message_crafting_display","none"),document.getElementById("message_show_crafting").classList.remove("active_selection_button")),Li.background?document.documentElement.style.setProperty("--message_background_display","inline-block"):(document.documentElement.style.setProperty("--message_background_display","none"),document.getElementById("message_show_background").classList.remove("active_selection_button")))}function Yr(e){let t=document.getElementById("options_dont_autoswitch_to_combat");t.checked||e?C.disable_combat_autoswitch=!0:C.disable_combat_autoswitch=!1,e!==void 0&&(t.checked=e)}function Vr(e){let t=document.getElementById("options_log_all_gathering");t.checked||e?C.log_every_gathering_period=!0:C.log_every_gathering_period=!1,e!==void 0&&(t.checked=e)}function Qr(e){let t=document.getElementById("options_log_gathering_result");t.checked||e?C.log_total_gathering_gain=!0:C.log_total_gathering_gain=!1,e!==void 0&&(t.checked=e)}function Ur(e){let t=document.getElementById("options_use_uncivilised_temperature_scale");t.checked||e?C.use_uncivilised_temperature_scale=!0:C.use_uncivilised_temperature_scale=!1,e!==void 0&&(t.checked=e),Ja()}function Kr(e){let t=document.getElementById("options_do_background_animations");t.checked||e?C.do_background_animations=!0:(C.do_background_animations=!1,sa(),window.removeEventListener("resize",nn),window.removeEventListener("resize",tn),window.removeEventListener("resize",an)),e!==void 0&&(t.checked=e)}function Jr(e){let t=document.getElementById("options_skip_play_button");t.checked||e?C.skip_play_button=!0:C.skip_play_button=!1,e!==void 0&&(t.checked=e)}function Xr(e){let t=document.getElementById("options_mofu_mofu_mode");e!==void 0&&(t.checked=e),t.checked?(C.mofu_mofu_mode=!0,Se.is_mofu_mofu_enabled=!0,Ct=On.mofu_english):(C.mofu_mofu_mode=!1,Se.is_mofu_mofu_enabled=!1,Ct=On.english)}function Zr(e){let t=document.getElementById("options_do_enemy_onhit_animations");t.checked||e?C.do_enemy_onhit_animations=!0:C.do_enemy_onhit_animations=!1,e!==void 0&&(t.checked=e)}function St({location_id:e,event:t,skip_travel_time:i=!1,do_quest_events:n=!0,skip_combat:s=!1}){if(t?.target.classList.contains("fast_travel_removal_button"))return;let a=v,o=m[e]||v;if(!(e!==v?.name&&o.is_finished)){if(Bo(),ws(),Vu(),!o)throw`No such location as "${e}"`;n&&ba({quest_event_type:"enter_location",quest_event_target:o.id,quest_event_count:1}),typeof v<"u"&&v.id!==o.id&&S(`[ Entering ${o.name} ]`,"message_travel"),o.crafting&&io(),v=o,Vt||(Vt=new Tn,Vt.fill_connections(m)),Mt[v.id]||(Mt[v.id]=Vt.find_shortest_paths(v.id)),a&&!i&&od({value:Mt[a.id][v.id],source:"travel"}),Ja(),Te(),"connected_locations"in v?Va(v):(Yl(v),s||cc(),v.is_challenge||(qt=v.id)),Ye({rewards:v.entrance_rewards})}}function Mu(){v.housing&&v.housing.is_unlocked||(at[v.id]?mc({location_id:v.id,update_choices:!1}):Yu({location_id:v.id}))}function ec(e){if($=Object.assign({},v.activities[e]),$.id=e,!x[$.activity_name])throw`No such activity as ${$.activity_name} could be found`;if(x[$.activity_name].type==="JOB"){if(!In($)){$=null;return}$.earnings=0,$.working_time=0}else if(x[$.activity_name].type==="TRAINING"){if(!In($)){$=null;return}}else if(x[$.activity_name].type==="GATHERING"){if(!(!x[$.activity_name].required_tool_type||r.equipment[x[$.activity_name].required_tool_type])){S("You need to equip a proper tool to do that!"),$=null;return}$.gathered_materials={}}else throw`"${x[$.activity_name].type}" is not a valid activity type!`;$.gathering_time=0,$.gained_resources&&($.gathering_time_needed=$.getActivityEfficiency().gathering_time_needed),Uo({content_type:"activity",data:{activity:$}})}function zo(){if(S(`${r.name} finished ${$.activity_name}`,"activity_finished"),$.earnings&&(S(`${r.name} earned ${Pe($.earnings)}`,"activity_money"),ic($.earnings)),$.gathered_materials&&C.log_total_gathering_gain){let e=[];Object.keys($.gathered_materials).forEach(t=>{e.push({item_key:t,count:$.gathered_materials[t]})}),za({loot_list:e,is_a_summary:!0})}li(),$=null,va(Ti.TOP)}function $u(e,t){Nn=e;let i;Je?i=q[Je].actions[e]:i=v.actions[e];let n;if(Uo({content_type:"action",data:{dialogue_key:Je,action_key:e}}),!i.can_be_started(r)){_s({action_key:e,conditions_status:-1,dialogue_key:Je});return}if(!i.check_conditions_on_finish&&(n=i.get_conditions_status(r),n==0)){_s({action_key:e,conditions_status:0,dialogue_key:Je});return}if(t&&i.floating_click_effects){let s=i.floating_click_effects[Math.floor(Math.random()*i.floating_click_effects.length)];Fl(s,{x:t.pageX,y:t.pageY})}if(i.attempt_duration>0){let s=0,a=i.attempt_duration/.1;gs=setInterval(()=>{s>=a-1&&(clearInterval(gs),_s({action_key:e,conditions_status:n,dialogue_key:Je})),s++,uo(s/a)},1e3*.1/ce)}else uo(1),_s({action_key:e,conditions_status:n,dialogue_key:Je})}function _s({action_key:e,conditions_status:t,dialogue_key:i}){li(!0);let n;i?n=q[i].actions[e]:n=v.actions[e],typeof t>"u"&&(i?t=q[i].actions[e].get_conditions_status(r):t=v.actions[e].get_conditions_status(r));let s="If you see this, Miktaew screwed something up. Whoops!";if(t==-1)s=n.failure_texts.unable_to_begin[Math.floor(n.failure_texts.unable_to_begin.length*Math.random())];else if(t==0)s=n.failure_texts.conditional_loss[Math.floor(n.failure_texts.conditional_loss.length*Math.random())];else{let a=Su({action_key:e,conditions_status:t,dialogue_key:i}),o=!1;a>Math.random()?(s=n.success_text,n.repeatable||tc({dialogue_key:i,location_key:v.id,action_key:e}),Ye({rewards:n.rewards,source_type:"action"}),o=!0):s=n.failure_texts.random_loss[Math.floor(n.failure_texts.random_loss.length*Math.random())],Object.keys(n.conditions[0]?.items_by_id||{}).forEach(l=>{n.conditions[0].items_by_id[l].remove&&dt([{item_key:d[l].getInventoryKey(),item_count:n.conditions[0].items_by_id[l].count}])}),Object.keys(n.required.items_by_id||{}).forEach(l=>{(n.required.items_by_id[l].remove_on_success&&o||n.required.items_by_id[l].remove_on_fail&&!o)&&dt([{item_key:d[l].getInventoryKey(),item_count:n.required.items_by_id[l].count}])})}lr(),i?(Qu({data:{upstack_result_message:s}}),n.attempt_duration==0&&va(Ti.TOP)):or(s)}function Eu(){li(),clearInterval(gs),Nn=null,va(Ti.TOP)}function Su({action_key:e,conditions_status:t,dialogue_key:i}){let n;return i?n=q[i].actions[e]:n=v.actions[e],n.success_chances.length==1?n.success_chances[0]:t==1&&n.success_chances[1]?n.success_chances[1]:n.success_chances[0]+(n.success_chances[1]-n.success_chances[0])*t}function Lu({activity_id:e}){if(!x[e].is_unlocked){x[e].is_unlocked=!0;let t="";x[e].unlock_text&&(t=x[e].unlock_text+":<br>"),S(t+`Gained the ability of "${x[e].name}"`,"activity_unlocked")}}function Iu(e){if(!e.activity.is_unlocked&&(e.activity.is_unlocked=!0,!e.skip_message)){let t="";m[e.location].activities[e.activity.activity_id].unlock_text&&(t=m[e.location].activities[e.activity.activity_id].unlock_text+":<br>"),(x[e.activity.activity_name].type!=="GATHERING"||Se.is_gathering_unlocked)&&S(t+`Unlocked activity "${e.activity.activity_name}" in location "${e.location}"`,"activity_unlocked")}}function Pr(e){if(!e.action.is_unlocked&&(e.action.is_unlocked=!0,!e.skip_message)){let t="";e.location?m[e.location].actions[e.action.action_id].unlock_text&&(t=m[e.location].actions[e.action.action_id].unlock_text+":<br>",S(t+`Unlocked action "${e.action.action_name}" in location "${e.location}"`,"activity_unlocked")):e.dialogue&&q[e.dialogue].actions[e.action.action_id].unlock_text&&(t=q[e.dialogue].actions[e.action.action_id].unlock_text+":<br>",S(t+`Unlocked action "${e.action.action_name}" wit "${e.dialogue}"`,"activity_unlocked"))}}function tc({location_key:e,dialogue_key:t,action_key:i}){t?q[t].actions[i].is_finished=!0:m[e].actions[i].is_finished=!0}function ic(e){r.money+=e,fn()}function Do({ammount_to_restore:e=0,ammount_to_loose:t=0,add_xp:i=!0}={}){if(!e&&!t)return;let n=Math.min(r.stats.full.max_health-r.stats.full.health,e-t),s=Math.min(r.stats.full.max_health-r.stats.full.health+t,e);n&&(r.stats.full.health+=n,ri()),s&&i&&s>0&&z({skill:p.Regeneration,xp_to_add:s}),r.stats.full.health<=0&&(r.stats.full.health=0,dc({is_combat:"parent_location"in v}))}function Tu(){if(r.stats.full.health<r.stats.full.max_health){let e=Math.round(Math.max(r.stats.full.max_health*.01,2)*(1+3*G("Regeneration")/p.Regeneration.max_level));Do({ammount_to_restore:e})}if(r.stats.full.stamina<r.stats.full.max_stamina){let e=Math.round(Math.max(r.stats.full.max_stamina/120,2));r.stats.full.stamina+=e,r.stats.full.stamina>r.stats.full.max_stamina&&(r.stats.full.stamina=r.stats.full.max_stamina),Zi()}}function Cu(){if(r.stats.full.health<r.stats.full.max_health){let e=Math.round(Math.max(r.stats.full.max_health*.04,5)*(1+G("Sleeping")/p.Sleeping.max_level)*(1+3*G("Regeneration")/p.Regeneration.max_level));Do({ammount_to_restore:e})}if(r.stats.full.stamina<r.stats.full.max_stamina){let e=Math.round(Math.max(r.stats.full.max_stamina/30,5)*(1+G("Sleeping")/p.Sleeping.max_level));r.stats.full.stamina+=e,r.stats.full.stamina>r.stats.full.max_stamina&&(r.stats.full.stamina=r.stats.full.max_stamina),Zi()}}function Yo(){rr(),Ci=!0,Ei=v.id}function nc(){Ci=!1,St({location_id:v.id,skip_travel_time:!0}),li()}function ac(e){let t=hs(e)?JSON.parse(e).id:e;if(!v?.parent_location){if(lt===t){ys();return}else lt&&ys();D[t].is_finished||(Ci&&nc(),$&&zo(),lt=t,cr(t),Ya(lt))}}function ys(){St({location_id:v.id,skip_travel_time:!0}),li();let e=lt;lt=null,Ya(e)}function Au(){d[lt].addProgress(),Ya(lt);let e=D[lt];z({skill:p.Literacy,xp_to_add:e.literacy_xp_rate}),e.is_finished&&(S(`Finished the book "${lt}"`),ss(lt,!0),ys(),r.stats.add_book_bonus(e.bonuses),Te(),Ye({rewards:e.rewards}))}function qo(){return lt}function In(e){if(!e.infinite){if(e.availability_time){if(e.availability_time.end>e.availability_time.start){if(M.hour*60+M.minute>e.availability_time.end*60||M.hour*60+M.minute<e.availability_time.start*60||!e.availability_seasons?.includes(M.getSeason()))return!1}else if(!e.availability_seasons?.includes(M.getSeason(1))||M.hour*60+M.minute>e.availability_time.start*60||M.hour*60+M.minute<e.availability_time.end*60)return!1}else if(!e.availability_seasons?.includes(M.getSeason()))return!1}return!0}function Mo(e){if(!e.infinite){if(e.availability_time.end>e.availability_time.start){if(M.hour*60+M.minute+e.working_period-e.working_time%e.working_period>e.availability_time.end*60||M.hour*60+M.minute<e.availability_time.start*60)return!1}else if(!e.availability_time.includes(M.getSeason(1))||M.hour*60+M.minute>e.availability_time.start*60&&M.hour*60+M.minute+e.working_period-e.working_time%e.working_period>e.availability_time.end*60+24*60||M.hour*60+M.minute<e.availability_time.start*60&&M.hour*60+M.minute+e.working_period-e.working_time%e.working_period>e.availability_time.end*60)return!1}return!0}function Hu(e){Uo({content_type:"dialogue",data:{dialogue_key:e}})}function Bu(){Je=null,va(Ti.TOP)}function Ou(){Va(v)}function Nu(e){let i=q[Je].textlines[e];Ye({rewards:i.rewards,source_type:"textline",inform_textline:!1}),i.otherUnlocks&&i.otherUnlocks();let n=ju(i);if(bi()&&Math.random()<=.01){let s=n.split(" "),a=Math.floor(s.length*Math.random());s[a]="rat",n=s.join(" ")}i.branches_into?.length?es({content_type:"dialogue_branch",data:{text:n,dialogue_key:Je,textlines:i.branches_into}}):es({content_type:"dialogue_answer",data:{text:n,dialogue_key:Je}})}function ju(e){return e.getText({season:M.getSeason()})}function Pu(e){if(!ie[e]){console.warn(`Tried to unlock stance "${e}", but no such stance exists!`);return}ie[e].is_unlocked||S(`You have learned a new stance: "${ie[e].name}"`,"location_unlocked"),ie[e].is_unlocked=!0,as(ie,Ce,Dt)}function jn({stance_id:e,is_temporary:t=!1}){if(t){if(!ie[e])throw new Error(`No such stance as "${e}"`);if(!ie[e].is_unlocked)throw new Error(`Stance "${e}" is not yet unlocked!`)}else pt=ie[e],mo(pt);Ce=ie[e],Te(),Vo(!0)}function sc(e){Dt[e]?delete Dt[e]:ie[e].is_unlocked?Dt[e]=!0:console.warn(`Tried to fav a stance '${e}' despite it not being unlocked!`),ho(ie)}function oc({enemies:e}={}){if(!v.get_next_enemies){Bo(),ws();return}for(let n=0;n<j?.length;n++)go(n);j=e||v.get_next_enemies(),Bo();let t=1/r.stats.full.attack_speed;Ii=[...j.map(n=>1/n.stats.attack_speed)];let i=[t,...Ii].sort((n,s)=>n-s)[0];if(i<1){let n=1/i;t*=n;for(let s=0;s<j.length;s++)Ii[s]*=n,hi[s]=0,un[s]=0,Hn[s]=[Date.now(),Date.now()]}else for(let n=0;n<j.length;n++)hi[n]=0,un[n]=0,Hn[n]=[Date.now(),Date.now()];Si=0,An=0,da=[Date.now(),Date.now()];for(let n=0;n<j.length;n++)C.do_enemy_onhit_animations&&gr(n),lc(n,0,!0);Qo({base_cooldown:t}),Xs(),Zs()}function Vo(e){if(!j)return;let t=1/r.stats.full.attack_speed;Ii=[...j.map(n=>1/n.stats.attack_speed)];let i=[t,...Ii].sort((n,s)=>n-s)[0];if(i<1){let n=1/i;t*=n;for(let s=0;s<j.length;s++)Ii[s]*=n}Qo({base_cooldown:t,skip_persistence_xp_for_stance_change:e})}function lc(e,t,i=!1){t=t||0,fo(e,t/60),i&&(hi[e]=0,un[e]=0),clearTimeout(wa[e]),wa[e]=setTimeout(()=>{Hn[e][0]=Date.now(),hi[e]+=Hn[e][0]-Hn[e][1]-Ii[e]*1e3/(60*ce),Hn[e][1]=Date.now(),fo(e,t/60),t++,t>=60&&(t=0,uc(e)),lc(e,t),hi[e]<=Et/ce&&hi[e]>=-Et/ce?un[e]=hi[e]:hi[e]>Et/ce?un[e]=Et/ce:hi[e]<-Et/ce&&(un[e]=-Et/ce)},Ii[e]*1e3/(60*ce)-un[e])}function Wu(e){clearTimeout(wa[e])}function Qo({base_cooldown:e,skip_persistence_xp_for_stance_change:t}){if(ws(),!j)return;if(r.stats.full.stamina>=pt.stamina_cost/r.stats.full.stamina_efficiency){if(pt.id!==Ce.id){jn({stance_id:pt.id});return}}else if(Ce.id!=="normal"){jn({stance_id:"normal",is_temporary:!0});return}let i=Ce.target_count;i>1&&Ce.related_skill&&(i=i+Math.round(i*G(Ce.related_skill)/p[Ce.related_skill].max_level)),Ce.randomize_target_count&&(i=Math.floor(Math.random()*i)||1);let n=[],s=j.filter(l=>l.is_alive).slice(-i);for(;s.length>0;)n.push(s.pop());Fu({stamina_to_use:Ce.stamina_cost,skip_persistence_xp_for_stance_change:t});let a=e/r.get_stamina_multiplier(),o=r.get_attack_power();rc({base_cooldown:e,actual_cooldown:a,attack_power:o,targets:n,target_count:i})}function rc({base_cooldown:e,actual_cooldown:t,attack_power:i,targets:n,count:s=0,is_new:a=!0,target_count:o=1,do_quest_events:l=!0}){yo(s/60),a&&(Si=0,An=0),ws(),Rr=setTimeout(()=>{if(da[0]=Date.now(),Si+=da[0]-da[1]-t*1e3/(60*ce),da[1]=Date.now(),yo(s/60),s++,s>=60){s=0;let u=!1;for(let c=0;c<n.length;c++)Ru({target:n[c],attack_power:i,target_count:n.length});Ce.related_skill&&(u=z({skill:p[Ce.related_skill],xp_to_add:n.reduce((c,_)=>c+_.xp_value,0)/n.length}),u&&(_r(Ce),Te())),j.filter(c=>c.is_alive).length!=0?Qo({base_cooldown:e}):(v.enemy_groups_killed+=1,v.enemy_groups_killed>0&&v.enemy_groups_killed%v.enemy_count==0&&(zu(v),l&&ba({quest_event_type:"clear",quest_event_target:v.id,quest_event_count:1})),document.getElementById("enemy_count_div").children[0].children[1].innerHTML=v.enemy_count-v.enemy_groups_killed%v.enemy_count,oc())}else rc({base_cooldown:e,actual_cooldown:t,attack_power:i,targets:n,target_count:o,count:s,is_new:!1});Si<=Et/ce&&Si>=-Et/ce?An=Si:Si>Et/ce?An=Et/ce:Si<-Et/ce&&(An=-Et/ce)},t*1e3/(60*ce)-An)}function ws(){clearTimeout(Rr)}function Bo(){Object.keys(wa).forEach(e=>{clearTimeout(wa[e])})}function cc(){j==null&&oc()}function uc(e){if(!j)return;let t=j.filter(h=>h.is_alive).length**(2/3),i=j[e],n=j.filter(h=>h.is_alive).length**(-1/3);i.size==="small"?z({skill:p["Pest killer"],xp_to_add:i.xp_value/t}):i.size==="large"&&(z({skill:p["Giant slayer"],xp_to_add:i.xp_value/t}),n*=A({scaling_type:"multiplicative",skill_id:"Giant slayer"}));let s=i.stats.attack,a=[],o=!1,l=!1;for(let h=0;h<i.stats.attack_count;h++)a.push(s*(1.2-Math.random()*.4));if(a=a.sort((h,f)=>f-h),r.equipment["off-hand"]?.offhand_type==="shield")if(r.stats.full.block_chance>Math.random()){z({skill:p["Shield blocking"],xp_to_add:i.xp_value/t});let h=r.equipment["off-hand"].getShieldStrength()*(r.equipment["off-hand"].tags.ignore_skill?1:r.stats.total_multiplier.block_strength);if(h>a[0]){S(r.name+" blocked an attack","hero_blocked");return}else a=a.map(f=>Math.max(0,f-h)),l=!0}else z({skill:p["Shield blocking"],xp_to_add:i.xp_value/(2*t)});else if(_n(i.stats.dexterity*Math.sqrt(i.stats.intuition??1),r.stats.full.evasion_points*n)<Math.random()){let f=r.wears_armor()?i.xp_value:i.xp_value*1.5;z({skill:p.Evasion,xp_to_add:f/t}),S(r.name+" evaded an attack","enemy_missed");return}else z({skill:p.Evasion,xp_to_add:i.xp_value/(2*t)});Fo++,xu>Math.random()&&(a=a.map(h=>h*qu),o=!0,Ro++),r.wears_armor()||z({skill:p["Iron skin"],xp_to_add:i.xp_value/t});let{damage_taken:u,fainted:c}=r.take_damage({damage_values:a});z({skill:p.Fortitude,xp_to_add:u**.6/t});let _=a.length>1?` x${a.length}`:"";if(o?l?S(r.name+" partially blocked, was critically hit"+_+" for "+Math.ceil(10*u)/10+" dmg","hero_attacked_critically"):S(r.name+" was critically hit"+_+" for "+Math.ceil(10*u)/10+" dmg","hero_attacked_critically"):l?S(r.name+" partially blocked, was hit"+_+" for "+Math.ceil(10*u)/10+" dmg","hero_attacked"):S(r.name+" was hit"+_+" for "+Math.ceil(10*u)/10+" dmg","hero_attacked"),c){dc();return}ri()}function Ru({target:e,attack_power:t,target_count:i}){let n=t,s=j.length**.3334,a,o=!1,l=j.filter(c=>c.is_alive).length**(-1/4);if(z({skill:p.Combat,xp_to_add:e.xp_value*s/i}),e.size==="small"?(z({skill:p["Pest killer"],xp_to_add:e.xp_value*s/i}),l*=A({scaling_type:"multiplicative",skill_id:"Pest killer"})):e.size==="large"&&z({skill:p["Giant slayer"],xp_to_add:e.xp_value*s/i}),_n(r.stats.full.attack_points*l,e.stats.agility*Math.sqrt(e.stats.intuition??1))>Math.random()){if(Go++,r.equipment.weapon!=null?(a=Math.round(10*n*(1.2-Math.random()*.4))/10,z({skill:p[Dn[r.equipment.weapon.weapon_type]],xp_to_add:e.xp_value*s/i})):(a=Math.round(10*n*(1.2-Math.random()*.4))/10,z({skill:p.Unarmed,xp_to_add:e.xp_value*s/i})),C.do_enemy_onhit_animations){let c=j.findIndex(_=>_===e);fr(c)}if(r.stats.full.crit_rate>Math.random()?(a=Math.round(10*a*r.stats.full.crit_multiplier)/10,o=!0,Wo++):o=!1,a=Math.ceil(10*Math.max(a-Math.max(0,e.stats.defense-r.stats.full.armor_penetration),a*.1,1))/10,e.stats.health-=a,a>ps&&(ps=a),o?S(e.name+" was critically hit for "+a+" dmg","enemy_attacked_critically"):S(e.name+" was hit for "+a+" dmg","enemy_attacked"),e.stats.health<=0){Po++,e.stats.health=0,S(e.name+" was defeated","enemy_defeated");let c=e.xp_value*s;bs(c/i,!0);let _=e.get_loot({drop_chance_modifier:1/i**.6667});_.length>0&&(za({loot_list:_,is_combat:!0}),_=_.map(h=>({item_key:d[h.item_id].getInventoryKey(),count:h.count})),ze(_)),Gu(e)}Zs()}else S(r.name+" has missed","hero_missed")}function Gu(e,t=!0){e.is_alive=!1,e.add_to_bestiary&&(Wt[e.name]?(Wt[e.name]+=1,pr(e.name)):(Wt[e.name]=1,po(e.name)));let i=j.findIndex(n=>n===e);Wu(i),t&&(ba({quest_event_type:"kill",quest_event_target:e.id,quest_event_count:1}),Object.keys(e.tags||{}).forEach(n=>{ba({quest_event_type:"kill_any",quest_event_target:n,quest_event_count:1})}))}function dc({is_combat:e=!0}={}){e&&(jo++,S(r.name+" has lost consciousness","hero_defeat"),ri(),C.auto_return_to_bed&&Ei?(St({location_id:Ei}),Yo()):St({location_id:v.parent_location.id})),fa("Recovering",5)}function Fu({stamina_to_use:e=1,skip_persistence_xp_for_stance_change:t=!1}){if(r.stats.full.stamina-=e/(r.stats.full.stamina_efficiency||1),r.stats.full.stamina<0&&(r.stats.full.stamina=0),r.stats.full.stamina<1){r.stats.full.health/r.stats.full.max_health<.2&&(e*=2);for(let i=0;i<ls.length;i++)pe[ls[i]]&&(e*=1.19**i);t||z({skill:p.Persistence,xp_to_add:e}),Ka()}Zi()}function z({skill:e,xp_to_add:t=1,should_info:i=!0,use_bonus:n=!0,add_to_parent:s=!0,cap_gained_xp:a=!0,is_from_loading:o=!1,do_quest_events:l=!0}){let u=!1;if(t==0)return u;if(t<0)return console.error(`Tried to add negative xp to skill ${e.skill_id}`),u;if(isNaN(t))return console.error(`Tried to add NaN xp to skill ${e.skill_id}`),u;n&&(t=t*ku*At(e.skill_id),e.parent_skill&&(t*=e.get_parent_xp_multiplier())),a&&typeof e.xp_to_next_lvl===Number&&(t=Math.min(t,e.xp_to_next_lvl*Ms));let c=e.name(),_=e.visibility_treshold>e.total_xp,{message:h,gains:f,unlocks:y}=e.add_xp({xp_to_add:t}),b=e.name();if(e.parent_skill&&s&&e.total_xp>p[e.parent_skill].total_xp){let k=Math.min(e.total_xp-p[e.parent_skill].total_xp,t);z({skill:p[e.parent_skill],xp_to_add:k,should_info:i,use_bonus:!1,add_to_parent:s,cap_gained_xp:!1,is_from_loading:o})}let w=e.visibility_treshold<=e.total_xp;if(_&&w&&(_o(e),en(e,!1),(typeof i>"u"||i)&&S(`Unlocked new skill: ${e.name()}`,"skill_raised")),f&&(r.stats.add_skill_milestone_bonus(f),e.skill_id==="Unarmed"&&r.stats.add_all_equipment_bonus()),w){if(c!==b&&ut[e.skill_id])for(let k=0;k<ut[e.skill_id].length;k++)en(p[ut[e.skill_id][k]],!1);typeof h<"u"?(u=!0,h=h.replace("%HeroName%",r.name),en(e,!0),(typeof i>"u"||i)&&Te(),typeof e.get_effect_description<"u"&&ur(e),e.is_parent?is():$n(e),Za(),Ye({source_name:e.skill_id,source_type:"skill",rewards:y,inform_overall:i}),(typeof i>"u"||i)&&S(h,"skill_raised"),c!==b&&(!_&&(typeof i>"u"||i)&&S(`Skill ${c} upgraded to ${b}`,"skill_raised"),v?.connected_locations&&!$&&Object.keys(v.activities).forEach(k=>{x[v.activities[k].activity_name].base_skills_names.includes(e.skill_id)&&Ua(x[k])}),Object.keys(r.inventory).forEach(k=>{let H=Oe(k);if(H.tags.usable){let W=H.effects;for(let ue=0;ue<W.length;ue++)if(Z[W[ue].effect].effects?.bonus_skill_levels?.[e.skill_id]){ve({item_key:k});return}}else H.tags.equippable&&H.getBonusSkillLevels()[e.skill_id]&&ve({item_key:k})}),Object.keys(r.equipment).forEach(k=>{if(!r.equipment[k])return;r.equipment[k].getBonusSkillLevels()[e.skill_id]&&(Xi(),ve({equip_slot:k}))}),Object.keys(Tt).forEach(k=>{(D[k]?.bonuses?.xp_multipliers||{})[e.skill_id]&&ss(k,!0)}),Mn()),ln[e.skill_id]&&!o&&(Vt=new Tn,Vt.fill_connections(m),Mt={},Mt[v.id]=Vt.find_shortest_paths(v.id)),Ia[e.skill_id]&&Object.keys(Wt).forEach(k=>{X[k].tags[Ia[e.skill_id]]&&hr(k)}),l&&ba({quest_event_type:"reach_skill",quest_event_target:e.skill_id,quest_event_count:e.current_level})):en(e,!1)}return u}function bs(e,t=!0,i){let n=r.add_xp({xp_to_add:e,use_bonus:i});n&&(t&&S(n,"level_up"),r.stats.full.health=r.stats.full.max_health,Te()),sr(n)}function zu(e){let t=!1;if(e.enemy_groups_killed==e.enemy_count||e.is_challenge?(e.is_challenge&&_c({location:e,challenge_self_lock:!0}),t=!0,e.first_reward&&Ye({rewards:e.first_reward,source_type:"location",source_name:e.name,is_first_clear:!0,source_id:e.id})):e.repeatable_reward.xp&&typeof e.repeatable_reward.xp=="number"&&Ye({rewards:{xp:e.repeatable_reward.xp},source_type:"location",source_name:e.name,is_first_clear:!1,source_id:e.id}),e.rewards_with_clear_requirement)for(let i=0;i<e.rewards_with_clear_requirement.length;i++)e.enemy_groups_killed==e.enemy_count*e.rewards_with_clear_requirement[i].required_clear_count&&Ye({rewards:e.rewards_with_clear_requirement[i],source_type:"location",source_name:e.name,is_first_clear:!1,source_id:e.id});Ye({rewards:{...e.repeatable_reward,xp:null},source_type:"location",source_name:e.name,is_first_clear:!1,source_id:e.id}),e.otherUnlocks(),t&&v?.parent_location&&St({location_id:v.parent_location.id})}function Ye({rewards:e={},source_type:t,source_name:i,is_first_clear:n,inform_overall:s=!0,inform_textline:a=!0,only_unlocks:o=!1,is_from_loading:l=!1}){let u=!1;if(e.messages&&!l)for(let c=0;c<e.messages.length;c++)S(e.messages[c]);if(e.money&&typeof e.money=="number"&&!o&&(s&&S(`${r.name} earned ${Pe(e.money)}`),ic(e.money)),e.xp&&typeof e.xp=="number"&&!o&&(t==="location"?s&&(n?S(`Obtained ${e.xp}xp for clearing ${i} for the first time`,"location_reward"):S(`Obtained additional ${e.xp}xp for clearing ${i}`,"location_reward")):S(`Gained ${e.xp}xp`,"location_reward"),bs(e.xp)),e.skill_xp&&!o&&Object.keys(e.skill_xp).forEach(c=>{typeof e.skill_xp[c]=="number"&&(s&&S(`${r.name} gained ${e.skill_xp[c]}xp to ${p[c].name()}`),z({skill:p[c],xp_to_add:e.skill_xp[c],cap_gained_xp:!1}))}),e.locations)for(let c=0;c<e.locations.length;c++)u=Du({location:m[e.locations[c].location],skip_message:s&&e.locations[c].skip_message||l})||u;if(e.flags)for(let c=0;c<e.flags.length;c++){let _=Se[e.flags[c]];Se[e.flags[c]]=!0,!_&&Nr[e.flags[c]]&&s&&S(`${Nr[e.flags[c]]}`,"activity_unlocked")}if(e.textlines)for(let c=0;c<e.textlines.length;c++){let _=!1;for(let h=0;h<e.textlines[c].lines.length;h++)q[e.textlines[c].dialogue].textlines[e.textlines[c].lines[h]].is_unlocked==!1&&(_=!0,q[e.textlines[c].dialogue].textlines[e.textlines[c].lines[h]].is_unlocked=!0);_&&a&&s&&!e.textlines[c].skip_message&&S(`You should talk to ${e.textlines[c].dialogue}`,"dialogue_unlocked")}if(e.dialogues)for(let c=0;c<e.dialogues?.length;c++){let _=q[e.dialogues[c]];_.is_unlocked||(_.is_unlocked=!0,S(`You can now talk with ${_.name}`,"activity_unlocked"))}if(e.traders)for(let c=0;c<e.traders.length;c++){let _=P[e.traders[c].trader];_.is_unlocked||(_.is_unlocked=!0,e.traders[c].skip_message||(_.unlock_message?S(_.unlock_message,"activity_unlocked"):S(`You can now trade with ${_.name}`,"activity_unlocked")))}if(e.housing&&Object.keys(e.housing).forEach(c=>{m[c].housing.is_unlocked=!0}),e.global_activities)for(let c=0;c<e.global_activities?.length;c++)Lu({activity_id:e.global_activities[c]});if(e.activities)for(let c=0;c<e.activities?.length;c++)(!m[e.activities[c].location].activities[e.activities[c].activity].tags?.gathering||Se.is_gathering_unlocked)&&Iu({location:m[e.activities[c].location].name,activity:m[e.activities[c].location].activities[e.activities[c].activity],skip_message:l});if(e.actions)for(let c=0;c<e.actions?.length;c++)e.actions[c].dialogue?Pr({dialogue:q[e.actions[c].dialogue]?.name,action:q[e.actions[c].dialogue].actions[e.actions[c].action],skip_message:l}):e.actions[c].location&&Pr({location:m[e.actions[c].location]?.name,action:m[e.actions[c].location].actions[e.actions[c].action],skip_message:l});if(e.stances)for(let c=0;c<e.stances.length;c++)Pu(e.stances[c]);if(e.skills){for(let c=0;c<e.skills.length;c++)if(!p[e.skills[c]].is_unlocked){p[e.skills[c]].is_unlocked=!0,_o(p[e.skills[c]]),en(p[e.skills[c]],!1),s&&S(`Unlocked new skill: ${p[e.skills[c]].name()}`),t==="skill"&&(ut[e.skills[c]]||(ut[e.skills[c]]=[]),p[i]?ut[e.skills[c]].push(i):console.error(`Tried to register skill "${i}" as related to "${e.skills[c]}", but the former does not exist!`));for(let _=0;_<ut[e.skills[c]]?.length;_++)en(p[ut[e.skills[c]][_]],!1)}}if(e.recipes)for(let c=0;c<e.recipes.length;c++)F[e.recipes[c].category][e.recipes[c].subcategory][e.recipes[c].recipe_id].is_unlocked||(F[e.recipes[c].category][e.recipes[c].subcategory][e.recipes[c].recipe_id].is_unlocked=!0,s&&S(`Unlocked new recipe: ${F[e.recipes[c].category][e.recipes[c].subcategory][e.recipes[c].recipe_id].name}`));if(e.quests)for(let c=0;c<e.quests.length;c++)le.isQuestActive(e.quests[c])||le.startQuest({quest_id:e.quests[c]});if(e.quest_progress)for(let c=0;c<e.quest_progress.length;c++){let _=e.quest_progress[c].quest_id,h=e.quest_progress[c].task_index;h==O[_].getCompletedTaskCount()&&(O[_]?.quest_tasks[h]?le.finishQuestTask({quest_id:_,task_index:h,skip_warning:!0}):console.warn(`Tried to complete ${h}'th task for quest '${_}', but either quest or index does not exist!`))}if(e.locks){if(e.locks.textlines&&Object.keys(e.locks.textlines).forEach(c=>{for(let _=0;_<e.locks.textlines[c].length;_++)q[c].textlines[e.locks.textlines[c][_]].is_finished=!0}),e.locks.locations)for(let c=0;c<e.locks.locations.length;c++)u=_c({location:m[e.locks.locations[c]]})||u;if(e.locks.traders)for(let c=0;c<e.locks.traders.length;c++)P[e.locks.traders[c]].is_finished=!0;if(e.locks.quests)for(let c=0;c<e.locks.quests.length;c++)le.finishQuest({quest_id:e.locks.quests[c],skip_rewards:!0});if(e.locks.actions)for(let c=0;c<e.locks.actions.length;c++)tc({dialogue_key:e.locks.actions[c].dialogue,location_key:e.locks.actions[c].location,action_key:e.locks.actions[c].action})}if(e.items&&!o)for(let c=0;c<e.items.length;c++){let _=d[e.items[c]];S(`${r.name} obtained "${_.getName()} x1"`),ze([{item_key:_.getInventoryKey(),count:1}])}e.reputation&&(Object.keys(e.reputation).forEach(c=>{Ar.add_reputation({region:c,reputation:e.reputation[c]})}),ro()),u&&!l&&(Vt=new Tn,Vt.fill_connections(m),Mt={},Mt[v.id]=Vt.find_shortest_paths(v.id)),e.move_to&&!o&&(t!=="action"?St({location_id:e.move_to.location}):v=m[e.move_to.location])}function Du({location:e,skip_message:t}){let i=!1;if(!e.is_unlocked){if(e.is_unlocked=!0,i=!0,!t){let n=e.unlock_text||`Unlocked location ${e.name}`;S(n,"location_unlocked")}v&&!Je&&!Nn&&St({location_id:v.id,skip_travel_time:!0})}return e.housing?.is_unlocked&&(Ln[e.id]=!0),i}function _c({location:e,challenge_self_lock:t=!1}){let i=!1;return at[e.id]&&(delete at[e.id],t||Qa({location_id:e.id})),e.is_finished||(i=!0,e.is_finished=!0),qt===e.id&&(qt=null),i}function Yu({location_id:e}){if(at[e]){console.warn(`Tried to favourite location "${m[e].name}" despite it already being in favourites`);return}at[e]=!0,aa()}function mc({location_id:e,update_choices:t=!0}){if(!at[e]){console.warn(`Tried to unfavourite location "${m[e].name}" despite it not being in favourites`);return}delete at[e],aa(),t&&Qa({location_id:e})}function Vu(){j=null;for(let e=0;e<7;e++)go(e)}function hc(e,t=1){let i=e.parentNode.parentNode.dataset.crafting_category,n=e.parentNode.parentNode.dataset.crafting_subcategory,s=e.parentNode.dataset.recipe_id,a=v.crafting.tiers[i];if(!i||!n||!s)throw new Error(`Tried to use a recipe but either category, subcategory, or recipe id was not passed: ${i} - ${n} - ${s}`);if(F[i][n][s]){let o=F[i][n][s],l=document.querySelector(`[data-crafting_category="${i}"][data-crafting_subcategory="${n}"] [data-recipe_id="${s}"]`),u=!1,c,_;if(n==="items"){let{available_ammount:h,materials:f}=o.get_availability(),y=Math.min(t,h),b=y,w;if(y>0){let k=o.get_success_chance(a);c=o.getResult();let{result_id:H,count:W}=c,ue=p[o.recipe_skill],qe=ue.total_xp_to_next_lvl-ue.total_xp,je=Math.min(ue.xp_to_next_lvl*$s,vt({category:i,subcategory:n,recipe_id:s})*At(ue.skill_id)),Ae=je*k,He=Math.ceil(qe/Ae);b=Math.min(He,y),w=Math.floor(b*k);let Ut=Math.random()<b*k-w?1:0;w+=Ut;let Kt=(w+(b-w)/4)*je,it=0,wt=0;if(b<y&&Kt<qe){for(let Y=0;Y<2&&b+it+wt<y&&(Math.random()<k?it++:wt++,!(Kt+je*(it+wt/4)>=qe));Y++);b+=it+wt,w+=it}_=Kt+je*(it+wt/4),ma+=b,ha+=w;for(let Y=0;Y<o.materials.length;Y++)if(o.materials[Y].material_id){let Me=d[o.materials[Y].material_id].getInventoryKey();dt([{item_key:Me,item_count:o.materials[Y].count*b}])}for(let Y=0;Y<f.length;Y++){let Me=d[f[Y]].material_type,nt=o.materials.find(se=>se.material_type===Me);dt([{item_key:d[f[Y]].getInventoryKey(),item_count:nt.count*b}])}if(w>0){ze([{item_key:d[H].getInventoryKey(),count:W*w}]);let Y=`Created ${d[H].getName()}`;b>1?Y+=` [${W*w} out of ${W*b}]`:Y+=` x${W*w}`,S(Y,"crafting")}else{let Y=`Failed to create ${d[H].getName()}`;b>1?Y+=` [0 out of ${W*b}]`:Y+=` x${W*b}`,S(Y,"crafting")}u=z({skill:ue,xp_to_add:_,cap_gained_xp:!1,use_bonus:!1}),Object.keys(d[H].tags).forEach(Y=>{let Me=Jo[Y];Me&&z({skill:p[Me],xp_to_add:_/2,cap_gained_xp:!0,use_bonus:!1})&&(r.stats.add_active_effect_bonus(),Te(),Object.keys(r.inventory).forEach(se=>{r.inventory[se].item.tags.medicine&&ve({item_key:se})}))}),b<y?hc(e,y-b):(so(),tr())}else console.warn("Tried to use a recipe without having enough materials!")}else if(n==="components"||o.recipe_type==="component"||o.recipe_type==="componentless"){let h=l.children[1].querySelector(".selected_material");if(h){let f=h.dataset.item_key,{id:y}=JSON.parse(f),b=o.materials.filter(w=>w.material_id===y)[0];if(b.count<=r.inventory[f]?.count){let w=p[o.recipe_skill],k=Math.min(t,Math.floor(r.inventory[f].count/b.count)),H=w.total_xp_to_next_lvl-w.total_xp,W=0,ue={},qe=0,je={},Ae=o.getResult(r.inventory[f].item,a),He;for(let Y=0;Y<k;Y++){let Me=Ae.component_tier??Ae.item_tier;if(He=o.get_quality(a-Me),ue[He]=ue[He]+1||1,je[He]=je[He]+1||1,qe++,W+=Math.min(w.xp_to_next_lvl*$s,vt({category:i,subcategory:n,recipe_id:s,material_count:b.count,result_tier:Me,rarity_multiplier:ke[Ke(He)]})*At(w.skill_id)),W>=H){let se=Object.keys(ue).map(Ot=>Number(Ot)).sort((Ot,Jt)=>Jt-Ot)[0];qe>1?S(`Created ${Ae.getName()} x${qe} [highest quality: ${se}% x${ue[se]}] (+${Math.floor(W)} xp)`,"crafting"):S(`Created ${Ae.getName()} [${se}% quality] x1 (+${Math.floor(W)} xp)`,"crafting"),z({skill:w,xp_to_add:W,cap_gained_xp:!1,use_bonus:!1}),ue={},qe=0,W=0,H=w.total_xp_to_next_lvl-w.total_xp}}if(ma+=k,ha+=k,qe>0){let Me=Object.keys(ue).map(nt=>Number(nt)).sort((nt,se)=>se-nt)[0];qe>1?S(`Created ${Ae.getName()} x${qe} [highest quality: ${Me}% x${ue[Me]}] (+${Math.floor(W)} xp)`,"crafting"):S(`Created ${Ae.getName()} [${Me}% quality] x1 (+${Math.floor(W)} xp)`,"crafting"),z({skill:w,xp_to_add:W,cap_gained_xp:!1,use_bonus:!1})}let Ut=Ae.getInventoryKey(),Kt=JSON.parse(Ut),it=Object.keys(je).map(Y=>Number(Y)),wt=[];for(let Y=0;Y<it.length;Y++){let Me=JSON.stringify({...Kt,quality:it[Y]});wt.push({item_key:Me,count:je[it[Y]]})}ze(wt),dt([{item_key:f,item_count:b.count*k}]),h.classList.remove("selected_material"),r.inventory[f]?b.count>r.inventory[f].count&&h.classList.add("recipe_unavailable"):h.remove(),ao({category:i,subcategory:n,recipe_id:s,refreshing:!0})}else console.log("Tried to create an item without having necessary materials")}else return}else if(n==="equipment"){let h=l.children[1].children[0].children[1].querySelector(".selected_component")?.dataset.item_key,f=l.children[1].children[1].children[1].querySelector(".selected_component")?.dataset.item_key;if(!h||!f)return;if(!r.inventory[h]||!r.inventory[f])throw new Error("Tried to create item with components that are not present in the inventory!");if(r.inventory[h].count&&r.inventory[f].count){let y=p[o.recipe_skill],b=Math.min(t,r.inventory[h].count,r.inventory[f].count),w=y.total_xp_to_next_lvl-y.total_xp,k=0,H={},W=0,ue=r.inventory[h].item,qe=r.inventory[f].item,je={},Ae=o.getResult(ue,qe,a),He,Ut=o.get_component_quality_weighted(ue,qe),Kt=Math.max(ue.component_tier,qe.component_tier);for(let se=0;se<b;se++)if(He=o.get_quality(Ut,a-Math.max(Kt)||0),H[He]=H[He]+1||1,je[He]=je[He]+1||1,W++,k+=Math.min(y.xp_to_next_lvl,vt({category:i,subcategory:n,recipe_id:s,selected_components:[ue,qe],rarity_multiplier:ke[Ke(He)]})*At(y.skill_id)),k>=w){let Jt=Object.keys(H).map(Pn=>Number(Pn)).sort((Pn,qc)=>qc-Pn)[0];W>1?S(`Created ${Ae.getName()} x${W} [highest quality: ${Jt}% x${H[Jt]}] (+${Math.floor(k)} xp)`,"crafting"):S(`Created ${Ae.getName()} [${Jt}% quality] x1 (+${Math.floor(k)} xp)`,"crafting"),z({skill:y,xp_to_add:k,use_bonus:!1,cap_gained_xp:!1}),H={},W=0,k=0,w=y.total_xp_to_next_lvl-y.total_xp}if(ma+=b,ha+=b,W>0){let Ot=Object.keys(H).map(Jt=>Number(Jt)).sort((Jt,Pn)=>Pn-Jt)[0];W>1?S(`Created ${Ae.getName()} x${W} [highest quality: ${Ot}% x${H[Ot]}] (+${Math.floor(k)} xp)`,"crafting"):S(`Created ${Ae.getName()} [${Ot}% quality] x1 (+${Math.floor(k)} xp)`,"crafting"),z({skill:y,xp_to_add:k,use_bonus:!1,cap_gained_xp:!1})}let it=Ae.getInventoryKey(),wt=JSON.parse(it),Y=Object.keys(je).map(se=>Number(se)),Me=[];for(let se=0;se<Y.length;se++){let Ot=JSON.stringify({...wt,quality:Y[se]});Me.push({item_key:Ot,count:je[Y[se]]})}ze(Me),dt([{item_key:h,item_count:b},{item_key:f,item_count:b}]);let nt={};nt[h]=!0,nt[f]=!0,no({category:i,recipe_id:s,component_keys:nt})}}}else throw new Error(`Tried to use a recipe that doesn't exist: ${i} -> ${n} -> ${s}`)}function Uo({content_type:e,data:t,what_to_remove:i=Ti.TOP}){Qt.push({content_type:e,data:t,what_to_remove:i}),pc()}function va(){let t=Qt.pop().what_to_remove||Ti.TOP;if(t!==Ti.TOP)if(t===Ti.ALL)for(;Qt[0];)Qt.pop();else throw new Error(`No such content stack removal option as "${t}"`);pc()}function Qu({data:e}){Qt.length>1&&(Qt[Qt.length-2].data.special=e)}function pc(){if(Je?Je=null:$?($=null,li()):Nn&&(Nn=null,li(),clearInterval(gs)),Qt.length){let{content_type:e,data:t}=Qt[Qt.length-1];if(e.startsWith("dialogue")&&(Je=t.dialogue_key),e!=="dialogue"){if(e!=="dialogue_answer"){if(e!=="dialogue_branch")if(e==="action")Je=t.dialogue_key,Nn=t.action_key;else if(e==="activity")$=t.activity;else throw new Error(`Error on switching action box content: no such content type as "${e}"`)}}e&&es({content_type:e,data:t})}else St({location_id:v.id,skip_travel_time:!0})}function Uu(e){Tr(e),j?Vo(!0):v.tags.safe_zone&&Object.keys(v.activities).forEach(t=>{v.activities[t].gained_resources&&Ua(v.activities[t])})}function Ku(e){Lo(e),j&&Vo(!0)}function fc(e){let{id:t}=JSON.parse(e),i=d[t].effects,n=!1;for(let s=0;s<i.length;s++){let a=d[t].effects[s].duration;(!pe[i[s].effect]||pe[i[s].effect].duration<a)&&(pe[i[s].effect]=new me({...Z[i[s].effect],duration:a}),n=!0)}if(n){Mn(),r.stats.add_active_effect_bonus(),Te();let s=[];Object.keys(d[t].recovery_chances).forEach(a=>{d[t].recovery_chances[a]>Math.random()&&s.push({item_id:a})}),ze(s),Object.keys(Hi).forEach(a=>{d[t].tags[Hi[a]]&&z({skill:p[a],xp_to_add:(d[t].value/10)**.6667})&&(r.stats.add_active_effect_bonus(),Te(),Object.keys(r.inventory).forEach(l=>{r.inventory[l].item.tags[Hi[a]]&&ve({item_key:l})}))}),dt([{item_key:e}])}}function Ju(e){if(d[e]){if(!d[e].tags.usable)throw new Error(`Tried to add "${e}" to auto consume, but it's not a consumable.`)}else throw new Error(`Tried to add "${e}" to auto consume, but no such item exists.`);Ht[e]=!0}function rs(e){if(!Ht[e])throw new Error(`Tried to remove "${e}" from auto consume, but it's not there.`);delete Ht[e],r.inventory[d[e].getInventoryKey()]}function Xu(e){if(d[e]){if(!d[e].tags.usable)throw new Error(`Tried to change "${e}" auto consume status, but it's not a consumable.`)}else throw new Error(`Tried to change "${e}" auto consum status, but no such item exists.`);Ht[e]?rs(e):Ju(e),r.inventory[d[e].getInventoryKey()]}function fa(e,t){let i=!1;Object.keys(pe).forEach(n=>{i||Object.keys(Z[n].group_tags).forEach(s=>{i||s in Z[e].group_tags&&(Z[n].group_tags[s]>Z[e].group_tags[s]?i=!0:delete pe[n])})}),!i&&(pe[e]=new me({...Z[e],duration:t}),r.stats.add_active_effect_bonus(),Mn(),Te())}function ba({quest_event_type:e,quest_event_target:t,quest_event_count:i}){le.catchQuestEvent({quest_event_type:e,quest_event_target:t,quest_event_count:i,additional_quest_tags:{location:v?.id||"",season:M.getSeason()||""}})}function Zu(){fa("Spark of Inspiration",1800),S("Gained a Spark of Inspiration!","export_reward")}function gc(){let e=new Date,t=e.getFullYear(),i=e.getMonth()+1,n=i>9?i.toString():"0"+i.toString(),s=e.getDate()>9?e.getDate().toString():"0"+e.getDate().toString(),a=e.getHours()>9?e.getHours().toString():"0"+e.getHours().toString(),o=e.getMinutes()>9?e.getMinutes().toString():"0"+e.getMinutes().toString(),l=e.getSeconds()>9?e.getSeconds().toString():"0"+e.getSeconds().toString();return`${t}-${n}-${s} ${a}_${o}_${l}`}function yt(){return window.location.href.endsWith("-dev/")}function hs(e){try{return JSON.parse(e)&&!!e}catch{return!1}}function yc(){try{let e={};e["game version"]=Cs,e["current time"]=M,e.language=Ct,e.saved_at=gc(),e.total_playtime=No,e.total_deaths=jo,e.total_crafting_attempts=ma,e.total_crafting_successes=ha,e.total_kills=Po,e.total_crits_done=Wo,e.total_crits_taken=Ro,e.total_hits_done=Go,e.total_hits_taken=Fo,e.strongest_hit=ps,e.gathered_materials=fs,e.global_flags=Se,e.last_rewarded_export=dn||0,e.character={name:r.name,titles:r.titles,inventory:{},equipment:r.equipment,money:r.money,xp:{total_xp:r.xp.total_xp},hp_to_full:r.stats.full.max_health-r.stats.full.health,stamina_to_full:r.stats.full.max_stamina-r.stats.full.stamina,reputation:r.reputation},e.player_storage={inventory:{}},e.rain_counter=rn,e.cold_status_counters=cn,Object.keys(r.inventory).forEach(t=>{e.character.inventory[t]={count:r.inventory[t].count}}),Object.keys(st.inventory).forEach(t=>{e.player_storage.inventory[t]={count:st.inventory[t].count}}),e.favourite_consumables=Ht,e.recipes={},Object.keys(F).forEach(t=>{e.recipes[t]={},Object.keys(F[t]).forEach(i=>{e.recipes[t][i]={},Object.keys(F[t][i]).forEach(n=>{e.recipes[t][i][n]={},e.recipes[t][i][n].is_unlocked=F[t][i][n].is_unlocked,e.recipes[t][i][n].is_finished=F[t][i][n].is_finished})})}),e.skill_category_order=Ie,e.skills={},Object.keys(p).forEach(function(t){p[t].is_parent||(e.skills[p[t].skill_id]={total_xp:p[t].total_xp})}),e["current location"]=v.id,e.locations={},Object.keys(m).forEach(function(t){e.locations[t]={},m[t].is_unlocked&&(e.locations[t].is_unlocked=!0),m[t].is_finished&&(e.locations[t].is_finished=!0),"parent_location"in m[t]&&(e.locations[t].enemy_groups_killed=m[t].enemy_groups_killed),m[t].activities&&(e.locations[t].unlocked_activities=[],Object.keys(m[t].activities).forEach(i=>{m[t].activities[i].is_unlocked&&e.locations[t].unlocked_activities.push(i)})),m[t].actions&&(e.locations[t].actions={},Object.keys(m[t].actions).forEach(i=>{(m[t].actions[i].is_unlocked||m[t].actions[i].is_finished)&&(e.locations[t].actions[i]={},m[t].actions[i].is_unlocked&&(e.locations[t].actions[i].is_unlocked=!0),m[t].actions[i].is_finished&&(e.locations[t].actions[i].is_finished=!0))})),m[t].housing?.is_unlocked&&(e.locations[t].housing_unlocked=!0)}),e.favourite_locations=at,e.activities={},Object.keys(x).forEach(function(t){x[t].is_unlocked&&(e.activities[t]={is_unlocked:!0})}),$&&(e.current_activity={activity_id:$.id,working_time:$.working_time,earnings:$.earnings,gathering_time:$.gathering_time,gathered_materials:$.gathered_materials}),e.dialogues={},Object.keys(q).forEach(function(t){e.dialogues[t]={is_unlocked:q[t].is_unlocked,is_finished:q[t].is_finished,textlines:{},actions:{}},q[t].textlines&&Object.keys(q[t].textlines).forEach(i=>{e.dialogues[t].textlines[i]={is_unlocked:q[t].textlines[i].is_unlocked,is_finished:q[t].textlines[i].is_finished}}),q[t].actions&&Object.keys(q[t].actions).forEach(i=>{e.dialogues[t].actions[i]={is_unlocked:q[t].actions[i].is_unlocked,is_finished:q[t].actions[i].is_finished}})}),e.traders={},Object.keys(P).forEach(function(t){if(P[t].is_finished)e.traders[t]={is_unlocked:P[t].is_unlocked,is_finished:P[t].is_finished};else if(P[t].is_unlocked)if(P[t].last_refresh==-1||P[t].can_refresh())e.traders[t]={last_refresh:-1,is_unlocked:P[t].is_unlocked};else{let i={};Object.keys(P[t].inventory).forEach(n=>{i[n]={count:P[t].inventory[n].count}}),e.traders[t]={inventory:i,last_refresh:P[t].last_refresh,is_unlocked:P[t].is_unlocked,is_finished:P[t].is_finished}}}),e.books={},Object.keys(D).forEach(t=>{(D[t].accumulated_time>0||D[t].is_finished)&&(e.books[t]={accumulated_time:D[t].accumulated_time,is_finished:D[t].is_finished})}),e.quests={},Object.keys(O).forEach(t=>{e.quests[t]={is_active:t in tt,is_finished:O[t].is_finished,task_status:[]};for(let i=0;i<O[t].quest_tasks.length;i++)if(O[t].quest_tasks[i].is_finished)e.quests[t].task_status[i]={is_finished:!0};else if(t in tt){e.quests[t].task_status[i]={progress:tt[t].quest_tasks[i].task_condition};return}}),e.is_reading=lt,e.is_sleeping=Ci,e.active_effects=pe,e.enemy_killcount=Wt,e.loot_sold_count=R,e.last_combat_location=qt,e.last_location_with_bed=Ei,e.options=C,e.stances={},Object.keys(ie).forEach(t=>{ie[t].is_unlocked&&(e.stances[t]=!0)}),e.current_stance=Ce,e.selected_stance=pt,e.faved_stances=Dt,e.message_filters={unlocks:document.documentElement.style.getPropertyValue("--message_unlocks_display")!=="none",events:document.documentElement.style.getPropertyValue("--message_events_display")!=="none",combat:document.documentElement.style.getPropertyValue("--message_combat_display")!=="none",loot:document.documentElement.style.getPropertyValue("--message_loot_display")!=="none",background:document.documentElement.style.getPropertyValue("--message_background_display")!=="none",crafting:document.documentElement.style.getPropertyValue("--message_crafting_display")!=="none"},e.skill_list_state={};for(let t=0;t<ht.childElementCount;t++)e.skill_list_state[t]=ht.children[t].classList.contains("skill_category_expanded");return JSON.stringify(e)}catch(e){console.error("Something went wrong on saving the game!"),console.error(e),S("FAILED TO CREATE A SAVE FILE, PLEASE CHECK CONSOLE FOR ERRORS AND REPORT IT","message_critical")}}function ed(){return Date.now()-dn>Ho&&(dn=Date.now(),Zu()),wc(),btoa(yc())}function Bn({key:e,is_manual:t}){let i=yc();return i&&(localStorage.setItem(e,i),t&&(S("Saved the game manually"),ms=0)),JSON.parse(i).saved_at}function wc(){yt()?Bn({key:gt,is_manual:!0}):Bn({key:rt,is_manual:!0})}function Ao(e){try{let t=!1;M.loadTime(e["current time"]),Gr.innerHTML=M.toString(),Object.keys(e.global_flags||{}).forEach(a=>{a==="is_deep_forest_beaten"?Se.is_strength_proved=e.global_flags[a]:Se[a]=e.global_flags[a]}),e.language&&(On[e.language]?Ct=e.language:(console.warn(`Language ${e.language} could not be found.`),C.mofu_mofu_mode?Ct=On.mofu_english:Ct=On.english)),dn=e.last_rewarded_export||dn,No=e.total_playtime||0,jo=e.total_deaths||0,ma=e.total_crafting_attempts||0,ha=e.total_crafting_successes||0,Po=e.total_kills||0,Wo=e.total_crits_done||0,Ro=e.total_crits_taken||0,Go=e.total_hits_done||0,Fo=e.total_hits_taken||0,ps=e.strongest_hit||0,fs=e.gathered_materials||{},pa.value=e.character.name,r.name=e.character.name,Ei=e.last_location_with_bed,qt=e.last_combat_location,C.uniform_text_size_in_action=e.options?.uniform_text_size_in_action,Fr(C.uniform_text_size_in_action),C.auto_return_to_bed=e.options?.auto_return_to_bed,zr(C.auto_return_to_bed),C.disable_combat_autoswitch=e.options?.disable_combat_autoswitch,Yr(C.disable_combat_autoswitch),C.remember_message_log_filters=e.options?.remember_message_log_filters,e.message_filters&&Object.keys(Li).forEach(a=>{Li[a]=e.message_filters[a]??!0}),Dr(C.remember_message_log_filters),C.log_every_gathering_period=e.options?.log_every_gathering_period,Vr(C.log_every_gathering_period),C.log_total_gathering_gain=e.options?.log_total_gathering_gain,Qr(C.log_total_gathering_gain),C.do_background_animations=e.options?.do_background_animations,Kr(C.do_background_animations),C.skip_play_button=e.options?.skip_play_button,Jr(C.skip_play_button),C.mofu_mofu_mode=e.options?.mofu_mofu_mode,Xr(C.mofu_mofu_mode),C.do_enemy_onhit_animations=e.options?.do_enemy_onhit_animations,Zr(C.do_enemy_onhit_animations);let i=Gn("v0.3.5",e["game version"])==1;r.money=(e.character.money||0)*((i==1)*10||1),fn(),bs(e.character.xp.total_xp,!1),rn=e.rain_counter||0;for(let a=0;a<e.cold_status_counters?.length;a++)cn[a]=e.cold_status_counters[a]||0;if(Object.keys(e.favourite_consumables||{}).forEach(a=>{Ht[a]=!0}),ro(),$t("Checking out your books"),e.skill_category_order&&e.skill_category_order.forEach((a,o)=>{Ie[o]=a}),e.books){let a=0,o=e.skills.Literacy.total_xp;Object.keys(e.books).forEach(l=>{d[l]||(console.warn(`Book ${l} couldn't be found and was skipped!`),t=!0),e.books[l].accumulated_time>0&&(e.books[l].is_finished?(d[l].setAsFinished(),r.stats.add_book_bonus(D[l].bonuses),Ye({rewards:D[l].rewards,only_unlocks:!0,inform_overall:!1,is_from_loading:!0}),a+=D[l].required_time*D[l].literacy_xp_rate):(d[l].addProgress(e.books[l].accumulated_time),a+=D[l].accumulated_time*D[l].literacy_xp_rate)),ss(l,e.books[l].is_finished)}),a>o?(z({skill:p.Literacy,should_info:!1,xp_to_add:a,use_bonus:!1,cap_gained_xp:!1,is_from_loading:!0}),console.warn(`Saved XP for "Literacy skill" was less than it should be based on progress with books (${o} vs ${a}), so it was adjusted to match it!`),t=!0):z({skill:p.Literacy,should_info:!1,xp_to_add:o,use_bonus:!1,cap_gained_xp:!1,is_from_loading:!0})}Object.keys(e.skills).forEach(a=>{a!=="Literacy"&&(p[a]&&!p[a].is_parent?e.skills[a].total_xp>0&&z({skill:p[a],xp_to_add:e.skills[a].total_xp,should_info:!1,add_to_parent:!0,use_bonus:!1,cap_gained_xp:!1,is_from_loading:!0}):e.skills[a].total_xp>0&&(console.warn(`Skill "${a}" couldn't be found!`),t=!0))}),e.stances&&Object.keys(e.stances).forEach(a=>{e.stances&&(ie[a].is_unlocked=!0)}),as(ie,Ce,Dt),e.faved_stances&&Object.keys(e.faved_stances).forEach(a=>{ie[a]&&ie[a].is_unlocked&&sc(a)}),e.current_stance&&(Ce=ie[e.current_stance.id]||ie[e.current_stance],pt=ie[e.selected_stance.id]||ie[e.selected_stance],jn({stance_id:pt.id})),Object.keys(e.character.equipment).forEach(function(a){if(e.character.equipment[a]!=null){let o=Gn("v0.4.4",e["game version"])==1?100:1;if(a==="weapon"){let{quality:l,equip_slot:u}=e.character.equipment[a],c;if(e.character.equipment[a].components)c=e.character.equipment[a].components;else{let{head:_,handle:h}=e.character.equipment[a];c={head:_,handle:h}}if(!d[c.head])console.warn(`Skipped item: weapon head component "${c.head}" couldn't be found!`),t=!0;else if(!d[c.handle])console.warn(`Skipped item: weapon handle component "${c.handle}" couldn't be found!`),t=!0;else{let _=_e({components:c,quality:l*o,equip_slot:u,item_type:"EQUIPPABLE"});ci(_,!0)}}else if(a==="off-hand"){let{quality:l,equip_slot:u}=e.character.equipment[a],c;if(e.character.equipment[a].components)c=e.character.equipment[a].components;else{let{shield_base:_,handle:h}=e.character.equipment[a];c={shield_base:_,handle:h}}if(!d[c.shield_base])console.warn(`Skipped item: shield base component "${c.shield_base}" couldn't be found!`),t=!0;else if(!d[c.handle])console.warn(`Skipped item: shield handle "${c.handle}" couldn't be found!`),t=!0;else{let _=_e({components:c,quality:l*o,equip_slot:u,item_type:"EQUIPPABLE"});ci(_,!0)}}else if(e.character.equipment[a].equip_slot==="arti'fact"||e.character.equipment[a].tags?.tool)ci(_e(e.character.equipment[a]),!0);else{let{quality:l,equip_slot:u}=e.character.equipment[a];if(e.character.equipment[a].components&&e.character.equipment[a].components.internal.includes(" [component]")){let c=_e({...d[e.character.equipment[a].components.internal.replace(" [component]","")],quality:l*o});ci(c,!0)}else if(e.character.equipment[a].components){let c=e.character.equipment[a].components;if(!d[c.internal])console.warn(`Skipped item: internal armor component "${c.internal}" couldn't be found!`),t=!0;else if(c.external&&!d[c.external])console.warn(`Skipped item: external armor component "${c.external}" couldn't be found!`),t=!0;else{let _=_e({components:c,quality:l*o,equip_slot:u,item_type:"EQUIPPABLE"});ci(_,!0)}}else{let c=_e({...d[e.character.equipment[a].name],quality:l*o});ci(c,!0)}}}}),r.equipment.weapon===null&&ci(null,!0);let n=[];Object.keys(e.character.inventory).forEach(a=>{if(hs(a)){let{id:o,components:l,quality:u}=JSON.parse(a);if(o&&!u)if(d[o])o==="Coal"&&Xe(e["game version"],"v0.4.6.12")?n.push({item_key:d.Charcoal.getInventoryKey(),count:e.character.inventory[a].count,quality:u}):n.push({item_key:a,count:e.character.inventory[a].count,quality:u});else{console.warn(`Inventory item "${a}" from save on version "${e["game version"]} couldn't be found!`),t=!0;return}else if(l){let{head:c,handle:_,shield_base:h,internal:f,external:y}=l;if(c)if(d[c])if(d[_])n.push({item_key:a,count:e.character.inventory[a].count,quality:u});else{console.warn(`Skipped item: weapon handle component "${_}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: weapon head component "${c}" couldn't be found!`),t=!0;return}else if(h)if(d[h])if(d[_])n.push({item_key:a,count:e.character.inventory[a].count,quality:u});else{console.warn(`Skipped item: shield handle component "${_}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: shield base component "${h}" couldn't be found!`),t=!0;return}else if(f)if(d[f])if(d[y]){if(!ra(f))return;n.push({item_key:a,count:e.character.inventory[a].count,quality:u})}else{console.warn(`Skipped item: external armor component "${y}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: internal armor component "${f}" couldn't be found!`),t=!0;return}else console.error(`Intentory key "${a}" from save on version "${e["game version"]} seems to refer to non-existing item type!`)}else u?n.push({item_key:a,count:e.character.inventory[a].count,quality:u}):console.error(`Intentory key "${a}" from save on version "${e["game version"]} is incorrect!`)}else if(Array.isArray(e.character.inventory[a]))for(let o=0;o<e.character.inventory[a].length;o++)if(e.character.inventory[a][o].item_type==="EQUIPPABLE")if(e.character.inventory[a][o].equip_slot==="weapon"){let{quality:l}=e.character.inventory[a][o],u;if(e.character.inventory[a][o].components)u=e.character.inventory[a][o].components;else{let{head:c,handle:_}=e.character.inventory[a][o];u={head:c,handle:_}}if(!d[u.head])console.warn(`Skipped item: weapon head component "${u.head}" couldn't be found!`),t=!0;else if(!d[u.handle])console.warn(`Skipped item: weapon handle component "${u.handle}" couldn't be found!`),t=!0;else{let c=_e({item_type:"EQUIPPABLE",equip_slot:"weapon",components:u});n.push({item_key:c.getInventoryKey(),count:1,quality:l*100})}}else if(e.character.inventory[a][o].equip_slot==="off-hand"){let{quality:l}=e.character.inventory[a][o],u;if(e.character.inventory[a][o].components)u=e.character.inventory[a][o].components;else{let{shield_base:c,handle:_}=e.character.inventory[a][o];u={shield_base:c,handle:_}}if(!d[u.shield_base])console.warn(`Skipped item: shield base component "${u.shield_base}" couldn't be found!`),t=!0;else if(!d[u.handle])console.warn(`Skipped item: shield handle "${u.handle}" couldn't be found!`),t=!0;else{let c=_e({item_type:"EQUIPPABLE",equip_slot:"off-hand",components:u});n.push({item_key:c.getInventoryKey(),count:1,quality:l*100})}}else if(e.character.inventory[a][o].equip_slot==="artifact"||e.character.inventory[a][o].equip_slot==="amulet")n.push({item_key:a,count:1});else if(e.character.inventory[a][o].components&&e.character.inventory[a][o].components.internal.includes(" [component]"))n.push({item_key:a,count:1});else if(e.character.inventory[a][o].components){let l=e.character.inventory[a][o].components;if(!d[l.internal])console.warn(`Skipped item: internal armor component "${l.internal}" couldn't be found!`),t=!0;else if(l.external&&!d[l.external])console.warn(`Skipped item: external armor component "${l.external}" couldn't be found!`),t=!0;else{let u=_e({item_type:"EQUIPPABLE",components:l});n.push({item_key:u.getInventoryKey(),count:1,quality:e.character.inventory[a][o].quality*100})}}else n.push({item_id:a,count:1});else n.push({item_id:a,count:1,quality:e.character.inventory[a][o].quality*100});else if(d[a])n.push({item_id:a,count:e.character.inventory[a].count});else{console.warn(`Inventory item "${a}" from save on version "${e["game version"]}" couldn't be found!`),t=!0;return}}),ze(n);let s=[];if(e.player_storage&&(Object.keys(e.player_storage.inventory).forEach(function(a){if(hs(a)){let{id:o,components:l,quality:u}=JSON.parse(a);if(o&&!u)if(d[o])s.push({item_key:a,count:e.player_storage.inventory[a].count,quality:u});else{console.warn(`Inventory item "${a}" from save on version "${e["game version"]} couldn't be found!`),t=!0;return}else if(l){let{head:c,handle:_,shield_base:h,internal:f,external:y}=l;if(c)if(d[c])if(d[_])s.push({item_key:a,count:e.player_storage.inventory[a].count,quality:u});else{console.warn(`Skipped item: weapon handle component "${_}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: weapon head component "${c}" couldn't be found!`),t=!0;return}else if(h)if(d[h])if(d[_])s.push({item_key:a,count:e.player_storage.inventory[a].count,quality:u});else{console.warn(`Skipped item: shield handle component "${_}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: shield base component "${h}" couldn't be found!`),t=!0;return}else if(f)if(d[f])if(d[y]){if(!ra(f))return;s.push({item_key:a,count:e.player_storage.inventory[a].count,quality:u})}else{console.warn(`Skipped item: external armor component "${y}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: internal armor component "${f}" couldn't be found!`),t=!0;return}else console.error(`Intentory key "${a}" from save on version "${e["game version"]} seems to refer to non-existing item type!`)}else u?s.push({item_key:a,count:e.player_storage.inventory[a].count,quality:u}):console.error(`Intentory key "${a}" from save on version "${e["game version"]} is incorrect!`)}}),st.add_to_inventory(s)),$t("Meowing at your cat"),Object.keys(e.dialogues).forEach(function(a){if(q[a])q[a].is_unlocked=e.dialogues[a].is_unlocked,q[a].is_finished=e.dialogues[a].is_finished;else{if(a==="cute little rat"&&Xe(e["game version"],"v0.5.0"))return;console.warn(`Dialogue "${a}" couldn't be found!`),t=!0;return}e.dialogues[a].textlines&&Object.keys(e.dialogues[a].textlines).forEach(o=>{if(q[a].textlines[o])q[a].textlines[o].is_unlocked=e.dialogues[a].textlines[o].is_unlocked,q[a].textlines[o].is_finished=e.dialogues[a].textlines[o].is_finished;else{console.warn(`Textline "${o}" in dialogue "${a}" couldn't be found!`),t=!0;return}}),e.dialogues[a].actions&&Object.keys(e.dialogues[a].actions).forEach(o=>{if(q[a].actions[o])q[a].actions[o].is_unlocked=e.dialogues[a].actions[o].is_unlocked,q[a].actions[o].is_finished=e.dialogues[a].actions[o].is_finished;else{console.warn(`Textline "${o}" in dialogue "${a}" couldn't be found!`),t=!0;return}})}),Object.keys(e.traders).forEach(function(a){let o=[];if(P[a]){if(P[a].is_unlocked=e.traders[a].is_unlocked,e.traders[a].is_finished){P[a].is_finished=!0;return}e.traders[a].inventory&&Object.keys(e.traders[a].inventory).forEach(function(l){if(hs(l)){let{id:u,components:c,quality:_}=JSON.parse(l);if(u&&!_)if(d[u])o.push({item_key:l,count:e.traders[a].inventory[l].count});else{console.warn(`Inventory item "${l}" from save on version "${e["game version"]} couldn't be found!`),t=!0;return}else if(c){let{head:h,handle:f,shield_base:y,internal:b,external:w}=c;if(h)if(d[h])if(d[f])o.push({item_key:l,count:e.traders[a].inventory[l].count,quality:_});else{console.warn(`Skipped item: weapon handle component "${f}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: weapon head component "${h}" couldn't be found!`),t=!0;return}else if(y)if(d[y])if(d[f])o.push({item_key:l,count:e.traders[a].inventory[l].count,quality:_});else{console.warn(`Skipped item: shield handle component "${f}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: shield base component "${y}" couldn't be found!`),t=!0;return}else if(b)if(d[b])if(d[w]){if(!ra(b))return;o.push({item_key:l,count:e.traders[a].inventory[l].count,quality:_})}else{console.warn(`Skipped item: external armor component "${w}" couldn't be found!`),t=!0;return}else{console.warn(`Skipped item: internal armor component "${b}" couldn't be found!`),t=!0;return}else console.error(`Intentory key "${l}" from save on version "${e["game version"]} seems to refer to non-existing item type!`)}else _?o.push({item_key:l,count:e.traders[a].inventory[l].count,quality:_}):console.error(`Intentory key "${l}" from save on version "${e["game version"]} is incorrect!`)}else if(Array.isArray(e.traders[a].inventory[l]))for(let u=0;u<e.traders[a].inventory[l].length;u++)if(e.traders[a].inventory[l][u].item_type==="EQUIPPABLE")if(e.traders[a].inventory[l][u].equip_slot==="weapon"){let{quality:c}=e.traders[a].inventory[l][u],_;if(e.traders[a].inventory[l][u].components)_=e.traders[a].inventory[l][u].components;else{let{head:h,handle:f}=e.traders[a].inventory[l][u];_={head:h,handle:f}}if(!d[_.head])console.warn(`Skipped item: weapon head component "${_.head}" couldn't be found!`),t=!0;else if(!d[_.handle])console.warn(`Skipped item: weapon handle component "${_.handle}" couldn't be found!`),t=!0;else{let h=_e({components:_,item_type:"EQUIPPABLE",equip_slot:"weapon"});o.push({item_key:h.getInventoryKey(),count:1,quality:c*100})}}else if(e.traders[a].inventory[l][u].equip_slot==="off-hand"){let{quality:c}=e.traders[a].inventory[l][u],_;if(e.traders[a].inventory[l][u].components)_=e.traders[a].inventory[l][u].components;else{let{shield_base:h,handle:f}=e.traders[a].inventory[l][u];_={shield_base:h,handle:f}}if(!d[_.shield_base])console.warn(`Skipped item: shield base component "${_.shield_base}" couldn't be found!`),t=!0;else if(!d[_.handle])console.warn(`Skipped item: shield handle "${_.handle}" couldn't be found!`),t=!0;else{let h=_e({components:_,item_type:"EQUIPPABLE",equip_slot:"off-hand"});o.push({item_key:h.getInventoryKey(),count:1,quality:c*100})}}else{let{quality:c}=e.traders[a].inventory[l][u];if(e.traders[a].inventory[l][u].components&&e.traders[a].inventory[l][u].components.internal.includes(" [component]")){let _=_e({...d[l]});o.push({item_key:_.getInventoryKey(),count:1,quality:c*100})}else if(e.traders[a].inventory[l][u].components){let _=e.traders[a].inventory[l][u].components;if(!d[_.internal])console.warn(`Skipped item: internal armor component "${_.internal}" couldn't be found!`),t=!0;else if(_.external&&!d[_.external])console.warn(`Skipped item: external armor component "${_.external}" couldn't be found!`),t=!0;else{let h=_e({components:_,item_type:"EQUIPPABLE",equip_slot:"armor"});o.push({item_key:h.getInventoryKey(),count:1,quality:c*100})}}else o.push({item_id:l,count:1,quality:c*100})}else console.warn('Skipped item, no such item type as "0" could be found'),t=!0;else e.traders[a].inventory[l].item.value=d[l].value,d[l].item_type==="EQUIPPABLE"?e.traders[a].inventory[l].item.equip_effect=d[l].equip_effect:d[l].item_type==="USABLE"&&(e.traders[a].inventory[l].item.use_effect=d[l].use_effect),o.push({item_id:l,count:e.traders[a].inventory[l].count})}),P[a].refresh(),P[a].inventory={},Is(a,o),P[a].last_refresh=e.traders[a].last_refresh}else{console.warn(`Trader "${a} couldn't be found!`),t=!0;return}}),$t("Hiding rats in your walls"),Object.keys(e.locations).forEach(function(a){if(m[a]){if(e.locations[a].is_unlocked&&(m[a].is_unlocked=!0),e.locations[a].is_finished&&(m[a].is_finished=!0),"parent_location"in m[a]){if(m[a].enemy_groups_killed=e.locations[a].enemy_groups_killed||0,Xe(e["game version"],"v0.4.6")){if(m[a].rewards_with_clear_requirement)for(let o=0;o<m[a].rewards_with_clear_requirement.length;o++)m[a].enemy_groups_killed==m[a].enemy_count*m[a].rewards_with_clear_requirement[o].required_clear_count&&Ye({rewards:m[a].rewards_with_clear_requirement[o],source_type:"location",source_name:m[a].name,is_first_clear:!1,source_id:m[a].id,is_from_loading:!0})}else if(m[a].rewards_with_clear_requirement)for(let o=0;o<m[a].rewards_with_clear_requirement.length;o++)m[a].enemy_groups_killed>=m[a].enemy_count*m[a].rewards_with_clear_requirement[o].required_clear_count&&Ye({rewards:m[a].rewards_with_clear_requirement[o],source_type:"location",source_name:m[a].name,is_first_clear:!1,source_id:m[a].id,only_unlocks:!0,is_from_loading:!0});m[a].first_reward&&Ye({rewards:m[a].first_reward,source_type:"location",is_first_clear:!0,source_id:location.id,is_from_loading:!0,only_unlocks:!0})}if(e.locations[a].unlocked_activities)for(let o=0;o<e.locations[a].unlocked_activities.length;o++)m[a].activities[e.locations[a].unlocked_activities[o]]&&(e.locations[a].unlocked_activities[o]==="plowing the fields"?m[a].activities.fieldwork.is_unlocked=!0:m[a].activities[e.locations[a].unlocked_activities[o]].is_unlocked=!0);e.locations[a].actions&&Object.keys(e.locations[a].actions).forEach(o=>{e.locations[a].actions[o].is_unlocked&&(m[a].actions[o].is_unlocked=!0),e.locations[a].actions[o].is_finished&&(m[a].actions[o].is_finished=!0)}),e.locations[a].housing_unlocked?Object.keys(m[a].housing).length?(m[a].housing.is_unlocked=!0,e.locations[a].is_unlocked&&(Ln[a]=!0)):(console.warn(`Location "${m[a].name}" was saved as having a bed unlocked, but it no longer has this mechanic and was skipped!`),t=!0):m[a].housing?.is_unlocked&&(Ln[a]=!0)}else{console.warn(`Location "${a}" couldn't be found!`),t=!0;return}}),Xe(e["game version"],"v0.5")&&m["Nearby cave"].activities.climbing.is_unlocked&&(x.climbing.is_unlocked=!0),Xe(e["game version"],"v0.4.6.7")&&(m["Town square"].is_unlocked=!1,e["current location"]==="Town square"&&(e["current location"]="Village")),Object.keys(e.activities).forEach(function(a){x[a]?x[a].is_unlocked=e.activities[a].is_unlocked||!1:a==="plowing the fields"?x.fieldwork.is_unlocked=e.activities[a].is_unlocked||!1:(console.warn(`Activity "${a}" couldn't be found!`),t=!0)}),Xe(e["game version"],"v0.5")){let a={},o=Object.keys(Be).length;Object.keys(e.loot_sold_count).forEach(l=>{let u=e.loot_sold_count[l];Object.keys(Be).forEach(c=>{a[c]||(a[c]={}),a[c][l]=[{sold:0,recovered:0}],a[c][l][0].sold=Math.floor(u.sold/o),a[c][l][0].recovered=Math.floor(u.recovered/o)})}),zn(a),q["old craftsman"].textlines.learn.is_finished&&ze([{item_id:"Old shovel"}])}else if(Xe(e["game version"],"v0.5.0.22")&&Xe("v0.5",e["game version"])){let a={};Object.keys(e.loot_sold_count).forEach(o=>{a[o]={},Object.keys(e.loot_sold_count[o]).forEach(l=>{a[o][l]=[];for(let u=0;u<e.loot_sold_count[o][l].length;u++){if(e.loot_sold_count[o][l][u].sold>Lt){console.warn(`Encountered a large sold count (${e.loot_sold_count[o][l][u].sold}) of a trade group "${l}" at tier ${u}. Due to the save being from a game version where a certain bug could make these values keep growing by themselves, it was reduced to ${Lt}, and it's recovered_count was lowered proportionally.`);let c=e.loot_sold_count[o][l][u].recovered/e.loot_sold_count[o][l][u].sold;e.loot_sold_count[o][l][u].sold=Lt,e.loot_sold_count[o][l][u].recovered=Lt*c}a[o][l].push({sold:e.loot_sold_count[o][l][u].sold,recovered:e.loot_sold_count[o][l][u].recovered})}})}),zn(a)}else zn(e.loot_sold_count||{});if(Gn(e["game version"],"v0.4.4")>=0&&(Object.keys(e.active_effects).forEach(function(a){pe[a]=new me({...Z[a],duration:e.active_effects[a].duration})}),r.stats.add_active_effect_bonus()),$t("Hiding from the vet"),e.character.hp_to_full==null||e.character.hp_to_full>=r.stats.full.max_health?r.stats.full.health=1:r.stats.full.health=r.stats.full.max_health-e.character.hp_to_full,e.character.stamina_to_full==null||e.character.stamina_to_full>=r.stats.full.max_stamina?r.stats.full.stamina=0:r.stats.full.stamina=r.stats.full.max_stamina-e.character.stamina_to_full,$t("Hiding rats in your walls (again!)"),e.enemy_killcount&&Object.keys(e.enemy_killcount).forEach(a=>{Wt[a]=e.enemy_killcount[a],po(a)}),$t("Looking for things that can be done tomorrow instead"),e.quests&&Object.keys(e.quests).forEach(a=>{if(e.quests[a].is_finished){for(let o=0;o<O[a].quest_tasks.length;o++)O[a].quest_tasks[o].is_finished=!0;le.startQuest({quest_id:a,should_inform:!1}),le.finishQuest({quest_id:a,should_inform:!1,only_unlocks:!0,is_from_loading:!0})}else if(e.quests[a].is_active){le.startQuest({quest_id:a,should_inform:!1});for(let u=0;u<e.quests[a].task_status.length-1;u++)O[a].quest_tasks[u].is_finished=!0;let o=e.quests[a].task_status.length-1,l=e.quests[a].task_status[o].progress;Object.keys(l||{}).forEach(u=>{if(!O[a].quest_tasks[o].task_condition[u]){console.warn(`Skipped loading progress for quest "${a}", no such task group as "${u}" was present.`),t=!0;return}Object.keys(l[u]).forEach(c=>{if(!O[a].quest_tasks[o].task_condition[u][c]){console.warn(`Skipped loading progress for quest "${a}", no such task type as "${c}" was present.`),t=!0;return}Object.keys(l[u][c]).forEach(_=>{if(!O[a].quest_tasks[o].task_condition[u][c][_]){console.warn(`Skipped loading progress for quest "${a}", no such task target as "${_}" was present.`),t=!0;return}O[a].quest_tasks[o].task_condition[u][c][_].current=l[u][c][_].current})})}),O[a].is_hidden||Un(a)}}),Xe(e["game version"],"v0.5.0")&&(le.startQuest({quest_id:"Lost memory",should_inform:!1}),q["village elder"].textlines["what happened"].is_finished&&(le.finishQuestTask({quest_id:"Lost memory",task_index:0,skip_message:!0}),q["village elder"].textlines["need to"].is_finished&&(le.finishQuestTask({quest_id:"Lost memory",task_index:1,skip_message:!0}),q["village elder"].textlines["cleared cave"].is_finished&&(le.finishQuestTask({quest_id:"Lost memory",task_index:2,skip_message:!0}),q["suspicious man"].textlines.defeated.is_finished&&le.finishQuestTask({quest_id:"Lost memory",task_index:3,skip_message:!0})))),m["Suspicious wall"].is_finished&&(le.startQuest({quest_id:"The Infinite Rat Saga",should_inform:!1}),m["Mysterious gate"].enemy_groups_killed>=m["Mysterious gate"].enemy_count&&(le.finishQuestTask({quest_id:"The Infinite Rat Saga",task_index:0,skip_message:!0}),m["Nearby cave"].actions["open the gate"].is_finished&&(le.finishQuestTask({quest_id:"The Infinite Rat Saga",task_index:1,skip_message:!0}),m["Writhing tunnel"].enemy_groups_killed>=m["Writhing tunnel"].enemy_count&&le.finishQuestTask({quest_id:"The Infinite Rat Saga",task_index:2,skip_message:!0})))),q["suspicious man"].textlines.gang.is_finished&&(le.startQuest({quest_id:"Light in the darkness",should_inform:!1}),le.finishQuestTask({quest_id:"Light in the darkness",task_index:0,skip_message:!0}),m["Gang hideout"].is_finished&&le.finishQuestTask({quest_id:"Light in the darkness",task_index:1,skip_message:!0})),(q["farm supervisor"].textlines.fight0.is_finished||q["farm supervisor"].textlines.fight.is_finished)&&(le.startQuest({quest_id:"Ploughs to swords",should_inform:!1}),q["farm supervisor"].textlines.fight.is_finished&&(le.finishQuestTask({quest_id:"Ploughs to swords",task_index:0,skip_message:!0}),q["farm supervisor"].textlines["defeated boars"].is_finished&&le.finishQuestTask({quest_id:"Ploughs to swords",task_index:1,skip_message:!0})))),Xe(e["game version"],"v0.5.0.7")&&Xe("v0.5.0",e["game version"])&&(q["farm supervisor"].textlines.fight0.is_finished||q["farm supervisor"].textlines.fight.is_finished)&&(le.startQuest({quest_id:"Ploughs to swords",should_inform:!1}),q["farm supervisor"].textlines.fight.is_finished&&(le.finishQuestTask({quest_id:"Ploughs to swords",task_index:0,skip_message:!0}),q["farm supervisor"].textlines["defeated boars"].is_finished&&le.finishQuestTask({quest_id:"Ploughs to swords",task_index:1,skip_message:!0}))),q["farm supervisor"].textlines["defeated boars"].is_finished&&(q["farm supervisor"].textlines.troubled.is_unlocked=!0),$t("Mixing catnip with more catnip"),e.recipes&&Object.keys(e.recipes).forEach(a=>{Object.keys(e.recipes[a]).forEach(o=>{Object.keys(e.recipes[a][o]).forEach(l=>{if(!F[a][o][l]){if(Xe(e["game version"],"v0.5.0")&&(a==="crafting"&&o==="items"&&(F.butchering.items[l]||F.woodworking.items[l])||l==="Shield base"||l==="Shield handle"))return;console.warn(`Could not find recipe "${a}"->"${o}"->"${l}". It might have been removed.`),t=!0;return}e.recipes[a][o][l].is_unlocked&&(F[a][o][l].is_unlocked=!0),e.recipes[a][o][l].is_finished&&(F[a][o][l].is_finished=!0)})})}),$t("Doing some finishing pats"),e.favourite_locations&&Object.keys(e.favourite_locations).forEach(a=>{m[a]?at[a]=!0:(console.warn(`Saved favourite locations included "${a}", which is not a valid location id`),t=!0)}),e.skill_list_state&&Object.keys(e.skill_list_state).forEach(a=>{ht.childElementCount>0&&e.skill_list_state[a]&&ht.children[a].classList.add("skill_category_expanded")}),Te(),ve(),ri(),Mn(),to(),St({location_id:e["current location"],skip_travel_time:!0,do_quest_events:!1,skip_combat:!0}),C.use_uncivilised_temperature_scale=e.options?.use_uncivilised_temperature_scale,Ur(C.use_uncivilised_temperature_scale),e.current_activity){let a=e.current_activity.activity_id;typeof a<"u"&&v.activities[a]&&x[v.activities[a].activity_name]?(ec(a),x[v.activities[a].activity_name].type==="JOB"?($.working_time=e.current_activity.working_time,$.earnings=e.current_activity.earnings*((i==1)*10||1),document.getElementById("action_end_earnings").innerHTML=`(earnings: ${Pe($.earnings)})`):x[v.activities[a].activity_name].type==="GATHERING"&&($.gathered_materials=e.current_activity.gathered_materials||{}),$.gathering_time=e.current_activity.gathering_time):(console.warn(`Couldn't find saved activity "${a}"! It might have been removed`),t=!0)}e.is_sleeping&&Yo(),e.is_reading&&ac(e.is_reading),t&&qr(),lo(),os(e["game version"])}catch(t){throw os(e["game version"]),t}}function td(e){try{yt()?localStorage.setItem(gt,atob(e)):localStorage.setItem(rt,atob(e)),window.location.reload(!1)}catch(t){console.error("Something went wrong on preparing to load from file!"),console.error(t)}}function id(){try{yt()?localStorage.getItem(gt)?(Ao(JSON.parse(localStorage.getItem(gt))),S("Loaded dev save. If you want to use save from live version, import it through options panel or manually")):(Ao(JSON.parse(localStorage.getItem(rt))),S("Dev save was not found. Loaded live version save.")):Ao(JSON.parse(localStorage.getItem(rt)))}catch(e){Wr=!0,$t("Something went wrong \u{1F62D}"),xr(),console.error("Something went wrong on loading from localStorage!"),console.error(e)}}function nd(){try{yt()?localStorage.getItem(ya)?(localStorage.setItem(gt,localStorage.getItem(ya)),window.location.reload(!1)):(console.log("Can't load backup as there is none yet."),S("Can't load backup as there is none yet.")):localStorage.getItem(ga)?(localStorage.setItem(rt,localStorage.getItem(ga)),window.location.reload(!1)):(console.log("Can't load backup as there is none yet."),S("Can't load backup as there is none yet."))}catch(e){console.error("Something went wrong on loading from localStorage!"),console.error(e)}}function ad(){try{yt()?localStorage.getItem(rt)?(localStorage.setItem(gt,localStorage.getItem(rt)),window.location.reload(!1)):(console.log("There are no saves on the other release."),S("There are no saves on the other release.")):localStorage.getItem(gt)?(localStorage.setItem(rt,localStorage.getItem(gt)),window.location.reload(!1)):(console.log("There are no saves on the other release."),S("There are no saves on the other release."))}catch(e){console.error("Something went wrong on loading from localStorage!"),console.error(e)}}function sd(){let e=prompt('This will erase all your progress and you will have to start from the very beginning. If you are sure this is what you want, type "reset" below');if(e==="reset"||e==='"reset"')return yt()?(localStorage.removeItem(gt),localStorage.setItem("skip_live_import","true")):localStorage.removeItem(rt),window.location.reload(),!1;console.log("Hard reset was cancelled.")}function bc(e){let t=pi(M);M.goUp(e||(Ci?6:1)),t!==pi(M)&&Te(),lo()}function od({value:e=0,source:t}){bc(e),vc({time_in_minutes:e,is_sleep:Ci,is_travel:t==="travel"})}function vc({time_in_minutes:e=1,is_travel:t}){let i=!1;return Object.keys(pe).forEach(n=>{(!t||t&&pe[n].affected_by_travel)&&(pe[n].duration-=e,pe[n].duration<=0&&(delete pe[n],r.stats.add_active_effect_bonus(),Te(),i=!0))}),i}function kc(){setTimeout(()=>{jr=Date.now(),Cn+=jr-_a-1e3/ce,_a=Date.now();let e=!1,t=M.day;bc(),_a-dn>Ho?document.getElementById("save_to_file_button").classList.add("export_button_with_reward"):document.getElementById("save_to_file_button").classList.remove("export_button_with_reward"),vr(_a-dn,Ho),M.day>t&&(Zo(fu,gu),el(yu),Ls()&&(ve({is_trade:!0}),jt())),e=e||vc({time_in_minutes:1}),oo(),Mn();let n=Aa();v.is_under_roof?((ca||ua)&&(sa(),window.removeEventListener("resize",an),window.removeEventListener("resize",nn),window.removeEventListener("resize",tn)),ca=!1,ua=!1):Ha()?(rn>=Sr?fa("Wet",30):n<0?rn+=.25:rn++,!ca&&C.do_background_animations&&(window.removeEventListener("resize",an),n>=0?(window.addEventListener("resize",tn),window.removeEventListener("resize",nn),tn()):(window.addEventListener("resize",nn),window.removeEventListener("resize",tn),nn())),ca=C.do_background_animations):(rn>0&&rn--,ca=!1,!ua&&pi()?(C.do_background_animations&&(window.addEventListener("resize",an),window.removeEventListener("resize",nn),window.removeEventListener("resize",tn),an()),ua=C.do_background_animations):ua&&!pi()&&(sa(),window.removeEventListener("resize",an))),To!==n&&(e||Te()),Ja(),To=n;let s=!1;for(let l=Sn.length-1;l>=0;l--)if(To+$i()<=Sn[l]){if(pe.Wet&&cn[l]>=Ir||cn[l]>=Lr){if(s)continue;fa(ls[l],60)}else cn[l]++;z({skill:p["Cold resistance"],xp_to_add:.2})}else cn[l]>0&&cn[l]--;if("parent_location"in v)Object.keys(Ht).forEach(l=>{let u=d[l].getInventoryKey();if(!r.inventory[u]){rs(l);return}let c=d[l].effects.sort((_,h)=>C.auto_use_when_longest_runs_out?h.duration-_.duration:_.duration-h.duration);if(!pe[c[0].effect]){fc(u);return}}),z({skill:p.Breathing,xp_to_add:.1});else{if(Ci?(Cu(),z({skill:p.Sleeping,xp_to_add:v.housing?.sleeping_xp_per_tick})):(wu&&Tu(),lt&&Au()),pt.id!==Ce.id&&jn({stance_id:pt.id}),$){if($.applied_effects)for(let u=0;u<$.applied_effects.length;u++)fa($.applied_effects[u].effect,$.applied_effects[u].duration);if(x[$.activity_name].type!=="GATHERING")for(let u=0;u<x[$.activity_name].base_skills_names?.length;u++)z({skill:p[x[$.activity_name].base_skills_names[u]],xp_to_add:$.skill_xp_per_tick});if(x[$.activity_name].type==="TRAINING"?z({skill:p.Breathing,xp_to_add:.5}):z({skill:p.Breathing,xp_to_add:.1}),$.gathering_time+=1,$.gained_resources&&$.gathering_time>=$.gathering_time_needed){let{gathering_time_needed:u,gained_resources:c}=$.getActivityEfficiency();$.gathering_time_needed=u;let _=[];for(let f=0;f<c.length;f++)if(Math.random()>1-c[f].chance){let y=Math.floor(Math.random()*(c[f].count[1]-c[f].count[0]+1))+c[f].count[0];_.push({item_key:d[c[f].name].getInventoryKey(),count:y}),fs[c[f].name]=(fs[c[f].name]||0)+y}if(_.length>0){C.log_every_gathering_period&&za({loot_list:_});for(let f=0;f<_.length;f++)$.gathered_materials[_[f].item_key]=$.gathered_materials[_[f].item_key]+_[f].count||_[f].count;ze(_)}let h=!1;if(x[$.activity_name].type==="GATHERING"){for(let f=0;f<x[$.activity_name].base_skills_names?.length;f++)h=z({skill:p[x[$.activity_name].base_skills_names[f]],xp_to_add:$.skill_xp_per_tick})||h;Ua($)}$.gathering_time=0}x[$.activity_name].type==="JOB"&&($.working_time+=1,$.working_time%$.working_period==0&&($.earnings+=$.get_payment()),co($,!0)),x[$.activity_name].type!=="JOB"&&co($,!1),In($)||zo()}else{z({skill:p.Breathing,xp_to_add:.1});let u=document.getElementsByClassName("activity_div");for(let c=0;c<u.length;c++){let _=v.activities[u[c].getAttribute("data-activity")];(x[_.activity_name].type==="JOB"||x[_.activity_name].type==="TRAINING")&&(In(_)?(u[c].classList.remove("activity_unavailable"),u[c].classList.add("start_activity")):(u[c].classList.remove("start_activity"),u[c].classList.add("activity_unavailable")))}}let l=v.getBackgroundNoises();l.length>0&&Math.random()<1/600&&S(`"${l[Math.floor(Math.random()*l.length)]}"`,"background"),$&&Math.random()<1/100&&(l=x[$.activity_name].getBackgroundNoises(),l.length>0&&S(`"${l[Math.floor(Math.random()*l.length)]}"`,"background"))}let a=0,o=0;if(r.stats.full.health_regeneration_flat&&(a+=r.stats.full.health_regeneration_flat),r.stats.full.health_regeneration_percent&&(a+=r.stats.full.max_health*r.stats.full.health_regeneration_percent/100),r.stats.full.health_loss_flat&&(o-=r.stats.full.health_loss_flat),r.stats.full.health_loss_percent&&(o+=r.stats.full.max_health*r.stats.full.health_loss_percent/100),Do({ammount_to_restore:a,ammount_to_loose:o}),r.stats.full.stamina_regeneration_flat&&(r.stats.full.stamina+=r.stats.full.stamina_regeneration_flat),r.stats.full.stamina_regeneration_percent&&(r.stats.full.stamina+=r.stats.full.max_stamina*r.stats.full.stamina_regeneration_percent/100),r.stats.full.mana_regeneration_flat&&(r.stats.full.mana+=r.stats.full.mana_regeneration_flat),r.stats.full.mana_regeneration_percent&&(r.stats.full.mana+=r.stats.full.max_mana*r.stats.full.mana_regeneration_percent/100),r.stats.full.stamina>r.stats.full.max_stamina&&(r.stats.full.stamina=r.stats.full.max_stamina),(r.stats.full.stamina_regeneration_flat||r.stats.full.stamina_regeneration_percent)&&Zi(),ms+=1,ms>=bu*ce&&(ms=0,yt()?Bn({key:gt}):Bn({key:rt}),console.log("Auto-saved the game!")),Co+=1,Co>=vu*ce){Co=0;let l;yt()?l=Bn({key:ya}):l=Bn({key:ga}),l&&En(l),console.log("Created an automatic backup!")}if(!Ci&&v&&v.light_level==="normal"&&pi()&&z({skill:p["Night vision"],xp_to_add:1}),v){let l=v.gained_skills,u=!1;for(let c=0;c<l?.length;c++)u=z({skill:v.gained_skills[c].skill,xp_to_add:v.gained_skills[c].xp})||u;u&&Ql(v)}Cn<=100/ce&&Cn>=-100/ce?ds=Cn:Cn>100/ce?ds=100/ce:Cn<-100/ce&&(ds=-100/ce),No+=1/ce,kc()},1e3/ce-ds)}function xc(){typeof v>"u"&&St({location_id:"Village",skip_travel_time:!0}),v.parent_location&&cc(),ri(),_a=Date.now(),kc()}window.equip_item=Uu;window.unequip_item=Ku;window.change_location=St;window.reload_normal_location=Ou;window.handleLocationIconClick=Mu;window.remove_location_from_favourites=mc;window.start_dialogue=Hu;window.end_dialogue=Bu;window.start_textline=Nu;window.remove_fast_travel_choice=Qa;window.start_activity=ec;window.end_activity=zo;window.start_game_action=$u;window.end_game_action=Eu;window.start_sleeping=Yo;window.end_sleeping=nc;window.start_reading=ac;window.end_reading=ys;window.start_trade=rl;window.exit_trade=dl;window.add_to_buying_list=_l;window.remove_from_buying_list=ml;window.add_to_selling_list=hl;window.remove_from_selling_list=pl;window.cancel_trade=cl;window.accept_trade=ul;window.is_in_trade=Ls;window.update_displayed_total_price=Dl;window.open_storage=yl;window.exit_storage=wl;window.move_item_to_storage=bl;window.remove_item_from_storage=vl;window.is_storage_open=kl;window.format_money=Pe;window.get_character_money=r.get_character_money;window.use_item=fc;window.change_consumable_favourite_status=Xu;window.do_enemy_combat_action=uc;window.sort_displayed_inventory=qn;window.update_displayed_character_inventory=ve;window.update_displayed_trader_inventory=jt;window.update_displayed_storage_inventory=Js;window.sort_displayed_skills=ns;window.change_stance=jn;window.fav_stance=sc;window.openCraftingWindow=Ul;window.closeCraftingWindow=Kl;window.switchCraftingRecipesPage=eo;window.switchCraftingRecipesSubpage=Jl;window.useRecipe=hc;window.updateDisplayedComponentChoice=no;window.updateDisplayedMaterialChoice=ao;window.updateRecipeTooltip=Ui;window.remove_from_content_stack=va;window.option_uniform_textsize=Fr;window.option_bed_return=zr;window.option_combat_autoswitch=Yr;window.option_remember_filters=Dr;window.option_log_all_gathering=Vr;window.option_log_gathering_result=Qr;window.option_use_uncivilised_temperature_scale=Ur;window.option_do_background_animations=Kr;window.option_skip_play_button=Jr;window.option_mofu_mofu_mode=Xr;window.option_do_enemy_onhit_animations=Zr;window.getDate=gc;window.isOnDev=yt;window.saveProgress=wc;window.save_to_file=ed;window.load_progress=td;window.loadBackup=nd;window.importOtherReleaseSave=ad;window.hardReset=sd;window.get_game_version=ja;window.run=xc;window.Verify_Game_Objects=Cr;$t("Waking up from a nyap...");Oo.addEventListener("click",xc);Oo.addEventListener("click",kr);!yt()&&rt in localStorage||yt()&&gt in localStorage||yt()&&!("skip_live_import"in localStorage)&&rt in localStorage?(id(),Te(),Xa()):(os(),ze([{item_id:"Cheap iron sword",quality:40},{item_id:"Cheap leather pants",quality:40},{item_id:"Stale bread",count:5}]),bs(0),r.money=102,fn(),Te(),as(ie,Ce,Dt),jn({stance_id:"normal"}),to(),St({location_id:"Village",skip_travel_time:!0}),le.startQuest({quest_id:"Lost memory"}));Wr?(bo(),Mr("Play...?"),vo()):($t("Waiting for you to click 'PLAY'"),bo(),vo());Xi();qn({sort_by:"name",target:"character"});C.skip_play_button&&Oo.click();yt()?(S("It looks like you are playing on the dev release. It is recommended to keep the developer console open (in Chrome/Firefox/Edge it's at F12 => 'Console' tab) in case of any errors/warnings appearing in there.","notification"),localStorage[ya]?En(JSON.parse(localStorage[ya]).saved_at):En(),localStorage[rt]?oa(JSON.parse(localStorage[rt]).saved_at||"",!0):oa(null,!0)):(localStorage[ga]?En(JSON.parse(localStorage[ga]).saved_at):En(),localStorage[gt]?oa(JSON.parse(localStorage[gt]).saved_at||""):oa());})();
//# sourceMappingURL=bundle.js.map
